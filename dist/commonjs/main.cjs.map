{
  "version": 3,
  "file": "main.cjs",
  "sources": [
    "../../src/internal/executeJsenvAsyncFunction.js",
    "../../src/internal/CONSTANTS.js",
    "../../src/internal/argUtils.js",
    "../../src/internal/import-meta/import-meta-url-commonjs.js",
    "../../src/internal/jsenvCoreDirectoryUrl.js",
    "../../src/internal/babel-plugin-replace-expressions.js",
    "../../src/internal/semantic-versioning/valueToVersion.js",
    "../../src/internal/semantic-versioning/versionCompare.js",
    "../../src/internal/semantic-versioning/versionIsBelow.js",
    "../../src/internal/semantic-versioning/findHighestVersion.js",
    "../../src/jsenvBabelPluginCompatMap.js",
    "../../src/jsenvPluginCompatMap.js",
    "../../src/internal/generateGroupMap/computeBabelPluginMapForRuntime.js",
    "../../src/internal/generateGroupMap/computeJsenvPluginMapForRuntime.js",
    "../../src/internal/generateGroupMap/groupHaveSameRequirements.js",
    "../../src/internal/generateGroupMap/generateRuntimeGroupArray.js",
    "../../src/internal/generateGroupMap/composeRuntimeCompatMap.js",
    "../../src/internal/generateGroupMap/composeGroupArray.js",
    "../../src/internal/generateGroupMap/generateAllRuntimeGroupArray.js",
    "../../src/internal/generateGroupMap/runtimeCompatMapToScore.js",
    "../../src/internal/generateGroupMap/generateGroupMap.js",
    "../../src/jsenvBrowserScoreMap.js",
    "../../src/jsenvNodeVersionScoreMap.js",
    "../../src/internal/require.js",
    "../../src/jsenvBabelPluginMap.js",
    "../../src/internal/createCallbackList.js",
    "../../src/internal/jsenvInternalFiles.js",
    "../../src/internal/compiling/transformImportmap.js",
    "../../src/internal/minimalBabelPluginArray.js",
    "../../src/internal/babel-plugin-transform-import-meta.js",
    "../../src/internal/compiling/js-compilation-service/findAsyncPluginNameInBabelPluginMap.js",
    "../../src/internal/compiling/js-compilation-service/ansiToHTML.js",
    "../../src/internal/compiling/js-compilation-service/ensureRegeneratorRuntimeImportBabelPlugin.js",
    "../../src/internal/compiling/js-compilation-service/ensureGlobalThisImportBabelPlugin.js",
    "../../src/internal/compiling/js-compilation-service/babelHelper.js",
    "../../src/internal/compiling/js-compilation-service/transformBabelHelperToImportBabelPlugin.js",
    "../../src/internal/compiling/js-compilation-service/jsenvTransform.js",
    "../../src/internal/compiling/js-compilation-service/transformJs.js",
    "../../src/internal/filePathUtils.js",
    "../../src/internal/sourceMappingURLUtils.js",
    "../../src/internal/compiling/compile-directory/compile-asset.js",
    "../../src/internal/compiling/js-compilation-service/transformResultToCompilationResult.js",
    "../../src/internal/compiling/compile-directory/fs-optimized-for-cache.js",
    "../../src/internal/compiling/compile-directory/readMeta.js",
    "../../src/internal/compiling/compile-directory/validateMeta.js",
    "../../src/internal/compiling/compile-directory/updateMeta.js",
    "../../src/internal/compiling/compile-directory/createLockRegistry.js",
    "../../src/internal/compiling/compile-directory/getOrGenerateCompiledFile.js",
    "../../src/internal/compiling/compileFile.js",
    "../../src/internal/building/js/minifyJs.js",
    "../../src/internal/building/bundleWorker.js",
    "../../src/internal/building/buildServiceWorker.js",
    "../../src/internal/fetchUrl.js",
    "../../src/internal/validateResponseStatusIsOk.js",
    "../../src/internal/renderNamePattern.js",
    "../../src/internal/compiling/compileHtml.js",
    "../../src/internal/building/sortObjectByPathnames.js",
    "../../src/internal/dataUrl.utils.js",
    "../../src/internal/building/asset-builder.util.js",
    "../../src/internal/building/parsing.utils.js",
    "../../src/internal/building/html/minifyHtml.js",
    "../../src/internal/building/svg/parseSvgAsset.js",
    "../../src/internal/building/html/parseHtmlAsset.js",
    "../../src/internal/building/importmap/parseImportmapAsset.js",
    "../../src/internal/building/css/applyPostCss.js",
    "../../src/internal/building/css/postcss-urlhash-plugin.js",
    "../../src/internal/building/css/parseCssUrls.js",
    "../../src/internal/building/css/replaceCssUrls.js",
    "../../src/internal/building/css/parseCssAsset.js",
    "../../src/internal/building/js/parseJsAsset.js",
    "../../src/internal/building/json/parseJsonAsset.js",
    "../../src/internal/building/webmanifest/parseWebmanifest.js",
    "../../src/internal/building/parseTarget.js",
    "../../src/internal/executing/ansi.js",
    "../../src/internal/building/showSourceLocation.js",
    "../../src/internal/building/isBareSpecifierForNativeNodeModule.js",
    "../../src/internal/building/fetchSourcemap.js",
    "../../src/internal/building/url-versioning.js",
    "../../src/internal/building/asset-url-versioning.js",
    "../../src/internal/building/asset-builder.js",
    "../../src/internal/building/transformImportMetaUrlReferences.js",
    "../../src/internal/building/createJsenvRollupPlugin.js",
    "../../src/internal/building/buildUsingRollup.js",
    "../../src/internal/building/buildToCompilationResult.js",
    "../../src/internal/compiling/serveBuild.js",
    "../../src/internal/compiling/createCompiledFileService.js",
    "../../src/internal/compiling/startCompileServer.js",
    "../../src/buildProject.js",
    "../../src/convertCommonJsWithBabel.js",
    "../../src/convertCommonJsWithRollup.js",
    "../../src/internal/executing/coverage/composeCoverageMap.js",
    "../../src/internal/executing/launchAndExecute.js",
    "../../src/execute.js",
    "../../src/internal/executing/coverage/babel-plugin-instrument.js",
    "../../src/internal/executing/generateFileExecutionSteps.js",
    "../../src/internal/executing/generateExecutionSteps.js",
    "../../src/internal/executing/coverage/createEmptyCoverage.js",
    "../../src/internal/executing/coverage/relativeUrlToEmptyCoverage.js",
    "../../src/internal/executing/coverage/ensureRelativePathsInCoverage.js",
    "../../src/internal/executing/coverage/reportToCoverageMap.js",
    "../../src/internal/executing/writeLog.js",
    "../../src/internal/executing/formatDuration.js",
    "../../src/internal/executing/createSummaryLog.js",
    "../../src/internal/executing/executionLogs.js",
    "../../src/internal/executing/executeConcurrently.js",
    "../../src/internal/executing/executePlan.js",
    "../../src/internal/executing/executionIsPassed.js",
    "../../src/internal/executing/coverage/generateCoverageJsonFile.js",
    "../../src/internal/executing/coverage/generateCoverageHtmlDirectory.js",
    "../../src/internal/executing/coverage/generateCoverageTextLog.js",
    "../../src/jsenvCoverageConfig.js",
    "../../src/executeTestPlan.js",
    "../../src/getBabelPluginMapForNode.js",
    "../../src/jsenvExplorableConfig.js",
    "../../src/jsenvServiceWorkerFinalizer.js",
    "../../src/internal/trackRessources.js",
    "../../src/internal/browser-launcher/trackPageToNotify.js",
    "../../src/internal/browser-launcher/createSharing.js",
    "../../src/internal/runtime/createNodeRuntime/evalSource.js",
    "../../src/internal/escapeRegexpSpecialCharacters.js",
    "../../src/internal/browser-launcher/executeHtmlFile.js",
    "../../src/launchBrowser.js",
    "../../src/internal/supportsDynamicImport.js",
    "../../src/internal/node-launcher/commandArguments.js",
    "../../src/internal/node-launcher/createChildExecArgv.js",
    "../../src/launchNode.js",
    "../../src/startExploring.js"
  ],
  "sourcesContent": [
    "import { executeAsyncFunction } from \"@jsenv/cancellation\"\n\nexport const executeJsenvAsyncFunction = (fn) =>\n  executeAsyncFunction(fn, {\n    catchCancellation: true,\n    considerUnhandledRejectionsAsExceptions: true,\n  })\n",
    "export const COMPILE_ID_BEST = \"best\"\n\nexport const COMPILE_ID_OTHERWISE = \"otherwise\"\n\nexport const COMPILE_ID_BUILD_GLOBAL = \"otherwise-build-global\"\n\nexport const COMPILE_ID_BUILD_GLOBAL_FILES = \"otherwise-build-global-files\"\n\nexport const COMPILE_ID_BUILD_COMMONJS = \"otherwise-build-commonjs\"\n\nexport const COMPILE_ID_BUILD_COMMONJS_FILES = \"otherwise-build-commonjs-files\"\n",
    "import { assertAndNormalizeDirectoryUrl, assertDirectoryPresence, urlIsInsideOf } from \"@jsenv/util\"\n\nexport const assertProjectDirectoryUrl = ({ projectDirectoryUrl }) => {\n  return assertAndNormalizeDirectoryUrl(projectDirectoryUrl)\n}\n\nexport const assertProjectDirectoryExists = ({ projectDirectoryUrl }) => {\n  assertDirectoryPresence(projectDirectoryUrl)\n}\n\nexport const assertImportMapFileRelativeUrl = ({ importMapFileRelativeUrl }) => {\n  if (importMapFileRelativeUrl === \"\") {\n    throw new TypeError(`importMapFileRelativeUrl is an empty string`)\n  }\n  if (typeof importMapFileRelativeUrl !== \"string\") {\n    throw new TypeError(\n      `importMapFileRelativeUrl must be a string, received ${importMapFileRelativeUrl}`,\n    )\n  }\n}\n\nexport const assertImportMapFileInsideProject = ({ importMapFileUrl, projectDirectoryUrl }) => {\n  if (!urlIsInsideOf(importMapFileUrl, projectDirectoryUrl)) {\n    throw new Error(`importmap file must be inside project directory\n--- import map file url ---\n${importMapFileUrl}\n--- project directory url ---\n${projectDirectoryUrl}`)\n  }\n}\n",
    "/* global __filename */\n\nconst filenameContainsBackSlashes = __filename.indexOf(\"\\\\\") > -1\n\nconst url = filenameContainsBackSlashes\n  ? `file:///${__filename.replace(/\\\\/g, \"/\")}`\n  : `file://${__filename}`\n\nexport default url\n",
    "/* global __filename */\n\nimport { fileSystemPathToUrl, resolveUrl } from \"@jsenv/util\"\n\nlet jsenvCoreDirectoryUrl\nif (typeof __filename === \"string\") {\n  jsenvCoreDirectoryUrl = resolveUrl(\n    // get ride of dist/commonjs/main.js\n    \"../../\",\n    fileSystemPathToUrl(__filename),\n  )\n} else {\n  jsenvCoreDirectoryUrl = resolveUrl(\n    // get ride of src/internal/jsenvCoreDirectoryUrl.js\n    \"../../\",\n    import.meta.url,\n  )\n}\n\nexport { jsenvCoreDirectoryUrl }\n",
    "// heavily inspired from https://github.com/jviide/babel-plugin-transform-replace-expressions\n// last known commit: 57b608e0eeb8807db53d1c68292621dfafb5599c\n\nexport const babelPluginReplaceExpressions = (api, options) => {\n  const { traverse, parse, types } = api\n  const { replaceMap = {}, allowConflictingReplacements = false } = options\n\n  const replacementMap = new Map()\n  const valueExpressionSet = new Set()\n\n  return {\n    name: \"transform-replace-expressions\",\n\n    pre: (state) => {\n      // https://github.com/babel/babel/blob/d50e78d45b608f6e0f6cc33aeb22f5db5027b153/packages/babel-traverse/src/path/replacement.js#L93\n      const parseExpression = (value) => {\n        const expressionNode = parse(value, state.opts).program.body[0].expression\n        traverse.removeProperties(expressionNode)\n        return expressionNode\n      }\n\n      Object.keys(replaceMap).forEach((key) => {\n        const keyExpressionNode = parseExpression(key)\n        const candidateArray = replacementMap.get(keyExpressionNode.type) || []\n        const value = replaceMap[key]\n        const valueExpressionNode = parseExpression(value)\n\n        const equivalentKeyExpressionIndex = candidateArray.findIndex((candidate) =>\n          types.isNodesEquivalent(candidate.keyExpressionNode, keyExpressionNode),\n        )\n        if (!allowConflictingReplacements && equivalentKeyExpressionIndex > -1) {\n          throw new Error(\n            `Expressions ${candidateArray[equivalentKeyExpressionIndex].key} and ${key} conflict`,\n          )\n        }\n\n        const newCandidate = { key, value, keyExpressionNode, valueExpressionNode }\n        if (equivalentKeyExpressionIndex > -1) {\n          candidateArray[equivalentKeyExpressionIndex] = newCandidate\n        } else {\n          candidateArray.push(newCandidate)\n        }\n        replacementMap.set(keyExpressionNode.type, candidateArray)\n      })\n\n      replacementMap.forEach((candidateArray) => {\n        candidateArray.forEach((candidate) => {\n          valueExpressionSet.add(candidate.valueExpressionNode)\n        })\n      })\n    },\n    visitor: {\n      Expression(path) {\n        if (valueExpressionSet.has(path.node)) {\n          path.skip()\n          return\n        }\n\n        const candidateArray = replacementMap.get(path.node.type)\n        if (!candidateArray) {\n          return\n        }\n\n        const candidateFound = candidateArray.find((candidate) => {\n          return types.isNodesEquivalent(candidate.keyExpressionNode, path.node)\n        })\n        if (candidateFound) {\n          try {\n            types.validate(path.parent, path.key, candidateFound.valueExpressionNode)\n          } catch (err) {\n            if (!(err instanceof TypeError)) {\n              throw err\n            }\n            path.skip()\n            return\n          }\n\n          path.replaceWith(candidateFound.valueExpressionNode)\n          return\n        }\n      },\n    },\n  }\n}\n",
    "export const valueToVersion = (value) => {\n  if (typeof value === \"number\") {\n    return numberToVersion(value)\n  }\n\n  if (typeof value === \"string\") {\n    return stringToVersion(value)\n  }\n\n  throw new TypeError(createValueErrorMessage({ version: value }))\n}\n\nconst numberToVersion = (number) => {\n  return {\n    major: number,\n    minor: 0,\n    patch: 0,\n  }\n}\n\nconst stringToVersion = (string) => {\n  if (string.indexOf(\".\") > -1) {\n    const parts = string.split(\".\")\n    return {\n      major: Number(parts[0]),\n      minor: parts[1] ? Number(parts[1]) : 0,\n      patch: parts[2] ? Number(parts[2]) : 0,\n    }\n  }\n\n  if (isNaN(string)) {\n    return {\n      major: 0,\n      minor: 0,\n      patch: 0,\n    }\n  }\n\n  return {\n    major: Number(string),\n    minor: 0,\n    patch: 0,\n  }\n}\n\nconst createValueErrorMessage = ({ value }) => `value must be a number or a string.\nvalue: ${value}`\n",
    "import { valueToVersion } from \"./valueToVersion.js\"\n\nexport const versionCompare = (versionA, versionB) => {\n  const semanticVersionA = valueToVersion(versionA)\n  const semanticVersionB = valueToVersion(versionB)\n\n  const majorDiff = semanticVersionA.major - semanticVersionB.major\n  if (majorDiff > 0) {\n    return majorDiff\n  }\n  if (majorDiff < 0) {\n    return majorDiff\n  }\n\n  const minorDiff = semanticVersionA.minor - semanticVersionB.minor\n  if (minorDiff > 0) {\n    return minorDiff\n  }\n  if (minorDiff < 0) {\n    return minorDiff\n  }\n\n  const patchDiff = semanticVersionA.patch - semanticVersionB.patch\n  if (patchDiff > 0) {\n    return patchDiff\n  }\n  if (patchDiff < 0) {\n    return patchDiff\n  }\n\n  return 0\n}\n",
    "import { versionCompare } from \"./versionCompare.js\"\n\nexport const versionIsBelow = (versionSupposedBelow, versionSupposedAbove) => {\n  return versionCompare(versionSupposedBelow, versionSupposedAbove) < 0\n}\n",
    "import { versionIsBelow } from \"./versionIsBelow.js\"\n\nexport const findHighestVersion = (...values) => {\n  if (values.length === 0) throw new Error(`missing argument`)\n\n  return values.reduce((highestVersion, value) => {\n    if (versionIsBelow(highestVersion, value)) {\n      return value\n    }\n    return highestVersion\n  })\n}\n",
    "// copied from\n// https://github.com/babel/babel/blob/master/packages/babel-compat-data/data/plugins.json#L1\n// now moved at https://github.com/babel/babel/blob/548cb3ee89552ffc08ee5625b084bd33f8107530/packages/babel-compat-data/data/plugins.json#L1\n// Because this is an hidden implementation detail of @babel/preset-env\n// it could be deprecated or moved anytime.\n// For that reason it makes more sens to have it inlined here\n// than importing it from an undocumented location.\n// Ideally it would be documented or a separate module\n\nexport const jsenvBabelPluginCompatMap = {\n  \"proposal-numeric-separator\": {\n    chrome: \"75\",\n    edge: \"79\",\n    firefox: \"70\",\n    safari: \"13\",\n    node: \"12.5\",\n    ios: \"13\",\n    opera: \"62\",\n    electron: \"6.1\",\n  },\n  \"proposal-nullish-coalescing-operator\": {\n    chrome: \"80\",\n    edge: \"80\",\n    firefox: \"72\",\n    safari: \"13.1\",\n    opera: \"67\",\n    electron: \"8.1\",\n  },\n  \"proposal-optional-chaining\": {\n    chrome: \"80\",\n    edge: \"80\",\n    firefox: \"74\",\n    safari: \"13.1\",\n    opera: \"67\",\n    electron: \"8.1\",\n  },\n  \"proposal-json-strings\": {\n    chrome: \"66\",\n    edge: \"79\",\n    firefox: \"62\",\n    safari: \"12\",\n    node: \"10\",\n    ios: \"12\",\n    samsung: \"9\",\n    opera: \"53\",\n    electron: \"3.1\",\n  },\n  \"proposal-optional-catch-binding\": {\n    chrome: \"66\",\n    edge: \"79\",\n    firefox: \"58\",\n    safari: \"11.1\",\n    node: \"10\",\n    ios: \"11.3\",\n    samsung: \"9\",\n    opera: \"53\",\n    electron: \"3.1\",\n  },\n  \"proposal-async-generator-functions\": {\n    chrome: \"63\",\n    edge: \"79\",\n    firefox: \"57\",\n    safari: \"12\",\n    node: \"10\",\n    ios: \"12\",\n    samsung: \"8\",\n    opera: \"50\",\n    electron: \"3.1\",\n  },\n  \"proposal-object-rest-spread\": {\n    chrome: \"60\",\n    edge: \"79\",\n    firefox: \"55\",\n    safari: \"11.1\",\n    node: \"8.3\",\n    ios: \"11.3\",\n    samsung: \"8\",\n    opera: \"47\",\n    electron: \"2.1\",\n  },\n  \"transform-dotall-regex\": {\n    chrome: \"62\",\n    edge: \"79\",\n    safari: \"11.1\",\n    node: \"8.10\",\n    ios: \"11.3\",\n    samsung: \"8\",\n    opera: \"49\",\n    electron: \"3.1\",\n  },\n  \"proposal-unicode-property-regex\": {\n    chrome: \"64\",\n    edge: \"79\",\n    safari: \"11.1\",\n    node: \"10\",\n    ios: \"11.3\",\n    samsung: \"9\",\n    opera: \"51\",\n    electron: \"3.1\",\n  },\n  \"transform-named-capturing-groups-regex\": {\n    chrome: \"64\",\n    edge: \"79\",\n    safari: \"11.1\",\n    node: \"10\",\n    ios: \"11.3\",\n    samsung: \"9\",\n    opera: \"51\",\n    electron: \"3.1\",\n  },\n  // copy of transform-async-to-generator\n  // so that async is not transpiled when supported\n  \"transform-async-to-promises\": {\n    chrome: \"55\",\n    edge: \"15\",\n    firefox: \"52\",\n    safari: \"11\",\n    node: \"7.6\",\n    ios: \"11\",\n    samsung: \"6\",\n    opera: \"42\",\n    electron: \"1.6\",\n  },\n  \"transform-async-to-generator\": {\n    chrome: \"55\",\n    edge: \"15\",\n    firefox: \"52\",\n    safari: \"11\",\n    node: \"7.6\",\n    ios: \"11\",\n    samsung: \"6\",\n    opera: \"42\",\n    electron: \"1.6\",\n  },\n  \"transform-exponentiation-operator\": {\n    chrome: \"52\",\n    edge: \"14\",\n    firefox: \"52\",\n    safari: \"10.1\",\n    node: \"7\",\n    ios: \"10.3\",\n    samsung: \"6\",\n    opera: \"39\",\n    electron: \"1.3\",\n  },\n  \"transform-template-literals\": {\n    chrome: \"41\",\n    edge: \"13\",\n    firefox: \"34\",\n    safari: \"13\",\n    node: \"4\",\n    ios: \"13\",\n    samsung: \"3.4\",\n    opera: \"28\",\n    electron: \"0.24\",\n  },\n  \"transform-literals\": {\n    chrome: \"44\",\n    edge: \"12\",\n    firefox: \"53\",\n    safari: \"9\",\n    node: \"4\",\n    ios: \"9\",\n    samsung: \"4\",\n    opera: \"31\",\n    electron: \"0.31\",\n  },\n  \"transform-function-name\": {\n    chrome: \"51\",\n    edge: \"79\",\n    firefox: \"53\",\n    safari: \"10\",\n    node: \"6.5\",\n    ios: \"10\",\n    samsung: \"5\",\n    opera: \"38\",\n    electron: \"1.2\",\n  },\n  \"transform-arrow-functions\": {\n    chrome: \"47\",\n    edge: \"13\",\n    firefox: \"45\",\n    safari: \"10\",\n    node: \"6\",\n    ios: \"10\",\n    samsung: \"5\",\n    opera: \"34\",\n    electron: \"0.36\",\n  },\n  \"transform-block-scoped-functions\": {\n    chrome: \"41\",\n    edge: \"12\",\n    firefox: \"46\",\n    safari: \"10\",\n    node: \"4\",\n    ie: \"11\",\n    ios: \"10\",\n    samsung: \"3.4\",\n    opera: \"28\",\n    electron: \"0.24\",\n  },\n  \"transform-classes\": {\n    chrome: \"46\",\n    edge: \"13\",\n    firefox: \"45\",\n    safari: \"10\",\n    node: \"5\",\n    ios: \"10\",\n    samsung: \"5\",\n    opera: \"33\",\n    electron: \"0.36\",\n  },\n  \"transform-object-super\": {\n    chrome: \"46\",\n    edge: \"13\",\n    firefox: \"45\",\n    safari: \"10\",\n    node: \"5\",\n    ios: \"10\",\n    samsung: \"5\",\n    opera: \"33\",\n    electron: \"0.36\",\n  },\n  \"transform-shorthand-properties\": {\n    chrome: \"43\",\n    edge: \"12\",\n    firefox: \"33\",\n    safari: \"9\",\n    node: \"4\",\n    ios: \"9\",\n    samsung: \"4\",\n    opera: \"30\",\n    electron: \"0.29\",\n  },\n  \"transform-duplicate-keys\": {\n    chrome: \"42\",\n    edge: \"12\",\n    firefox: \"34\",\n    safari: \"9\",\n    node: \"4\",\n    ios: \"9\",\n    samsung: \"3.4\",\n    opera: \"29\",\n    electron: \"0.27\",\n  },\n  \"transform-computed-properties\": {\n    chrome: \"44\",\n    edge: \"12\",\n    firefox: \"34\",\n    safari: \"7.1\",\n    node: \"4\",\n    ios: \"8\",\n    samsung: \"4\",\n    opera: \"31\",\n    electron: \"0.31\",\n  },\n  \"transform-for-of\": {\n    chrome: \"51\",\n    edge: \"15\",\n    firefox: \"53\",\n    safari: \"10\",\n    node: \"6.5\",\n    ios: \"10\",\n    samsung: \"5\",\n    opera: \"38\",\n    electron: \"1.2\",\n  },\n  \"transform-sticky-regex\": {\n    chrome: \"49\",\n    edge: \"13\",\n    firefox: \"3\",\n    safari: \"10\",\n    node: \"6\",\n    ios: \"10\",\n    samsung: \"5\",\n    opera: \"36\",\n    electron: \"1\",\n  },\n  \"transform-unicode-regex\": {\n    chrome: \"50\",\n    edge: \"13\",\n    firefox: \"46\",\n    safari: \"12\",\n    node: \"6\",\n    ios: \"12\",\n    samsung: \"5\",\n    opera: \"37\",\n    electron: \"1.1\",\n  },\n  \"transform-spread\": {\n    chrome: \"46\",\n    edge: \"13\",\n    firefox: \"36\",\n    safari: \"10\",\n    node: \"5\",\n    ios: \"10\",\n    samsung: \"5\",\n    opera: \"33\",\n    electron: \"0.36\",\n  },\n  \"transform-parameters\": {\n    chrome: \"49\",\n    edge: \"18\",\n    firefox: \"53\",\n    safari: \"10\",\n    node: \"6\",\n    ios: \"10\",\n    samsung: \"5\",\n    opera: \"36\",\n    electron: \"1\",\n  },\n  \"transform-destructuring\": {\n    chrome: \"51\",\n    edge: \"15\",\n    firefox: \"53\",\n    safari: \"10\",\n    node: \"6.5\",\n    ios: \"10\",\n    samsung: \"5\",\n    opera: \"38\",\n    electron: \"1.2\",\n  },\n  \"transform-block-scoping\": {\n    chrome: \"49\",\n    edge: \"14\",\n    firefox: \"51\",\n    safari: \"11\",\n    node: \"6\",\n    ios: \"11\",\n    samsung: \"5\",\n    opera: \"36\",\n    electron: \"1\",\n  },\n  \"transform-typeof-symbol\": {\n    chrome: \"38\",\n    edge: \"12\",\n    firefox: \"36\",\n    safari: \"9\",\n    node: \"0.12\",\n    ios: \"9\",\n    samsung: \"3\",\n    opera: \"25\",\n    electron: \"0.2\",\n  },\n  \"transform-new-target\": {\n    chrome: \"46\",\n    edge: \"14\",\n    firefox: \"41\",\n    safari: \"10\",\n    node: \"5\",\n    ios: \"10\",\n    samsung: \"5\",\n    opera: \"33\",\n    electron: \"0.36\",\n  },\n  \"transform-regenerator\": {\n    chrome: \"50\",\n    edge: \"13\",\n    firefox: \"53\",\n    safari: \"10\",\n    node: \"6\",\n    ios: \"10\",\n    samsung: \"5\",\n    opera: \"37\",\n    electron: \"1.1\",\n  },\n  \"transform-member-expression-literals\": {\n    chrome: \"7\",\n    opera: \"12\",\n    edge: \"12\",\n    firefox: \"2\",\n    safari: \"5.1\",\n    node: \"0.10\",\n    ie: \"9\",\n    android: \"4\",\n    ios: \"6\",\n    phantom: \"2\",\n    samsung: \"1\",\n    electron: \"5\",\n  },\n  \"transform-property-literals\": {\n    chrome: \"7\",\n    opera: \"12\",\n    edge: \"12\",\n    firefox: \"2\",\n    safari: \"5.1\",\n    node: \"0.10\",\n    ie: \"9\",\n    android: \"4\",\n    ios: \"6\",\n    phantom: \"2\",\n    samsung: \"1\",\n    electron: \"5\",\n  },\n  \"transform-reserved-words\": {\n    chrome: \"13\",\n    opera: \"10.50\",\n    edge: \"12\",\n    firefox: \"2\",\n    safari: \"3.1\",\n    node: \"0.10\",\n    ie: \"9\",\n    android: \"4.4\",\n    ios: \"6\",\n    phantom: \"2\",\n    samsung: \"1\",\n    electron: \"0.2\",\n  },\n}\n",
    "// we could reuse this to get a list of polyfill\n// using https://github.com/babel/babel/blob/master/packages/babel-preset-env/data/built-ins.json#L1\n// adding a featureNameArray to every group\n// and according to that featureNameArray, add these polyfill\n// to the generated build\n\nexport const jsenvPluginCompatMap = {}\n",
    "import { findHighestVersion } from \"../semantic-versioning/index.js\"\nimport { jsenvBabelPluginCompatMap } from \"../../jsenvBabelPluginCompatMap.js\"\n\nexport const computeBabelPluginMapForRuntime = ({\n  babelPluginMap,\n  babelPluginCompatMap = jsenvBabelPluginCompatMap,\n  runtimeName,\n  runtimeVersion,\n}) => {\n  if (typeof babelPluginMap !== \"object\") {\n    throw new TypeError(`babelPluginMap must be an object, got ${babelPluginMap}`)\n  }\n  if (typeof babelPluginCompatMap !== \"object\") {\n    throw new TypeError(`babelPluginCompatMap must be an object, got ${babelPluginCompatMap}`)\n  }\n  if (typeof runtimeName !== \"string\") {\n    throw new TypeError(`runtimeName must be a string, got ${runtimeName}`)\n  }\n  if (typeof runtimeVersion !== \"string\") {\n    throw new TypeError(`runtimeVersion must be a string, got ${runtimeVersion}`)\n  }\n\n  const babelPluginMapForRuntime = {}\n  Object.keys(babelPluginMap).forEach((key) => {\n    const compatible = runtimeIsCompatibleWithFeature({\n      runtimeName,\n      runtimeVersion,\n      runtimeCompatMap: key in babelPluginCompatMap ? babelPluginCompatMap[key] : {},\n    })\n    if (!compatible) {\n      babelPluginMapForRuntime[key] = babelPluginMap[key]\n    }\n  })\n  return babelPluginMapForRuntime\n}\n\nconst runtimeIsCompatibleWithFeature = ({ runtimeName, runtimeVersion, runtimeCompatMap }) => {\n  const runtimeCompatibleVersion = computeRuntimeCompatibleVersion({\n    runtimeCompatMap,\n    runtimeName,\n  })\n  const highestVersion = findHighestVersion(runtimeVersion, runtimeCompatibleVersion)\n  return highestVersion === runtimeVersion\n}\n\nconst computeRuntimeCompatibleVersion = ({ runtimeCompatMap, runtimeName }) => {\n  return runtimeName in runtimeCompatMap ? runtimeCompatMap[runtimeName] : \"Infinity\"\n}\n",
    "import { findHighestVersion } from \"../semantic-versioning/index.js\"\nimport { jsenvPluginCompatMap as jsenvPluginCompatMapFallback } from \"../../jsenvPluginCompatMap.js\"\n\nexport const computeJsenvPluginMapForRuntime = ({\n  jsenvPluginMap,\n  jsenvPluginCompatMap = jsenvPluginCompatMapFallback,\n  runtimeName,\n  runtimeVersion,\n}) => {\n  if (typeof jsenvPluginMap !== \"object\") {\n    throw new TypeError(`jsenvPluginMap must be a object, got ${jsenvPluginMap}`)\n  }\n  if (typeof jsenvPluginCompatMap !== \"object\") {\n    throw new TypeError(`jsenvPluginCompatMap must be a string, got ${jsenvPluginCompatMap}`)\n  }\n  if (typeof runtimeName !== \"string\") {\n    throw new TypeError(`runtimeName must be a string, got ${runtimeName}`)\n  }\n  if (typeof runtimeVersion !== \"string\") {\n    throw new TypeError(`runtimeVersion must be a string, got ${runtimeVersion}`)\n  }\n\n  const jsenvPluginMapForRuntime = {}\n  Object.keys(jsenvPluginMap).forEach((key) => {\n    const compatible = runtimeIsCompatibleWithFeature({\n      runtimeName,\n      runtimeVersion,\n      featureCompat: key in jsenvPluginCompatMap ? jsenvPluginCompatMap[key] : {},\n    })\n    if (!compatible) {\n      jsenvPluginMapForRuntime[key] = jsenvPluginMap[key]\n    }\n  })\n  return jsenvPluginMapForRuntime\n}\n\nconst runtimeIsCompatibleWithFeature = ({ runtimeName, runtimeVersion, featureCompat }) => {\n  const runtimeCompatibleVersion = computeRuntimeCompatibleVersion({\n    featureCompat,\n    runtimeName,\n  })\n  const highestVersion = findHighestVersion(runtimeVersion, runtimeCompatibleVersion)\n  return highestVersion === runtimeVersion\n}\n\nconst computeRuntimeCompatibleVersion = ({ featureCompat, runtimeName }) => {\n  return runtimeName in featureCompat ? featureCompat[runtimeName] : \"Infinity\"\n}\n",
    "export const groupHaveSameRequirements = (leftGroup, rightGroup) => {\n  return (\n    leftGroup.babelPluginRequiredNameArray.join(\"\") ===\n      rightGroup.babelPluginRequiredNameArray.join(\"\") &&\n    leftGroup.jsenvPluginRequiredNameArray.join(\"\") ===\n      rightGroup.jsenvPluginRequiredNameArray.join(\"\")\n  )\n}\n",
    "import { findHighestVersion, versionCompare } from \"../semantic-versioning/index.js\"\nimport { jsenvBabelPluginCompatMap } from \"../../jsenvBabelPluginCompatMap.js\"\nimport { jsenvPluginCompatMap as jsenvPluginCompatMapFallback } from \"../../jsenvPluginCompatMap.js\"\nimport { computeBabelPluginMapForRuntime } from \"./computeBabelPluginMapForRuntime.js\"\nimport { computeJsenvPluginMapForRuntime } from \"./computeJsenvPluginMapForRuntime.js\"\nimport { groupHaveSameRequirements } from \"./groupHaveSameRequirements.js\"\n\nexport const generateRuntimeGroupArray = ({\n  babelPluginMap,\n  jsenvPluginMap,\n  babelPluginCompatMap = jsenvBabelPluginCompatMap,\n  jsenvPluginCompatMap = jsenvPluginCompatMapFallback,\n  runtimeName,\n}) => {\n  const versionArray = []\n  Object.keys(babelPluginMap).forEach((babelPluginKey) => {\n    if (babelPluginKey in babelPluginCompatMap) {\n      const babelPluginCompat = babelPluginCompatMap[babelPluginKey]\n      if (runtimeName in babelPluginCompat) {\n        const version = String(babelPluginCompat[runtimeName])\n        if (!versionArray.includes(version)) {\n          versionArray.push(version)\n        }\n      }\n    }\n  })\n  Object.keys(jsenvPluginMap).forEach((jsenvPluginKey) => {\n    if (jsenvPluginKey in jsenvPluginCompatMap) {\n      const jsenvPluginCompat = jsenvPluginCompatMap[jsenvPluginKey]\n      if (runtimeName in jsenvPluginCompat) {\n        const version = String(jsenvPluginCompat[runtimeName])\n        if (!versionArray.includes(version)) {\n          versionArray.push(version)\n        }\n      }\n    }\n  })\n  versionArray.push(\"0.0.0\")\n  versionArray.sort(versionCompare)\n\n  const runtimeGroupArray = []\n\n  versionArray.forEach((version) => {\n    const babelPluginMapForRuntime = computeBabelPluginMapForRuntime({\n      babelPluginMap,\n      babelPluginCompatMap,\n      runtimeName,\n      runtimeVersion: version,\n    })\n    const babelPluginRequiredNameArray = Object.keys(babelPluginMap)\n      .filter((babelPluginKey) => babelPluginKey in babelPluginMapForRuntime)\n      .sort()\n    const jsenvPluginMapForRuntime = computeJsenvPluginMapForRuntime({\n      jsenvPluginMap,\n      jsenvPluginCompatMap,\n      runtimeName,\n      runtimeVersion: version,\n    })\n    const jsenvPluginRequiredNameArray = Object.keys(jsenvPluginMap)\n      .filter((jsenvPluginKey) => jsenvPluginKey in jsenvPluginMapForRuntime)\n      .sort()\n\n    const group = {\n      babelPluginRequiredNameArray,\n      jsenvPluginRequiredNameArray,\n      runtimeCompatMap: {\n        [runtimeName]: version,\n      },\n    }\n\n    const groupWithSameRequirements = runtimeGroupArray.find((runtimeGroupCandidate) =>\n      groupHaveSameRequirements(runtimeGroupCandidate, group),\n    )\n\n    if (groupWithSameRequirements) {\n      groupWithSameRequirements.runtimeCompatMap[runtimeName] = findHighestVersion(\n        groupWithSameRequirements.runtimeCompatMap[runtimeName],\n        version,\n      )\n    } else {\n      runtimeGroupArray.push(group)\n    }\n  })\n\n  return runtimeGroupArray\n}\n",
    "import { findHighestVersion } from \"../semantic-versioning/index.js\"\n\nexport const composeRuntimeCompatMap = (runtimeCompatMap, secondRuntimeCompatMap) => {\n  return objectComposeValue(\n    normalizeRuntimeCompatMapVersions(runtimeCompatMap),\n    normalizeRuntimeCompatMapVersions(secondRuntimeCompatMap),\n    (version, secondVersion) => findHighestVersion(version, secondVersion),\n  )\n}\n\nconst normalizeRuntimeCompatMapVersions = (runtimeCompatibility) => {\n  return objectMapValue(runtimeCompatibility, (version) => String(version))\n}\n\nconst objectMapValue = (object, callback) => {\n  const mapped = {}\n\n  Object.keys(object).forEach((key) => {\n    mapped[key] = callback(object[key], key, object)\n  })\n\n  return mapped\n}\n\nconst objectComposeValue = (previous, object, callback) => {\n  const composed = { ...previous }\n\n  Object.keys(object).forEach((key) => {\n    composed[key] = key in composed ? callback(composed[key], object[key]) : object[key]\n  })\n\n  return composed\n}\n",
    "import { composeRuntimeCompatMap } from \"./composeRuntimeCompatMap.js\"\nimport { groupHaveSameRequirements } from \"./groupHaveSameRequirements.js\"\n\nexport const composeGroupArray = (...arrayOfGroupArray) => {\n  return arrayOfGroupArray.reduce(groupArrayReducer, [])\n}\n\nconst groupArrayReducer = (previousGroupArray, groupArray) => {\n  const reducedGroupArray = []\n\n  previousGroupArray.forEach((group) => {\n    reducedGroupArray.push(copyGroup(group))\n  })\n\n  groupArray.forEach((group) => {\n    const groupWithSameRequirements = reducedGroupArray.find((existingGroupCandidate) =>\n      groupHaveSameRequirements(group, existingGroupCandidate),\n    )\n    if (groupWithSameRequirements) {\n      groupWithSameRequirements.runtimeCompatMap = composeRuntimeCompatMap(\n        groupWithSameRequirements.runtimeCompatMap,\n        group.runtimeCompatMap,\n      )\n    } else {\n      reducedGroupArray.push(copyGroup(group))\n    }\n  })\n\n  return reducedGroupArray\n}\n\nconst copyGroup = ({\n  babelPluginRequiredNameArray,\n  jsenvPluginRequiredNameArray,\n  runtimeCompatMap,\n}) => {\n  return {\n    babelPluginRequiredNameArray: babelPluginRequiredNameArray.slice(),\n    jsenvPluginRequiredNameArray: jsenvPluginRequiredNameArray.slice(),\n    runtimeCompatMap: { ...runtimeCompatMap },\n  }\n}\n",
    "import { generateRuntimeGroupArray } from \"./generateRuntimeGroupArray.js\"\nimport { composeGroupArray } from \"./composeGroupArray.js\"\n\nexport const generateAllRuntimeGroupArray = ({\n  babelPluginMap,\n  jsenvPluginMap,\n  babelPluginCompatMap,\n  jsenvPluginCompatMap,\n  runtimeNames,\n}) => {\n  const arrayOfGroupArray = runtimeNames.map((runtimeName) =>\n    generateRuntimeGroupArray({\n      babelPluginMap,\n      jsenvPluginMap,\n      babelPluginCompatMap,\n      jsenvPluginCompatMap,\n      runtimeName,\n    }),\n  )\n  const groupArray = composeGroupArray(...arrayOfGroupArray)\n  return groupArray\n}\n",
    "import { versionCompare, findHighestVersion } from \"../semantic-versioning/index.js\"\n\nexport const runtimeCompatMapToScore = (runtimeCompatMap, runtimeScoreMap) => {\n  return Object.keys(runtimeCompatMap).reduce((previous, runtimeName) => {\n    const runtimeVersion = runtimeCompatMap[runtimeName]\n    return previous + runtimeToScore(runtimeName, runtimeVersion, runtimeScoreMap)\n  }, 0)\n}\n\nconst runtimeToScore = (runtimeName, runtimeVersion, runtimeScoreMap) => {\n  if (runtimeName in runtimeScoreMap === false) return runtimeScoreMap.other || 0\n\n  const versionUsageMap = runtimeScoreMap[runtimeName]\n  const versionArray = Object.keys(versionUsageMap)\n  if (versionArray.length === 0) return runtimeScoreMap.other || 0\n\n  const versionArrayAscending = versionArray.sort(versionCompare)\n  const highestVersion = versionArrayAscending[versionArray.length - 1]\n\n  if (findHighestVersion(runtimeVersion, highestVersion) === runtimeVersion)\n    return versionUsageMap[highestVersion]\n\n  const closestVersion = versionArrayAscending\n    .reverse()\n    .find((version) => findHighestVersion(runtimeVersion, version) === runtimeVersion)\n\n  if (!closestVersion) return runtimeScoreMap.other || 0\n\n  return versionUsageMap[closestVersion]\n}\n",
    "/*\n\n# featureCompatMap legend\n\n        featureName\n             │\n{ ┌──────────┴────────────┐\n  \"transform-block-scoping\": {─┐\n    \"chrome\": \"10\",            │\n    \"safari\": \"3.0\",           runTimeCompatMap\n    \"firefox\": \"5.1\"           │\n}────┼─────────┼───────────────┘\n}    │         └─────┐\n  runtimeName  runtimeVersion\n\n# group legend\n\n{\n  \"best\": {\n    \"babelPluginRequiredNameArray\" : [\n      \"transform-block-scoping\",\n    ],\n    \"runtimeCompatMap\": {\n      \"chrome\": \"10\",\n      \"firefox\": \"6\"\n    }\n  }\n}\n\nTake chars below to update legends\n─│┌┐└┘├┤┴┬\n\n*/\n\nimport { COMPILE_ID_OTHERWISE, COMPILE_ID_BEST } from \"../CONSTANTS.js\"\nimport { generateAllRuntimeGroupArray } from \"./generateAllRuntimeGroupArray.js\"\nimport { runtimeCompatMapToScore } from \"./runtimeCompatMapToScore.js\"\n\nexport const generateGroupMap = ({\n  babelPluginMap,\n  // jsenv plugin are for later, for now, nothing is using them\n  jsenvPluginMap = {},\n  babelPluginCompatMap,\n  jsenvPluginCompatMap,\n  runtimeScoreMap,\n  groupCount = 1,\n  // pass this to true if you don't care if someone tries to run your code\n  // on a runtime which is not inside runtimeScoreMap.\n  runtimeAlwaysInsideRuntimeScoreMap = false,\n  // pass this to true if you think you will always be able to detect\n  // the runtime or that if you fail to do so you don't care.\n  runtimeWillAlwaysBeKnown = false,\n}) => {\n  if (typeof babelPluginMap !== \"object\") {\n    throw new TypeError(`babelPluginMap must be an object, got ${babelPluginMap}`)\n  }\n  if (typeof jsenvPluginMap !== \"object\") {\n    throw new TypeError(`jsenvPluginMap must be an object, got ${jsenvPluginMap}`)\n  }\n  if (typeof runtimeScoreMap !== \"object\") {\n    throw new TypeError(`runtimeScoreMap must be an object, got ${runtimeScoreMap}`)\n  }\n  if (typeof groupCount < 1) {\n    throw new TypeError(`groupCount must be above 1, got ${groupCount}`)\n  }\n\n  const groupWithoutFeature = {\n    babelPluginRequiredNameArray: Object.keys(babelPluginMap),\n    jsenvPluginRequiredNameArray: Object.keys(jsenvPluginMap),\n    runtimeCompatMap: {},\n  }\n\n  // when we create one group and we cannot ensure\n  // code will be runned on a runtime inside runtimeScoreMap\n  // then we return otherwise group to be safe\n  if (groupCount === 1 && !runtimeAlwaysInsideRuntimeScoreMap) {\n    return {\n      [COMPILE_ID_OTHERWISE]: groupWithoutFeature,\n    }\n  }\n\n  const allRuntimeGroupArray = generateAllRuntimeGroupArray({\n    babelPluginMap,\n    babelPluginCompatMap,\n    jsenvPluginMap,\n    jsenvPluginCompatMap,\n    runtimeNames: arrayWithoutValue(Object.keys(runtimeScoreMap), \"other\"),\n  })\n\n  if (allRuntimeGroupArray.length === 0) {\n    return {\n      [COMPILE_ID_OTHERWISE]: groupWithoutFeature,\n    }\n  }\n\n  const groupToScore = ({ runtimeCompatMap }) =>\n    runtimeCompatMapToScore(runtimeCompatMap, runtimeScoreMap)\n\n  const allRuntimeGroupArraySortedByScore = allRuntimeGroupArray.sort(\n    (a, b) => groupToScore(b) - groupToScore(a),\n  )\n\n  const length = allRuntimeGroupArraySortedByScore.length\n\n  // if we arrive here and want a single group\n  // we take the worst group and consider it's our best group\n  // because it's the lowest runtime we want to support\n  if (groupCount === 1) {\n    return {\n      [COMPILE_ID_BEST]: allRuntimeGroupArraySortedByScore[length - 1],\n    }\n  }\n\n  const addOtherwiseToBeSafe = !runtimeAlwaysInsideRuntimeScoreMap || !runtimeWillAlwaysBeKnown\n\n  const lastGroupIndex = addOtherwiseToBeSafe ? groupCount - 1 : groupCount\n\n  const groupArray =\n    length + 1 > groupCount\n      ? allRuntimeGroupArraySortedByScore.slice(0, lastGroupIndex)\n      : allRuntimeGroupArraySortedByScore\n\n  const groupMap = {}\n  groupArray.forEach((group, index) => {\n    if (index === 0) {\n      groupMap[COMPILE_ID_BEST] = group\n    } else {\n      groupMap[`intermediate-${index + 1}`] = group\n    }\n  })\n  if (addOtherwiseToBeSafe) {\n    groupMap[COMPILE_ID_OTHERWISE] = groupWithoutFeature\n  }\n\n  return groupMap\n}\n\nconst arrayWithoutValue = (array, value) =>\n  array.filter((valueCandidate) => valueCandidate !== value)\n",
    "// https://www.statista.com/statistics/268299/most-popular-internet-browsers/\n// this source of stat is what I found in 5min\n// we could improve these default usage score using better stats\n// and keep in mind this should be updated time to time or even better\n// come from a project specific audience\n\nexport const jsenvBrowserScoreMap = {\n  android: 0.001,\n  chrome: {\n    \"71\": 0.3,\n    \"69\": 0.19,\n    \"0\": 0.01, // it means oldest version of chrome will get a score of 0.01\n  },\n  firefox: {\n    \"61\": 0.3,\n  },\n  edge: {\n    \"12\": 0.1,\n  },\n  electron: 0.001,\n  ios: 0.001,\n  opera: 0.001,\n  other: 0.001,\n  safari: {\n    \"10\": 0.1,\n  },\n}\n",
    "// https://nodejs.org/metrics/summaries/version/nodejs.org-access.log.csv\nexport const jsenvNodeVersionScoreMap = {\n  \"0.10\": 0.02,\n  \"0.12\": 0.01,\n  4: 0.1,\n  6: 0.25,\n  7: 0.1,\n  8: 1,\n  9: 0.1,\n  10: 0.5,\n  11: 0.25,\n}\n",
    "import { createRequire } from \"module\"\n\nexport const require = createRequire(import.meta.url)\n",
    "/* eslint-disable import/max-dependencies */\n\nimport { require } from \"./internal/require.js\"\n\nconst proposalJSONStrings = require(\"@babel/plugin-proposal-json-strings\")\nconst proposalNumericSeparator = require(\"@babel/plugin-proposal-numeric-separator\")\nconst proposalObjectRestSpread = require(\"@babel/plugin-proposal-object-rest-spread\")\nconst proposalOptionalCatchBinding = require(\"@babel/plugin-proposal-optional-catch-binding\")\nconst proposalOptionalChaining = require(\"@babel/plugin-proposal-optional-chaining\")\nconst proposalUnicodePropertyRegex = require(\"@babel/plugin-proposal-unicode-property-regex\")\nconst syntaxObjectRestSpread = require(\"@babel/plugin-syntax-object-rest-spread\")\nconst syntaxOptionalCatchBinding = require(\"@babel/plugin-syntax-optional-catch-binding\")\nconst transformArrowFunction = require(\"@babel/plugin-transform-arrow-functions\")\nconst transformAsyncToPromises = require(\"babel-plugin-transform-async-to-promises\")\nconst transformBlockScopedFunctions = require(\"@babel/plugin-transform-block-scoped-functions\")\nconst transformBlockScoping = require(\"@babel/plugin-transform-block-scoping\")\nconst transformClasses = require(\"@babel/plugin-transform-classes\")\nconst transformComputedProperties = require(\"@babel/plugin-transform-computed-properties\")\nconst transformDestructuring = require(\"@babel/plugin-transform-destructuring\")\nconst transformDotAllRegex = require(\"@babel/plugin-transform-dotall-regex\")\nconst transformDuplicateKeys = require(\"@babel/plugin-transform-duplicate-keys\")\nconst transformExponentiationOperator = require(\"@babel/plugin-transform-exponentiation-operator\")\nconst transformForOf = require(\"@babel/plugin-transform-for-of\")\nconst transformFunctionName = require(\"@babel/plugin-transform-function-name\")\nconst transformLiterals = require(\"@babel/plugin-transform-literals\")\nconst transformNewTarget = require(\"@babel/plugin-transform-new-target\")\nconst transformObjectSuper = require(\"@babel/plugin-transform-object-super\")\nconst transformParameters = require(\"@babel/plugin-transform-parameters\")\nconst transformRegenerator = require(\"@babel/plugin-transform-regenerator\")\nconst transformShorthandProperties = require(\"@babel/plugin-transform-shorthand-properties\")\nconst transformSpread = require(\"@babel/plugin-transform-spread\")\nconst transformStickyRegex = require(\"@babel/plugin-transform-sticky-regex\")\nconst transformTemplateLiterals = require(\"@babel/plugin-transform-template-literals\")\nconst transformTypeOfSymbol = require(\"@babel/plugin-transform-typeof-symbol\")\nconst transformUnicodeRegex = require(\"@babel/plugin-transform-unicode-regex\")\n\nexport const jsenvBabelPluginMap = {\n  \"proposal-numeric-separator\": [proposalNumericSeparator],\n  \"proposal-json-strings\": [proposalJSONStrings],\n  \"proposal-object-rest-spread\": [proposalObjectRestSpread],\n  \"proposal-optional-catch-binding\": [proposalOptionalCatchBinding],\n  \"proposal-optional-chaining\": [proposalOptionalChaining],\n  \"proposal-unicode-property-regex\": [proposalUnicodePropertyRegex],\n  \"syntax-object-rest-spread\": [syntaxObjectRestSpread],\n  \"syntax-optional-catch-binding\": [syntaxOptionalCatchBinding],\n  \"transform-async-to-promises\": [transformAsyncToPromises],\n  \"transform-arrow-functions\": [transformArrowFunction],\n  \"transform-block-scoped-functions\": [transformBlockScopedFunctions],\n  \"transform-block-scoping\": [transformBlockScoping],\n  \"transform-classes\": [transformClasses],\n  \"transform-computed-properties\": [transformComputedProperties],\n  \"transform-destructuring\": [transformDestructuring],\n  \"transform-dotall-regex\": [transformDotAllRegex],\n  \"transform-duplicate-keys\": [transformDuplicateKeys],\n  \"transform-exponentiation-operator\": [transformExponentiationOperator],\n  \"transform-for-of\": [transformForOf],\n  \"transform-function-name\": [transformFunctionName],\n  \"transform-literals\": [transformLiterals],\n  \"transform-new-target\": [transformNewTarget],\n  \"transform-object-super\": [transformObjectSuper],\n  \"transform-parameters\": [transformParameters],\n  \"transform-regenerator\": [\n    transformRegenerator,\n    {\n      asyncGenerators: true,\n      generators: true,\n      async: false,\n    },\n  ],\n  \"transform-shorthand-properties\": [transformShorthandProperties],\n  \"transform-spread\": [transformSpread],\n  \"transform-sticky-regex\": [transformStickyRegex],\n  \"transform-template-literals\": [transformTemplateLiterals],\n  \"transform-typeof-symbol\": [transformTypeOfSymbol],\n  \"transform-unicode-regex\": [transformUnicodeRegex],\n}\n",
    "export const createCallbackList = () => {\n  const callbackSet = new Set()\n\n  const register = (callback) => {\n    callbackSet.add(callback)\n    return () => {\n      callbackSet.delete(callback)\n    }\n  }\n\n  const notify = (...args) => {\n    callbackSet.forEach((callback) => {\n      callback(...args)\n    })\n  }\n\n  return {\n    register,\n    notify,\n  }\n}\n",
    "import { resolveUrl, fileSystemPathToUrl } from \"@jsenv/util\"\nimport { require } from \"./require.js\"\nimport { jsenvCoreDirectoryUrl } from \"./jsenvCoreDirectoryUrl.js\"\n\nexport const jsenvNodeSystemRelativeUrl = \"./src/internal/node-launcher/node-js-file.js\"\nconst jsenvNodeSystemBuildRelativeUrl = \"./dist/jsenv-node-system.cjs\"\nexport const jsenvNodeSystemUrl = resolveUrl(jsenvNodeSystemRelativeUrl, jsenvCoreDirectoryUrl)\nexport const jsenvNodeSystemBuildUrl = resolveUrl(\n  jsenvNodeSystemBuildRelativeUrl,\n  jsenvCoreDirectoryUrl,\n)\n\nexport const jsenvBrowserSystemRelativeUrl =\n  \"./src/internal/browser-launcher/jsenv-browser-system.js\"\nconst jsenvBrowserSystemBuildRelativeUrl = \"./dist/jsenv-browser-system.js\"\nexport const jsenvBrowserSystemUrl = resolveUrl(\n  jsenvBrowserSystemRelativeUrl,\n  jsenvCoreDirectoryUrl,\n)\nexport const jsenvBrowserSystemBuildUrl = resolveUrl(\n  jsenvBrowserSystemBuildRelativeUrl,\n  jsenvCoreDirectoryUrl,\n)\n\nexport const sourcemapMainFileUrl = fileSystemPathToUrl(\n  require.resolve(\"source-map/dist/source-map.js\"),\n)\n\nexport const sourcemapMappingFileUrl = fileSystemPathToUrl(\n  require.resolve(\"source-map/lib/mappings.wasm\"),\n)\n\n// Exploring redirection\n// (auto redirection to a compile group depending on browser capabilities)\nexport const jsenvExploringRedirectorHtmlUrl = resolveUrl(\n  \"./src/internal/exploring/exploring.redirector.html\",\n  jsenvCoreDirectoryUrl,\n)\nexport const jsenvExploringRedirectorJsRelativeUrl =\n  \"./src/internal/exploring/exploring.redirector.js\"\nconst jsenvExploringRedirectorJsBuildRelativeUrl = \"./dist/jsenv-exploring-redirector.js\"\nexport const jsenvExploringRedirectorJsUrl = resolveUrl(\n  jsenvExploringRedirectorJsRelativeUrl,\n  jsenvCoreDirectoryUrl,\n)\nexport const jsenvExploringRedirectorJsBuildUrl = resolveUrl(\n  jsenvExploringRedirectorJsBuildRelativeUrl,\n  jsenvCoreDirectoryUrl,\n)\n\n// Exploring index and toolbar\nexport const jsenvExploringHtmlUrl = resolveUrl(\n  \"./src/internal/exploring/exploring.html\",\n  jsenvCoreDirectoryUrl,\n)\nexport const jsenvToolbarHtmlUrl = resolveUrl(\n  \"./src/internal/toolbar/toolbar.html\",\n  jsenvCoreDirectoryUrl,\n)\nexport const jsenvToolbarInjectorRelativeUrl = \"./src/internal/toolbar/toolbar.injector.js\"\nconst jsenvToolbarInjectorBuildRelativeUrl = \"./dist/jsenv-toolbar-injector.js\"\nexport const jsenvToolbarInjectorBuildUrl = resolveUrl(\n  jsenvToolbarInjectorBuildRelativeUrl,\n  jsenvCoreDirectoryUrl,\n)\nexport const jsenvToolbarJsRelativeUrl = \"./src/internal/toolbar/toolbar.main.js\"\nconst jsenvToolbarJsBuildRelativeUrl = \"dist/jsenv-toolbar.js\"\nexport const jsenvToolbarJsUrl = resolveUrl(jsenvToolbarJsRelativeUrl, jsenvCoreDirectoryUrl)\nexport const jsenvToolbarJsBuildUrl = resolveUrl(\n  jsenvToolbarJsBuildRelativeUrl,\n  jsenvCoreDirectoryUrl,\n)\n",
    "import { loggerToLogLevel } from \"@jsenv/logger\"\nimport { urlToRelativeUrl, urlIsInsideOf, resolveUrl } from \"@jsenv/util\"\nimport { composeTwoImportMaps } from \"@jsenv/import-map\"\nimport { getImportMapFromNodeModules } from \"@jsenv/node-module-import-map\"\nimport { jsenvCoreDirectoryUrl } from \"../jsenvCoreDirectoryUrl.js\"\n\n/**\n * allows the following:\n *\n * import \"@jsenv/core/helpers/regenerator-runtime/regenerator-runtime.js\"\n * -> searches a file inside @jsenv/core/*\n *\n * import importMap from \"/jsenv.importmap\"\n * -> searches project importMap at importMapFileRelativeUrl\n * (if importMap file does not exists an empty object is returned)\n * (if project uses a custom importMapFileRelativeUrl jsenv that file is returned)\n *\n */\n\nexport const transformImportmap = async (\n  importmapBeforeTransformation,\n  {\n    logger,\n    projectDirectoryUrl,\n    outDirectoryRelativeUrl,\n    originalFileUrl,\n    compiledFileUrl,\n    projectFileRequestedCallback,\n    request,\n  },\n) => {\n  projectFileRequestedCallback(urlToRelativeUrl(originalFileUrl, projectDirectoryUrl), request)\n\n  const importMapForProject = JSON.parse(importmapBeforeTransformation)\n  const originalFileRelativeUrl = urlToRelativeUrl(originalFileUrl, projectDirectoryUrl)\n\n  const importMapForJsenvCore = await getImportMapFromNodeModules({\n    logLevel: loggerToLogLevel(logger),\n    projectDirectoryUrl: jsenvCoreDirectoryUrl,\n    rootProjectDirectoryUrl: projectDirectoryUrl,\n    importMapFileRelativeUrl: originalFileRelativeUrl,\n    projectPackageDevDependenciesIncluded: false,\n  })\n\n  const topLevelRemappingForJsenvCore = {\n    \"@jsenv/core/\": urlToRelativeUrlRemapping(jsenvCoreDirectoryUrl, originalFileUrl),\n  }\n\n  const importmapForSelfImport = {\n    imports: topLevelRemappingForJsenvCore,\n    scopes: generateJsenvCoreScopes({ importMapForProject, topLevelRemappingForJsenvCore }),\n  }\n\n  const outDirectoryUrl = resolveUrl(outDirectoryRelativeUrl, projectDirectoryUrl)\n  const importMapInternal = {\n    imports: {\n      \"/.jsenv/out/\": urlToRelativeUrlRemapping(outDirectoryUrl, compiledFileUrl),\n      \"/jsenv.importmap\": urlToRelativeUrlRemapping(originalFileUrl, compiledFileUrl),\n    },\n  }\n\n  const importMap = [\n    importMapForJsenvCore,\n    importmapForSelfImport,\n    importMapInternal,\n    importMapForProject,\n  ].reduce((previous, current) => composeTwoImportMaps(previous, current), {})\n\n  const scopes = importMap.scopes || {}\n  const projectTopLevelMappings = importMapForProject.imports || {}\n  Object.keys(scopes).forEach((scope) => {\n    const scopedMappings = scopes[scope]\n    Object.keys(projectTopLevelMappings).forEach((key) => {\n      if (key in scopedMappings) {\n        scopedMappings[key] = projectTopLevelMappings[key]\n      }\n    })\n  })\n\n  return {\n    compiledSource: JSON.stringify(importMap, null, \"  \"),\n    contentType: \"application/importmap+json\",\n    sources: [originalFileUrl],\n    sourcesContent: [importmapBeforeTransformation],\n    assets: [],\n    assetsContent: [],\n  }\n}\n\n// this function just here to ensure relative urls starts with './'\n// so that importmap do not consider them as bare specifiers\nconst urlToRelativeUrlRemapping = (url, baseUrl) => {\n  const relativeUrl = urlToRelativeUrl(url, baseUrl)\n\n  if (urlIsInsideOf(url, baseUrl)) {\n    if (relativeUrl.startsWith(\"../\")) return relativeUrl\n    if (relativeUrl.startsWith(\"./\")) return relativeUrl\n    return `./${relativeUrl}`\n  }\n\n  return relativeUrl\n}\n\nconst generateJsenvCoreScopes = ({ importMapForProject, topLevelRemappingForJsenvCore }) => {\n  const { scopes } = importMapForProject\n\n  if (!scopes) {\n    return undefined\n  }\n\n  // I must ensure jsenvCoreImports wins by default in every scope\n  // because scope may contains stuff like\n  // \"/\": \"/\"\n  // \"/\": \"/folder/\"\n  // to achieve this, we set jsenvCoreImports into every scope\n  // they can still be overriden by importMapForProject\n  // even if I see no use case for that\n  const scopesForJsenvCore = {}\n  Object.keys(scopes).forEach((scopeKey) => {\n    scopesForJsenvCore[scopeKey] = topLevelRemappingForJsenvCore\n  })\n  return scopesForJsenvCore\n}\n",
    "/**\n\nminimalBabelPluginArray exists so that jsenv support latest js syntax by default.\nOtherwise users have to explicitely enable those syntax when they use it.\n\n*/\n\nimport { require } from \"./require.js\"\n\nconst syntaxDynamicImport = require(\"@babel/plugin-syntax-dynamic-import\")\nconst syntaxImportMeta = require(\"@babel/plugin-syntax-import-meta\")\nconst syntaxNumericSeparator = require(\"@babel/plugin-syntax-numeric-separator\")\n\nexport const minimalBabelPluginArray = [\n  syntaxDynamicImport,\n  syntaxImportMeta,\n  syntaxNumericSeparator,\n]\n",
    "// https://github.com/jamiebuilds/babel-handbook/blob/master/translations/en/plugin-handbook.md#toc-stages-of-babel\n// https://github.com/cfware/babel-plugin-bundled-import-meta/blob/master/index.js\n// https://github.com/babel/babel/blob/f4edf62f6beeab8ae9f2b7f0b82f1b3b12a581af/packages/babel-helper-module-imports/src/index.js#L7\n\nimport { require } from \"@jsenv/core/src/internal/require.js\"\n\nconst { addNamespace, addDefault, addNamed } = require(\"@babel/helper-module-imports\")\nconst { parseExpression } = require(\"@babel/parser\")\n\nexport const babelPluginTransformImportMeta = (api, pluginOptions) => {\n  const { replaceImportMeta } = pluginOptions\n\n  let babelState\n  const jsValueToAst = (jsValue) => {\n    const valueAst = parseExpression(jsValue, babelState.opts)\n    return valueAst\n  }\n\n  return {\n    pre: (state) => {\n      babelState = state\n    },\n\n    // visitor: {\n    //   Program(path) {\n    //     const metas = []\n    //     const identifiers = new Set()\n\n    //     path.traverse({\n    //       MetaProperty(path) {\n    //         const node = path.node\n    //         if (node.meta && node.meta.name === \"import\" && node.property.name === \"meta\") {\n    //           metas.push(path)\n    //           Object.keys(path.scope.getAllBindings()).forEach((name) => {\n    //             identifiers.add(name)\n    //           })\n    //         }\n    //       },\n    //     })\n\n    //     if (metas.length === 0) {\n    //       return\n    //     }\n    //   },\n    // },\n\n    visitor: {\n      Program(programPath) {\n        const metaPropertyPathMap = {}\n\n        programPath.traverse({\n          MemberExpression(path) {\n            const { node } = path\n            const { object } = node\n            if (object.type !== \"MetaProperty\") {\n              return\n            }\n\n            const { property: objectProperty } = object\n            if (objectProperty.name !== \"meta\") {\n              return\n            }\n\n            const { property } = node\n            const { name } = property\n            if (name in metaPropertyPathMap) {\n              metaPropertyPathMap[name].push(path)\n            } else {\n              metaPropertyPathMap[name] = [path]\n            }\n          },\n        })\n\n        Object.keys(metaPropertyPathMap).forEach((importMetaPropertyName) => {\n          replaceImportMeta(importMetaPropertyName, {\n            replaceWithImport: ({ namespace, name, from }) => {\n              let importAst\n              if (namespace) {\n                importAst = addNamespace(programPath, from)\n              } else if (name) {\n                importAst = addNamed(programPath, name, from)\n              } else {\n                importAst = addDefault(programPath, from)\n              }\n              metaPropertyPathMap[importMetaPropertyName].forEach((path) => {\n                path.replaceWith(importAst)\n              })\n            },\n            replaceWithValue: (value) => {\n              const valueAst = jsValueToAst(JSON.stringify(value))\n              metaPropertyPathMap[importMetaPropertyName].forEach((path) => {\n                path.replaceWith(valueAst)\n              })\n            },\n          })\n        })\n      },\n    },\n  }\n}\n",
    "export const findAsyncPluginNameInBabelPluginMap = (babelPluginMap) => {\n  if (\"transform-async-to-promises\" in babelPluginMap) {\n    return \"transform-async-to-promises\"\n  }\n  if (\"transform-async-to-generator\" in babelPluginMap) {\n    return \"transform-async-to-generator\"\n  }\n  return \"\"\n}\n",
    "import { require } from \"../../require.js\"\n\n// https://github.com/rburns/ansi-to-html/blob/master/src/ansi_to_html.js\n// https://github.com/drudru/ansi_up/blob/master/ansi_up.js\n\nexport const ansiToHTML = (ansiString) => {\n  const Convert = require(\"ansi-to-html\")\n  return new Convert().toHtml(ansiString)\n}\n",
    "import { require } from \"../../require.js\"\n\nexport const ensureRegeneratorRuntimeImportBabelPlugin = (api, options) => {\n  const { addSideEffect } = require(\"@babel/helper-module-imports\")\n\n  api.assertVersion(7)\n\n  const {\n    regeneratorRuntimeIdentifierName = \"regeneratorRuntime\",\n    regeneratorRuntimeImportPath = \"@jsenv/core/helpers/regenerator-runtime/regenerator-runtime.js\",\n  } = options\n\n  return {\n    visitor: {\n      Identifier(path, opts) {\n        const { filename } = opts\n        const filepathname = filename.replace(/\\\\/g, \"/\")\n        if (filepathname.endsWith(\"node_modules/regenerator-runtime/runtime.js\")) {\n          return\n        }\n\n        const { node } = path\n        if (node.name === regeneratorRuntimeIdentifierName) {\n          addSideEffect(path.scope.getProgramParent().path, regeneratorRuntimeImportPath)\n        }\n      },\n    },\n  }\n}\n",
    "import { require } from \"../../require.js\"\n\nexport const ensureGlobalThisImportBabelPlugin = (api, options) => {\n  const { addSideEffect } = require(\"@babel/helper-module-imports\")\n\n  api.assertVersion(7)\n\n  const {\n    globalThisIdentifierName = \"globalThis\",\n    globalThisImportPath = \"@jsenv/core/helpers/global-this/global-this.js\",\n  } = options\n\n  return {\n    visitor: {\n      Identifier(path, opts) {\n        const { filename } = opts\n        const filepathname = filename.replace(/\\\\/g, \"/\")\n        if (filepathname.endsWith(\"/helpers/global-this/global-this.js\")) {\n          return\n        }\n\n        const { node } = path\n        if (node.name === globalThisIdentifierName) {\n          addSideEffect(path.scope.getProgramParent().path, globalThisImportPath)\n        }\n      },\n    },\n  }\n}\n",
    "// https://github.com/babel/babel/blob/99f4f6c3b03c7f3f67cf1b9f1a21b80cfd5b0224/packages/babel-core/src/tools/build-external-helpers.js\n// the list of possible helpers:\n// https://github.com/babel/babel/blob/99f4f6c3b03c7f3f67cf1b9f1a21b80cfd5b0224/packages/babel-helpers/src/helpers.js#L13\nimport { fileSystemPathToUrl } from \"@jsenv/util\"\nimport { require } from \"../../require.js\"\n\nconst { list } = require(\"@babel/helpers\")\n\nconst babelHelperNameInsideJsenvCoreArray = [\n  \"applyDecoratedDescriptor\",\n  \"arrayLikeToArray\",\n  \"arrayWithHoles\",\n  \"arrayWithoutHoles\",\n  \"assertThisInitialized\",\n  \"AsyncGenerator\",\n  \"asyncGeneratorDelegate\",\n  \"asyncIterator\",\n  \"asyncToGenerator\",\n  \"awaitAsyncGenerator\",\n  \"AwaitValue\",\n  \"classCallCheck\",\n  \"classNameTDZError\",\n  \"classPrivateFieldDestructureSet\",\n  \"classPrivateFieldGet\",\n  \"classPrivateFieldLooseBase\",\n  \"classPrivateFieldLooseKey\",\n  \"classPrivateFieldSet\",\n  \"classPrivateMethodGet\",\n  \"classPrivateMethodSet\",\n  \"classStaticPrivateFieldSpecGet\",\n  \"classStaticPrivateFieldSpecSet\",\n  \"classStaticPrivateMethodGet\",\n  \"classStaticPrivateMethodSet\",\n  \"construct\",\n  \"createClass\",\n  \"createForOfIteratorHelper\",\n  \"createForOfIteratorHelperLoose\",\n  \"createSuper\",\n  \"decorate\",\n  \"defaults\",\n  \"defineEnumerableProperties\",\n  \"defineProperty\",\n  \"extends\",\n  \"get\",\n  \"getPrototypeOf\",\n  \"inherits\",\n  \"inheritsLoose\",\n  \"initializerDefineProperty\",\n  \"initializerWarningHelper\",\n  \"instanceof\",\n  \"interopRequireDefault\",\n  \"interopRequireWildcard\",\n  \"isNativeFunction\",\n  \"isNativeReflectConstruct\",\n  \"iterableToArray\",\n  \"iterableToArrayLimit\",\n  \"iterableToArrayLimitLoose\",\n  \"jsx\",\n  \"newArrowCheck\",\n  \"nonIterableRest\",\n  \"nonIterableSpread\",\n  \"objectDestructuringEmpty\",\n  \"objectSpread\",\n  \"objectSpread2\",\n  \"objectWithoutProperties\",\n  \"objectWithoutPropertiesLoose\",\n  \"possibleConstructorReturn\",\n  \"readOnlyError\",\n  \"set\",\n  \"setPrototypeOf\",\n  \"skipFirstGeneratorNext\",\n  \"slicedToArray\",\n  \"slicedToArrayLoose\",\n  \"superPropBase\",\n  \"taggedTemplateLiteral\",\n  \"taggedTemplateLiteralLoose\",\n  \"tdz\",\n  \"temporalRef\",\n  \"temporalUndefined\",\n  \"toArray\",\n  \"toConsumableArray\",\n  \"toPrimitive\",\n  \"toPropertyKey\",\n  \"typeof\",\n  \"unsupportedIterableToArray\",\n  \"wrapAsyncGenerator\",\n  \"wrapNativeSuper\",\n  \"wrapRegExp\",\n]\n\nconst babelHelperScope = \"@jsenv/core/helpers/babel/\"\n// maybe we can put back / in front of .jsenv here because we will\n// \"redirect\" or at least transform everything inside .jsenv\n// not only everything inside .dist\nconst babelHelperAbstractScope = `.jsenv/helpers/babel/`\n\nexport const listAbstractBabelHelpers = () => {\n  return list.filter((babelHelperName) => !babelHelperIsInsideJsenvCore(babelHelperName))\n}\n\nexport const babelHelperNameToImportSpecifier = (babelHelperName) => {\n  if (babelHelperNameInsideJsenvCoreArray.includes(babelHelperName)) {\n    return `${babelHelperScope}${babelHelperName}/${babelHelperName}.js`\n  }\n  return `${babelHelperAbstractScope}${babelHelperName}/${babelHelperName}.js`\n}\n\nexport const filePathToBabelHelperName = (filePath) => {\n  const fileUrl = fileSystemPathToUrl(filePath)\n\n  const babelHelperPrefix = \"core/helpers/babel/\"\n  if (fileUrl.includes(babelHelperPrefix)) {\n    const afterBabelHelper = fileUrl.slice(\n      fileUrl.indexOf(babelHelperPrefix) + babelHelperPrefix.length,\n    )\n    return afterBabelHelper.slice(0, afterBabelHelper.indexOf(\"/\"))\n  }\n\n  if (fileUrl.includes(babelHelperAbstractScope)) {\n    const afterBabelHelper = fileUrl.slice(\n      fileUrl.indexOf(babelHelperAbstractScope) + babelHelperAbstractScope.length,\n    )\n    return afterBabelHelper.slice(0, afterBabelHelper.indexOf(\"/\"))\n  }\n\n  return null\n}\n\nexport const babelHelperIsInsideJsenvCore = (babelHelperName) => {\n  return babelHelperNameInsideJsenvCoreArray.includes(babelHelperName)\n}\n",
    "import { require } from \"../../require.js\"\nimport { filePathToBabelHelperName, babelHelperNameToImportSpecifier } from \"./babelHelper.js\"\n\n// https://github.com/babel/babel/tree/master/packages/babel-helper-module-imports\nconst { addDefault } = require(\"@babel/helper-module-imports\")\n\n// named import approach found here:\n// https://github.com/rollup/rollup-plugin-babel/blob/18e4232a450f320f44c651aa8c495f21c74d59ac/src/helperPlugin.js#L1\n\n// for reference this is how it's done to reference\n// a global babel helper object instead of using\n// a named import\n// https://github.com/babel/babel/blob/99f4f6c3b03c7f3f67cf1b9f1a21b80cfd5b0224/packages/babel-plugin-external-helpers/src/index.js\n\nexport const transformBabelHelperToImportBabelPlugin = (api) => {\n  api.assertVersion(7)\n\n  return {\n    pre: (file) => {\n      const cachedHelpers = {}\n      file.set(\"helperGenerator\", (name) => {\n        // the list of possible helpers name\n        // https://github.com/babel/babel/blob/99f4f6c3b03c7f3f67cf1b9f1a21b80cfd5b0224/packages/babel-helpers/src/helpers.js#L13\n\n        if (!file.availableHelper(name)) {\n          return undefined\n        }\n\n        if (cachedHelpers[name]) {\n          return cachedHelpers[name]\n        }\n\n        const filePath = file.opts.filename\n        const babelHelperImportSpecifier = babelHelperNameToImportSpecifier(name)\n\n        if (filePathToBabelHelperName(filePath) === name) {\n          return undefined\n        }\n\n        const helper = addDefault(file.path, babelHelperImportSpecifier, { nameHint: `_${name}` })\n        cachedHelpers[name] = helper\n        return helper\n      })\n    },\n  }\n}\n",
    "/* eslint-disable import/max-dependencies */\nimport { require } from \"@jsenv/core/src/internal/require.js\"\nimport { minimalBabelPluginArray } from \"@jsenv/core/src/internal/minimalBabelPluginArray.js\"\nimport { babelPluginTransformImportMeta } from \"@jsenv/core/src/internal/babel-plugin-transform-import-meta.js\"\n\nimport { findAsyncPluginNameInBabelPluginMap } from \"./findAsyncPluginNameInBabelPluginMap.js\"\nimport { ansiToHTML } from \"./ansiToHTML.js\"\nimport { ensureRegeneratorRuntimeImportBabelPlugin } from \"./ensureRegeneratorRuntimeImportBabelPlugin.js\"\nimport { ensureGlobalThisImportBabelPlugin } from \"./ensureGlobalThisImportBabelPlugin.js\"\nimport { transformBabelHelperToImportBabelPlugin } from \"./transformBabelHelperToImportBabelPlugin.js\"\nimport { filePathToBabelHelperName } from \"./babelHelper.js\"\n\nconst { transformAsync, transformFromAstAsync } = require(\"@babel/core\")\nconst transformModulesSystemJs = require(\"@babel/plugin-transform-modules-systemjs\")\nconst proposalDynamicImport = require(\"@babel/plugin-proposal-dynamic-import\")\n\nexport const jsenvTransform = async ({\n  inputCode,\n  inputPath,\n  inputRelativePath,\n  inputAst,\n  inputMap,\n\n  babelPluginMap,\n  moduleOutFormat,\n  importMetaFormat,\n  importMetaEnvFileSpecifier,\n  importMeta = {},\n\n  allowTopLevelAwait,\n  transformTopLevelAwait,\n  transformGenerator,\n  transformGlobalThis,\n  regeneratorRuntimeImportPath,\n  sourcemapEnabled,\n}) => {\n  // https://babeljs.io/docs/en/options\n  const options = {\n    filename: inputPath,\n    filenameRelative: inputRelativePath,\n    inputSourceMap: inputMap,\n    configFile: false,\n    babelrc: false, // trust only these options, do not read any babelrc config file\n    ast: true,\n    sourceMaps: sourcemapEnabled,\n    sourceFileName: inputPath,\n    // https://babeljs.io/docs/en/options#parseropts\n    parserOpts: {\n      allowAwaitOutsideFunction: allowTopLevelAwait,\n    },\n  }\n\n  const babelHelperName = filePathToBabelHelperName(inputPath)\n  // to prevent typeof circular dependency\n  if (babelHelperName === \"typeof\") {\n    const babelPluginMapWithoutTransformTypeOf = {}\n    Object.keys(babelPluginMap).forEach((key) => {\n      if (key !== \"transform-typeof-symbol\") {\n        babelPluginMapWithoutTransformTypeOf[key] = babelPluginMap[key]\n      }\n    })\n    babelPluginMap = babelPluginMapWithoutTransformTypeOf\n  }\n\n  if (transformGenerator) {\n    babelPluginMap = {\n      ...babelPluginMap,\n      \"ensure-regenerator-runtime-import\": [\n        ensureRegeneratorRuntimeImportBabelPlugin,\n        {\n          regeneratorRuntimeImportPath,\n        },\n      ],\n    }\n  }\n\n  if (transformGlobalThis) {\n    babelPluginMap = {\n      ...babelPluginMap,\n      \"ensure-global-this-import\": [ensureGlobalThisImportBabelPlugin],\n    }\n  }\n\n  babelPluginMap = {\n    \"transform-import-meta\": [\n      babelPluginTransformImportMeta,\n      {\n        replaceImportMeta: (metaPropertyName, { replaceWithImport, replaceWithValue }) => {\n          if (metaPropertyName === \"url\") {\n            if (importMetaFormat === \"esmodule\") {\n              // keep native version\n              return\n            }\n            if (importMetaFormat === \"systemjs\") {\n              // systemjs will handle it\n              return\n            }\n            if (importMetaFormat === \"commonjs\") {\n              replaceWithImport({\n                from: `@jsenv/core/src/internal/import-meta/import-meta-url-commonjs.js`,\n              })\n              return\n            }\n            if (importMetaFormat === \"global\") {\n              replaceWithImport({\n                from: `@jsenv/core/src/internal/import-meta/import-meta-url-global.js`,\n              })\n              return\n            }\n            return\n          }\n\n          if (metaPropertyName === \"resolve\") {\n            if (importMetaFormat === \"esmodule\") {\n              // keep native version\n              return\n            }\n            if (importMetaFormat === \"systemjs\") {\n              // systemjs will handle it\n              return\n            }\n            if (importMetaFormat === \"commonjs\") {\n              replaceWithImport({\n                from: `@jsenv/core/src/internal/import-meta/import-meta-resolve-commonjs.js`,\n              })\n              return\n            }\n            if (importMetaFormat === \"global\") {\n              replaceWithImport({\n                from: `@jsenv/core/src/internal/import-meta/import-meta-resolve-global.js`,\n              })\n              return\n            }\n            return\n          }\n\n          if (metaPropertyName === \"env\") {\n            replaceWithImport({\n              namespace: true,\n              from: importMetaEnvFileSpecifier,\n            })\n            return\n          }\n\n          replaceWithValue(importMeta[metaPropertyName])\n        },\n      },\n    ],\n    ...babelPluginMap,\n    \"transform-babel-helpers-to-import\": [transformBabelHelperToImportBabelPlugin],\n  }\n\n  const asyncPluginName = findAsyncPluginNameInBabelPluginMap(babelPluginMap)\n\n  if (moduleOutFormat === \"systemjs\" && transformTopLevelAwait && asyncPluginName) {\n    const babelPluginArrayWithoutAsync = []\n    Object.keys(babelPluginMap).forEach((name) => {\n      if (name !== asyncPluginName) {\n        babelPluginArrayWithoutAsync.push(babelPluginMap[name])\n      }\n    })\n\n    // put body inside something like (async () => {})()\n    const result = await babelTransform({\n      ast: inputAst,\n      code: inputCode,\n      options: {\n        ...options,\n        plugins: [\n          ...minimalBabelPluginArray,\n          ...babelPluginArrayWithoutAsync,\n          [proposalDynamicImport],\n          [transformModulesSystemJs],\n        ],\n      },\n    })\n\n    // we need to retranspile the await keywords now wrapped\n    // inside Systemjs function.\n    // They are ignored, at least by transform-async-to-promises\n    // see https://github.com/rpetrich/babel-plugin-transform-async-to-promises/issues/26\n\n    const finalResult = await babelTransform({\n      // ast: result.ast,\n      code: result.code,\n      options: {\n        ...options,\n        // about inputSourceMap see\n        // https://github.com/babel/babel/blob/eac4c5bc17133c2857f2c94c1a6a8643e3b547a7/packages/babel-core/src/transformation/file/generate.js#L57\n        // https://github.com/babel/babel/blob/090c364a90fe73d36a30707fc612ce037bdbbb24/packages/babel-core/src/transformation/file/merge-map.js#L6s\n        inputSourceMap: result.map,\n        plugins: [...minimalBabelPluginArray, babelPluginMap[asyncPluginName]],\n      },\n    })\n\n    return {\n      ...result,\n      ...finalResult,\n      metadata: { ...result.metadata, ...finalResult.metadata },\n    }\n  }\n\n  const babelPluginArray = [\n    ...minimalBabelPluginArray,\n    ...Object.keys(babelPluginMap).map((babelPluginName) => babelPluginMap[babelPluginName]),\n    ...(moduleOutFormat === \"systemjs\"\n      ? [[proposalDynamicImport], [transformModulesSystemJs]]\n      : []),\n  ]\n  const result = await babelTransform({\n    ast: inputAst,\n    code: inputCode,\n    options: {\n      ...options,\n      plugins: babelPluginArray,\n    },\n  })\n  return result\n}\n\nconst babelTransform = async ({ ast, code, options }) => {\n  try {\n    if (ast) {\n      const result = await transformFromAstAsync(ast, code, options)\n      return result\n    }\n    return await transformAsync(code, options)\n  } catch (error) {\n    if (error && error.code === \"BABEL_PARSE_ERROR\") {\n      const message = error.message\n      throw createParseError({\n        message: message.replace(ansiRegex, \"\"),\n        messageHTML: ansiToHTML(message),\n        filename: options.filename,\n        lineNumber: error.loc.line,\n        columnNumber: error.loc.column,\n      })\n    }\n    throw error\n  }\n}\n\nconst pattern = [\n  \"[\\\\u001B\\\\u009B][[\\\\]()#;?]*(?:(?:(?:[a-zA-Z\\\\d]*(?:;[-a-zA-Z\\\\d\\\\/#&.:=?%@~_]*)*)?\\\\u0007)\",\n  \"(?:(?:\\\\d{1,4}(?:;\\\\d{0,4})*)?[\\\\dA-PR-TZcf-ntqry=><~]))\",\n].join(\"|\")\nconst ansiRegex = new RegExp(pattern, \"g\")\n\nconst createParseError = (data) => {\n  const { message } = data\n  const parseError = new Error(message)\n  parseError.code = \"PARSE_ERROR\"\n  parseError.data = data\n\n  return parseError\n}\n",
    "import {\n  resolveUrl,\n  urlToFileSystemPath,\n  urlToRelativeUrl,\n  normalizeStructuredMetaMap,\n  urlToMeta,\n} from \"@jsenv/util\"\nimport { jsenvTransform } from \"./jsenvTransform.js\"\n\nexport const transformJs = async ({\n  projectDirectoryUrl,\n  code,\n  url,\n  urlAfterTransform,\n  map,\n\n  babelPluginMap,\n  convertMap = {},\n  moduleOutFormat = \"esmodule\",\n  importMetaFormat = moduleOutFormat,\n  importMetaEnvFileRelativeUrl,\n  importMeta,\n\n  allowTopLevelAwait = true,\n  transformTopLevelAwait = true,\n  transformGenerator = true,\n  transformGlobalThis = true,\n  sourcemapEnabled = true,\n}) => {\n  if (typeof projectDirectoryUrl !== \"string\") {\n    throw new TypeError(`projectDirectoryUrl must be a string, got ${projectDirectoryUrl}`)\n  }\n  if (typeof babelPluginMap !== \"object\") {\n    throw new TypeError(`babelPluginMap must be an object, got ${babelPluginMap}`)\n  }\n  if (typeof code === \"undefined\") {\n    throw new TypeError(`code missing, received ${code}`)\n  }\n  if (typeof url !== \"string\") {\n    throw new TypeError(`url must be a string, got ${url}`)\n  }\n\n  const { inputCode, inputMap } = await computeInputCodeAndInputMap({\n    code: String(code),\n    url,\n    urlAfterTransform,\n    map,\n    projectDirectoryUrl,\n    convertMap,\n    sourcemapEnabled,\n    allowTopLevelAwait,\n  })\n  const inputPath = computeInputPath(url)\n  const inputRelativePath = computeInputRelativePath(url, projectDirectoryUrl)\n\n  const importMetaEnvFileUrl = resolveUrl(importMetaEnvFileRelativeUrl, projectDirectoryUrl)\n  const importMetaEnvRelativeUrlForInput = urlToRelativeUrl(importMetaEnvFileUrl, url)\n  const importMetaEnvFileSpecifier = relativeUrlToSpecifier(importMetaEnvRelativeUrlForInput)\n\n  return jsenvTransform({\n    inputCode,\n    inputMap,\n    inputPath,\n    inputRelativePath,\n\n    babelPluginMap,\n    convertMap,\n    moduleOutFormat,\n    importMetaFormat,\n    importMetaEnvFileSpecifier,\n    importMeta,\n\n    allowTopLevelAwait,\n    transformTopLevelAwait,\n    transformGenerator,\n    transformGlobalThis,\n    sourcemapEnabled,\n  })\n}\n\nconst computeInputCodeAndInputMap = async ({\n  code,\n  url,\n  urlAfterTransform,\n  map,\n  projectDirectoryUrl,\n  convertMap,\n  remap,\n  allowTopLevelAwait,\n}) => {\n  const structuredMetaMap = normalizeStructuredMetaMap(\n    {\n      convert: convertMap,\n    },\n    projectDirectoryUrl,\n  )\n  const { convert } = urlToMeta({ url, structuredMetaMap })\n  if (!convert) {\n    return { inputCode: code, inputMap: map }\n  }\n\n  if (typeof convert !== \"function\") {\n    throw new TypeError(`convert must be a function, got ${convert}`)\n  }\n  // TODO: handle map when passed\n  const conversionResult = await convert({\n    projectDirectoryUrl,\n    code,\n    url,\n    urlAfterTransform,\n    map,\n    remap,\n    allowTopLevelAwait,\n  })\n  if (typeof conversionResult !== \"object\") {\n    throw new TypeError(`convert must return an object, got ${conversionResult}`)\n  }\n  const inputCode = conversionResult.code\n  if (typeof inputCode !== \"string\") {\n    throw new TypeError(`convert must return { code } string, got { code: ${inputCode} } `)\n  }\n  const inputMap = conversionResult.map\n  return { inputCode, inputMap }\n}\n\nconst computeInputPath = (url) => {\n  if (url.startsWith(\"file://\")) {\n    return urlToFileSystemPath(url)\n  }\n  return url\n}\n\nconst computeInputRelativePath = (url, projectDirectoryUrl) => {\n  if (url.startsWith(projectDirectoryUrl)) {\n    return urlToRelativeUrl(url, projectDirectoryUrl)\n  }\n  return undefined\n}\n\nconst relativeUrlToSpecifier = (relativeUrl) => {\n  if (relativeUrl.startsWith(\"../\")) return relativeUrl\n  if (relativeUrl.startsWith(\"./\")) return relativeUrl\n  return `./${relativeUrl}`\n}\n",
    "export const isWindowsFilePath = (path) => startsWithWindowsDriveLetter(path) && path[2] === \"\\\\\"\n\nexport const startsWithWindowsDriveLetter = (string) => {\n  const firstChar = string[0]\n  if (!/[a-zA-Z]/.test(firstChar)) return false\n\n  const secondChar = string[1]\n  if (secondChar !== \":\") return false\n\n  return true\n}\n\nexport const windowsFilePathToUrl = (windowsFilePath) => {\n  return `file:///${replaceBackSlashesWithSlashes(windowsFilePath)}`\n}\n\nexport const replaceBackSlashesWithSlashes = (string) => string.replace(/\\\\/g, \"/\")\n",
    "export const getJavaScriptSourceMappingUrl = (javaScriptSource) => {\n  let sourceMappingUrl\n  replaceSourceMappingUrl(javaScriptSource, javascriptSourceMappingUrlCommentRegexp, (value) => {\n    sourceMappingUrl = value\n  })\n  return sourceMappingUrl\n}\n\nexport const setJavaScriptSourceMappingUrl = (javaScriptSource, sourceMappingFileUrl) => {\n  let replaced\n  const sourceAfterReplace = replaceSourceMappingUrl(\n    javaScriptSource,\n    javascriptSourceMappingUrlCommentRegexp,\n    () => {\n      replaced = true\n      return sourceMappingFileUrl ? writeJavaScriptSourceMappingURL(sourceMappingFileUrl) : \"\"\n    },\n  )\n  if (replaced) {\n    return sourceAfterReplace\n  }\n\n  return sourceMappingFileUrl\n    ? `${javaScriptSource}\n${writeJavaScriptSourceMappingURL(sourceMappingFileUrl)}`\n    : javaScriptSource\n}\n\nexport const getCssSourceMappingUrl = (cssSource) => {\n  let sourceMappingUrl\n  replaceSourceMappingUrl(cssSource, cssSourceMappingUrlCommentRegExp, (value) => {\n    sourceMappingUrl = value\n  })\n  return sourceMappingUrl\n}\n\nexport const setCssSourceMappingUrl = (cssSource, sourceMappingFileUrl) => {\n  let replaced\n  const sourceAfterReplace = replaceSourceMappingUrl(\n    cssSource,\n    cssSourceMappingUrlCommentRegExp,\n    () => {\n      replaced = true\n      return sourceMappingFileUrl ? writeCssSourceMappingUrl(sourceMappingFileUrl) : \"\"\n    },\n  )\n  if (replaced) {\n    return sourceAfterReplace\n  }\n  return sourceMappingFileUrl\n    ? `${cssSource}\n${writeCssSourceMappingUrl(sourceMappingFileUrl)}`\n    : cssSource\n}\n\nconst javascriptSourceMappingUrlCommentRegexp = /\\/\\/ ?# ?sourceMappingURL=([^\\s'\"]+)/g\nconst cssSourceMappingUrlCommentRegExp = /\\/\\*# ?sourceMappingURL=([^\\s'\"]+) \\*\\//g\n\n// ${\"//#\"} is to avoid a parser thinking there is a sourceMappingUrl for this file\nconst writeJavaScriptSourceMappingURL = (value) => `${\"//#\"} sourceMappingURL=${value}`\nconst writeCssSourceMappingUrl = (value) => `/*# sourceMappingURL=${value} */`\n\nexport const sourcemapToBase64Url = (sourcemap) => {\n  const asBase64 = Buffer.from(JSON.stringify(sourcemap)).toString(\"base64\")\n  return `data:application/json;charset=utf-8;base64,${asBase64}`\n}\n\nconst replaceSourceMappingUrl = (source, regexp, callback) => {\n  let lastSourceMappingUrl\n  let matchSourceMappingUrl\n  while ((matchSourceMappingUrl = regexp.exec(source))) {\n    lastSourceMappingUrl = matchSourceMappingUrl\n  }\n  if (lastSourceMappingUrl) {\n    const index = lastSourceMappingUrl.index\n    const before = source.slice(0, index)\n    const after = source.slice(index)\n    const mappedAfter = after.replace(regexp, (match, firstGroup) => {\n      return callback(firstGroup)\n    })\n    return `${before}${mappedAfter}`\n  }\n  return source\n}\n",
    "import { urlToFilename } from \"@jsenv/util\"\n\nexport const urlIsAsset = (url) => {\n  const filename = urlToFilename(url)\n\n  // sourcemap are not inside the asset folder because\n  // of https://github.com/microsoft/vscode-chrome-debug-core/issues/544\n  if (filename.endsWith(\".map\")) {\n    return true\n  }\n\n  return filename.includes(\"__asset__\")\n}\n\nexport const getMetaJsonFileUrl = (compileFileUrl) =>\n  generateCompiledFileAssetUrl(compileFileUrl, \"meta.json\")\n\nexport const generateCompiledFileAssetUrl = (compiledFileUrl, assetName) => {\n  return `${compiledFileUrl}__asset__${assetName}`\n}\n",
    "import { resolveUrl, urlToRelativeUrl, readFile, ensureWindowsDriveLetter } from \"@jsenv/util\"\nimport {\n  replaceBackSlashesWithSlashes,\n  startsWithWindowsDriveLetter,\n  windowsFilePathToUrl,\n} from \"../../filePathUtils.js\"\nimport { setJavaScriptSourceMappingUrl, sourcemapToBase64Url } from \"../../sourceMappingURLUtils.js\"\nimport { generateCompiledFileAssetUrl } from \"../compile-directory/compile-asset.js\"\n\nconst isWindows = process.platform === \"win32\"\n\nexport const transformResultToCompilationResult = async (\n  { code, map, metadata = {} },\n  {\n    projectDirectoryUrl,\n    originalFileContent,\n    originalFileUrl,\n    compiledFileUrl,\n    sourcemapFileUrl,\n    sourcemapEnabled = true,\n    // removing sourcesContent from map decrease the sourceMap\n    // it also means client have to fetch source from server (additional http request)\n    // some client ignore sourcesContent property such as vscode-chrome-debugger\n    // Because it's the most complex scenario and we want to ensure client is always able\n    // to find source from the sourcemap, we remove map.sourcesContent by default to test this.\n    sourcemapExcludeSources = true,\n    sourcemapMethod = \"comment\", // \"comment\", \"inline\"\n  },\n) => {\n  if (typeof projectDirectoryUrl !== \"string\") {\n    throw new TypeError(`projectDirectoryUrl must be a string, got ${projectDirectoryUrl}`)\n  }\n  if (typeof originalFileContent !== \"string\") {\n    throw new TypeError(`originalFileContent must be a string, got ${originalFileContent}`)\n  }\n  if (typeof originalFileUrl !== \"string\") {\n    throw new TypeError(`originalFileUrl must be a string, got ${originalFileUrl}`)\n  }\n  if (typeof compiledFileUrl !== \"string\") {\n    throw new TypeError(`compiledFileUrl must be a string, got ${compiledFileUrl}`)\n  }\n  if (typeof sourcemapFileUrl !== \"string\") {\n    throw new TypeError(`sourcemapFileUrl must be a string, got ${sourcemapFileUrl}`)\n  }\n\n  const sources = []\n  const sourcesContent = []\n  const assets = []\n  const assetsContent = []\n\n  let output = code\n  if (sourcemapEnabled && map) {\n    if (map.sources.length === 0) {\n      // may happen in some cases where babel returns a wrong sourcemap\n      // there is at least one case where it happens\n      // a file with only import './whatever.js' inside\n      sources.push(originalFileUrl)\n      sourcesContent.push(originalFileContent)\n    } else {\n      await Promise.all(\n        map.sources.map(async (source, index) => {\n          // be careful here we might received C:/Directory/file.js path from babel\n          // also in case we receive relative path like directory\\file.js we replace \\ with slash\n          // for url resolution\n          const sourceFileUrl =\n            isWindows && startsWithWindowsDriveLetter(source)\n              ? windowsFilePathToUrl(source)\n              : ensureWindowsDriveLetter(\n                  resolveUrl(\n                    isWindows ? replaceBackSlashesWithSlashes(source) : source,\n                    sourcemapFileUrl,\n                  ),\n                  sourcemapFileUrl,\n                )\n\n          if (!sourceFileUrl.startsWith(projectDirectoryUrl)) {\n            // do not track dependency outside project\n            // it means cache stays valid for those external sources\n            return\n          }\n\n          map.sources[index] = urlToRelativeUrl(sourceFileUrl, sourcemapFileUrl)\n          sources[index] = sourceFileUrl\n\n          if (map.sourcesContent && map.sourcesContent[index]) {\n            sourcesContent[index] = map.sourcesContent[index]\n          } else {\n            const sourceFileContent = await readFile(sourceFileUrl)\n            sourcesContent[index] = sourceFileContent\n          }\n        }),\n      )\n    }\n\n    if (sourcemapExcludeSources) {\n      delete map.sourcesContent\n    }\n\n    // we don't need sourceRoot because our path are relative or absolute to the current location\n    // we could comment this line because it is not set by babel because not passed during transform\n    delete map.sourceRoot\n\n    if (sourcemapMethod === \"inline\") {\n      output = setJavaScriptSourceMappingUrl(output, sourcemapToBase64Url(map))\n    } else if (sourcemapMethod === \"comment\") {\n      const sourcemapFileRelativePathForModule = urlToRelativeUrl(sourcemapFileUrl, compiledFileUrl)\n      output = setJavaScriptSourceMappingUrl(output, sourcemapFileRelativePathForModule)\n      assets.push(sourcemapFileUrl)\n      assetsContent.push(stringifyMap(map))\n    }\n  } else {\n    sources.push(originalFileUrl)\n    sourcesContent.push(originalFileContent)\n  }\n\n  const { coverage } = metadata\n  if (coverage) {\n    const coverageAssetFileUrl = generateCompiledFileAssetUrl(compiledFileUrl, \"coverage.json\")\n    assets.push(coverageAssetFileUrl)\n    assetsContent.push(stringifyCoverage(coverage))\n  }\n\n  return {\n    compiledSource: output,\n    contentType: \"application/javascript\",\n    sources,\n    sourcesContent,\n    assets,\n    assetsContent,\n  }\n}\n\nconst stringifyMap = (object) => JSON.stringify(object, null, \"  \")\n\nconst stringifyCoverage = (object) => JSON.stringify(object, null, \"  \")\n",
    "import { dirname } from \"path\"\nimport { readFileSync, writeFileSync, mkdirSync, existsSync } from \"fs\"\nimport { urlToFileSystemPath } from \"@jsenv/util\"\n\n// readFileSync seems faster than readFile\n// and in our case we are talking about a dev server\n// in other words it's not super important to handle concurrent connections\n// https://gist.github.com/adamhooper/9e0e2583e0f22ace0e0840b9c09e395d\n// https://stackoverflow.com/questions/42321861/fs-readfile-is-very-slow-am-i-making-too-many-request\nexport const readFileContent = async (url) => {\n  const buffer = readFileSync(urlToFileSystemPath(url))\n  return String(buffer)\n}\n\nexport const writeFileContent = async (url, content, { fileLikelyNotFound = false } = {}) => {\n  const filePath = urlToFileSystemPath(url)\n  const directoryPath = dirname(filePath)\n\n  const ensureParentDirectory = () => {\n    try {\n      mkdirSync(directoryPath, { recursive: true })\n    } catch (error) {\n      if (error.code === \"EEXIST\") {\n        return\n      }\n      throw error\n    }\n  }\n\n  if (fileLikelyNotFound) {\n    // whenever outside knows file is likely not exisiting\n    // ensure parent directory exists first\n    ensureParentDirectory()\n    writeFileSync(filePath, content)\n  } else {\n    // most of the time when you want to write a file it's likely existing (at least the parent directory)\n    try {\n      writeFileSync(filePath, content)\n    } catch (error) {\n      if (error.code === \"ENOENT\") {\n        ensureParentDirectory()\n        writeFileSync(filePath, content)\n        return\n      }\n      throw error\n    }\n  }\n}\n\nexport const testFilePresence = async (url) => {\n  return existsSync(urlToFileSystemPath(url))\n}\n",
    "import { urlToFileSystemPath } from \"@jsenv/util\"\nimport { getMetaJsonFileUrl } from \"./compile-asset.js\"\nimport { readFileContent } from \"./fs-optimized-for-cache.js\"\n\nexport const readMeta = async ({ logger, compiledFileUrl }) => {\n  const metaJsonFileUrl = getMetaJsonFileUrl(compiledFileUrl)\n\n  try {\n    const metaJsonString = await readFileContent(metaJsonFileUrl)\n    const metaJsonObject = JSON.parse(metaJsonString)\n    return metaJsonObject\n  } catch (error) {\n    if (error && error.code === \"ENOENT\") {\n      logger.debug(`no meta.json.\n--- meta.json path ---\n${urlToFileSystemPath(metaJsonFileUrl)}\n--- compiled file ---\n${urlToFileSystemPath(compiledFileUrl)}`)\n      return null\n    }\n\n    if (error && error.name === \"SyntaxError\") {\n      logger.error(\n        createCacheSyntaxErrorMessage({\n          syntaxError: error,\n          metaJsonFileUrl,\n        }),\n      )\n      return null\n    }\n\n    throw error\n  }\n}\n\nconst createCacheSyntaxErrorMessage = ({ syntaxError, metaJsonFileUrl }) => `meta.json syntax error.\n--- syntax error stack ---\n${syntaxError.stack}\n--- meta.json path ---\n${urlToFileSystemPath(metaJsonFileUrl)}`\n",
    "import {\n  resolveUrl,\n  urlToFileSystemPath,\n  readFileSystemNodeModificationTime,\n  bufferToEtag,\n} from \"@jsenv/util\"\nimport { timeFunction } from \"@jsenv/server\"\nimport { readFileContent } from \"./fs-optimized-for-cache.js\"\nimport { getMetaJsonFileUrl } from \"./compile-asset.js\"\n\nexport const validateMeta = async ({\n  logger,\n  meta,\n  compiledFileUrl,\n  ifEtagMatch,\n  ifModifiedSinceDate,\n  compileCacheSourcesValidation = true,\n  compileCacheAssetsValidation = true,\n}) => {\n  const [compiledFileValidationTiming, compiledFileValidation] = await timeFunction(\n    \"cache compiled file validation\",\n    () =>\n      validateCompiledFile({\n        compiledFileUrl,\n        ifEtagMatch,\n        ifModifiedSinceDate,\n      }),\n  )\n\n  if (!compiledFileValidation.valid) {\n    logger.debug(\n      `${urlToFileSystemPath(compiledFileUrl)} modified (${compiledFileValidation.code})`,\n    )\n    return {\n      ...compiledFileValidation,\n      timing: compiledFileValidationTiming,\n    }\n  }\n  logger.debug(`${urlToFileSystemPath(compiledFileUrl)} not modified`)\n\n  if (meta.sources.length === 0) {\n    logger.warn(`meta.sources is empty, cache considered as invalid by precaution`)\n    return {\n      code: \"SOURCES_EMPTY\",\n      valid: false,\n      timing: compiledFileValidationTiming,\n    }\n  }\n\n  const [\n    [sourcesValidationTiming, sourcesValidations],\n    [assetsValidationTiming, assetValidations],\n  ] = await Promise.all([\n    timeFunction(\"cache sources validation\", () =>\n      compileCacheSourcesValidation\n        ? validateSources({\n            meta,\n            compiledFileUrl,\n          })\n        : [],\n    ),\n    timeFunction(\"cache assets validation\", () =>\n      compileCacheAssetsValidation\n        ? validateAssets({\n            meta,\n            compiledFileUrl,\n          })\n        : [],\n    ),\n  ])\n\n  const invalidSourceValidation = sourcesValidations.find(({ valid }) => !valid)\n  if (invalidSourceValidation) {\n    logger.debug(\n      `${urlToFileSystemPath(invalidSourceValidation.data.sourceFileUrl)} source modified (${\n        invalidSourceValidation.code\n      })`,\n    )\n    return {\n      ...invalidSourceValidation,\n      timing: {\n        ...compiledFileValidationTiming,\n        ...sourcesValidationTiming,\n        ...assetsValidationTiming,\n      },\n    }\n  }\n  const invalidAssetValidation = assetValidations.find(({ valid }) => !valid)\n  if (invalidAssetValidation) {\n    logger.debug(\n      `${urlToFileSystemPath(invalidAssetValidation.data.assetFileUrl)} asset modified (${\n        invalidAssetValidation.code\n      })`,\n    )\n    return {\n      ...invalidAssetValidation,\n      timing: {\n        ...compiledFileValidationTiming,\n        ...sourcesValidationTiming,\n        ...assetsValidationTiming,\n      },\n    }\n  }\n  logger.debug(`${urlToFileSystemPath(compiledFileUrl)} cache is valid`)\n\n  const compiledSource = compiledFileValidation.data.compiledSource\n  const sourcesContent = sourcesValidations.map(({ data }) => data.sourceContent)\n  const assetsContent = assetValidations.find(({ data }) => data.assetContent)\n\n  return {\n    valid: true,\n    data: {\n      compiledSource,\n      sourcesContent,\n      assetsContent,\n    },\n    timing: {\n      ...compiledFileValidationTiming,\n      ...sourcesValidationTiming,\n      ...assetsValidationTiming,\n    },\n  }\n}\n\nconst validateCompiledFile = async ({ compiledFileUrl, ifEtagMatch, ifModifiedSinceDate }) => {\n  try {\n    const compiledSource = await readFileContent(compiledFileUrl)\n\n    if (ifEtagMatch) {\n      const compiledEtag = bufferToEtag(Buffer.from(compiledSource))\n      if (ifEtagMatch !== compiledEtag) {\n        return {\n          code: \"COMPILED_FILE_ETAG_MISMATCH\",\n          valid: false,\n          data: { compiledSource, compiledEtag },\n        }\n      }\n    }\n\n    if (ifModifiedSinceDate) {\n      const compiledMtime = await readFileSystemNodeModificationTime(compiledFileUrl)\n      if (ifModifiedSinceDate < dateToSecondsPrecision(compiledMtime)) {\n        return {\n          code: \"COMPILED_FILE_MTIME_OUTDATED\",\n          valid: false,\n          data: { compiledSource, compiledMtime },\n        }\n      }\n    }\n\n    return {\n      valid: true,\n      data: { compiledSource },\n    }\n  } catch (error) {\n    if (error && error.code === \"ENOENT\") {\n      return {\n        code: \"COMPILED_FILE_NOT_FOUND\",\n        valid: false,\n        data: { compiledFileUrl },\n      }\n    }\n    return Promise.reject(error)\n  }\n}\n\nconst validateSources = ({ meta, compiledFileUrl }) => {\n  return Promise.all(\n    meta.sources.map((source, index) =>\n      validateSource({\n        compiledFileUrl,\n        source,\n        eTag: meta.sourcesEtag[index],\n      }),\n    ),\n  )\n}\n\nconst validateSource = async ({ compiledFileUrl, source, eTag }) => {\n  const metaJsonFileUrl = getMetaJsonFileUrl(compiledFileUrl)\n  const sourceFileUrl = resolveUrl(source, metaJsonFileUrl)\n\n  try {\n    const sourceContent = await readFileContent(sourceFileUrl)\n    const sourceETag = bufferToEtag(Buffer.from(sourceContent))\n\n    if (sourceETag !== eTag) {\n      return {\n        code: \"SOURCE_ETAG_MISMATCH\",\n        valid: false,\n        data: {\n          source,\n          sourceFileUrl,\n          sourceContent,\n        },\n      }\n    }\n\n    return {\n      valid: true,\n      data: { sourceContent },\n    }\n  } catch (e) {\n    if (e && e.code === \"ENOENT\") {\n      // missing source invalidates the cache because\n      // we cannot check its validity\n      // HOWEVER inside writeMeta we will check if a source can be found\n      // when it cannot we will not put it as a dependency\n      // to invalidate the cache.\n      // It is important because some files are constructed on other files\n      // which are not truly on the filesystem\n      // (IN theory the above happens only for convertCommonJsWithRollup because jsenv\n      // always have a concrete file especially to avoid that kind of thing)\n      return {\n        code: \"SOURCE_NOT_FOUND\",\n        valid: false,\n        data: {\n          source,\n          sourceFileUrl,\n          sourceContent: \"\",\n        },\n      }\n    }\n    throw e\n  }\n}\n\nconst validateAssets = ({ compiledFileUrl, meta }) =>\n  Promise.all(\n    meta.assets.map((asset, index) =>\n      validateAsset({\n        asset,\n        compiledFileUrl,\n        eTag: meta.assetsEtag[index],\n      }),\n    ),\n  )\n\nconst validateAsset = async ({ asset, compiledFileUrl, eTag }) => {\n  const metaJsonFileUrl = getMetaJsonFileUrl(compiledFileUrl)\n  const assetFileUrl = resolveUrl(asset, metaJsonFileUrl)\n\n  try {\n    const assetContent = await readFileContent(assetFileUrl)\n    const assetContentETag = bufferToEtag(Buffer.from(assetContent))\n\n    if (eTag !== assetContentETag) {\n      return {\n        code: \"ASSET_ETAG_MISMATCH\",\n        valid: false,\n        data: { asset, assetFileUrl, assetContent, assetContentETag },\n      }\n    }\n\n    return {\n      valid: true,\n      data: { assetContent, assetContentETag },\n    }\n  } catch (error) {\n    if (error && error.code === \"ENOENT\") {\n      return {\n        code: \"ASSET_FILE_NOT_FOUND\",\n        valid: false,\n        data: { asset, assetFileUrl },\n      }\n    }\n    return Promise.reject(error)\n  }\n}\n\nconst dateToSecondsPrecision = (date) => {\n  const dateWithSecondsPrecision = new Date(date)\n  dateWithSecondsPrecision.setMilliseconds(0)\n  return dateWithSecondsPrecision\n}\n",
    "import { urlToRelativeUrl, urlToFileSystemPath, bufferToEtag } from \"@jsenv/util\"\nimport { writeFileContent, testFilePresence } from \"./fs-optimized-for-cache.js\"\nimport { getMetaJsonFileUrl } from \"./compile-asset.js\"\n\nexport const updateMeta = async ({\n  logger,\n  meta,\n  compiledFileUrl,\n  cacheHitTracking,\n  compileResult,\n  compileResultStatus,\n}) => {\n  const isNew = compileResultStatus === \"created\"\n  const isUpdated = compileResultStatus === \"updated\"\n  const isCached = compileResultStatus === \"cached\"\n  const { compiledSource, contentType, assets, assetsContent } = compileResult\n  let { sources, sourcesContent } = compileResult\n\n  const promises = []\n  if (isNew || isUpdated) {\n    // ensure source that does not leads to concrete files are not capable to invalidate the cache\n    const sourceExists = await Promise.all(\n      sources.map(async (sourceFileUrl) => {\n        const sourceFileExists = await testFilePresence(sourceFileUrl)\n        if (sourceFileExists) {\n          return true\n        }\n        // this can lead to cache never invalidated by itself\n        // it's a very important warning\n        logger.warn(`a source file cannot be found -> excluded from meta.sources & meta.sourcesEtag.\n--- source ---\n${sourceFileUrl}`)\n        return false\n      }),\n    )\n    sources = sources.filter((source, index) => sourceExists[index])\n    sourcesContent = sourcesContent.filter((sourceContent, index) => sourceExists[index])\n\n    const { writeCompiledSourceFile = true, writeAssetsFile = true } = compileResult\n\n    if (writeCompiledSourceFile) {\n      logger.debug(`write compiled file at ${urlToFileSystemPath(compiledFileUrl)}`)\n      promises.push(\n        writeFileContent(compiledFileUrl, compiledSource, {\n          fileLikelyNotFound: isNew,\n        }),\n      )\n    }\n\n    if (writeAssetsFile) {\n      promises.push(\n        ...assets.map((assetFileUrl, index) => {\n          logger.debug(`write compiled file asset at ${urlToFileSystemPath(assetFileUrl)}`)\n          return writeFileContent(assetFileUrl, assetsContent[index], {\n            fileLikelyNotFound: isNew,\n          })\n        }),\n      )\n    }\n  }\n\n  const metaJsonFileUrl = getMetaJsonFileUrl(compiledFileUrl)\n\n  if (isNew || isUpdated || (isCached && cacheHitTracking)) {\n    let latestMeta\n\n    const sourceAndAssetProps = {\n      sources: sources.map((source) => urlToRelativeUrl(source, metaJsonFileUrl)),\n      sourcesEtag: sourcesContent.map((sourceContent) => bufferToEtag(Buffer.from(sourceContent))),\n      assets: assets.map((asset) => urlToRelativeUrl(asset, metaJsonFileUrl)),\n      assetsEtag: assetsContent.map((assetContent) => bufferToEtag(Buffer.from(assetContent))),\n    }\n\n    if (isNew) {\n      latestMeta = {\n        contentType,\n        ...sourceAndAssetProps,\n        createdMs: Number(Date.now()),\n        lastModifiedMs: Number(Date.now()),\n      }\n    } else if (isUpdated) {\n      latestMeta = {\n        ...meta,\n        ...sourceAndAssetProps,\n        lastModifiedMs: Number(Date.now()),\n      }\n    } else {\n      latestMeta = {\n        ...meta,\n      }\n    }\n\n    if (cacheHitTracking) {\n      latestMeta = {\n        ...latestMeta,\n        matchCount: 1,\n        lastMatchMs: Number(Date.now()),\n      }\n    }\n\n    logger.debug(`write compiled file meta at ${urlToFileSystemPath(metaJsonFileUrl)}`)\n    promises.push(\n      writeFileContent(metaJsonFileUrl, JSON.stringify(latestMeta, null, \"  \"), {\n        fileLikelyNotFound: isNew,\n      }),\n    )\n  }\n\n  return Promise.all(promises)\n}\n",
    "export const createLockRegistry = () => {\n  let lockArray = []\n  const lockForRessource = async (ressource) => {\n    const currentLock = lockArray.find((lock) => lock.ressource === ressource)\n    let unlockResolve\n    const unlocked = new Promise((resolve) => {\n      unlockResolve = resolve\n    })\n    const lock = {\n      ressource,\n      unlocked,\n    }\n    lockArray = [...lockArray, lock]\n\n    if (currentLock) await currentLock.unlocked\n\n    const unlock = () => {\n      lockArray = lockArray.filter((lockCandidate) => lockCandidate !== lock)\n      unlockResolve()\n    }\n    return unlock\n  }\n  return { lockForRessource }\n}\n",
    "import { urlToFileSystemPath, ensureParentDirectories } from \"@jsenv/util\"\nimport { timeStart, timeFunction } from \"@jsenv/server\"\nimport { require } from \"../../require.js\"\nimport { readFileContent } from \"./fs-optimized-for-cache.js\"\nimport { readMeta } from \"./readMeta.js\"\nimport { validateMeta } from \"./validateMeta.js\"\nimport { updateMeta } from \"./updateMeta.js\"\nimport { getMetaJsonFileUrl } from \"./compile-asset.js\"\nimport { createLockRegistry } from \"./createLockRegistry.js\"\n\nconst { lockForRessource } = createLockRegistry()\n\nexport const getOrGenerateCompiledFile = async ({\n  logger,\n\n  projectDirectoryUrl,\n  originalFileUrl,\n  compiledFileUrl = originalFileUrl,\n  writeOnFilesystem,\n  useFilesystemAsCache,\n  cacheHitTracking = false,\n  cacheInterProcessLocking = false,\n  compileCacheSourcesValidation,\n  compileCacheAssetsValidation,\n  ifEtagMatch,\n  ifModifiedSinceDate,\n  compile,\n}) => {\n  if (typeof projectDirectoryUrl !== \"string\") {\n    throw new TypeError(`projectDirectoryUrl must be a string, got ${projectDirectoryUrl}`)\n  }\n  if (typeof originalFileUrl !== \"string\") {\n    throw new TypeError(`originalFileUrl must be a string, got ${originalFileUrl}`)\n  }\n  if (!originalFileUrl.startsWith(projectDirectoryUrl)) {\n    throw new Error(`origin file must be inside project\n--- original file url ---\n${originalFileUrl}\n--- project directory url ---\n${projectDirectoryUrl}`)\n  }\n  if (typeof compiledFileUrl !== \"string\") {\n    throw new TypeError(`compiledFileUrl must be a string, got ${compiledFileUrl}`)\n  }\n  if (!compiledFileUrl.startsWith(projectDirectoryUrl)) {\n    throw new Error(`compiled file must be inside project\n--- compiled file url ---\n${compiledFileUrl}\n--- project directory url ---\n${projectDirectoryUrl}`)\n  }\n  if (typeof compile !== \"function\") {\n    throw new TypeError(`compile must be a function, got ${compile}`)\n  }\n\n  const lockTimeEnd = timeStart(\"lock\")\n  return startAsap(\n    async () => {\n      const lockTiming = lockTimeEnd()\n      const { meta, compileResult, compileResultStatus, timing } = await computeCompileReport({\n        originalFileUrl,\n        compiledFileUrl,\n        compile,\n        ifEtagMatch,\n        ifModifiedSinceDate,\n        useFilesystemAsCache,\n        compileCacheSourcesValidation,\n        compileCacheAssetsValidation,\n        logger,\n      })\n\n      let cacheWriteTiming = {}\n      if (writeOnFilesystem) {\n        const result = await timeFunction(\"cache write\", () =>\n          updateMeta({\n            logger,\n            meta,\n            compileResult,\n            compileResultStatus,\n            compiledFileUrl,\n            cacheHitTracking,\n          }),\n        )\n        cacheWriteTiming = result[0]\n      }\n\n      return {\n        meta,\n        compileResult,\n        compileResultStatus,\n        timing: {\n          ...lockTiming,\n          ...timing,\n          ...cacheWriteTiming,\n        },\n      }\n    },\n    {\n      compiledFileUrl,\n      cacheInterProcessLocking,\n      logger,\n    },\n  )\n}\n\nconst computeCompileReport = async ({\n  originalFileUrl,\n  compiledFileUrl,\n  compile,\n  ifEtagMatch,\n  ifModifiedSinceDate,\n  useFilesystemAsCache,\n  compileCacheSourcesValidation,\n  compileCacheAssetsValidation,\n  logger,\n}) => {\n  const [cacheReadTiming, meta] = await timeFunction(\"cache read\", async () => {\n    if (useFilesystemAsCache) {\n      return readMeta({\n        logger,\n        compiledFileUrl,\n      })\n    }\n    return null\n  })\n\n  if (!meta) {\n    const [compileTiming, compileResult] = await timeFunction(\"compile\", () =>\n      callCompile({\n        logger,\n        originalFileUrl,\n        compile,\n      }),\n    )\n\n    return {\n      meta: null,\n      compileResult,\n      compileResultStatus: \"created\",\n      timing: {\n        ...cacheReadTiming,\n        ...compileTiming,\n      },\n    }\n  }\n\n  const metaValidation = await validateMeta({\n    logger,\n    meta,\n    compiledFileUrl,\n    ifEtagMatch,\n    ifModifiedSinceDate,\n    compileCacheSourcesValidation,\n    compileCacheAssetsValidation,\n  })\n\n  if (!metaValidation.valid) {\n    const [compileTiming, compileResult] = await timeFunction(\"compile\", () =>\n      callCompile({\n        logger,\n        originalFileUrl,\n        compile,\n      }),\n    )\n    return {\n      meta,\n      compileResult,\n      compileResultStatus: \"updated\",\n      timing: {\n        ...cacheReadTiming,\n        ...metaValidation.timing,\n        ...compileTiming,\n      },\n    }\n  }\n\n  const { contentType, sources, assets } = meta\n  const { compiledSource, sourcesContent, assetsContent } = metaValidation.data\n  return {\n    meta,\n    compileResult: {\n      contentType,\n      compiledSource,\n      sources,\n      sourcesContent,\n      assets,\n      assetsContent,\n    },\n    compileResultStatus: \"cached\",\n    timing: {\n      ...cacheReadTiming,\n      ...metaValidation.timing,\n    },\n  }\n}\n\nconst callCompile = async ({ logger, originalFileUrl, compile }) => {\n  logger.debug(`compile ${originalFileUrl}`)\n\n  const {\n    sources = [],\n    sourcesContent = [],\n    assets = [],\n    assetsContent = [],\n    contentType,\n    compiledSource,\n    ...rest\n  } = await compile(compile.length ? await readFileContent(originalFileUrl) : undefined)\n\n  if (typeof contentType !== \"string\") {\n    throw new TypeError(`compile must return a contentType string, got ${contentType}`)\n  }\n  if (typeof compiledSource !== \"string\") {\n    throw new TypeError(`compile must return a compiledSource string, got ${compiledSource}`)\n  }\n\n  return {\n    contentType,\n    compiledSource,\n    sources,\n    sourcesContent,\n    assets,\n    assetsContent,\n    ...rest,\n  }\n}\n\nconst startAsap = async (fn, { logger, compiledFileUrl, cacheInterProcessLocking }) => {\n  const metaJsonFileUrl = getMetaJsonFileUrl(compiledFileUrl)\n  const metaJsonFilePath = urlToFileSystemPath(metaJsonFileUrl)\n\n  logger.debug(`lock ${metaJsonFilePath}`)\n  // in case this process try to concurrently access meta we wait for previous to be done\n  const unlockLocal = await lockForRessource(metaJsonFilePath)\n\n  let unlockInterProcessLock = () => {}\n  if (cacheInterProcessLocking) {\n    // after that we use a lock pathnameRelative to be sure we don't conflict with other process\n    // trying to do the same (mapy happen when spawining multiple server for instance)\n    // https://github.com/moxystudio/node-proper-lockfile/issues/69\n    await ensureParentDirectories(metaJsonFilePath)\n    // https://github.com/moxystudio/node-proper-lockfile#lockfile-options\n    const lockfile = require(\"proper-lockfile\")\n    unlockInterProcessLock = await lockfile.lock(metaJsonFilePath, {\n      realpath: false,\n      retries: {\n        retries: 20,\n        minTimeout: 20,\n        maxTimeout: 500,\n      },\n    })\n  }\n\n  try {\n    return await fn()\n  } finally {\n    // we want to unlock in case of error too\n    logger.debug(`unlock ${metaJsonFilePath}`)\n    unlockLocal()\n    unlockInterProcessLock()\n  }\n\n  // here in case of error.code === 'ELOCKED' thrown from here\n  // https://github.com/moxystudio/node-proper-lockfile/blob/1a478a43a077a7a7efc46ac79fd8f713a64fd499/lib/lockfile.js#L54\n  // we could give a better failure message when server tries to compile a file\n  // otherwise he'll get a 500 without much more info to debug\n\n  // we use two lock because the local lock is very fast, it's a sort of perf improvement\n}\n",
    "import { convertFileSystemErrorToResponseProperties } from \"@jsenv/server\"\nimport {\n  urlToRelativeUrl,\n  fileSystemPathToUrl,\n  resolveUrl,\n  bufferToEtag,\n  readFileSystemNodeModificationTime,\n} from \"@jsenv/util\"\nimport { getOrGenerateCompiledFile } from \"./compile-directory/getOrGenerateCompiledFile.js\"\n\nexport const compileFile = async ({\n  // cancellatioToken,\n  logger,\n\n  projectDirectoryUrl,\n  originalFileUrl,\n  compiledFileUrl,\n  projectFileRequestedCallback = () => {},\n  request,\n  compile,\n  writeOnFilesystem,\n  useFilesystemAsCache,\n  compileCacheStrategy = \"etag\",\n  serverCompileCacheHitTracking = false,\n  serverCompileCacheInterProcessLocking = false,\n  compileCacheSourcesValidation,\n  compileCacheAssetsValidation,\n}) => {\n  if (writeOnFilesystem && compileCacheStrategy !== \"etag\" && compileCacheStrategy !== \"mtime\") {\n    throw new Error(`compileCacheStrategy must be etag or mtime , got ${compileCacheStrategy}`)\n  }\n\n  const { headers = {} } = request\n  const clientCacheDisabled = headers[\"cache-control\"] === \"no-cache\"\n  const cacheWithETag = writeOnFilesystem && compileCacheStrategy === \"etag\"\n\n  let ifEtagMatch\n  if (cacheWithETag && \"if-none-match\" in headers) {\n    ifEtagMatch = headers[\"if-none-match\"]\n  }\n\n  const cacheWithMtime = writeOnFilesystem && compileCacheStrategy === \"mtime\"\n  let ifModifiedSinceDate\n  if (cacheWithMtime && \"if-modified-since\" in headers) {\n    const ifModifiedSince = headers[\"if-modified-since\"]\n    try {\n      ifModifiedSinceDate = new Date(ifModifiedSince)\n    } catch (e) {\n      return {\n        status: 400,\n        statusText: \"if-modified-since header is not a valid date\",\n      }\n    }\n  }\n\n  try {\n    const { compileResult, compileResultStatus, timing } = await getOrGenerateCompiledFile({\n      logger,\n      projectDirectoryUrl,\n      originalFileUrl,\n      compiledFileUrl,\n      ifEtagMatch,\n      ifModifiedSinceDate,\n      writeOnFilesystem,\n      useFilesystemAsCache,\n      cacheHitTracking: serverCompileCacheHitTracking,\n      cacheInterProcessLocking: serverCompileCacheInterProcessLocking,\n      compileCacheSourcesValidation,\n      compileCacheAssetsValidation,\n      compile,\n    })\n\n    projectFileRequestedCallback(urlToRelativeUrl(originalFileUrl, projectDirectoryUrl), request)\n    compileResult.sources.forEach((source) => {\n      const sourceFileUrl = resolveUrl(source, compiledFileUrl)\n      projectFileRequestedCallback(urlToRelativeUrl(sourceFileUrl, projectDirectoryUrl), request)\n    })\n\n    const { contentType, compiledSource } = compileResult\n\n    if (cacheWithETag && !clientCacheDisabled) {\n      if (ifEtagMatch && compileResultStatus === \"cached\") {\n        return {\n          status: 304,\n          timing,\n        }\n      }\n      return {\n        status: 200,\n        headers: {\n          \"content-length\": Buffer.byteLength(compiledSource),\n          \"content-type\": contentType,\n          \"etag\": bufferToEtag(Buffer.from(compiledSource)),\n        },\n        body: compiledSource,\n        timing,\n      }\n    }\n\n    if (cacheWithMtime && !clientCacheDisabled) {\n      if (ifModifiedSinceDate && compileResultStatus === \"cached\") {\n        return {\n          status: 304,\n          timing,\n        }\n      }\n      return {\n        status: 200,\n        headers: {\n          \"content-length\": Buffer.byteLength(compiledSource),\n          \"content-type\": contentType,\n          \"last-modified\": new Date(\n            await readFileSystemNodeModificationTime(compiledFileUrl),\n          ).toUTCString(),\n        },\n        body: compiledSource,\n        timing,\n      }\n    }\n\n    return {\n      status: 200,\n      headers: {\n        \"content-length\": Buffer.byteLength(compiledSource),\n        \"content-type\": contentType,\n      },\n      body: compiledSource,\n      timing,\n    }\n  } catch (error) {\n    if (error && error.code === \"PARSE_ERROR\") {\n      const relativeUrl = urlToRelativeUrl(\n        fileSystemPathToUrl(error.data.filename),\n        projectDirectoryUrl,\n      )\n      projectFileRequestedCallback(relativeUrl, request)\n      // on the correspondig file\n      const json = JSON.stringify(error.data)\n\n      return {\n        status: 500,\n        statusText: \"parse error\",\n        headers: {\n          \"cache-control\": \"no-store\",\n          \"content-length\": Buffer.byteLength(json),\n          \"content-type\": \"application/json\",\n        },\n        body: json,\n      }\n    }\n\n    if (error && error.statusText === \"Unexpected directory operation\") {\n      return {\n        status: 403,\n      }\n    }\n\n    return convertFileSystemErrorToResponseProperties(error)\n  }\n}\n",
    "import { require } from \"@jsenv/core/src/internal/require.js\"\n\n// https://github.com/terser-js/terser#minify-options\nexport const minifyJs = async (jsString, jsUrl, options) => {\n  const { minify } = require(\"terser\")\n  const result = await minify({ [jsUrl]: jsString }, options)\n  return result\n}\n",
    "import { readFileSync } from \"fs\"\nimport { resolveUrl, urlToFileSystemPath, fileSystemPathToUrl } from \"@jsenv/util\"\nimport { require } from \"@jsenv/core/src/internal/require.js\"\n\nconst { transformSync } = require(\"@babel/core\")\n\nexport const bundleWorker = ({ workerScriptUrl, workerScriptSourceMap }) => {\n  const { code, map } = transformWorkerScript(workerScriptUrl, { workerScriptSourceMap })\n  return { code, map }\n}\n\nconst transformWorkerScript = (scriptUrl, { workerScriptSourceMap, importerUrl }) => {\n  const scriptPath = urlToFileSystemPath(scriptUrl)\n  let scriptContent\n  try {\n    scriptContent = String(readFileSync(scriptPath))\n  } catch (e) {\n    if (e.code === \"ENOENT\") {\n      if (importerUrl) {\n        throw new Error(`no file found for an import in a worker.\n--- worker url ---\n${importerUrl}.\n--- imported url ---\n${scriptUrl}`)\n      }\n      throw new Error(`no worker file at ${scriptUrl}`)\n    }\n    throw e\n  }\n  const { code, map } = transformSync(scriptContent, {\n    filename: scriptPath,\n    configFile: false,\n    babelrc: false, // trust only these options, do not read any babelrc config file\n    ast: false,\n    inputSourceMap: workerScriptSourceMap,\n    sourceMaps: true,\n    // sourceFileName: scriptPath,\n    plugins: [[babelPluginInlineImportScripts, {}]],\n  })\n  return { code, map }\n}\n\nconst babelPluginInlineImportScripts = (api) => {\n  const { types, parse } = api\n  return {\n    name: \"transform-inline-import-scripts\",\n\n    visitor: {\n      CallExpression: (\n        path,\n        {\n          file: {\n            opts: { filename },\n          },\n        },\n      ) => {\n        const calleePath = path.get(\"callee\")\n\n        const replaceImportScriptsWithFileContents = () => {\n          const fileUrl = fileSystemPathToUrl(filename)\n\n          let previousArgType = \"\"\n          const importedUrls = path.get(\"arguments\").map((arg, index) => {\n            if (!types.isStringLiteral(arg)) {\n              if (previousArgType && previousArgType !== \"dynamic\") {\n                throw new Error(\n                  `importScript mixed arguments: arg number ${index} is dynamic while previous arg was ${previousArgType}`,\n                )\n              }\n              previousArgType = \"dynamic\"\n              return arg\n            }\n            const importedUrl = resolveUrl(arg.node.value, fileUrl)\n            if (!importedUrl.startsWith(\"file://\")) {\n              if (previousArgType && previousArgType !== \"remote\") {\n                throw new Error(\n                  `importScript mixed arguments: arg number ${index} targets a remote url while previous arg was ${previousArgType}`,\n                )\n              }\n              previousArgType = \"remote\"\n              return arg\n            }\n            previousArgType = \"local\"\n            return importedUrl\n          })\n\n          if (previousArgType === \"local\") {\n            const nodes = importedUrls.reduce((previous, importedUrl) => {\n              const importedScriptResult = transformWorkerScript(importedUrl, {\n                importerUrl: fileUrl,\n              })\n              const importedSourceAst = parse(importedScriptResult.code)\n              return [...previous, ...importedSourceAst.program.body]\n            }, [])\n\n            calleePath.parentPath.replaceWithMultiple(nodes)\n          }\n        }\n\n        if (types.isIdentifier(calleePath.node, { name: \"importScripts\" })) {\n          replaceImportScriptsWithFileContents()\n          return\n        }\n\n        if (types.isMemberExpression(calleePath.node)) {\n          const calleeObject = calleePath.get(\"object\")\n          const isSelf = types.isIdentifier(calleeObject.node, { name: \"self\" })\n          if (isSelf) {\n            const propertyPath = calleePath.get(\"property\")\n            if (types.isIdentifier(propertyPath.node, { name: \"importScripts\" })) {\n              replaceImportScriptsWithFileContents()\n              return\n            }\n          }\n        }\n      },\n    },\n  }\n}\n",
    "import { resolveUrl, urlToFilename, writeFile, urlToParentUrl } from \"@jsenv/util\"\n\nimport { minifyJs } from \"@jsenv/core/src/internal/building/js/minifyJs.js\"\nimport { setJavaScriptSourceMappingUrl } from \"@jsenv/core/src/internal/sourceMappingURLUtils.js\"\nimport { bundleWorker } from \"./bundleWorker.js\"\n\nexport const buildServiceWorker = async ({\n  projectDirectoryUrl,\n  buildDirectoryUrl,\n  serviceWorkerProjectRelativeUrl,\n  serviceWorkerBuildRelativeUrl = serviceWorkerProjectRelativeUrl,\n  minify = false,\n  serviceWorkerTransformer = (code) => code,\n}) => {\n  const serviceWorkerProjectUrl = resolveUrl(serviceWorkerProjectRelativeUrl, projectDirectoryUrl)\n  const serviceWorkerBuildUrl = resolveUrl(serviceWorkerBuildRelativeUrl, buildDirectoryUrl)\n  const workerBundle = bundleWorker({ workerScriptUrl: serviceWorkerProjectUrl })\n  const serviceWorkerCode = serviceWorkerTransformer(workerBundle.code)\n\n  if (minify) {\n    const minifyResult = await minifyJs(serviceWorkerCode, serviceWorkerProjectRelativeUrl, {\n      sourceMap: {\n        ...(workerBundle.map ? { content: JSON.stringify(workerBundle.map) } : {}),\n        asObject: true,\n        includeSources: true,\n      },\n    })\n    await writeJsAndSourcemap(serviceWorkerBuildUrl, minifyResult.code, minifyResult.map)\n  } else {\n    await writeJsAndSourcemap(serviceWorkerBuildUrl, serviceWorkerCode, workerBundle.map)\n  }\n}\n\nconst writeJsAndSourcemap = async (\n  serviceWorkerBuildUrl,\n  serviceWorkerCode,\n  serviceWorkerSourceMap,\n) => {\n  const filename = urlToFilename(serviceWorkerBuildUrl)\n  const sourcemapFilename = `${filename}.map`\n  const sourcemapBuildUrl = `${urlToParentUrl(serviceWorkerBuildUrl)}${sourcemapFilename}`\n  serviceWorkerCode = setJavaScriptSourceMappingUrl(serviceWorkerCode, sourcemapFilename)\n  await Promise.all([\n    writeFile(serviceWorkerBuildUrl, serviceWorkerCode),\n    writeFile(sourcemapBuildUrl, JSON.stringify(serviceWorkerSourceMap, null, \"  \")),\n  ])\n}\n",
    "import { globalAgent } from \"https\"\nimport { fetchUrl as serverFetchUrl, headersToObject } from \"@jsenv/server\"\n\n// ideally we should only pass this to the fetch below\nglobalAgent.options.rejectUnauthorized = false\n\nexport const fetchUrl = async (url, { ignoreHttpsError = true, ...rest } = {}) => {\n  const response = await serverFetchUrl(url, { ignoreHttpsError, ...rest })\n\n  return {\n    url: response.url,\n    status: response.status,\n    statusText: response.statusText,\n    headers: headersToObject(response.headers),\n    text: response.text.bind(response),\n    json: response.json.bind(response),\n    blob: response.blob.bind(response),\n    arrayBuffer: response.arrayBuffer.bind(response),\n  }\n}\n",
    "export const validateResponseStatusIsOk = ({ status, url }, importer) => {\n  if (status === 404) {\n    return {\n      valid: false,\n      message: `Error: got 404 on url.\n--- url ---\n${url}\n--- imported by ---\n${importer}`,\n    }\n  }\n\n  if (responseStatusIsOk(status)) {\n    return { valid: true }\n  }\n\n  return {\n    valid: false,\n    message: `unexpected response status.\n--- response status ---\n${status}\n--- expected status ---\n200 to 299\n--- url ---\n${url}\n--- imported by ---\n${importer}`,\n  }\n}\n\nconst responseStatusIsOk = (responseStatus) => responseStatus >= 200 && responseStatus < 300\n",
    "export const renderNamePattern = (pattern, replacements) => {\n  return pattern.replace(/\\[(\\w+)\\]/g, (_match, type) => {\n    const replacement = replacements[type]()\n    return replacement\n  })\n}\n",
    "/**\n\nAn important concern here:\n\nAll script type=\"module\" will be converted to inline script.\nThese inline script execution order is non predictible it depends\nwhich one is being done first\n\n*/\n\nimport { createHash } from \"crypto\"\nimport { require } from \"../require.js\"\nimport { renderNamePattern } from \"../renderNamePattern.js\"\n\nconst parse5 = require(\"parse5\")\n// https://github.com/inikulin/parse5/blob/master/packages/parse5/lib/tree-adapters/default.js\n// eslint-disable-next-line import/no-unresolved\n// const treeAdapter = require(\"parse5/lib/tree-adapters/default.js\")\n\nexport const parseHtmlString = (htmlString) => {\n  const htmlAst = parse5.parse(htmlString, { sourceCodeLocationInfo: true })\n  return htmlAst\n}\n\nexport const parseSvgString = (svgString) => {\n  const svgAst = parse5.parseFragment(svgString, { sourceCodeLocationInfo: true })\n  return svgAst\n}\n\nexport const stringifyHtmlAst = (htmlAst) => {\n  const htmlString = parse5.serialize(htmlAst)\n  return htmlString\n}\n\nexport const findNode = (htmlStringOrAst, predicate) => {\n  const htmlAst =\n    typeof htmlStringOrAst === \"string\" ? parseHtmlString(htmlStringOrAst) : htmlStringOrAst\n  let nodeMatching = null\n  visitHtmlAst(htmlAst, (node) => {\n    if (predicate(node)) {\n      nodeMatching = node\n      return \"stop\"\n    }\n    return null\n  })\n  return nodeMatching\n}\n\nexport const findNodes = (htmlString, predicate) => {\n  const htmlAst = parseHtmlString(htmlString)\n  const nodes = []\n  visitHtmlAst(htmlAst, (node) => {\n    if (predicate(node)) {\n      nodes.push(node)\n    }\n    return null\n  })\n  return nodes\n}\n\nexport const findNodeByTagName = (htmlString, tagName) =>\n  findNode(htmlString, (node) => node.nodeName === tagName)\n\nexport const findAllNodeByTagName = (htmlString, tagName) =>\n  findNodes(htmlString, (node) => node.nodeName === tagName)\n\nexport const findFirstImportmapNode = (htmlStringOrAst) =>\n  findNode(htmlStringOrAst, htmlNodeIsScriptImportmap)\n\nexport const getHtmlNodeAttributeByName = (htmlNode, attributeName) =>\n  htmlNode.attrs.find((attr) => attr.name === attributeName)\n\nexport const removeHtmlNodeAttribute = (htmlNode, attributeToRemove) => {\n  let attrIndex\n  if (typeof attributeToRemove === \"object\") {\n    attrIndex = htmlNode.attrs.indexOf(attributeToRemove)\n  }\n  if (attrIndex === -1) {\n    return false\n  }\n  htmlNode.attrs.splice(attrIndex, 1)\n  return true\n}\n\nexport const addHtmlNodeAttribute = (htmlNode, attributeToSet) => {\n  if (typeof attributeToSet !== \"object\") {\n    throw new TypeError(`addHtmlNodeAttribute attribute must be an object {name, value}`)\n  }\n\n  const existingAttributeIndex = htmlNode.attrs.findIndex(\n    (attr) => attr.name === attributeToSet.name,\n  )\n  if (existingAttributeIndex === -1) {\n    htmlNode.attrs.push(attributeToSet)\n  } else {\n    htmlNode.attrs[existingAttributeIndex] = attributeToSet\n  }\n}\n\nexport const getHtmlNodeTextNode = (htmlNode) => {\n  const firstChild = htmlNode.childNodes[0]\n  return firstChild && firstChild.nodeName === \"#text\" ? firstChild : null\n}\n\nexport const setHtmlNodeText = (htmlNode, textContent) => {\n  const textNode = getHtmlNodeTextNode(htmlNode)\n  if (textNode) {\n    textNode.value = textContent\n  } else {\n    const newTextNode = { nodeName: \"#text\", value: textContent, parentNode: htmlNode }\n    htmlNode.childNodes.splice(0, 0, newTextNode)\n  }\n}\n\nexport const removeHtmlNodeText = (htmlNode) => {\n  const textNode = getHtmlNodeTextNode(htmlNode)\n  if (textNode) {\n    htmlNode.childNodes = []\n  }\n}\n\nexport const getHtmlNodeLocation = (htmlNode) => {\n  const { sourceCodeLocation } = htmlNode\n  if (!sourceCodeLocation) {\n    return {}\n  }\n  const { startLine, startCol } = sourceCodeLocation\n  return {\n    line: startLine,\n    column: startCol,\n  }\n}\n\nexport const htmlAstContains = (htmlAst, predicate) => {\n  let contains = false\n  visitHtmlAst(htmlAst, (node) => {\n    if (predicate(node)) {\n      contains = true\n      return \"stop\"\n    }\n    return null\n  })\n  return contains\n}\n\nexport const htmlNodeIsScriptModule = (htmlNode) => {\n  if (htmlNode.nodeName !== \"script\") {\n    return false\n  }\n  const typeAttribute = getHtmlNodeAttributeByName(htmlNode, \"type\")\n  if (!typeAttribute) {\n    return false\n  }\n  return typeAttribute.value === \"module\"\n}\n\nexport const htmlNodeIsScriptImportmap = (htmlNode) => {\n  if (htmlNode.nodeName !== \"script\") {\n    return false\n  }\n  const typeAttribute = getHtmlNodeAttributeByName(htmlNode, \"type\")\n  if (!typeAttribute) {\n    return false\n  }\n  return typeAttribute.value === \"importmap\"\n}\n\nexport const parseSrcset = (srcsetString) => {\n  const srcsetParts = []\n  srcsetString.split(\",\").forEach((set) => {\n    const [specifier, descriptor] = set.trim().split(\" \")\n    srcsetParts.push({\n      specifier,\n      descriptor,\n    })\n  })\n  return srcsetParts\n}\n\nexport const stringifySrcset = (srcsetParts) => {\n  const srcsetString = srcsetParts\n    .map(({ specifier, descriptor }) => `${specifier} ${descriptor}`)\n    .join(\", \")\n  return srcsetString\n}\n\n// let's <img>, <link for favicon>, <link for css>, <styles>\n// <audio> <video> <picture> supports comes for free by detecting\n// <source src> attribute\n// if srcset is used we should parse it and collect all src referenced in it\n// also <link ref=\"preload\">\n// ideally relative iframe should recursively fetch (not needed so lets ignore)\n// <svg> ideally looks for external ressources inside them\n\n// but right now we will focus on: <link href> and <style> tags\n// on veut vérifier qu'on les récupere bien\n// dans rollup pour chaque css on feras le transformcss + l'ajout des assets reférencés\n// pour le style inline on le parse aussi et on le remettra inline dans le html\n// ensuite qu'on est capable de les mettre a jour\n// ce qui veut dire de mettre a jour link.ref et style.text\nexport const parseHtmlAstRessources = (htmlAst) => {\n  const links = []\n  const styles = []\n  const scripts = []\n  const imgs = []\n  const images = []\n  const uses = []\n  const sources = []\n\n  visitHtmlAst(htmlAst, (node) => {\n    if (node.nodeName === \"link\") {\n      links.push(node)\n      return\n    }\n\n    if (node.nodeName === \"style\") {\n      styles.push(node)\n      return\n    }\n\n    if (node.nodeName === \"script\") {\n      scripts.push(node)\n      return\n    }\n\n    if (node.nodeName === \"img\") {\n      imgs.push(node)\n      return\n    }\n\n    if (node.nodeName === \"image\") {\n      images.push(node)\n      return\n    }\n\n    if (node.nodeName === \"use\") {\n      uses.push(node)\n      return\n    }\n\n    if (node.nodeName === \"source\") {\n      sources.push(node)\n      return\n    }\n  })\n\n  return {\n    links,\n    styles,\n    scripts,\n    imgs,\n    images,\n    uses,\n    sources,\n  }\n}\n\nexport const replaceHtmlNode = (node, replacement, { inheritAttributes = true } = {}) => {\n  let newNode\n  if (typeof replacement === \"string\") {\n    newNode = parseHtmlAsSingleElement(replacement)\n  } else {\n    newNode = replacement\n  }\n\n  if (inheritAttributes) {\n    newNode.attrs = [\n      // inherit script attributes except src, type, href\n      ...node.attrs.filter(({ name }) => name !== \"type\" && name !== \"src\" && name !== \"href\"),\n      ...newNode.attrs,\n    ]\n  }\n\n  replaceNode(node, newNode)\n}\n\nexport const manipulateHtmlAst = (htmlAst, { scriptInjections = [] }) => {\n  const htmlNode = htmlAst.childNodes.find((node) => node.nodeName === \"html\")\n  const headNode = htmlNode.childNodes[0]\n  const bodyNode = htmlNode.childNodes[1]\n\n  const scriptsToPreprendInHead = []\n  scriptInjections.forEach((script) => {\n    const scriptExistingInHead = findExistingScript(headNode, script)\n    if (scriptExistingInHead) {\n      replaceNode(scriptExistingInHead, scriptToNode(script))\n      return\n    }\n    const scriptExistingInBody = findExistingScript(bodyNode, script)\n    if (scriptExistingInBody) {\n      replaceNode(scriptExistingInBody, scriptToNode(script))\n      return\n    }\n    scriptsToPreprendInHead.push(script)\n  })\n  const headScriptsFragment = scriptsToFragment(scriptsToPreprendInHead)\n  insertFragmentBefore(\n    headNode,\n    headScriptsFragment,\n    findChild(headNode, (node) => node.nodeName === \"script\"),\n  )\n}\n\nconst insertFragmentBefore = (node, fragment, childNode) => {\n  const { childNodes = [] } = node\n\n  if (childNode) {\n    const childNodeIndex = childNodes.indexOf(childNode)\n    node.childNodes = [\n      ...childNodes.slice(0, childNodeIndex),\n      ...fragment.childNodes.map((child) => {\n        return { ...child, parentNode: node }\n      }),\n      ...childNodes.slice(childNodeIndex),\n    ]\n  } else {\n    node.childNodes = [\n      ...childNodes,\n      ...fragment.childNodes.map((child) => {\n        return { ...child, parentNode: node }\n      }),\n    ]\n  }\n}\n\nconst scriptToNode = (script) => {\n  return scriptsToFragment([script]).childNodes[0]\n}\n\nconst scriptsToFragment = (scripts) => {\n  const html = scripts.reduce((previous, script) => {\n    const { text = \"\", ...attributes } = script\n    const scriptAttributes = objectToHtmlAttributes(attributes)\n    return `${previous}<script ${scriptAttributes}>${text}</script>\n      `\n  }, \"\")\n  const fragment = parse5.parseFragment(html)\n  return fragment\n}\n\nconst findExistingScript = (node, script) =>\n  findChild(node, (childNode) => {\n    return childNode.nodeName === \"script\" && sameScript(childNode, script)\n  })\n\nconst findChild = ({ childNodes = [] }, predicate) => childNodes.find(predicate)\n\nconst sameScript = (node, { type = \"text/javascript\", src }) => {\n  const typeAttribute = getHtmlNodeAttributeByName(node, \"type\")\n  if (!typeAttribute) {\n    return type === undefined || type === \"text/javascript\"\n  }\n  if (typeAttribute !== type) {\n    return false\n  }\n\n  const srcAttribute = getHtmlNodeAttributeByName(node, \"src\")\n  if (!srcAttribute) {\n    return src === undefined\n  }\n  if (srcAttribute.value !== src) {\n    return false\n  }\n\n  return true\n}\n\nconst objectToHtmlAttributes = (object) => {\n  return Object.keys(object)\n    .map((key) => `${key}=${valueToHtmlAttributeValue(object[key])}`)\n    .join(\" \")\n}\n\nconst valueToHtmlAttributeValue = (value) => {\n  if (typeof value === \"string\") {\n    return JSON.stringify(value)\n  }\n  return `\"${JSON.stringify(value)}\"`\n}\n\nexport const createInlineScriptHash = (script) => {\n  const hash = createHash(\"sha256\")\n  hash.update(getHtmlNodeTextNode(script).value)\n  return hash.digest(\"hex\").slice(0, 8)\n}\n\nexport const getUniqueNameForInlineHtmlNode = (node, nodes, pattern) => {\n  return renderNamePattern(pattern, {\n    id: () => {\n      const idAttribute = getHtmlNodeAttributeByName(node, \"id\")\n      if (idAttribute) {\n        return idAttribute.value\n      }\n\n      const { line, column } = getHtmlNodeLocation(node)\n      const lineTaken = nodes.some(\n        (nodeCandidate) =>\n          nodeCandidate !== node && getHtmlNodeLocation(nodeCandidate).line === line,\n      )\n      if (lineTaken) {\n        return `${line}.${column}`\n      }\n\n      return line\n    },\n  })\n}\n\nconst parseHtmlAsSingleElement = (html) => {\n  const fragment = parse5.parseFragment(html)\n  return fragment.childNodes[0]\n}\n\nconst replaceNode = (node, newNode) => {\n  const { parentNode } = node\n  const parentNodeChildNodes = parentNode.childNodes\n  const nodeIndex = parentNodeChildNodes.indexOf(node)\n  parentNodeChildNodes[nodeIndex] = newNode\n}\n\nconst visitHtmlAst = (htmlAst, callback) => {\n  const visitNode = (node) => {\n    const callbackReturnValue = callback(node)\n    if (callbackReturnValue === \"stop\") {\n      return\n    }\n    const { childNodes } = node\n    if (childNodes) {\n      let i = 0\n      while (i < childNodes.length) {\n        visitNode(childNodes[i++])\n      }\n    }\n  }\n  visitNode(htmlAst)\n}\n",
    "import { comparePathnames } from \"@jsenv/util\"\n\nexport const sortObjectByPathnames = (object) => {\n  const objectSorted = {}\n  const keysSorted = Object.keys(object).sort(comparePathnames)\n  keysSorted.forEach((key) => {\n    objectSorted[key] = object[key]\n  })\n  return objectSorted\n}\n",
    "export const parseDataUrl = (dataUrl) => {\n  const afterDataProtocol = dataUrl.slice(\"data:\".length)\n  const commaIndex = afterDataProtocol.indexOf(\",\")\n  const beforeComma = afterDataProtocol.slice(0, commaIndex)\n\n  let mediaType\n  let base64Flag\n  if (beforeComma.endsWith(`;base64`)) {\n    mediaType = beforeComma.slice(0, -`;base64`.length)\n    base64Flag = true\n  } else {\n    mediaType = beforeComma\n    base64Flag = false\n  }\n\n  const afterComma = afterDataProtocol.slice(commaIndex + 1)\n  return {\n    mediaType: mediaType === \"\" ? \"text/plain;charset=US-ASCII\" : mediaType,\n    base64Flag,\n    data: afterComma,\n  }\n}\n\nexport const stringifyDataUrl = ({ mediaType, base64Flag = true, data }) => {\n  if (!mediaType || mediaType === \"text/plain;charset=US-ASCII\") {\n    // can be a buffer or a string, hence check on data.length instead of !data or data === ''\n    if (data.length === 0) {\n      return `data:,`\n    }\n    if (base64Flag) {\n      return `data:,${data}`\n    }\n    return `data:,${dataToBase64(data)}`\n  }\n  if (base64Flag) {\n    return `data:${mediaType};base64,${dataToBase64(data)}`\n  }\n  return `data:${mediaType},${data}`\n}\n\nexport const dataUrlToRawData = ({ base64Flag, data }) => {\n  return base64Flag ? base64ToString(data) : data\n}\n\nexport const dataToBase64 =\n  typeof window === \"object\" ? window.atob : (data) => Buffer.from(data).toString(\"base64\")\n\nexport const base64ToString =\n  typeof window === \"object\"\n    ? window.btoa\n    : (base64String) => Buffer.from(base64String, \"base64\").toString(\"utf8\")\n",
    "import { isFileSystemPath, fileSystemPathToUrl } from \"@jsenv/util\"\nimport { stringifyDataUrl } from \"@jsenv/core/src/internal/dataUrl.utils.js\"\n\nexport const getTargetAsBase64Url = ({ targetBufferAfterTransformation, targetContentType }) => {\n  return stringifyDataUrl({\n    data: targetBufferAfterTransformation,\n    base64Flag: true,\n    mediaType: targetContentType,\n  })\n}\n\nexport const memoize = (fn) => {\n  let called\n  let previousCallReturnValue\n  const memoized = (...args) => {\n    if (called) return previousCallReturnValue\n    previousCallReturnValue = fn(...args)\n    called = true\n    return previousCallReturnValue\n  }\n  memoized.forceMemoization = (value) => {\n    called = true\n    previousCallReturnValue = value\n  }\n  return memoized\n}\n\nexport const getCallerLocation = () => {\n  const { prepareStackTrace } = Error\n  Error.prepareStackTrace = (error, stack) => {\n    Error.prepareStackTrace = prepareStackTrace\n    return stack\n  }\n\n  const { stack } = new Error()\n  const callerCallsite = stack[2]\n  const fileName = callerCallsite.getFileName()\n  return {\n    url: fileName && isFileSystemPath(fileName) ? fileSystemPathToUrl(fileName) : fileName,\n    line: callerCallsite.getLineNumber(),\n    column: callerCallsite.getColumnNumber(),\n  }\n}\n\nexport const compareContentType = (leftContentType, rightContentType) => {\n  if (leftContentType === rightContentType) {\n    return true\n  }\n  if (leftContentType === \"text/javascript\" && rightContentType === \"application/javascript\") {\n    return true\n  }\n  if (leftContentType === \"application/javascript\" && rightContentType === \"text/javascript\") {\n    return true\n  }\n  return false\n}\n\nexport const checkContentType = (reference, { logger, showReferenceSourceLocation }) => {\n  const { referenceExpectedContentType } = reference\n  const { targetContentType } = reference.target\n\n  if (!referenceExpectedContentType) {\n    return\n  }\n\n  if (compareContentType(referenceExpectedContentType, targetContentType)) {\n    return\n  }\n\n  // sourcemap content type is fine if we got octet-stream too\n  const { targetUrl } = reference.target\n  if (\n    referenceExpectedContentType === \"application/json\" &&\n    targetContentType === \"application/octet-stream\" &&\n    targetUrl.endsWith(\".map\")\n  ) {\n    return\n  }\n\n  logger.warn(\n    formatContentTypeMismatchLog(reference, {\n      showReferenceSourceLocation,\n    }),\n  )\n}\n\nconst formatContentTypeMismatchLog = (reference, { showReferenceSourceLocation }) => {\n  const { referenceExpectedContentType, target } = reference\n  const { targetContentType, targetUrl } = target\n\n  return `A reference was expecting ${referenceExpectedContentType} but found ${targetContentType} instead.\n--- reference ---\n${showReferenceSourceLocation(reference)}\n--- target url ---\n${targetUrl}`\n}\n\nexport const formatExternalReferenceLog = (\n  reference,\n  { showReferenceSourceLocation, projectDirectoryUrl },\n) => {\n  const { target } = reference\n  const { targetUrl } = target\n  return `Found reference to an url outside project directory.\n${showReferenceSourceLocation(reference)}\n--- target url ---\n${targetUrl}\n--- project directory url ---\n${projectDirectoryUrl}`\n}\n\nexport const formatReferenceFound = (reference, referenceSourceLocation) => {\n  const { target } = reference\n  const { targetIsInline, targetIsJsModule, targetRelativeUrl } = target\n\n  let message\n\n  if (targetIsInline && targetIsJsModule) {\n    message = `found inline js module.`\n  } else if (targetIsInline) {\n    message = `found inline asset.`\n  } else if (targetIsJsModule) {\n    message = `found js module reference to ${targetRelativeUrl}.`\n  } else {\n    message = `found asset reference to ${targetRelativeUrl}.`\n  }\n\n  message += `\n--- reference source ---\n${referenceSourceLocation}`\n\n  return message\n}\n\n// const textualContentTypes = [\"text/html\", \"text/css\", \"image/svg+xml\"]\n// const isTextualContentType = (contentType) => {\n//   if (textualContentTypes.includes(contentType)) {\n//     return true\n//   }\n//   if (contentType.startsWith(\"text/\")) {\n//     return true\n//   }\n//   return false\n// }\n",
    "import { getHtmlNodeLocation } from \"@jsenv/core/src/internal/compiling/compileHtml.js\"\n\nexport const collectNodesMutations = (nodes, notifiers, target, candidates) => {\n  const mutations = []\n  nodes.forEach((node) => {\n    mutations.push(...collectNodeMutations(node, notifiers, target, nodes, candidates))\n  })\n  return mutations\n}\n\nexport const htmlNodeToReferenceLocation = (htmlNode) => {\n  const { line, column } = getHtmlNodeLocation(htmlNode)\n  return {\n    referenceLine: line,\n    referenceColumn: column,\n  }\n}\n\nconst collectNodeMutations = (node, notifiers, target, nodes, candidates) => {\n  let firstValueReturned\n  candidates.find((candidate) => {\n    const returnValue = candidate(node, notifiers, target, nodes)\n    if (returnValue === null || returnValue === undefined) {\n      return false\n    }\n    firstValueReturned = returnValue\n    return true\n  })\n\n  if (typeof firstValueReturned === \"function\") {\n    return [firstValueReturned]\n  }\n  if (Array.isArray(firstValueReturned)) {\n    return firstValueReturned\n  }\n  return []\n}\n",
    "import { require } from \"@jsenv/core/src/internal/require.js\"\n\nexport const minifyHtml = (htmlString, options) => {\n  const { minify } = require(\"html-minifier\")\n  return minify(htmlString, options)\n}\n",
    "import {\n  parseSvgString,\n  parseHtmlAstRessources,\n  getHtmlNodeAttributeByName,\n  stringifyHtmlAst,\n} from \"@jsenv/core/src/internal/compiling/compileHtml.js\"\nimport { collectNodesMutations, htmlNodeToReferenceLocation } from \"../parsing.utils.js\"\nimport { getTargetAsBase64Url } from \"../asset-builder.util.js\"\nimport { minifyHtml } from \"../html/minifyHtml.js\"\n\nexport const parseSvgAsset = async (svgTarget, notifiers, { minify, minifyHtmlOptions }) => {\n  const svgString = String(svgTarget.targetBuffer)\n  const svgAst = await parseSvgString(svgString)\n  const htmlRessources = parseHtmlAstRessources(svgAst)\n  const mutations = collectSvgMutations(htmlRessources, notifiers, svgTarget)\n\n  return ({ getReferenceUrlRelativeToImporter }) => {\n    mutations.forEach((mutationCallback) => {\n      mutationCallback({ getReferenceUrlRelativeToImporter })\n    })\n    const svgAfterTransformation = stringifyHtmlAst(svgAst)\n    // could also benefit of minification https://github.com/svg/svgo\n    const targetBufferAfterTransformation = minify\n      ? minifyHtml(svgAfterTransformation, minifyHtmlOptions)\n      : svgAfterTransformation\n\n    return { targetBufferAfterTransformation }\n  }\n}\n\nexport const collectSvgMutations = ({ images, uses }, notifiers, svgTarget) => {\n  const imagesMutations = collectNodesMutations(images, notifiers, svgTarget, [imageHrefVisitor])\n  const usesMutations = collectNodesMutations(uses, notifiers, svgTarget, [useHrefVisitor])\n  const svgMutations = [...imagesMutations, ...usesMutations]\n  return svgMutations\n}\n\nconst imageHrefVisitor = (image, { notifyReferenceFound }) => {\n  const hrefAttribute = getHtmlNodeAttributeByName(image, \"href\")\n  if (!hrefAttribute) {\n    return null\n  }\n\n  const hrefReference = notifyReferenceFound({\n    referenceTargetSpecifier: hrefAttribute.value,\n    ...htmlNodeToReferenceLocation(image),\n  })\n  return ({ getReferenceUrlRelativeToImporter }) => {\n    const hrefNewValue = referenceToUrl(hrefReference, getReferenceUrlRelativeToImporter)\n    hrefAttribute.value = hrefNewValue\n  }\n}\n\nconst useHrefVisitor = (use, { notifyReferenceFound }) => {\n  const hrefAttribute = getHtmlNodeAttributeByName(use, \"href\")\n  if (!hrefAttribute) {\n    return null\n  }\n  const href = hrefAttribute.value\n  if (href[0] === \"#\") {\n    return null\n  }\n\n  const { hash } = new URL(href, \"file://\")\n  const hrefReference = notifyReferenceFound({\n    referenceTargetSpecifier: href,\n    ...htmlNodeToReferenceLocation(use),\n  })\n  return ({ getReferenceUrlRelativeToImporter }) => {\n    const hrefNewValue = referenceToUrl(hrefReference, getReferenceUrlRelativeToImporter)\n    hrefAttribute.value = `${hrefNewValue}${hash}`\n  }\n}\n\nconst referenceToUrl = (reference, getReferenceUrlRelativeToImporter) => {\n  const { targetIsInline } = reference.target\n  if (targetIsInline) {\n    return getTargetAsBase64Url(reference.target)\n  }\n  return getReferenceUrlRelativeToImporter(reference)\n}\n",
    "/**\n\nFinds all asset reference in html then update all references to target the files in dist/ when needed.\n\nThere is some cases where the asset won't be found and updated:\n- inline styles\n- inline attributes\n\nDon't write the following for instance:\n\n<div style=\"background:url('img.png')\"></div>\n\nOr be sure to also reference this url somewhere in the html file like\n\n<link rel=\"preload\" href=\"img.png\" />\n\n*/\n\nimport { urlToBasename, urlToRelativeUrl, resolveUrl, urlToParentUrl } from \"@jsenv/util\"\nimport {\n  parseHtmlString,\n  parseHtmlAstRessources,\n  replaceHtmlNode,\n  getHtmlNodeAttributeByName,\n  stringifyHtmlAst,\n  getUniqueNameForInlineHtmlNode,\n  addHtmlNodeAttribute,\n  removeHtmlNodeAttribute,\n  setHtmlNodeText,\n  getHtmlNodeTextNode,\n  removeHtmlNodeText,\n  parseSrcset,\n  stringifySrcset,\n} from \"@jsenv/core/src/internal/compiling/compileHtml.js\"\nimport { getTargetAsBase64Url } from \"../asset-builder.util.js\"\nimport { collectNodesMutations, htmlNodeToReferenceLocation } from \"../parsing.utils.js\"\nimport { collectSvgMutations } from \"../svg/parseSvgAsset.js\"\nimport { minifyHtml } from \"./minifyHtml.js\"\n\nexport const parseHtmlAsset = async (\n  htmlTarget,\n  notifiers,\n  {\n    minify,\n    minifyHtmlOptions,\n    transformImportmapTarget = () => {},\n    htmlStringToHtmlAst = (htmlString) => parseHtmlString(htmlString),\n    htmlAstToHtmlString = (htmlAst) => stringifyHtmlAst(htmlAst),\n  } = {},\n) => {\n  const htmlString = String(htmlTarget.targetBuffer)\n  const htmlAst = await htmlStringToHtmlAst(htmlString)\n  const { links, styles, scripts, imgs, images, uses, sources } = parseHtmlAstRessources(htmlAst)\n\n  const scriptsMutations = collectNodesMutations(scripts, notifiers, htmlTarget, [\n    // regular javascript are not parseable by rollup\n    // and we don't really care about there content\n    // we will handle them as regular asset\n    // but we still want to inline/minify/hash them for performance\n    regularScriptSrcVisitor,\n    regularScriptTextNodeVisitor,\n    moduleScriptSrcVisitor,\n    moduleScriptTextNodeVisitor,\n    importmapScriptSrcVisitor,\n    importmapScriptTextNodeVisitor,\n  ])\n  const linksMutations = collectNodesMutations(links, notifiers, htmlTarget, [\n    linkStylesheetHrefVisitor,\n    linkHrefVisitor,\n  ])\n  const stylesMutations = collectNodesMutations(styles, notifiers, htmlTarget, [\n    styleTextNodeVisitor,\n  ])\n  const imgsSrcMutations = collectNodesMutations(imgs, notifiers, htmlTarget, [imgSrcVisitor])\n  const imgsSrcsetMutations = collectNodesMutations(imgs, notifiers, htmlTarget, [srcsetVisitor])\n  const sourcesSrcMutations = collectNodesMutations(sources, notifiers, htmlTarget, [\n    sourceSrcVisitor,\n  ])\n  const sourcesSrcsetMutations = collectNodesMutations(sources, notifiers, htmlTarget, [\n    srcsetVisitor,\n  ])\n  const svgMutations = collectSvgMutations({ images, uses }, notifiers, htmlTarget)\n\n  const htmlMutations = [\n    ...scriptsMutations,\n    ...linksMutations,\n    ...stylesMutations,\n    ...imgsSrcMutations,\n    ...imgsSrcsetMutations,\n    ...sourcesSrcMutations,\n    ...sourcesSrcsetMutations,\n    ...svgMutations,\n  ]\n\n  return async (params) => {\n    htmlMutations.forEach((mutationCallback) => {\n      mutationCallback({\n        ...params,\n        transformImportmapTarget,\n      })\n    })\n\n    const htmlAfterTransformation = htmlAstToHtmlString(htmlAst)\n    const targetBufferAfterTransformation = minify\n      ? minifyHtml(htmlAfterTransformation, minifyHtmlOptions)\n      : htmlAfterTransformation\n    return {\n      targetBufferAfterTransformation,\n    }\n  }\n}\n\nconst regularScriptSrcVisitor = (script, { notifyReferenceFound }) => {\n  const typeAttribute = getHtmlNodeAttributeByName(script, \"type\")\n  if (\n    typeAttribute &&\n    (typeAttribute.value !== \"text/javascript\" || typeAttribute.value !== \"application/javascript\")\n  ) {\n    return null\n  }\n  const srcAttribute = getHtmlNodeAttributeByName(script, \"src\")\n  if (!srcAttribute) {\n    return null\n  }\n\n  const remoteScriptReference = notifyReferenceFound({\n    referenceExpectedContentType: \"application/javascript\",\n    referenceTargetSpecifier: srcAttribute.value,\n    ...htmlNodeToReferenceLocation(script),\n  })\n  return ({ getReferenceUrlRelativeToImporter }) => {\n    const { targetIsInline } = remoteScriptReference.target\n    if (targetIsInline) {\n      removeHtmlNodeAttribute(script, srcAttribute)\n      const { targetBufferAfterTransformation } = remoteScriptReference.target\n      setHtmlNodeText(script, targetBufferAfterTransformation)\n    } else {\n      const urlRelativeToImporter = getReferenceUrlRelativeToImporter(remoteScriptReference)\n      srcAttribute.value = urlRelativeToImporter\n    }\n  }\n}\n\nconst regularScriptTextNodeVisitor = (script, { notifyReferenceFound }, htmlTarget, scripts) => {\n  const typeAttribute = getHtmlNodeAttributeByName(script, \"type\")\n  if (\n    typeAttribute &&\n    (typeAttribute.value !== \"text/javascript\" || typeAttribute.value !== \"application/javascript\")\n  ) {\n    return null\n  }\n  const srcAttribute = getHtmlNodeAttributeByName(script, \"src\")\n  if (srcAttribute) {\n    return null\n  }\n  const textNode = getHtmlNodeTextNode(script)\n  if (!textNode) {\n    return null\n  }\n\n  const jsReference = notifyReferenceFound({\n    referenceExpectedContentType: \"application/javascript\",\n    referenceTargetSpecifier: getUniqueNameForInlineHtmlNode(\n      script,\n      scripts,\n      `${urlToBasename(htmlTarget.targetUrl)}.[id].js`,\n    ),\n    ...htmlNodeToReferenceLocation(script),\n\n    targetContentType: \"application/javascript\",\n    targetBuffer: Buffer.from(textNode.value),\n    targetIsInline: true,\n  })\n  return () => {\n    const { targetBufferAfterTransformation } = jsReference.target\n    textNode.value = targetBufferAfterTransformation\n  }\n}\n\nconst moduleScriptSrcVisitor = (script, { format, notifyReferenceFound }) => {\n  const typeAttribute = getHtmlNodeAttributeByName(script, \"type\")\n  if (!typeAttribute) {\n    return null\n  }\n  if (typeAttribute.value !== \"module\") {\n    return null\n  }\n  const srcAttribute = getHtmlNodeAttributeByName(script, \"src\")\n  if (!srcAttribute) {\n    return null\n  }\n\n  const remoteScriptReference = notifyReferenceFound({\n    referenceExpectedContentType: \"application/javascript\",\n    referenceTargetSpecifier: srcAttribute.value,\n    ...htmlNodeToReferenceLocation(script),\n\n    targetIsJsModule: true,\n  })\n  return ({ getReferenceUrlRelativeToImporter }) => {\n    if (format === \"systemjs\") {\n      typeAttribute.value = \"systemjs-module\"\n    }\n    const urlRelativeToImporter = getReferenceUrlRelativeToImporter(remoteScriptReference)\n    const relativeUrlNotation = ensureRelativeUrlNotation(urlRelativeToImporter)\n    srcAttribute.value = relativeUrlNotation\n  }\n}\n\nconst moduleScriptTextNodeVisitor = (\n  script,\n  { format, notifyReferenceFound },\n  htmlTarget,\n  scripts,\n) => {\n  const typeAttribute = getHtmlNodeAttributeByName(script, \"type\")\n  if (!typeAttribute) {\n    return null\n  }\n  if (typeAttribute.value !== \"module\") {\n    return null\n  }\n  const srcAttribute = getHtmlNodeAttributeByName(script, \"src\")\n  if (srcAttribute) {\n    return null\n  }\n  const textNode = getHtmlNodeTextNode(script)\n  if (!textNode) {\n    return null\n  }\n\n  const jsReference = notifyReferenceFound({\n    referenceExpectedContentType: \"application/javascript\",\n    referenceTargetSpecifier: getUniqueNameForInlineHtmlNode(\n      script,\n      scripts,\n      `${urlToBasename(htmlTarget.targetUrl)}.[id].js`,\n    ),\n    ...htmlNodeToReferenceLocation(script),\n\n    targetContentType: \"application/javascript\",\n    targetBuffer: textNode.value,\n    targetIsJsModule: true,\n    targetIsInline: true,\n  })\n  return ({ getReferenceUrlRelativeToImporter }) => {\n    if (format === \"systemjs\") {\n      typeAttribute.value = \"systemjs-module\"\n    }\n    const urlRelativeToImporter = getReferenceUrlRelativeToImporter(jsReference)\n    const relativeUrlNotation = ensureRelativeUrlNotation(urlRelativeToImporter)\n    removeHtmlNodeText(script)\n    addHtmlNodeAttribute(script, { name: \"src\", value: relativeUrlNotation })\n  }\n}\n\nconst importmapScriptSrcVisitor = (script, { format, notifyReferenceFound }) => {\n  const typeAttribute = getHtmlNodeAttributeByName(script, \"type\")\n  if (!typeAttribute) {\n    return null\n  }\n  if (typeAttribute.value !== \"importmap\") {\n    return null\n  }\n  const srcAttribute = getHtmlNodeAttributeByName(script, \"src\")\n  if (!srcAttribute) {\n    return null\n  }\n\n  const importmapReference = notifyReferenceFound({\n    referenceExpectedContentType: \"application/importmap+json\",\n    referenceTargetSpecifier: srcAttribute.value,\n    ...htmlNodeToReferenceLocation(script),\n\n    // here we want to force the fileName for the importmap\n    // so that we don't have to rewrite its content\n    // the goal is to put the importmap at the same relative path\n    // than in the project\n    targetFileNamePattern: () => {\n      const importmapReferenceUrl = importmapReference.referenceUrl\n      const importmapTargetUrl = importmapReference.target.targetUrl\n      const importmapUrlRelativeToImporter = urlToRelativeUrl(\n        importmapTargetUrl,\n        importmapReferenceUrl,\n      )\n      const importmapParentRelativeUrl = urlToRelativeUrl(\n        urlToParentUrl(resolveUrl(importmapUrlRelativeToImporter, \"file://\")),\n        \"file://\",\n      )\n      return `${importmapParentRelativeUrl}[name]-[hash][extname]`\n    },\n  })\n  return ({ getReferenceUrlRelativeToImporter, transformImportmapTarget }) => {\n    if (format === \"systemjs\") {\n      typeAttribute.value = \"systemjs-importmap\"\n    }\n    transformImportmapTarget(importmapReference.target)\n\n    const { targetIsInline } = importmapReference.target\n    if (targetIsInline) {\n      // here put a warning if we cannot inline importmap because it would mess\n      // the remapping (note that it's feasible) but not yet supported\n      removeHtmlNodeAttribute(script, srcAttribute)\n      const { targetBufferAfterTransformation } = importmapReference.target\n      setHtmlNodeText(script, targetBufferAfterTransformation)\n    } else {\n      const urlRelativeToImporter = getReferenceUrlRelativeToImporter(importmapReference)\n      srcAttribute.value = urlRelativeToImporter\n    }\n  }\n}\n\nconst importmapScriptTextNodeVisitor = (\n  script,\n  { format, notifyReferenceFound },\n  htmlTarget,\n  scripts,\n) => {\n  const typeAttribute = getHtmlNodeAttributeByName(script, \"type\")\n  if (!typeAttribute) {\n    return null\n  }\n  if (typeAttribute.value !== \"importmap\") {\n    return null\n  }\n  const srcAttribute = getHtmlNodeAttributeByName(script, \"src\")\n  if (srcAttribute) {\n    return null\n  }\n  const textNode = getHtmlNodeTextNode(script)\n  if (!textNode) {\n    return null\n  }\n\n  const importmapReference = notifyReferenceFound({\n    referenceExpectedContentType: \"application/importmap+json\",\n    referenceTargetSpecifier: getUniqueNameForInlineHtmlNode(\n      script,\n      scripts,\n      `${urlToBasename(htmlTarget.targetUrl)}.[id].importmap`,\n    ),\n    ...htmlNodeToReferenceLocation(script),\n\n    targetContentType: \"application/importmap+json\",\n    targetBuffer: Buffer.from(textNode.value),\n    targetIsInline: true,\n  })\n  return ({ transformImportmapTarget }) => {\n    if (format === \"systemjs\") {\n      typeAttribute.value = \"systemjs-importmap\"\n    }\n    transformImportmapTarget(importmapReference.target)\n\n    const { targetBufferAfterTransformation } = importmapReference.target\n    textNode.value = targetBufferAfterTransformation\n  }\n}\n\nconst linkStylesheetHrefVisitor = (link, { notifyReferenceFound }) => {\n  const hrefAttribute = getHtmlNodeAttributeByName(link, \"href\")\n  if (!hrefAttribute) {\n    return null\n  }\n  const relAttribute = getHtmlNodeAttributeByName(link, \"rel\")\n  if (!relAttribute) {\n    return null\n  }\n  if (relAttribute.value !== \"stylesheet\") {\n    return null\n  }\n\n  const cssReference = notifyReferenceFound({\n    referenceExpectedContentType: \"text/css\",\n    referenceTargetSpecifier: hrefAttribute.value,\n    ...htmlNodeToReferenceLocation(link),\n  })\n  return ({ getReferenceUrlRelativeToImporter }) => {\n    const { targetIsInline } = cssReference.target\n\n    if (targetIsInline) {\n      const { targetBufferAfterTransformation } = cssReference.target\n      replaceHtmlNode(link, `<style>${targetBufferAfterTransformation}</style>`)\n    } else {\n      const urlRelativeToImporter = getReferenceUrlRelativeToImporter(cssReference)\n      hrefAttribute.value = urlRelativeToImporter\n    }\n  }\n}\n\nconst linkHrefVisitor = (link, { notifyReferenceFound }) => {\n  const hrefAttribute = getHtmlNodeAttributeByName(link, \"href\")\n  if (!hrefAttribute) {\n    return null\n  }\n\n  const contentType = linkToContentType(link)\n\n  const reference = notifyReferenceFound({\n    referenceExpectedContentType: contentType,\n    referenceTargetSpecifier: hrefAttribute.value,\n    ...htmlNodeToReferenceLocation(link),\n\n    targetUrlVersioningDisabled: contentType === \"application/manifest+json\",\n  })\n  return ({ getReferenceUrlRelativeToImporter }) => {\n    const { targetIsInline } = reference.target\n\n    if (targetIsInline) {\n      replaceHtmlNode(link, `<link href=\"${getTargetAsBase64Url(reference.target)}\" />`)\n    } else {\n      const urlRelativeToImporter = getReferenceUrlRelativeToImporter(reference)\n      hrefAttribute.value = urlRelativeToImporter\n    }\n  }\n}\n\nconst linkToContentType = (link) => {\n  const typeAttribute = getHtmlNodeAttributeByName(link, \"type\")\n  if (typeAttribute) {\n    return typeAttribute.value\n  }\n  const relAttribute = getHtmlNodeAttributeByName(link, \"rel\")\n  if (relAttribute) {\n    if (relAttribute.value === \"manifest\") {\n      return \"application/manifest+json\"\n    }\n  }\n  return undefined\n}\n\nconst styleTextNodeVisitor = (style, { notifyReferenceFound }, htmlTarget, styles) => {\n  const textNode = getHtmlNodeTextNode(style)\n  if (!textNode) {\n    return null\n  }\n\n  const inlineStyleReference = notifyReferenceFound({\n    referenceExpectedContentType: \"text/css\",\n    referenceTargetSpecifier: getUniqueNameForInlineHtmlNode(\n      style,\n      styles,\n      `${urlToBasename(htmlTarget.targetUrl)}.[id].css`,\n    ),\n    ...htmlNodeToReferenceLocation(style),\n\n    targetContentType: \"text/css\",\n    targetBuffer: Buffer.from(textNode.value),\n    targetIsInline: true,\n  })\n  return () => {\n    const { targetBufferAfterTransformation } = inlineStyleReference.target\n    textNode.value = targetBufferAfterTransformation\n  }\n}\n\nconst imgSrcVisitor = (img, { notifyReferenceFound }) => {\n  const srcAttribute = getHtmlNodeAttributeByName(img, \"src\")\n  if (!srcAttribute) {\n    return null\n  }\n\n  const srcReference = notifyReferenceFound({\n    referenceTargetSpecifier: srcAttribute.value,\n    ...htmlNodeToReferenceLocation(img),\n  })\n  return ({ getReferenceUrlRelativeToImporter }) => {\n    const srcNewValue = referenceToUrl(srcReference, getReferenceUrlRelativeToImporter)\n    srcAttribute.value = srcNewValue\n  }\n}\n\nconst srcsetVisitor = (htmlNode, { notifyReferenceFound }) => {\n  const srcsetAttribute = getHtmlNodeAttributeByName(htmlNode, \"srcset\")\n  if (!srcsetAttribute) {\n    return null\n  }\n\n  const srcsetParts = parseSrcset(srcsetAttribute.value)\n  const srcsetPartsReferences = srcsetParts.map(({ specifier }) =>\n    notifyReferenceFound({\n      referenceTargetSpecifier: specifier,\n      ...htmlNodeToReferenceLocation(htmlNode),\n    }),\n  )\n  if (srcsetParts.length === 0) {\n    return null\n  }\n\n  return ({ getReferenceUrlRelativeToImporter }) => {\n    srcsetParts.forEach((srcsetPart, index) => {\n      const reference = srcsetPartsReferences[index]\n      srcsetPart.specifier = referenceToUrl(reference, getReferenceUrlRelativeToImporter)\n    })\n\n    const srcsetNewValue = stringifySrcset(srcsetParts)\n    srcsetAttribute.value = srcsetNewValue\n  }\n}\n\nconst sourceSrcVisitor = (source, { notifyReferenceFound }) => {\n  const srcAttribute = getHtmlNodeAttributeByName(source, \"src\")\n  if (!srcAttribute) {\n    return null\n  }\n\n  const typeAttribute = getHtmlNodeAttributeByName(source, \"type\")\n  const srcReference = notifyReferenceFound({\n    referenceExpectedContentType: typeAttribute ? typeAttribute.value : undefined,\n    referenceTargetSpecifier: srcAttribute.value,\n    ...htmlNodeToReferenceLocation(source),\n  })\n  return ({ getReferenceUrlRelativeToImporter }) => {\n    const srcNewValue = referenceToUrl(srcReference, getReferenceUrlRelativeToImporter)\n    srcAttribute.value = srcNewValue\n  }\n}\n\nconst referenceToUrl = (reference, getReferenceUrlRelativeToImporter) => {\n  const { targetIsInline } = reference.target\n  if (targetIsInline) {\n    return getTargetAsBase64Url(reference.target)\n  }\n  return getReferenceUrlRelativeToImporter(reference)\n}\n\n// otherwise systemjs handle it as a bare import\nconst ensureRelativeUrlNotation = (relativeUrl) => {\n  if (relativeUrl.startsWith(\"../\")) {\n    return relativeUrl\n  }\n  return `./${relativeUrl}`\n}\n",
    "export const parseImportmapAsset = (importmapTarget, notifiers, { minify }) => {\n  const importmapString = String(importmapTarget.targetBuffer)\n  return () => {\n    if (minify) {\n      // this is to remove eventual whitespaces\n      return JSON.stringify(JSON.parse(importmapString))\n    }\n    return importmapString\n  }\n}\n",
    "import { urlToFileSystemPath } from \"@jsenv/util\"\n\nimport { require } from \"@jsenv/core/src/internal/require.js\"\n\nexport const applyPostCss = async (\n  cssString,\n  cssUrl,\n  plugins,\n  // https://github.com/postcss/postcss#options\n  options = {},\n) => {\n  const postcss = require(\"postcss\")\n\n  let result\n  try {\n    const cssFileUrl = urlToFileUrl(cssUrl)\n    result = await postcss(plugins).process(cssString, {\n      collectUrls: true,\n      from: urlToFileSystemPath(cssFileUrl),\n      to: urlToFileSystemPath(cssFileUrl),\n      ...options,\n    })\n  } catch (error) {\n    if (error.name === \"CssSyntaxError\") {\n      console.error(String(error))\n      throw error\n    }\n    throw error\n  }\n  return result\n}\n\n// the goal of this function is to take an url that is likely an http url\n// info a file:// url\n// for instance http://example.com/dir/file.js\n// must becomes file:///dir/file.js\n// but in windows it must be file://C:/dir/file.js\nconst filesystemRootUrl = new URL(\"/\", import.meta.url)\nconst urlToFileUrl = (url) => {\n  if (url.startsWith(\"file://\")) {\n    return url\n  }\n  const origin = new URL(url).origin\n  const afterOrigin = url.slice(origin.length)\n  return new URL(afterOrigin, filesystemRootUrl).href\n}\n",
    "/**\n\nhttps://github.com/postcss/postcss/blob/master/docs/writing-a-plugin.md\nhttps://github.com/postcss/postcss/blob/master/docs/guidelines/plugin.md\nhttps://github.com/postcss/postcss/blob/master/docs/guidelines/runner.md#31-dont-show-js-stack-for-csssyntaxerror\n\nIn case css sourcemap contains no%20source\nThis is because of https://github.com/postcss/postcss/blob/fd30d3df5abc0954a0ec642a3cdc644ab2aacf9c/lib/map-generator.js#L231\nand it indicates a node has been replaced without passing source\nhence sourcemap cannot point the original source location\n\n*/\n\nimport { fileSystemPathToUrl, resolveUrl } from \"@jsenv/util\"\nimport { require } from \"@jsenv/core/src/internal/require.js\"\n\nconst valueParser = require(\"postcss-value-parser\")\n\nexport const postCssUrlHashPlugin = () => {\n  return {\n    postcssPlugin: \"urlhash\",\n    prepare: (result) => {\n      const { from, collectUrls = false, getUrlReplacementValue = () => undefined } = result.opts\n      const fromUrl = fileSystemPathToUrl(from)\n      return {\n        AtRule: {\n          import: (atImportNode, { AtRule }) => {\n            if (atImportNode.parent.type !== \"root\") {\n              atImportNode.warn(result, \"`@import` should be top level\")\n              return\n            }\n\n            if (atImportNode.nodes) {\n              atImportNode.warn(result, \"`@import` was not terminated correctly\")\n              return\n            }\n\n            const parsed = valueParser(atImportNode.params)\n            let [urlNode] = parsed.nodes\n\n            if (!urlNode || (urlNode.type !== \"string\" && urlNode.type !== \"function\")) {\n              atImportNode.warn(result, `No URL in \\`${atImportNode.toString()}\\``)\n              return\n            }\n\n            let url = \"\"\n            if (urlNode.type === \"string\") {\n              url = urlNode.value\n            } else if (urlNode.type === \"function\") {\n              // Invalid function\n              if (!/^url$/i.test(urlNode.value)) {\n                atImportNode.warn(\n                  result,\n                  `Invalid \\`url\\` function in \\`${atImportNode.toString()}\\``,\n                )\n                return\n              }\n\n              const firstNode = urlNode.nodes[0]\n              if (firstNode && firstNode.type === \"string\") {\n                urlNode = firstNode\n                url = urlNode.value\n              } else {\n                urlNode = urlNode.nodes\n                url = valueParser.stringify(urlNode.nodes)\n              }\n            }\n\n            url = url.trim()\n\n            if (url.length === 0) {\n              atImportNode.warn(result, `Empty URL in \\`${atImportNode.toString()}\\``)\n              return\n            }\n\n            const specifier = url\n            url = resolveUrl(specifier, fromUrl)\n\n            if (url === fromUrl) {\n              atImportNode.warn(result, `\\`@import\\` loop in \\`${atImportNode.toString()}\\``)\n              return\n            }\n\n            const urlReference = {\n              type: \"import\",\n              specifier,\n              url,\n              atImportNode,\n              urlNode,\n            }\n            const urlNewValue = getUrlReplacementValue(urlReference)\n            if (urlNewValue && urlNewValue !== urlNode.value) {\n              urlNode.value = urlNewValue\n              const newParams = parsed.toString()\n              const newAtImportRule = new AtRule({\n                name: \"import\",\n                params: newParams,\n                source: atImportNode.source,\n              })\n              atImportNode.replaceWith(newAtImportRule)\n            }\n\n            if (collectUrls) {\n              result.messages.push(urlReference)\n            }\n          },\n        },\n        Declaration: (declarationNode) => {\n          if (!declarationNodeContainsUrl(declarationNode)) {\n            return\n          }\n\n          walkUrls(declarationNode, (url, urlNode) => {\n            // Empty URL\n            if (!urlNode || url.length === 0) {\n              declarationNode.warn(result, `Empty URL in \\`${declarationNode.toString()}\\``)\n              return\n            }\n\n            // Skip Data URI\n            if (isDataUrl(url)) {\n              return\n            }\n\n            const specifier = url\n            url = resolveUrl(specifier, fileSystemPathToUrl(from))\n\n            const urlReference = {\n              type: \"asset\",\n              specifier,\n              url,\n              declarationNode,\n              urlNode,\n            }\n\n            const urlNewValue = getUrlReplacementValue(urlReference)\n            if (urlNewValue) {\n              urlNode.value = urlNewValue\n            }\n\n            if (collectUrls) {\n              result.messages.push(urlReference)\n            }\n          })\n        },\n      }\n    },\n  }\n}\npostCssUrlHashPlugin.postcss = true\n\nconst declarationNodeContainsUrl = (declarationNode) => {\n  return /^(?:url|(?:-webkit-)?image-set)\\(/i.test(declarationNode.value)\n}\n\nconst walkUrls = (declarationNode, callback) => {\n  const parsed = valueParser(declarationNode.value)\n  parsed.walk((node) => {\n    // https://github.com/andyjansson/postcss-functions\n    if (isUrlFunctionNode(node)) {\n      const { nodes } = node\n      const [urlNode] = nodes\n      const url =\n        urlNode && urlNode.type === \"string\" ? urlNode.value : valueParser.stringify(nodes)\n      callback(url.trim(), urlNode)\n      return\n    }\n\n    if (isImageSetFunctionNode(node)) {\n      Array.from(node.nodes).forEach((childNode) => {\n        if (childNode.type === \"string\") {\n          callback(childNode.value.trim(), childNode)\n          return\n        }\n\n        if (isUrlFunctionNode(node)) {\n          const { nodes } = childNode\n          const [urlNode] = nodes\n          const url =\n            urlNode && urlNode.type === \"string\" ? urlNode.value : valueParser.stringify(nodes)\n          callback(url.trim(), urlNode)\n          return\n        }\n      })\n    }\n  })\n\n  declarationNode.value = parsed.toString()\n}\n\nconst isUrlFunctionNode = (node) => {\n  return node.type === \"function\" && /^url$/i.test(node.value)\n}\n\nconst isImageSetFunctionNode = (node) => {\n  return node.type === \"function\" && /^(?:-webkit-)?image-set$/i.test(node.value)\n}\n\nconst isDataUrl = (url) => {\n  return /data:[^\\n\\r;]+?(?:;charset=[^\\n\\r;]+?)?;base64,([\\d+/A-Za-z]+={0,2})/.test(url)\n}\n",
    "import { applyPostCss } from \"./applyPostCss.js\"\nimport { postCssUrlHashPlugin } from \"./postcss-urlhash-plugin.js\"\n\nexport const parseCssUrls = async (css, cssUrl = \"file:///file.css\") => {\n  const atImports = []\n  const urlDeclarations = []\n\n  const postCssPlugins = [postCssUrlHashPlugin]\n  const postCssOptions = { collectUrls: true }\n  const result = await applyPostCss(css, cssUrl, postCssPlugins, postCssOptions)\n\n  result.messages.forEach(({ type, specifier, atImportNode, declarationNode, urlNode }) => {\n    if (type === \"import\") {\n      atImports.push({\n        specifier,\n        urlNode,\n        urlDeclarationNode: atImportNode,\n      })\n    }\n    if (type === \"asset\") {\n      urlDeclarations.push({\n        specifier,\n        urlNode,\n        urlDeclarationNode: declarationNode,\n      })\n    }\n  })\n\n  return { atImports, urlDeclarations }\n}\n",
    "import { require } from \"@jsenv/core/src/internal/require.js\"\nimport { applyPostCss } from \"./applyPostCss.js\"\nimport { postCssUrlHashPlugin } from \"./postcss-urlhash-plugin.js\"\n\nexport const replaceCssUrls = async (\n  css,\n  cssUrl,\n  getUrlReplacementValue,\n  { cssMinification = false, cssMinificationOptions, sourcemapOptions = {} } = {},\n) => {\n  const postcssPlugins = [\n    postCssUrlHashPlugin,\n    ...(cssMinification ? [await getCssMinificationPlugin(cssMinificationOptions)] : []),\n  ]\n  const postcssOptions = {\n    getUrlReplacementValue,\n    map: {\n      inline: false,\n      ...sourcemapOptions,\n    },\n  }\n  const result = await applyPostCss(css, cssUrl, postcssPlugins, postcssOptions)\n  return result\n}\n\nconst getCssMinificationPlugin = async (cssMinificationOptions = {}) => {\n  const cssnano = require(\"cssnano\")\n  const cssnanoDefaultPreset = require(\"cssnano-preset-default\")\n  return cssnano({\n    preset: cssnanoDefaultPreset({\n      ...cssMinificationOptions,\n      // just to show how you could configure dicard comment plugin from css nano\n      // https://github.com/cssnano/cssnano/tree/master/packages/cssnano-preset-default\n      // discardComments: {\n      //   remove: () => false,\n      // },\n    }),\n  })\n}\n",
    "import { basename } from \"path\"\nimport { urlToFilename, urlToRelativeUrl, resolveUrl } from \"@jsenv/util\"\nimport {\n  getCssSourceMappingUrl,\n  setCssSourceMappingUrl,\n} from \"@jsenv/core/src/internal/sourceMappingURLUtils.js\"\nimport { getTargetAsBase64Url } from \"../asset-builder.util.js\"\nimport { parseCssUrls } from \"./parseCssUrls.js\"\nimport { replaceCssUrls } from \"./replaceCssUrls.js\"\n\nexport const parseCssAsset = async (\n  cssTarget,\n  { notifyReferenceFound },\n  { minify, minifyCssOptions },\n) => {\n  const cssString = String(cssTarget.targetBuffer)\n  const cssSourcemapUrl = getCssSourceMappingUrl(cssString)\n  let sourcemapReference\n  if (cssSourcemapUrl) {\n    sourcemapReference = notifyReferenceFound({\n      referenceExpectedContentType: \"application/json\",\n      referenceTargetSpecifier: cssSourcemapUrl,\n      // we don't really know the line or column\n      // but let's asusme it the last line and first column\n      referenceLine: cssString.split(/\\r?\\n/).length - 1,\n      referenceColumn: 0,\n    })\n  }\n\n  const { atImports, urlDeclarations } = await parseCssUrls(cssString, cssTarget.targetUrl)\n\n  const urlNodeReferenceMapping = new Map()\n  atImports.forEach((atImport) => {\n    const importReference = notifyReferenceFound({\n      referenceTargetSpecifier: atImport.specifier,\n      ...cssNodeToReferenceLocation(atImport.urlDeclarationNode),\n    })\n    urlNodeReferenceMapping.set(atImport.urlNode, importReference)\n  })\n  urlDeclarations.forEach((urlDeclaration) => {\n    const urlReference = notifyReferenceFound({\n      referenceTargetSpecifier: urlDeclaration.specifier,\n      ...cssNodeToReferenceLocation(urlDeclaration.urlDeclarationNode),\n    })\n    urlNodeReferenceMapping.set(urlDeclaration.urlNode, urlReference)\n  })\n\n  return async ({\n    getReferenceUrlRelativeToImporter,\n    precomputeBuildRelativeUrl,\n    registerAssetEmitter,\n  }) => {\n    const cssReplaceResult = await replaceCssUrls(\n      cssString,\n      cssTarget.targetUrl,\n      ({ urlNode }) => {\n        const nodeCandidates = Array.from(urlNodeReferenceMapping.keys())\n        const urlNodeFound = nodeCandidates.find((urlNodeCandidate) =>\n          isSameCssDocumentUrlNode(urlNodeCandidate, urlNode),\n        )\n        if (!urlNodeFound) {\n          return urlNode.value\n        }\n\n        // url node nous dit quel réfrence y correspond\n        const urlNodeReference = urlNodeReferenceMapping.get(urlNodeFound)\n        const { targetIsInline } = urlNodeReference.target\n        if (targetIsInline) {\n          return getTargetAsBase64Url(urlNodeReference.target)\n        }\n        return getReferenceUrlRelativeToImporter(urlNodeReference)\n      },\n      {\n        cssMinification: minify,\n        cssMinificationOptions: minifyCssOptions,\n        sourcemapOptions: sourcemapReference\n          ? { prev: sourcemapReference.target.targetBufferAfterTransformation }\n          : {},\n      },\n    )\n    const code = cssReplaceResult.css\n    const map = cssReplaceResult.map.toJSON()\n    const cssBuildRelativeUrl = precomputeBuildRelativeUrl(code)\n\n    const cssSourcemapFilename = `${basename(cssBuildRelativeUrl)}.map`\n\n    // In theory code should never be modified once the url for caching is computed\n    // because url for caching depends on file content.\n    // There is an exception for sourcemap because we want to update sourcemap.file\n    // to the cached filename of the css file.\n    // To achieve that we set/update the sourceMapping url comment in compiled css file.\n    // This is totally fine to do that because sourcemap and css file lives togethers\n    // so this comment changes nothing regarding cache invalidation and is not important\n    // to decide the filename for this css asset.\n    const cssSourceAfterTransformation = setCssSourceMappingUrl(code, cssSourcemapFilename)\n\n    registerAssetEmitter(({ buildDirectoryUrl, emitAsset }) => {\n      const cssBuildUrl = resolveUrl(cssTarget.targetBuildRelativeUrl, buildDirectoryUrl)\n      const mapBuildUrl = resolveUrl(cssSourcemapFilename, cssBuildUrl)\n      map.file = urlToFilename(cssBuildUrl)\n      if (map.sources) {\n        map.sources = map.sources.map((source) => {\n          const sourceUrl = resolveUrl(source, cssTarget.targetUrl)\n          const sourceUrlRelativeToSourceMap = urlToRelativeUrl(sourceUrl, mapBuildUrl)\n          return sourceUrlRelativeToSourceMap\n        })\n      }\n\n      const mapSource = JSON.stringify(map, null, \"  \")\n      const buildRelativeUrl = urlToRelativeUrl(mapBuildUrl, buildDirectoryUrl)\n\n      if (sourcemapReference) {\n        sourcemapReference.target.updateOnceReady({\n          targetBufferAfterTransformation: mapSource,\n          buildRelativeUrl,\n        })\n      } else {\n        emitAsset({\n          source: mapSource,\n          fileName: buildRelativeUrl,\n        })\n      }\n    })\n\n    return {\n      targetBufferAfterTransformation: cssSourceAfterTransformation,\n      targetBuildRelativeUrl: cssBuildRelativeUrl,\n    }\n  }\n}\n\nconst cssNodeToReferenceLocation = (node) => {\n  const { line, column } = node.source.start\n  return {\n    referenceLine: line,\n    referenceColumn: column,\n  }\n}\n\nconst isSameCssDocumentUrlNode = (firstUrlNode, secondUrlNode) => {\n  if (!compareUrlNodeTypes(firstUrlNode.type, secondUrlNode.type)) {\n    return false\n  }\n  if (!compareUrlNodeValue(firstUrlNode.value, secondUrlNode.value)) {\n    return false\n  }\n  // maybe this sourceIndex should be removed in case there is some css transformation one day?\n  // it does not seems to change though as if it was refering the original file source index\n  if (firstUrlNode.sourceIndex !== secondUrlNode.sourceIndex) {\n    return false\n  }\n  return true\n}\n\n// minification may change url node type from string to word\n// that's still the same node\nconst compareUrlNodeTypes = (firstUrlNodeType, secondUrlNodeType) => {\n  if (firstUrlNodeType === secondUrlNodeType) {\n    return true\n  }\n  if (firstUrlNodeType === \"word\" && secondUrlNodeType === \"string\") {\n    return true\n  }\n  if (firstUrlNodeType === \"string\" && secondUrlNodeType === \"word\") {\n    return true\n  }\n  return false\n}\n\n// minification may change url node value from './whatever.png' to 'whatever.png'\n// the value still revolves to the same target\nconst compareUrlNodeValue = (firstUrlNodeValue, secondUrlNodeValue) => {\n  const firstValueNormalized = urlToRelativeUrl(\n    resolveUrl(firstUrlNodeValue, \"file:///\"),\n    \"file:///\",\n  )\n  const secondValueNormalized = urlToRelativeUrl(\n    resolveUrl(secondUrlNodeValue, \"file:///\"),\n    \"file:///\",\n  )\n  return firstValueNormalized === secondValueNormalized\n}\n",
    "import { basename } from \"path\"\nimport { urlToFilename, resolveUrl, urlToRelativeUrl } from \"@jsenv/util\"\nimport {\n  getJavaScriptSourceMappingUrl,\n  setJavaScriptSourceMappingUrl,\n} from \"@jsenv/core/src/internal/sourceMappingURLUtils.js\"\nimport { bundleWorker } from \"@jsenv/core/src/internal/building/bundleWorker.js\"\nimport { minifyJs } from \"./minifyJs.js\"\n\nexport const parseJsAsset = async (\n  jsTarget,\n  { notifyReferenceFound },\n  { urlToOriginalProjectUrl, minify, minifyJsOptions },\n) => {\n  const jsUrl = jsTarget.targetUrl\n  const jsString = String(jsTarget.targetBuffer)\n  const jsSourcemapUrl = getJavaScriptSourceMappingUrl(jsString)\n  let sourcemapReference\n\n  if (jsSourcemapUrl) {\n    sourcemapReference = notifyReferenceFound({\n      referenceExpectedContentType: \"application/json\",\n      referenceTargetSpecifier: jsSourcemapUrl,\n      // we don't really know the line or column\n      // but let's asusme it the last line and first column\n      referenceLine: jsString.split(/\\r?\\n/).length - 1,\n      referenceColumn: 0,\n    })\n  }\n\n  return async ({ precomputeBuildRelativeUrl, registerAssetEmitter }) => {\n    let map\n    if (sourcemapReference) {\n      map = JSON.parse(sourcemapReference.target.targetBufferAfterTransformation)\n    }\n\n    // in case this js asset is a worker, bundle it so that:\n    // importScripts are inlined which is good for:\n    // - not breaking things (otherwise we would have to copy imported files in the build directory)\n    // - perf (one less http request)\n    const mightBeAWorkerScript = !jsTarget.targetIsInline\n\n    let jsSourceAfterTransformation\n    if (mightBeAWorkerScript) {\n      const workerScriptUrl = urlToOriginalProjectUrl(jsUrl)\n      const workerBundle = await bundleWorker({ workerScriptUrl, workerScriptSourceMap: map })\n      jsSourceAfterTransformation = workerBundle.code\n      map = workerBundle.map\n    } else {\n      jsSourceAfterTransformation = jsString\n    }\n\n    if (minify) {\n      const jsUrlRelativeToImporter = jsTarget.targetIsInline\n        ? urlToRelativeUrl(jsTarget.targetUrl, jsTarget.targetReferences[0].referenceUrl)\n        : jsTarget.targetRelativeUrl\n      const result = await minifyJs(jsString, jsUrlRelativeToImporter, {\n        sourceMap: {\n          ...(map ? { content: JSON.stringify(map) } : {}),\n          asObject: true,\n        },\n        toplevel: false,\n        ...minifyJsOptions,\n      })\n      jsSourceAfterTransformation = result.code\n      map = result.map\n      if (!map.sourcesContent) {\n        map.sourcesContent = [jsString]\n      }\n    }\n\n    if (map) {\n      const jsBuildRelativeUrl = precomputeBuildRelativeUrl(jsString)\n      const jsSourcemapFilename = `${basename(jsBuildRelativeUrl)}.map`\n      jsSourceAfterTransformation = setJavaScriptSourceMappingUrl(\n        jsSourceAfterTransformation,\n        jsSourcemapFilename,\n      )\n\n      registerAssetEmitter(({ buildDirectoryUrl, emitAsset }) => {\n        const jsBuildUrl = resolveUrl(jsTarget.targetBuildRelativeUrl, buildDirectoryUrl)\n        const mapBuildUrl = resolveUrl(jsSourcemapFilename, jsBuildUrl)\n        map.file = urlToFilename(jsBuildUrl)\n        if (map.sources) {\n          map.sources = map.sources.map((source) => {\n            const sourceUrl = resolveUrl(source, jsUrl)\n            const sourceUrlRelativeToSourceMap = urlToRelativeUrl(sourceUrl, mapBuildUrl)\n            return sourceUrlRelativeToSourceMap\n          })\n        }\n\n        const mapSource = JSON.stringify(map, null, \"  \")\n        const buildRelativeUrl = urlToRelativeUrl(mapBuildUrl, buildDirectoryUrl)\n\n        if (sourcemapReference) {\n          // redirect original sourcemap from build to a new file\n          // we'll need to remove the old asset from rollup build\n          // and emit a new one instead\n          // when finding this asset in the rollup build we'll have to remove it\n          sourcemapReference.target.updateOnceReady({\n            targetBufferAfterTransformation: mapSource,\n            buildRelativeUrl,\n          })\n        } else {\n          emitAsset({\n            source: mapSource,\n            fileName: buildRelativeUrl,\n          })\n        }\n      })\n\n      return {\n        targetBufferAfterTransformation: jsSourceAfterTransformation,\n        targetBuildRelativeUrl: jsBuildRelativeUrl,\n      }\n    }\n\n    return jsSourceAfterTransformation\n  }\n}\n",
    "export const parseJsonAsset = (jsonTarget, notifiers, { minify }) => {\n  const jsonString = String(jsonTarget.targetBuffer)\n  return () => {\n    if (minify) {\n      // this is to remove eventual whitespaces\n      return JSON.stringify(JSON.parse(jsonString))\n    }\n    return jsonString\n  }\n}\n",
    "export const parseWebmanifest = (webmanifestTarget, { notifyReferenceFound }, { minify }) => {\n  // const manifestUrl = manifestTarget.url\n  const manifestString = String(webmanifestTarget.targetBuffer)\n\n  const manifest = JSON.parse(manifestString)\n  const { icons = [] } = manifest\n\n  const iconReferences = icons.map((icon) => {\n    const iconReference = notifyReferenceFound({\n      referenceTargetSpecifier: icon.src,\n    })\n    return iconReference\n  })\n\n  return ({ getReferenceUrlRelativeToImporter }) => {\n    if (icons.length === 0) {\n      if (minify) {\n        // this is to remove eventual whitespaces\n        return JSON.stringify(manifest)\n      }\n      return JSON.stringify(manifestString)\n    }\n\n    const iconsAfterBuild = icons.map((icon, index) => {\n      const iconAfterBuild = { ...icon }\n      iconAfterBuild.src = getReferenceUrlRelativeToImporter(iconReferences[index])\n      return iconAfterBuild\n    })\n    const manifestAfterBuild = { ...manifest }\n    manifestAfterBuild.icons = iconsAfterBuild\n    if (minify) {\n      return JSON.stringify(manifestAfterBuild)\n    }\n    return JSON.stringify(manifestAfterBuild, null, \"  \")\n  }\n}\n",
    "import { composeTwoImportMaps } from \"@jsenv/import-map\"\nimport {\n  parseHtmlString,\n  htmlAstContains,\n  htmlNodeIsScriptModule,\n  manipulateHtmlAst,\n  findFirstImportmapNode,\n} from \"@jsenv/core/src/internal/compiling/compileHtml.js\"\n\nimport { parseHtmlAsset } from \"./html/parseHtmlAsset.js\"\nimport { parseImportmapAsset } from \"./importmap/parseImportmapAsset.js\"\nimport { parseSvgAsset } from \"./svg/parseSvgAsset.js\"\nimport { parseCssAsset } from \"./css/parseCssAsset.js\"\nimport { parseJsAsset } from \"./js/parseJsAsset.js\"\nimport { parseJsonAsset } from \"./json/parseJsonAsset.js\"\nimport { parseWebmanifest } from \"./webmanifest/parseWebmanifest.js\"\n\nexport const parseTarget = (\n  target,\n  notifiers,\n  {\n    urlToOriginalProjectUrl,\n    format,\n    systemJsUrl,\n    useImportMapToImproveLongTermCaching,\n    createImportMapForFilesUsedInJs,\n    minify,\n    minifyHtmlOptions,\n    minifyCssOptions,\n    minifyJsOptions,\n  },\n) => {\n  const { targetContentType } = target\n  if (!targetContentType) {\n    return null\n  }\n\n  if (targetContentType === \"text/html\") {\n    return parseHtmlAsset(target, notifiers, {\n      minify,\n      minifyHtmlOptions,\n      htmlStringToHtmlAst: (htmlString) => {\n        const htmlAst = parseHtmlString(htmlString)\n\n        // force presence of systemjs script if html contains a module script\n        const injectSystemJsScriptIfNeeded = (htmlAst) => {\n          if (format !== \"systemjs\") {\n            return\n          }\n\n          const htmlContainsModuleScript = htmlAstContains(htmlAst, htmlNodeIsScriptModule)\n          if (!htmlContainsModuleScript) {\n            return\n          }\n\n          manipulateHtmlAst(htmlAst, {\n            scriptInjections: [\n              {\n                src: systemJsUrl,\n              },\n            ],\n          })\n        }\n\n        // force the presence of a fake+inline+empty importmap script\n        // if html contains no importmap and we useImportMapToImproveLongTermCaching\n        // this inline importmap will be transformed later to have top level remapping\n        // required to target hashed js urls\n        const injectImportMapScriptIfNeeded = (htmlAst) => {\n          if (!useImportMapToImproveLongTermCaching) {\n            return\n          }\n          if (findFirstImportmapNode(htmlAst)) {\n            return\n          }\n\n          manipulateHtmlAst(htmlAst, {\n            scriptInjections: [\n              {\n                type: \"importmap\",\n                id: \"jsenv-build-importmap\",\n                text: \"{}\",\n              },\n            ],\n          })\n        }\n\n        injectSystemJsScriptIfNeeded(htmlAst)\n        injectImportMapScriptIfNeeded(htmlAst)\n\n        return htmlAst\n      },\n      transformImportmapTarget: (importmapTarget) => {\n        if (!useImportMapToImproveLongTermCaching) {\n          return\n        }\n        injectImportedFilesIntoImportMapTarget(\n          importmapTarget,\n          createImportMapForFilesUsedInJs(),\n          minify,\n        )\n      },\n    })\n  }\n\n  if (targetContentType === \"text/css\") {\n    return parseCssAsset(target, notifiers, { minify, minifyCssOptions })\n  }\n\n  if (targetContentType === \"application/importmap+json\") {\n    return parseImportmapAsset(target, notifiers, { minify })\n  }\n\n  if (\n    targetContentType === \"application/manifest+json\" ||\n    target.targetReferences[0].referenceExpectedContentType === \"application/manifest+json\"\n  ) {\n    return parseWebmanifest(target, notifiers, { minify })\n  }\n\n  if (targetContentType === \"application/javascript\" || targetContentType === \"text/javascript\") {\n    return parseJsAsset(target, notifiers, { urlToOriginalProjectUrl, minify, minifyJsOptions })\n  }\n\n  if (targetContentType === \"image/svg+xml\") {\n    return parseSvgAsset(target, notifiers, { minify, minifyHtmlOptions })\n  }\n\n  if (targetContentType === \"application/json\" || targetContentType.endsWith(\"+json\")) {\n    return parseJsonAsset(target, notifiers, { minify })\n  }\n\n  return null\n}\n\nconst injectImportedFilesIntoImportMapTarget = (importmapTarget, importMapToInject, minify) => {\n  const { targetBufferAfterTransformation } = importmapTarget\n\n  const importmapOriginal = JSON.parse(targetBufferAfterTransformation)\n  const importmapFinal = composeTwoImportMaps(importmapOriginal, importMapToInject)\n  const importmapFinalContent = minify\n    ? JSON.stringify(importmapFinal)\n    : JSON.stringify(importmapFinal, null, \"  \")\n\n  importmapTarget.updateOnceReady({\n    targetBufferAfterTransformation: importmapFinalContent,\n  })\n}\n",
    "export const cross = \"☓\" // \"\\u2613\"\nexport const checkmark = \"✔\" // \"\\u2714\"\n\nexport const yellow = \"\\x1b[33m\"\nexport const magenta = \"\\x1b[35m\"\nexport const red = \"\\x1b[31m\"\nexport const green = \"\\x1b[32m\"\nexport const grey = \"\\x1b[39m\"\nexport const ansiResetSequence = \"\\x1b[0m\"\n",
    "// https://github.com/postcss/postcss/blob/fd30d3df5abc0954a0ec642a3cdc644ab2aacf9c/lib/css-syntax-error.js#L43\n// https://github.com/postcss/postcss/blob/fd30d3df5abc0954a0ec642a3cdc644ab2aacf9c/lib/terminal-highlight.js#L50\n// https://github.com/babel/babel/blob/eea156b2cb8deecfcf82d52aa1b71ba4995c7d68/packages/babel-code-frame/src/index.js#L1\n\nimport { grey, red, ansiResetSequence } from \"../executing/ansi.js\"\n\nexport const showSourceLocation = (\n  source,\n  { line, column, numberOfSurroundingLinesToShow = 1, lineMaxLength = 120, color = false },\n) => {\n  let mark = (string) => string\n  let aside = (string) => string\n  if (color) {\n    mark = (string) => `${red}${string}${ansiResetSequence}`\n    aside = (string) => `${grey}${string}${ansiResetSequence}`\n  }\n\n  const lines = source.split(/\\r?\\n/)\n  let lineRange = {\n    start: line - 1,\n    end: line,\n  }\n  lineRange = moveLineRangeUp(lineRange, numberOfSurroundingLinesToShow)\n  lineRange = moveLineRangeDown(lineRange, numberOfSurroundingLinesToShow)\n  lineRange = lineRangeWithinLines(lineRange, lines)\n  const linesToShow = lines.slice(lineRange.start, lineRange.end)\n  const endLineNumber = lineRange.end\n  const lineNumberMaxWidth = String(endLineNumber).length\n\n  const columnRange = {}\n  if (column === undefined) {\n    columnRange.start = 0\n    columnRange.end = lineMaxLength\n  } else if (column > lineMaxLength) {\n    columnRange.start = column - Math.floor(lineMaxLength / 2)\n    columnRange.end = column + Math.ceil(lineMaxLength / 2)\n  } else {\n    columnRange.start = 0\n    columnRange.end = lineMaxLength\n  }\n\n  return linesToShow.map((lineSource, index) => {\n    const lineNumber = lineRange.start + index + 1\n    const isMainLine = lineNumber === line\n    const lineSourceTruncated = applyColumnRange(columnRange, lineSource)\n    const lineNumberWidth = String(lineNumber).length\n    // ensure if line moves from 7,8,9 to 10 the display is still great\n    const lineNumberRightSpacing = \" \".repeat(lineNumberMaxWidth - lineNumberWidth)\n    const asideSource = `${lineNumber}${lineNumberRightSpacing} |`\n    const lineFormatted = `${aside(asideSource)} ${lineSourceTruncated}`\n    if (isMainLine) {\n      if (column === undefined) {\n        return `${mark(\">\")} ${lineFormatted}`\n      }\n      const spacing = stringToSpaces(\n        `${asideSource} ${lineSourceTruncated.slice(0, column - columnRange.start - 1)}`,\n      )\n      return `${mark(\">\")} ${lineFormatted}\n  ${spacing}${mark(\"^\")}`\n    }\n    return `  ${lineFormatted}`\n  }).join(`\n`)\n}\n\nconst applyColumnRange = ({ start, end }, line) => {\n  if (typeof start !== \"number\") {\n    throw new TypeError(`start must be a number, received ${start}`)\n  }\n  if (typeof end !== \"number\") {\n    throw new TypeError(`end must be a number, received ${end}`)\n  }\n  if (end < start) {\n    throw new Error(`end must be greater than start, but ${end} is smaller than ${start}`)\n  }\n\n  const prefix = \"…\"\n  const suffix = \"…\"\n  const lastIndex = line.length\n\n  if (line.length === 0) {\n    // don't show any ellipsis if the line is empty\n    // because it's not truncated in that case\n    return \"\"\n  }\n\n  const startTruncated = start > 0\n  const endTruncated = lastIndex > end\n\n  let from = startTruncated ? start + prefix.length : start\n  let to = endTruncated ? end - suffix.length : end\n  if (to > lastIndex) to = lastIndex\n\n  if (start >= lastIndex || from === to) {\n    return \"\"\n  }\n\n  let result = \"\"\n  while (from < to) {\n    result += line[from]\n    from++\n  }\n\n  if (result.length === 0) {\n    return \"\"\n  }\n  if (startTruncated && endTruncated) {\n    return `${prefix}${result}${suffix}`\n  }\n  if (startTruncated) {\n    return `${prefix}${result}`\n  }\n  if (endTruncated) {\n    return `${result}${suffix}`\n  }\n  return result\n}\n\nconst stringToSpaces = (string) => string.replace(/[^\\t]/g, \" \")\n\n// const getLineRangeLength = ({ start, end }) => end - start\n\nconst moveLineRangeUp = ({ start, end }, number) => {\n  return {\n    start: start - number,\n    end,\n  }\n}\n\nconst moveLineRangeDown = ({ start, end }, number) => {\n  return {\n    start,\n    end: end + number,\n  }\n}\n\nconst lineRangeWithinLines = ({ start, end }, lines) => {\n  return {\n    start: start < 0 ? 0 : start,\n    end: end > lines.length ? lines.length : end,\n  }\n}\n",
    "// https://github.com/browserify/resolve/blob/a09a2e7f16273970be4639313c83b913daea15d7/lib/core.json#L1\n// https://nodejs.org/api/modules.html#modules_module_builtinmodules\n// https://stackoverflow.com/a/35825896\n// https://github.com/browserify/resolve/blob/master/lib/core.json#L1\n\nconst NATIVE_NODE_MODULE_SPECIFIER_ARRAY = [\n  \"assert\",\n  \"async_hooks\",\n  \"buffer_ieee754\",\n  \"buffer\",\n  \"child_process\",\n  \"cluster\",\n  \"console\",\n  \"constants\",\n  \"crypto\",\n  \"_debugger\",\n  \"dgram\",\n  \"dns\",\n  \"domain\",\n  \"events\",\n  \"freelist\",\n  \"fs\",\n  \"fs/promises\",\n  \"_http_agent\",\n  \"_http_client\",\n  \"_http_common\",\n  \"_http_incoming\",\n  \"_http_outgoing\",\n  \"_http_server\",\n  \"http\",\n  \"http2\",\n  \"https\",\n  \"inspector\",\n  \"_linklist\",\n  \"module\",\n  \"net\",\n  \"node-inspect/lib/_inspect\",\n  \"node-inspect/lib/internal/inspect_client\",\n  \"node-inspect/lib/internal/inspect_repl\",\n  \"os\",\n  \"path\",\n  \"perf_hooks\",\n  \"process\",\n  \"punycode\",\n  \"querystring\",\n  \"readline\",\n  \"repl\",\n  \"smalloc\",\n  \"_stream_duplex\",\n  \"_stream_transform\",\n  \"_stream_wrap\",\n  \"_stream_passthrough\",\n  \"_stream_readable\",\n  \"_stream_writable\",\n  \"stream\",\n  \"string_decoder\",\n  \"sys\",\n  \"timers\",\n  \"_tls_common\",\n  \"_tls_legacy\",\n  \"_tls_wrap\",\n  \"tls\",\n  \"trace_events\",\n  \"tty\",\n  \"url\",\n  \"util\",\n  \"v8/tools/arguments\",\n  \"v8/tools/codemap\",\n  \"v8/tools/consarray\",\n  \"v8/tools/csvparser\",\n  \"v8/tools/logreader\",\n  \"v8/tools/profile_view\",\n  \"v8/tools/splaytree\",\n  \"v8\",\n  \"vm\",\n  \"worker_threads\",\n  \"zlib\",\n  // global is special\n  \"global\",\n]\n\nexport const isBareSpecifierForNativeNodeModule = (specifier) => {\n  return NATIVE_NODE_MODULE_SPECIFIER_ARRAY.includes(specifier)\n}\n",
    "import { createCancellationToken } from \"@jsenv/cancellation\"\nimport { resolveUrl } from \"@jsenv/util\"\nimport { createLogger } from \"@jsenv/logger\"\nimport { dataUrlToRawData, parseDataUrl } from \"@jsenv/core/src/internal/dataUrl.utils.js\"\nimport { getJavaScriptSourceMappingUrl } from \"@jsenv/core/src/internal/sourceMappingURLUtils.js\"\nimport { fetchUrl } from \"@jsenv/core/src/internal/fetchUrl.js\"\nimport { validateResponseStatusIsOk } from \"@jsenv/core/src/internal/validateResponseStatusIsOk.js\"\n\nexport const fetchSourcemap = async (\n  jsUrl,\n  jsString,\n  { cancellationToken = createCancellationToken(), logger = createLogger() } = {},\n) => {\n  const jsSourcemapUrl = getJavaScriptSourceMappingUrl(jsString)\n\n  if (!jsSourcemapUrl) {\n    return null\n  }\n\n  if (jsSourcemapUrl.startsWith(\"data:\")) {\n    const jsSourcemapString = dataUrlToRawData(parseDataUrl(jsSourcemapUrl))\n    return parseSourcemapString(jsSourcemapString, jsSourcemapUrl, `inline comment in ${jsUrl}`)\n  }\n\n  const sourcemapUrl = resolveUrl(jsSourcemapUrl, jsUrl)\n  const sourcemapResponse = await fetchUrl(sourcemapUrl, {\n    cancellationToken,\n    ignoreHttpsError: true,\n  })\n  const okValidation = validateResponseStatusIsOk(sourcemapResponse, jsUrl)\n\n  if (!okValidation.valid) {\n    logger.warn(`unexpected response for sourcemap file:\n${okValidation.message}`)\n    return null\n  }\n\n  // in theory we should also check sourcemapResponse content-type is correctly set\n  // but not really important.\n  const sourcemapBodyAsText = await sourcemapResponse.text()\n  return parseSourcemapString(sourcemapBodyAsText, sourcemapUrl, jsUrl)\n}\n\nconst parseSourcemapString = (sourcemapString, sourcemapUrl, importer) => {\n  try {\n    return JSON.parse(sourcemapString)\n  } catch (e) {\n    if (e.name === \"SyntaxError\") {\n      console.error(\n        `syntax error while parsing sourcemap.\n--- syntax error stack ---\n${e.stack}\n--- sourcemap url ---\n${sourcemapUrl}\n--- imported by ---\n${importer}`,\n      )\n      return null\n    }\n    throw e\n  }\n}\n",
    "import { createHash } from \"crypto\"\nimport { urlToParentUrl, urlToBasename, urlToExtension } from \"@jsenv/util\"\nimport { renderNamePattern } from \"../renderNamePattern.js\"\n\nexport const computeBuildRelativeUrl = (\n  fileUrl,\n  fileContent,\n  pattern = \"[name]-[hash][extname]\",\n) => {\n  const buildRelativeUrl = renderNamePattern(typeof pattern === \"function\" ? pattern() : pattern, {\n    dirname: () => urlToParentUrl(fileUrl),\n    name: () => urlToBasename(fileUrl),\n    hash: () => generateContentHash(fileContent),\n    extname: () => urlToExtension(fileUrl),\n  })\n  return buildRelativeUrl\n}\n\n// https://github.com/rollup/rollup/blob/19e50af3099c2f627451a45a84e2fa90d20246d5/src/utils/FileEmitter.ts#L47\nexport const generateContentHash = (stringOrBuffer) => {\n  const hash = createHash(\"sha256\")\n  hash.update(stringOrBuffer)\n  return hash.digest(\"hex\").slice(0, 8)\n}\n",
    "import { computeBuildRelativeUrl } from \"./url-versioning.js\"\n\nexport const computeBuildRelativeUrlForTarget = (target) => {\n  return computeBuildRelativeUrl(\n    target.targetUrl,\n    target.targetBufferAfterTransformation,\n    targetToFileNamePattern(target),\n  )\n}\n\nconst assetFileNamePattern = \"assets/[name]-[hash][extname]\"\nconst assetFileNamePatternWithoutHash = \"assets/[name][extname]\"\n\nconst targetToFileNamePattern = (target) => {\n  if (target.targetFileNamePattern) {\n    return target.targetFileNamePattern\n  }\n\n  if (target.targetUrlVersioningDisabled) {\n    if (target.targetIsEntry || target.targetIsJsModule) {\n      return `[name][extname]`\n    }\n    return assetFileNamePatternWithoutHash\n  }\n\n  if (target.targetIsEntry || target.isTargetIsJsModule) {\n    return `[name]-[hash][extname]`\n  }\n  return assetFileNamePattern\n}\n\nexport const precomputeBuildRelativeUrlForTarget = (\n  target,\n  targetBufferAfterTransformation = \"\",\n) => {\n  if (target.targetBuildRelativeUrl) {\n    return target.targetBuildRelativeUrl\n  }\n\n  target.targetBufferAfterTransformation = targetBufferAfterTransformation\n  const precomputedBuildRelativeUrl = computeBuildRelativeUrlForTarget(target)\n  target.targetBufferAfterTransformation = undefined\n  return precomputedBuildRelativeUrl\n}\n",
    "/**\n\n--- Inlining asset ---\nIn the context of http2 and beyond http request\nis reused so saving http request by inlining asset is less\nattractive.\nYou gain some speed because one big file is still faster\nthan many small files.\n\nBut inlined asset got two drawbacks:\n\n(1) they cannot be cached by the browser\nassets inlined in the html file have no hash\nand must be redownloaded every time.\n-> No way to mitigate this\n\n(2) they cannot be shared by different files.\nassets inlined in the html cannot be shared\nbecause their source lives in the html.\nYou might accidentatly load twice a css because it's\nreferenced both in js and html for instance.\n-> We could warn about asset inlined + referenced\nmore than once\n\nEach time an asset needs to be inlined its dependencies\nmust be re-resolved to its importer location.\nThis is quite a lot of work to implement this.\nConsidering that inlining is not that worth it and might\nduplicate them when imported more than once let's just not do it.\n\n*/\n\nimport { resolveUrl, urlToRelativeUrl, urlIsInsideOf, urlToParentUrl } from \"@jsenv/util\"\nimport { createLogger } from \"@jsenv/logger\"\nimport { parseDataUrl } from \"@jsenv/core/src/internal/dataUrl.utils.js\"\nimport { showSourceLocation } from \"./showSourceLocation.js\"\n\nimport {\n  getTargetAsBase64Url,\n  memoize,\n  getCallerLocation,\n  formatReferenceFound,\n  formatExternalReferenceLog,\n  checkContentType,\n} from \"./asset-builder.util.js\"\nimport {\n  computeBuildRelativeUrlForTarget,\n  precomputeBuildRelativeUrlForTarget,\n} from \"./asset-url-versioning.js\"\n\nexport const createAssetBuilder = (\n  { fetch, parse },\n  {\n    logLevel,\n    format,\n    projectDirectoryUrl, // project url but it can be an http url\n    buildDirectoryRelativeUrl,\n    urlToFileUrl, // get a file url from an eventual http url\n    loadUrl = () => null,\n    emitAsset,\n    connectTarget = () => {},\n    resolveTargetUrl = ({ targetSpecifier, importerUrl }) =>\n      resolveUrl(targetSpecifier, importerUrl),\n  },\n) => {\n  const logger = createLogger({ logLevel })\n\n  const buildDirectoryUrl = resolveUrl(buildDirectoryRelativeUrl, projectDirectoryUrl)\n\n  const createReferenceForHTMLEntry = async ({\n    entryContentType,\n    entryUrl,\n    entryBuffer,\n    entryBuildRelativeUrl,\n  }) => {\n    // we don't really know where this reference to that asset file comes from\n    // we could almost say it's from the script calling this function\n    // so we could analyse stack trace here to put this function caller\n    // as the reference to this target file\n    const callerLocation = getCallerLocation()\n    const entryReference = createReference({\n      referenceTargetSpecifier: entryUrl,\n      referenceExpectedContentType: entryContentType,\n      referenceUrl: callerLocation.url,\n      referenceLine: callerLocation.line,\n      referenceColumn: callerLocation.column,\n\n      targetContentType: entryContentType,\n      targetBuffer: entryBuffer,\n\n      targetIsEntry: true,\n\n      // don't hash asset entry points\n      targetUrlVersioningDisabled: true,\n      targetFileNamePattern: entryBuildRelativeUrl,\n    })\n\n    await entryReference.target.getDependenciesAvailablePromise()\n    // start to wait internally for eventual chunks\n    // but don't await here because this function will be awaited by rollup before starting\n    // to parse chunks\n    entryReference.target.getReadyPromise()\n  }\n\n  const createReferenceForJs = async ({\n    jsUrl,\n    jsLine,\n    jsColumn,\n\n    targetSpecifier,\n    targetContentType,\n    targetBuffer,\n  }) => {\n    const reference = createReference({\n      referenceTargetSpecifier: targetSpecifier,\n      referenceExpectedContentType: targetContentType,\n      referenceUrl: jsUrl,\n      referenceColumn: jsLine,\n      referenceLine: jsColumn,\n\n      targetContentType,\n      targetBuffer,\n    })\n    await reference.target.getRollupReferenceIdAvailablePromise()\n    return reference\n  }\n\n  const getAllAssetEntryEmittedPromise = async () => {\n    const urlToWait = Object.keys(targetMap).filter((url) => targetMap[url].targetIsEntry)\n    return Promise.all(\n      urlToWait.map(async (url) => {\n        const target = targetMap[url]\n        await target.getRollupReferenceIdAvailablePromise()\n        return target\n      }),\n    )\n  }\n\n  const targetMap = {}\n  const createReference = ({\n    referenceTargetSpecifier,\n    referenceExpectedContentType,\n    referenceUrl,\n    referenceColumn,\n    referenceLine,\n\n    targetContentType,\n    targetBuffer,\n    targetIsEntry,\n    targetIsJsModule,\n    targetIsInline,\n    targetFileNamePattern,\n    targetUrlVersioningDisabled,\n  }) => {\n    const importerUrl = referenceUrl\n    const importerTarget =\n      importerUrl in targetMap\n        ? targetMap[importerUrl]\n        : {\n            targetUrl: importerUrl,\n            targetIsEntry: false, // maybe\n            targetIsJsModule: true,\n            targetBufferAfterTransformation: \"\",\n          }\n\n    // for now we can only emit a chunk from an entry file as visible in\n    // https://rollupjs.org/guide/en/#thisemitfileemittedfile-emittedchunk--emittedasset--string\n    // https://github.com/rollup/rollup/issues/2872\n    if (targetIsJsModule && !importerTarget.targetIsEntry) {\n      // it's not really possible\n      logger.warn(\n        `ignoring js reference found in an asset (it's only possible to reference js from entry asset)`,\n      )\n      return null\n    }\n\n    const resolveTargetReturnValue = resolveTargetUrl({\n      targetSpecifier: referenceTargetSpecifier,\n      targetIsJsModule,\n      importerUrl: referenceUrl,\n      importerIsEntry: importerTarget.targetIsEntry,\n      importerIsJsModule: importerTarget.targetIsJsModule,\n    })\n\n    let targetUrl\n    let targetIsExternal = false\n    if (typeof resolveTargetReturnValue === \"object\") {\n      if (resolveTargetReturnValue.external) {\n        targetIsExternal = true\n      }\n      targetUrl = resolveTargetReturnValue.url\n    } else {\n      targetUrl = resolveTargetReturnValue\n    }\n\n    if (targetUrl.startsWith(\"data:\")) {\n      targetIsExternal = false\n      targetIsInline = true\n      const { mediaType, base64Flag, data } = parseDataUrl(targetUrl)\n      referenceExpectedContentType = mediaType\n      targetContentType = mediaType\n      targetBuffer = base64Flag ? Buffer.from(data, \"base64\") : decodeURI(data)\n    }\n\n    // any hash in the url would mess up with filenames\n    targetUrl = removePotentialUrlHash(targetUrl)\n\n    if (targetIsInline && targetFileNamePattern === undefined) {\n      // inherit parent directory location because it's an inline file\n      targetFileNamePattern = () => {\n        const importerBuildRelativeUrl = precomputeBuildRelativeUrlForTarget(importerTarget)\n        const importerParentRelativeUrl = urlToRelativeUrl(\n          urlToParentUrl(resolveUrl(importerBuildRelativeUrl, \"file://\")),\n          \"file://\",\n        )\n        return `${importerParentRelativeUrl}[name]-[hash][extname]`\n      }\n    }\n\n    const reference = {\n      referenceExpectedContentType,\n      referenceUrl,\n      referenceColumn,\n      referenceLine,\n    }\n\n    if (targetUrl in targetMap) {\n      const target = targetMap[targetUrl]\n      connectReferenceAndTarget(reference, target)\n    } else {\n      const target = createTarget({\n        targetContentType,\n        targetUrl,\n        targetBuffer,\n\n        targetIsEntry,\n        targetIsJsModule,\n        targetIsExternal,\n        targetIsInline,\n        targetFileNamePattern,\n        targetUrlVersioningDisabled,\n      })\n      targetMap[targetUrl] = target\n      connectReferenceAndTarget(reference, target)\n      connectTarget(target)\n    }\n\n    if (targetIsExternal) {\n      logger.debug(\n        formatExternalReferenceLog(reference, {\n          showReferenceSourceLocation,\n          projectDirectoryUrl: urlToFileUrl(projectDirectoryUrl),\n        }),\n      )\n    } else {\n      logger.debug(formatReferenceFound(reference, showReferenceSourceLocation(reference)))\n    }\n\n    return reference\n  }\n\n  const connectReferenceAndTarget = (reference, target) => {\n    reference.target = target\n    target.targetReferences.push(reference)\n    target.getBufferAvailablePromise().then(() => {\n      checkContentType(reference, { logger, showReferenceSourceLocation })\n    })\n  }\n\n  const assetTransformMap = {}\n  // used to remove sourcemap files that are renamed after they are emitted\n  const buildRelativeUrlsToClean = []\n  const getBuildRelativeUrlsToClean = () => buildRelativeUrlsToClean\n\n  const createTarget = ({\n    targetContentType,\n    targetUrl,\n    targetBuffer,\n\n    targetIsEntry = false,\n    targetIsJsModule = false,\n    targetIsExternal = false,\n    targetIsInline = false,\n\n    targetFileNamePattern,\n    targetUrlVersioningDisabled = false,\n  }) => {\n    const target = {\n      targetContentType,\n      targetUrl,\n      targetBuffer,\n      targetReferences: [],\n\n      targetIsEntry,\n      targetIsJsModule,\n      targetIsInline,\n\n      targetUrlVersioningDisabled,\n      targetFileNamePattern,\n\n      targetRelativeUrl: urlToRelativeUrl(targetUrl, projectDirectoryUrl),\n      targetBufferAfterTransformation: undefined,\n    }\n\n    const getBufferAvailablePromise = memoize(async () => {\n      const response = await fetch(\n        targetUrl,\n        showReferenceSourceLocation(target.targetReferences[0]),\n      )\n      const responseContentTypeHeader = response.headers[\"content-type\"]\n      target.targetContentType = responseContentTypeHeader\n\n      const responseBodyAsArrayBuffer = await response.arrayBuffer()\n      target.targetBuffer = Buffer.from(responseBodyAsArrayBuffer)\n    })\n    if (targetBuffer !== undefined) {\n      getBufferAvailablePromise.forceMemoization(Promise.resolve())\n    }\n\n    const getDependenciesAvailablePromise = memoize(async () => {\n      await getBufferAvailablePromise()\n      const dependencies = []\n\n      let previousJsDependency\n      let parsingDone = false\n      const notifyReferenceFound = ({\n        referenceTargetSpecifier,\n        referenceExpectedContentType,\n        referenceLine,\n        referenceColumn,\n\n        targetContentType,\n        targetBuffer,\n        targetIsJsModule = false,\n        targetIsInline = false,\n        targetUrlVersioningDisabled,\n        targetFileNamePattern,\n      }) => {\n        if (parsingDone) {\n          throw new Error(\n            `notifyReferenceFound cannot be called once ${targetUrl} parsing is done.`,\n          )\n        }\n\n        const dependencyReference = createReference({\n          referenceTargetSpecifier,\n          referenceUrl: targetUrl,\n          referenceLine,\n          referenceColumn,\n          referenceExpectedContentType,\n\n          previousJsDependency,\n\n          targetContentType,\n          targetBuffer,\n          targetIsJsModule,\n          targetIsInline,\n\n          targetUrlVersioningDisabled,\n          targetFileNamePattern,\n        })\n\n        if (dependencyReference) {\n          dependencies.push(dependencyReference)\n          if (targetIsJsModule) {\n            previousJsDependency = dependencyReference\n          }\n        }\n        return dependencyReference\n      }\n\n      const parseReturnValue = await parse(target, {\n        format,\n        notifyReferenceFound,\n      })\n      parsingDone = true\n\n      if (dependencies.length > 0 && typeof parseReturnValue !== \"function\") {\n        throw new Error(\n          `parse notified some dependencies, it must return a function but received ${parseReturnValue}`,\n        )\n      }\n      if (typeof parseReturnValue === \"function\") {\n        assetTransformMap[targetUrl] = parseReturnValue\n      }\n      if (dependencies.length > 0) {\n        logger.debug(\n          `${shortenUrl(\n            targetUrl,\n          )} dependencies collected -> ${dependencies.map((dependencyReference) =>\n            shortenUrl(dependencyReference.target.targetUrl),\n          )}`,\n        )\n      }\n\n      target.dependencies = dependencies\n    })\n\n    const getReadyPromise = memoize(async () => {\n      if (targetIsExternal) {\n        // external urls are immediatly available and not modified\n        return\n      }\n\n      // une fois que les dépendances sont transformées on peut transformer cet asset\n      if (targetIsJsModule) {\n        // ici l'url n'est pas top parce que\n        // l'url de l'asset est relative au fichier html source\n        logger.debug(`waiting for rollup chunk to be ready to resolve ${shortenUrl(targetUrl)}`)\n        const rollupChunkReadyPromise = new Promise((resolve) => {\n          registerCallbackOnceRollupChunkIsReady(target.targetUrl, resolve)\n        })\n        const {\n          targetBufferAfterTransformation,\n          targetBuildRelativeUrl,\n          targetFileName,\n        } = await rollupChunkReadyPromise\n        target.targetBufferAfterTransformation = targetBufferAfterTransformation\n        target.targetBuildRelativeUrl = targetBuildRelativeUrl\n        target.targetFileName = targetFileName\n        return\n      }\n\n      // la transformation d'un asset c'est avant tout la transformation de ses dépendances\n      // mais si on a rien a transformer, on a pas vraiment besoin de tout ça\n      await getDependenciesAvailablePromise()\n      const dependencies = target.dependencies\n      await Promise.all(\n        dependencies.map((dependencyReference) => dependencyReference.target.getReadyPromise()),\n      )\n\n      const transform = assetTransformMap[targetUrl]\n      if (typeof transform !== \"function\") {\n        target.targetBufferAfterTransformation = target.targetBuffer\n        target.targetBuildRelativeUrl = computeBuildRelativeUrlForTarget(target)\n        return\n      }\n\n      // assetDependenciesMapping contains all dependencies for an asset\n      // each key is the absolute url to the dependency file\n      // each value is an url relative to the asset importing this dependency\n      // it looks like this:\n      // {\n      //   \"file:///project/coin.png\": \"./coin-45eiopri.png\"\n      // }\n      // we don't yet know the exact importerBuildRelativeUrl but we can generate a fake one\n      // to ensure we resolve dependency against where the importer file will be\n\n      const importerBuildRelativeUrl = precomputeBuildRelativeUrlForTarget(target)\n      const assetEmitters = []\n      const transformReturnValue = await transform({\n        precomputeBuildRelativeUrl: (targetBufferAfterTransformation) =>\n          precomputeBuildRelativeUrlForTarget(target, targetBufferAfterTransformation),\n        registerAssetEmitter: (callback) => {\n          assetEmitters.push(callback)\n        },\n        getReferenceUrlRelativeToImporter: (reference) => {\n          const referenceTarget = reference.target\n          const referenceTargetBuildRelativeUrl =\n            referenceTarget.targetFileName || referenceTarget.targetBuildRelativeUrl\n          const referenceTargetBuildUrl = resolveUrl(referenceTargetBuildRelativeUrl, \"file:///\")\n          const importerBuildUrl = resolveUrl(importerBuildRelativeUrl, \"file:///\")\n          return urlToRelativeUrl(referenceTargetBuildUrl, importerBuildUrl)\n        },\n      })\n      if (transformReturnValue === null || transformReturnValue === undefined) {\n        throw new Error(`transform must return an object {code, map}`)\n      }\n\n      let targetBufferAfterTransformation\n      let targetBuildRelativeUrl\n      if (typeof transformReturnValue === \"string\") {\n        targetBufferAfterTransformation = transformReturnValue\n      } else {\n        targetBufferAfterTransformation = transformReturnValue.targetBufferAfterTransformation\n        if (transformReturnValue.targetBuildRelativeUrl) {\n          targetBuildRelativeUrl = transformReturnValue.targetBuildRelativeUrl\n        }\n      }\n\n      target.targetBufferAfterTransformation = targetBufferAfterTransformation\n      if (targetBuildRelativeUrl === undefined) {\n        targetBuildRelativeUrl = computeBuildRelativeUrlForTarget(target)\n      }\n      target.targetBuildRelativeUrl = targetBuildRelativeUrl\n\n      assetEmitters.forEach((callback) => {\n        callback({\n          emitAsset,\n          buildDirectoryUrl,\n        })\n      })\n    })\n\n    const connect = memoize(async (connectFn) => {\n      const { rollupReferenceId } = await connectFn()\n      target.rollupReferenceId = rollupReferenceId\n    })\n\n    // the idea is to return the connect promise here\n    // because connect is memoized and called immediatly after target is created\n    const getRollupReferenceIdAvailablePromise = () => connect()\n\n    // meant to be used only when asset is modified\n    // after being emitted.\n    // (sourcemap and importmap)\n    const updateOnceReady = ({ targetBufferAfterTransformation, buildRelativeUrl }) => {\n      // the source after transform has changed\n      if (\n        targetBufferAfterTransformation !== undefined &&\n        targetBufferAfterTransformation !== target.targetBufferAfterTransformation\n      ) {\n        target.targetBufferAfterTransformation = targetBufferAfterTransformation\n        if (buildRelativeUrl === undefined) {\n          buildRelativeUrl = computeBuildRelativeUrlForTarget(target)\n        }\n      }\n\n      // the build relative url has changed\n      if (buildRelativeUrl !== undefined && buildRelativeUrl !== target.targetBuildRelativeUrl) {\n        buildRelativeUrlsToClean.push(target.buildRelativeUrl)\n        target.targetBuildRelativeUrl = buildRelativeUrl\n        if (!target.targetIsInline) {\n          emitAsset({\n            source: target.targetBufferAfterTransformation,\n            fileName: buildRelativeUrl,\n          })\n        }\n      }\n    }\n\n    Object.assign(target, {\n      connect,\n\n      getBufferAvailablePromise,\n      getDependenciesAvailablePromise,\n      getReadyPromise,\n      getRollupReferenceIdAvailablePromise,\n\n      updateOnceReady,\n    })\n\n    return target\n  }\n\n  const rollupChunkReadyCallbackMap = {}\n  const registerCallbackOnceRollupChunkIsReady = (url, callback) => {\n    rollupChunkReadyCallbackMap[url] = callback\n  }\n  const getRollupChunkReadyCallbackMap = () => rollupChunkReadyCallbackMap\n\n  const findAssetUrlByBuildRelativeUrl = (buildRelativeUrl) => {\n    const assetUrl = Object.keys(targetMap).find(\n      (url) => targetMap[url].targetBuildRelativeUrl === buildRelativeUrl,\n    )\n    return assetUrl\n  }\n\n  const shortenUrl = (url) => {\n    return urlIsInsideOf(url, projectDirectoryUrl)\n      ? urlToRelativeUrl(url, projectDirectoryUrl)\n      : url\n  }\n\n  const showReferenceSourceLocation = (reference) => {\n    const referenceUrl = reference.referenceUrl\n    const referenceSource = String(\n      referenceUrl in targetMap ? targetMap[referenceUrl].targetBuffer : loadUrl(referenceUrl),\n    )\n\n    let message = `${urlToFileUrl(referenceUrl)}`\n    if (typeof reference.line === \"number\") {\n      message += `:${reference.line}`\n      if (typeof reference.column === \"number\") {\n        message += `:${reference.column}`\n      }\n    }\n\n    if (referenceSource && typeof reference.referenceLine === \"number\") {\n      return `${message}\n\n${showSourceLocation(referenceSource, {\n  line: reference.referenceLine,\n  column: reference.referenceColumn,\n})}\n`\n    }\n\n    return `${message}`\n  }\n\n  return {\n    createReferenceForHTMLEntry,\n    createReferenceForJs,\n\n    getRollupChunkReadyCallbackMap,\n    getAllAssetEntryEmittedPromise,\n    getBuildRelativeUrlsToClean,\n    findAssetUrlByBuildRelativeUrl,\n\n    inspect: () => {\n      return {\n        targetMap,\n      }\n    },\n  }\n}\n\nexport const referenceToCodeForRollup = (reference) => {\n  const target = reference.target\n  if (target.targetIsInline) {\n    return getTargetAsBase64Url(target)\n  }\n\n  return `import.meta.ROLLUP_FILE_URL_${target.rollupReferenceId}`\n}\n\nconst removePotentialUrlHash = (url) => {\n  const urlObject = new URL(url)\n  urlObject.hash = \"\"\n  return String(urlObject)\n}\n",
    "import { resolveUrl } from \"@jsenv/util\"\nimport { require } from \"@jsenv/core/src/internal/require.js\"\nimport { referenceToCodeForRollup } from \"./asset-builder.js\"\n\nconst { asyncWalk } = require(\"estree-walker\")\nconst MagicString = require(\"magic-string\")\n\nexport const transformImportMetaUrlReferences = async ({\n  url,\n  // importerUrl,\n  code,\n  ast,\n  assetBuilder,\n  fetch,\n  markBuildRelativeUrlAsUsedByJs,\n}) => {\n  const magicString = new MagicString(code)\n\n  await asyncWalk(ast, {\n    enter: async (node) => {\n      if (!isNewUrlImportMetaUrl(node)) {\n        return\n      }\n      const relativeUrl = node.arguments[0].value\n\n      // hum on devrait le fetch pour obtenir l'url finale et le content-type\n      // par contre on y applique pas les import map\n      const targetUrl = resolveUrl(relativeUrl, url)\n      const response = await fetch(targetUrl, url)\n      const targetBuffer = Buffer.from(await response.arrayBuffer())\n\n      const reference = await assetBuilder.createReferenceForJs({\n        jsUrl: url,\n        ...(node.loc\n          ? {\n              jsLine: node.loc.start.line,\n              jsColumn: node.loc.start.column,\n            }\n          : {}),\n\n        targetSpecifier: response.url,\n        targetContentType: response.headers[\"content-type\"],\n        targetBuffer,\n      })\n      if (reference) {\n        magicString.overwrite(\n          node.arguments[0].start,\n          node.arguments[0].end,\n          referenceToCodeForRollup(reference),\n        )\n        markBuildRelativeUrlAsUsedByJs(reference.target.targetBuildRelativeUrl)\n      }\n    },\n  })\n\n  const codeOutput = magicString.toString()\n  const map = magicString.generateMap({ hires: true })\n\n  return {\n    code: codeOutput,\n    map,\n  }\n}\n\nconst isNewUrlImportMetaUrl = (node) => {\n  return (\n    node.type === \"NewExpression\" &&\n    node.callee.type === \"Identifier\" &&\n    node.callee.name === \"URL\" &&\n    node.arguments.length === 2 &&\n    node.arguments[0].type === \"Literal\" &&\n    typeof node.arguments[0].value === \"string\" &&\n    node.arguments[1].type === \"MemberExpression\" &&\n    node.arguments[1].object.type === \"MetaProperty\" &&\n    node.arguments[1].property.type === \"Identifier\" &&\n    node.arguments[1].property.name === \"url\"\n  )\n}\n",
    "/* eslint-disable import/max-dependencies */\nimport { extname } from \"path\"\nimport { normalizeImportMap, resolveImport } from \"@jsenv/import-map\"\nimport { loggerToLogLevel } from \"@jsenv/logger\"\nimport {\n  isFileSystemPath,\n  fileSystemPathToUrl,\n  resolveUrl,\n  urlToRelativeUrl,\n  resolveDirectoryUrl,\n  writeFile,\n  comparePathnames,\n  urlIsInsideOf,\n  urlToFileSystemPath,\n  urlToBasename,\n  normalizeStructuredMetaMap,\n  urlToMeta,\n} from \"@jsenv/util\"\n\nimport { fetchUrl } from \"@jsenv/core/src/internal/fetchUrl.js\"\nimport { validateResponseStatusIsOk } from \"@jsenv/core/src/internal/validateResponseStatusIsOk.js\"\nimport { transformJs } from \"@jsenv/core/src/internal/compiling/js-compilation-service/transformJs.js\"\nimport {\n  findFirstImportmapNode,\n  getHtmlNodeLocation,\n  getHtmlNodeAttributeByName,\n  getHtmlNodeTextNode,\n} from \"@jsenv/core/src/internal/compiling/compileHtml.js\"\nimport { setJavaScriptSourceMappingUrl } from \"@jsenv/core/src/internal/sourceMappingURLUtils.js\"\nimport { sortObjectByPathnames } from \"@jsenv/core/src/internal/building/sortObjectByPathnames.js\"\n\nimport { parseTarget } from \"./parseTarget.js\"\nimport { showSourceLocation } from \"./showSourceLocation.js\"\nimport { isBareSpecifierForNativeNodeModule } from \"./isBareSpecifierForNativeNodeModule.js\"\nimport { fetchSourcemap } from \"./fetchSourcemap.js\"\nimport { createAssetBuilder, referenceToCodeForRollup } from \"./asset-builder.js\"\nimport { computeBuildRelativeUrl } from \"./url-versioning.js\"\nimport { transformImportMetaUrlReferences } from \"./transformImportMetaUrlReferences.js\"\n\nimport { minifyJs } from \"./js/minifyJs.js\"\n\n// use a fake and predictable compile server origin\n// because rollup will check the dependencies url\n// when computing the file hash\n// https://github.com/rollup/rollup/blob/d6131378f9481a442aeaa6d4e608faf3303366dc/src/Chunk.ts#L483\n// this way file hash remains the same when file content does not change\nconst STATIC_COMPILE_SERVER_AUTHORITY = \"//jsenv.com\"\n\nexport const createJsenvRollupPlugin = async ({\n  cancellationToken,\n  logger,\n\n  entryPointMap,\n  projectDirectoryUrl,\n  importMapFileRelativeUrl,\n  importMetaEnvFileRelativeUrl,\n  compileDirectoryRelativeUrl,\n  compileServerOrigin,\n  importDefaultExtension,\n  externalImportSpecifiers,\n  externalImportUrlPatterns,\n  babelPluginMap,\n  node,\n  browser,\n\n  format,\n  urlVersioning,\n  useImportMapToImproveLongTermCaching,\n  systemJsUrl,\n  minify,\n  minifyJsOptions,\n  minifyCssOptions,\n  minifyHtmlOptions,\n  manifestFile,\n  writeOnFileSystem,\n\n  buildDirectoryUrl,\n}) => {\n  const urlImporterMap = {}\n  const urlResponseBodyMap = {}\n  const virtualModules = {}\n  const urlRedirectionMap = {}\n  const jsModulesInHtml = {}\n\n  const externalUrlPredicate = externalImportUrlPatternsToExternalUrlPredicate(\n    externalImportUrlPatterns,\n    projectDirectoryUrl,\n  )\n\n  // map fileName (build relative urls without hash) to build relative url\n  let buildManifest = {}\n  const fileNameToBuildRelativeUrl = (fileName) => {\n    if (fileName in buildManifest) {\n      return buildManifest[fileName]\n    }\n    return null\n  }\n  const buildRelativeUrlToFileName = (buildRelativeUrl) => {\n    const fileName = Object.keys(buildManifest).find(\n      (key) => buildManifest[key] === buildRelativeUrl,\n    )\n    return fileName\n  }\n  const addFileNameMapping = (fileName, buildRelativeUrl) => {\n    buildManifest[fileName] = buildRelativeUrl\n  }\n  const buildRelativeUrlsUsedInJs = []\n  const markBuildRelativeUrlAsUsedByJs = (buildRelativeUrl) => {\n    buildRelativeUrlsUsedInJs.push(buildRelativeUrl)\n  }\n  const createImportMapForFilesUsedInJs = () => {\n    const topLevelMappings = {}\n    buildRelativeUrlsUsedInJs.sort(comparePathnames).forEach((buildRelativeUrl) => {\n      const fileName = buildRelativeUrlToFileName(buildRelativeUrl)\n      if (fileName !== buildRelativeUrl) {\n        topLevelMappings[`./${fileName}`] = `./${buildRelativeUrl}`\n      }\n    })\n    return {\n      imports: topLevelMappings,\n    }\n  }\n\n  let buildMappings = {}\n  // an object where keys are build relative urls\n  // and values rollup chunk or asset\n  // we need this because we sometimes tell rollup\n  // that a file.fileName is something while it's not really this\n  // because of remapping\n  let rollupBuild\n\n  const compileServerOriginForRollup = String(\n    new URL(STATIC_COMPILE_SERVER_AUTHORITY, compileServerOrigin),\n  ).slice(0, -1)\n\n  const EMPTY_CHUNK_URL = resolveUrl(\"__empty__\", projectDirectoryUrl)\n\n  const compileDirectoryUrl = resolveDirectoryUrl(compileDirectoryRelativeUrl, projectDirectoryUrl)\n  const compileDirectoryRemoteUrl = resolveDirectoryUrl(\n    compileDirectoryRelativeUrl,\n    compileServerOrigin,\n  )\n\n  const nativeModulePredicate = (specifier) => {\n    if (node && isBareSpecifierForNativeNodeModule(specifier)) return true\n    // for now browser have no native module\n    // and we don't know how we will handle that\n    if (browser) return false\n    return false\n  }\n\n  const fetchImportmapFromParameter = async () => {\n    const importmapProjectUrl = resolveUrl(importMapFileRelativeUrl, projectDirectoryUrl)\n    const importMapFileCompiledUrl = resolveUrl(importMapFileRelativeUrl, compileDirectoryRemoteUrl)\n    const importMap = await fetchAndNormalizeImportmap(importMapFileCompiledUrl, { allow404: true })\n    if (importMap === null) {\n      logger.warn(\n        `WARNING: no importmap found following importMapRelativeUrl at ${importmapProjectUrl}`,\n      )\n      return {}\n    }\n    logger.debug(`use importmap found following importMapRelativeUrl at ${importmapProjectUrl}`)\n    return importMap\n  }\n\n  let assetBuilder\n  let emitFile = () => {}\n  let fetchImportmap = fetchImportmapFromParameter\n  let importMap\n\n  const emitAsset = ({ source, fileName }) => {\n    const buildRelativeUrl = fileName\n    if (useImportMapToImproveLongTermCaching || !urlVersioning) {\n      // sauf dans le cas ou cet asset est référence avec\n      // new URL(relativeUrl, import.meta.url)\n      // quoique le fix ce serais d'avoir cet asset dans les import maps\n      fileName = rollupFileNameWithoutHash(buildRelativeUrl)\n    } else {\n      fileName = buildRelativeUrl\n    }\n    addFileNameMapping(fileName, buildRelativeUrl)\n\n    return emitFile({\n      type: \"asset\",\n      source,\n      fileName,\n    })\n  }\n  const emitChunk = (chunk) =>\n    emitFile({\n      type: \"chunk\",\n      ...chunk,\n    })\n\n  const jsenvRollupPlugin = {\n    name: \"jsenv\",\n\n    async buildStart() {\n      logger.info(`\nstart building project\n--- project directory path ---\n${urlToFileSystemPath(projectDirectoryUrl)}\n--- build directory path ---\n${urlToFileSystemPath(buildDirectoryUrl)}\n--- entry point map ---\n${JSON.stringify(entryPointMap, null, \"  \")}`)\n\n      emitFile = (...args) => this.emitFile(...args)\n\n      // https://github.com/easesu/rollup-plugin-html-input/blob/master/index.js\n      // https://rollupjs.org/guide/en/#thisemitfileemittedfile-emittedchunk--emittedasset--string\n\n      const entryPointsPrepared = []\n      await Promise.all(\n        Object.keys(entryPointMap).map(async (key) => {\n          const entryProjectUrl = resolveUrl(key, projectDirectoryUrl)\n          const entryBuildUrl = resolveUrl(entryPointMap[key], buildDirectoryUrl)\n\n          const entryProjectRelativeUrl = urlToRelativeUrl(entryProjectUrl, projectDirectoryUrl)\n          const entryBuildRelativeUrl = urlToRelativeUrl(entryBuildUrl, buildDirectoryUrl)\n\n          const entryServerUrl = resolveUrl(entryProjectRelativeUrl, compileServerOrigin)\n          const entryCompiledUrl = resolveUrl(entryProjectRelativeUrl, compileDirectoryRemoteUrl)\n\n          const entryResponse = await fetchModule(entryServerUrl, `entryPointMap`)\n          const entryContentType = entryResponse.headers[\"content-type\"]\n\n          if (entryContentType === \"text/html\") {\n            const htmlSource = await entryResponse.text()\n            const importmapHtmlNode = findFirstImportmapNode(htmlSource)\n            if (importmapHtmlNode) {\n              if (fetchImportmap === fetchImportmapFromParameter) {\n                const srcAttribute = getHtmlNodeAttributeByName(importmapHtmlNode, \"src\")\n                if (srcAttribute) {\n                  logger.info(formatUseImportMap(importmapHtmlNode, entryProjectUrl, htmlSource))\n                  const importmapUrl = resolveUrl(srcAttribute.value, entryCompiledUrl)\n                  if (!urlIsInsideOf(importmapUrl, compileDirectoryRemoteUrl)) {\n                    logger.warn(\n                      formatImportmapOutsideCompileDirectory(\n                        importmapHtmlNode,\n                        entryProjectUrl,\n                        htmlSource,\n                        compileDirectoryUrl,\n                      ),\n                    )\n                  }\n                  fetchImportmap = () => fetchAndNormalizeImportmap(importmapUrl)\n                } else {\n                  const textNode = getHtmlNodeTextNode(importmapHtmlNode)\n                  if (textNode) {\n                    logger.info(formatUseImportMap(importmapHtmlNode, entryProjectUrl, htmlSource))\n                    fetchImportmap = () => {\n                      const importmapRaw = JSON.parse(textNode.value)\n                      const importmap = normalizeImportMap(importmapRaw, entryCompiledUrl)\n                      return importmap\n                    }\n                  }\n                }\n              } else {\n                logger.warn(formatIgnoreImportMap(importmapHtmlNode, entryProjectUrl, htmlSource))\n              }\n            }\n\n            entryPointsPrepared.push({\n              entryContentType,\n              entryProjectRelativeUrl,\n              entryBuildRelativeUrl,\n              entryBuffer: Buffer.from(htmlSource),\n            })\n          } else if (\n            entryContentType === \"application/javascript\" ||\n            entryContentType === \"text/javascript\"\n          ) {\n            entryPointsPrepared.push({\n              entryContentType: \"application/javascript\",\n              entryProjectRelativeUrl,\n              entryBuildRelativeUrl,\n            })\n          } else {\n            entryPointsPrepared.push({\n              entryContentType,\n              entryProjectRelativeUrl,\n              entryBuildRelativeUrl,\n              entryBuffer: Buffer.from(await entryResponse.arrayBuffer()),\n            })\n          }\n        }),\n      )\n      importMap = await fetchImportmap()\n\n      // rollup will yell at us telling we did not provide an input option\n      // if we provide only an html file without any script type module in it\n      // but this can be desired to produce a build with only assets (html, css, images)\n      // without any js\n      // we emit an empty chunk, discards rollup warning about it and we manually remove\n      // this chunk in buildProject hook\n      let atleastOneChunkEmitted = false\n      assetBuilder = createAssetBuilder(\n        {\n          parse: async (target, notifiers) => {\n            return parseTarget(target, notifiers, {\n              urlToOriginalProjectUrl,\n              format,\n              systemJsUrl,\n              useImportMapToImproveLongTermCaching,\n              createImportMapForFilesUsedInJs,\n              minify,\n              minifyHtmlOptions,\n              minifyCssOptions,\n              minifyJsOptions,\n            })\n          },\n          fetch: async (url, importer) => {\n            const moduleResponse = await fetchModule(url, importer)\n            return moduleResponse\n          },\n        },\n        {\n          logLevel: loggerToLogLevel(logger),\n          format,\n          projectDirectoryUrl: `${compileServerOrigin}`,\n          buildDirectoryRelativeUrl: urlToRelativeUrl(buildDirectoryUrl, projectDirectoryUrl),\n          urlToFileUrl: urlToProjectUrl,\n          loadUrl: (url) => urlResponseBodyMap[url],\n          resolveTargetUrl: ({\n            targetSpecifier,\n            targetIsJsModule,\n            importerUrl,\n            importerIsEntry,\n            importerIsJsModule,\n          }) => {\n            const isHtmlEntryPoint = importerIsEntry && !importerIsJsModule\n            const isHtmlEntryPointReferencingAJsModule = isHtmlEntryPoint && targetIsJsModule\n            // when html references a js we must wait for the compiled version of js\n            if (isHtmlEntryPointReferencingAJsModule) {\n              const htmlCompiledUrl = urlToCompiledUrl(importerUrl)\n              const jsModuleUrl = resolveUrl(targetSpecifier, htmlCompiledUrl)\n              return jsModuleUrl\n            }\n\n            const targetUrl = resolveUrl(targetSpecifier, importerUrl)\n            // ignore url outside project directory\n            // a better version would console.warn about file url outside projectDirectoryUrl\n            // and ignore them and console.info/debug about remote url (https, http, ...)\n            const projectUrl = urlToProjectUrl(targetUrl)\n            if (!projectUrl) {\n              return { external: true, url: targetUrl }\n            }\n            return targetUrl\n          },\n          emitAsset,\n          connectTarget: (target) => {\n            const { targetIsExternal } = target\n            if (targetIsExternal) {\n              return\n            }\n\n            const { targetIsJsModule } = target\n            if (targetIsJsModule) {\n              target.connect(async () => {\n                const { targetUrl, targetBuffer } = target\n\n                const id = targetUrl\n                if (typeof targetBuffer !== \"undefined\") {\n                  virtualModules[id] = String(targetBuffer)\n                }\n\n                logger.debug(`emit chunk for ${shortenUrl(targetUrl)}`)\n                atleastOneChunkEmitted = true\n                const name = urlToRelativeUrl(\n                  // get basename url\n                  resolveUrl(urlToBasename(targetUrl), targetUrl),\n                  // get importer url\n                  urlToCompiledUrl(target.targetReferences[0].referenceUrl),\n                )\n                jsModulesInHtml[urlToUrlForRollup(id)] = true\n                const rollupReferenceId = emitChunk({\n                  id,\n                  name,\n                  ...(target.previousJsReference\n                    ? {\n                        implicitlyLoadedAfterOneOf: [target.previousJsReference.referenceUrl],\n                      }\n                    : {}),\n                })\n\n                return { rollupReferenceId }\n              })\n              return\n            }\n\n            target.connect(async () => {\n              await target.getReadyPromise()\n              const {\n                targetUrl,\n                targetIsInline,\n                targetBufferAfterTransformation,\n                targetBuildRelativeUrl,\n              } = target\n\n              if (targetIsInline) {\n                return {}\n              }\n\n              logger.debug(`emit asset for ${shortenUrl(targetUrl)}`)\n              const fileName = targetBuildRelativeUrl\n              const rollupReferenceId = emitAsset({\n                source: targetBufferAfterTransformation,\n                fileName,\n              })\n              logger.debug(`${shortenUrl(targetUrl)} ready -> ${targetBuildRelativeUrl}`)\n              return { rollupReferenceId }\n            })\n          },\n        },\n      )\n\n      await Promise.all(\n        entryPointsPrepared.map(\n          async ({\n            entryContentType,\n            entryProjectRelativeUrl,\n            entryBuildRelativeUrl,\n            entryBuffer,\n          }) => {\n            if (entryContentType === \"text/html\") {\n              const entryUrl = resolveUrl(entryProjectRelativeUrl, compileServerOrigin)\n              await assetBuilder.createReferenceForHTMLEntry({\n                entryContentType,\n                entryUrl,\n                entryBuffer,\n                entryBuildRelativeUrl,\n              })\n            } else if (entryContentType === \"application/javascript\") {\n              atleastOneChunkEmitted = true\n              emitChunk({\n                id: ensureRelativeUrlNotation(entryProjectRelativeUrl),\n                name: entryBuildRelativeUrl,\n                // don't hash js entry points\n                fileName: entryBuildRelativeUrl,\n              })\n            } else {\n              const entryUrl = resolveUrl(entryProjectRelativeUrl, compileServerOrigin)\n              await assetBuilder.createReferenceForHTMLEntry({\n                entryContentType,\n                entryUrl,\n                entryBuffer,\n                entryBuildRelativeUrl,\n              })\n            }\n          },\n        ),\n      )\n      if (!atleastOneChunkEmitted) {\n        emitChunk({\n          id: EMPTY_CHUNK_URL,\n          fileName: \"__empty__\",\n        })\n      }\n    },\n\n    resolveId(specifier, importer) {\n      if (importer === undefined) {\n        if (specifier.endsWith(\".html\")) {\n          importer = compileServerOrigin\n        } else {\n          importer = compileDirectoryRemoteUrl\n        }\n      } else {\n        importer = urlToServerUrl(importer)\n      }\n\n      if (nativeModulePredicate(specifier)) {\n        logger.debug(`${specifier} is native module -> marked as external`)\n        return false\n      }\n\n      if (externalImportSpecifiers.includes(specifier)) {\n        logger.debug(`${specifier} verifies externalImportSpecifiers -> marked as external`)\n        return { id: specifier, external: true }\n      }\n\n      if (virtualModules.hasOwnProperty(specifier)) {\n        return specifier\n      }\n\n      if (isFileSystemPath(importer)) {\n        importer = fileSystemPathToUrl(importer)\n      }\n      const importUrl = resolveImport({\n        specifier,\n        importer,\n        importMap,\n        defaultExtension: importDefaultExtension,\n      })\n\n      if (importer !== projectDirectoryUrl) {\n        urlImporterMap[importUrl] = importer\n      }\n\n      // keep external url intact\n      const importProjectUrl = urlToProjectUrl(importUrl)\n      if (!importProjectUrl) {\n        return { id: specifier, external: true }\n      }\n\n      if (externalUrlPredicate(urlToOriginalProjectUrl(importProjectUrl))) {\n        return { id: specifier, external: true }\n      }\n\n      // const rollupId = urlToRollupId(importUrl, { projectDirectoryUrl, compileServerOrigin })\n      logger.debug(`${specifier} imported by ${importer} resolved to ${importUrl}`)\n      return urlToUrlForRollup(importUrl)\n    },\n\n    ...(format === \"systemjs\"\n      ? {\n          resolveFileUrl: ({ fileName }) => {\n            return `System.resolve(\"./${fileName}\", module.meta.url)`\n          },\n        }\n      : {}),\n\n    // https://rollupjs.org/guide/en#resolvedynamicimport\n    // resolveDynamicImport: (specifier, importer) => {\n\n    // },\n\n    async load(id) {\n      if (id === EMPTY_CHUNK_URL) {\n        return \"\"\n      }\n\n      const moduleInfo = this.getModuleInfo(id)\n      const url = urlToServerUrl(id)\n\n      logger.debug(`loads ${url}`)\n      const { responseUrl, contentRaw, content = \"\", map } = await loadModule(url, {\n        moduleInfo,\n      })\n\n      saveUrlResponseBody(responseUrl, contentRaw)\n      // handle redirection\n      if (responseUrl !== url) {\n        saveUrlResponseBody(url, contentRaw)\n        urlRedirectionMap[url] = responseUrl\n      }\n\n      return { code: content, map }\n    },\n\n    async transform(code, id) {\n      const ast = this.parse(code, {\n        // used to know node line and column\n        locations: true,\n      })\n      // const moduleInfo = this.getModuleInfo(id)\n      const url = urlToServerUrl(id)\n      const importerUrl = urlImporterMap[url]\n      return transformImportMetaUrlReferences({\n        url,\n        importerUrl,\n        code,\n        ast,\n        assetBuilder,\n        fetch: fetchModule,\n        markBuildRelativeUrlAsUsedByJs,\n      })\n    },\n\n    // resolveImportMeta: () => {}\n\n    // transform should not be required anymore as\n    // we will receive\n    // transform: async (moduleContent, rollupId) => {}\n\n    outputOptions: (outputOptions) => {\n      const extension = extname(entryPointMap[Object.keys(entryPointMap)[0]])\n      const outputExtension = extension === \".html\" ? \".js\" : extension\n\n      outputOptions.entryFileNames = `[name]${outputExtension}`\n      outputOptions.chunkFileNames =\n        useImportMapToImproveLongTermCaching || !urlVersioning\n          ? `[name]${outputExtension}`\n          : `[name]-[hash]${outputExtension}`\n\n      // rollup does not expects to have http dependency in the mix: fix them\n      outputOptions.sourcemapPathTransform = (relativePath, sourcemapPath) => {\n        const sourcemapUrl = fileSystemPathToUrl(sourcemapPath)\n        const url = relativePathToUrl(relativePath, sourcemapUrl)\n        const serverUrl = urlToServerUrl(url)\n        const finalUrl = serverUrl in urlRedirectionMap ? urlRedirectionMap[serverUrl] : serverUrl\n        const projectUrl = urlToProjectUrl(finalUrl)\n\n        if (projectUrl) {\n          relativePath = urlToRelativeUrl(projectUrl, sourcemapUrl)\n          return relativePath\n        }\n\n        return finalUrl\n      }\n\n      const relativePathToUrl = (relativePath, sourcemapUrl) => {\n        const rollupUrl = resolveUrl(relativePath, sourcemapUrl)\n        // here relativePath contains a protocol\n        // because rollup don't work with url but with filesystem paths\n        // let fix it below\n        const url = fixRollupUrl(rollupUrl)\n        return url\n      }\n\n      return outputOptions\n    },\n\n    renderChunk: async (code, chunk) => {\n      let map = chunk.map\n\n      if (!minify) {\n        return null\n      }\n\n      const result = await minifyJs(code, chunk.fileName, {\n        sourceMap: {\n          ...(map ? { content: JSON.stringify(map) } : {}),\n          asObject: true,\n        },\n        ...(format === \"global\" ? { toplevel: false } : { toplevel: true }),\n        ...minifyJsOptions,\n      })\n      code = result.code\n      map = result.map\n      return {\n        code,\n        map,\n      }\n    },\n\n    async generateBundle(outputOptions, rollupResult) {\n      const jsBuild = {}\n      Object.keys(rollupResult).forEach((fileName) => {\n        const file = rollupResult[fileName]\n        if (file.type === \"chunk\" && file.facadeModuleId === EMPTY_CHUNK_URL) {\n          return\n        }\n\n        if (file.type === \"chunk\") {\n          let buildRelativeUrl\n          const canBeHashed = file.facadeModuleId in jsModulesInHtml || !file.isEntry\n          if (urlVersioning && useImportMapToImproveLongTermCaching) {\n            if (canBeHashed) {\n              buildRelativeUrl = computeBuildRelativeUrl(\n                resolveUrl(fileName, buildDirectoryUrl),\n                file.code,\n                `[name]-[hash][extname]`,\n              )\n            } else {\n              buildRelativeUrl = fileName\n            }\n          } else {\n            buildRelativeUrl = fileName\n            fileName = rollupFileNameWithoutHash(fileName)\n          }\n\n          if (canBeHashed) {\n            markBuildRelativeUrlAsUsedByJs(buildRelativeUrl)\n          }\n          addFileNameMapping(fileName, buildRelativeUrl)\n          jsBuild[buildRelativeUrl] = file\n        }\n      })\n\n      // it's important to do this to emit late asset\n      emitFile = (...args) => this.emitFile(...args)\n\n      // malheureusement rollup ne permet pas de savoir lorsqu'un chunk\n      // a fini d'etre résolu (parsing des imports statiques et dynamiques recursivement)\n      // donc lorsque le build se termine on va indiquer\n      // aux assets faisant référence a ces chunk js qu'ils sont terminés\n      // et donc les assets peuvent connaitre le nom du chunk\n      // et mettre a jour leur dépendance vers ce fichier js\n      const rollupChunkReadyCallbackMap = assetBuilder.getRollupChunkReadyCallbackMap()\n      Object.keys(rollupChunkReadyCallbackMap).forEach((key) => {\n        const targetBuildRelativeUrl = Object.keys(jsBuild).find((buildRelativeUrlCandidate) => {\n          const file = jsBuild[buildRelativeUrlCandidate]\n          const { facadeModuleId } = file\n          return facadeModuleId && urlToServerUrl(facadeModuleId) === key\n        })\n        const file = jsBuild[targetBuildRelativeUrl]\n        const targetBufferAfterTransformation = file.code\n        const targetFileName =\n          useImportMapToImproveLongTermCaching || !urlVersioning\n            ? buildRelativeUrlToFileName(targetBuildRelativeUrl)\n            : targetBuildRelativeUrl\n\n        logger.debug(`resolve rollup chunk ${shortenUrl(key)}`)\n        rollupChunkReadyCallbackMap[key]({\n          targetBufferAfterTransformation,\n          targetBuildRelativeUrl,\n          targetFileName,\n        })\n      })\n      // wait html files to be emitted\n      await assetBuilder.getAllAssetEntryEmittedPromise()\n\n      const assetBuild = {}\n      const buildRelativeUrlsToClean = assetBuilder.getBuildRelativeUrlsToClean()\n      Object.keys(rollupResult).forEach((fileName) => {\n        const file = rollupResult[fileName]\n        if (file.type !== \"asset\") {\n          return\n        }\n\n        const buildRelativeUrl = fileNameToBuildRelativeUrl(fileName)\n        // ignore potential useless assets which happens when:\n        // - sourcemap re-emitted\n        // - importmap re-emitted to have buildRelativeUrlMap\n        if (buildRelativeUrlsToClean.includes(buildRelativeUrl)) {\n          return\n        }\n\n        assetBuild[buildRelativeUrl] = file\n      })\n\n      rollupBuild = {\n        ...jsBuild,\n        ...assetBuild,\n      }\n\n      Object.keys(rollupBuild).forEach((buildRelativeUrl) => {\n        const file = rollupBuild[buildRelativeUrl]\n\n        if (file.type === \"chunk\") {\n          const id = file.facadeModuleId\n          if (id) {\n            const originalProjectUrl = urlToOriginalProjectUrl(id)\n            const originalProjectRelativeUrl = urlToRelativeUrl(\n              originalProjectUrl,\n              projectDirectoryUrl,\n            )\n            buildMappings[originalProjectRelativeUrl] = buildRelativeUrl\n          } else {\n            const sourcePath = file.map.sources[file.map.sources.length - 1]\n            const fileBuildUrl = resolveUrl(file.fileName, buildDirectoryUrl)\n            const originalProjectUrl = resolveUrl(sourcePath, fileBuildUrl)\n            const originalProjectRelativeUrl = urlToRelativeUrl(\n              originalProjectUrl,\n              projectDirectoryUrl,\n            )\n            buildMappings[originalProjectRelativeUrl] = buildRelativeUrl\n          }\n        } else {\n          const assetUrl = assetBuilder.findAssetUrlByBuildRelativeUrl(buildRelativeUrl)\n          if (assetUrl) {\n            const originalProjectUrl = urlToOriginalProjectUrl(assetUrl)\n            const originalProjectRelativeUrl = urlToRelativeUrl(\n              originalProjectUrl,\n              projectDirectoryUrl,\n            )\n            buildMappings[originalProjectRelativeUrl] = buildRelativeUrl\n          } else {\n            // the asset does not exists in the project it was generated during building\n            // ici il est possible de trouver un asset ayant été redirigé ailleurs (sourcemap)\n          }\n        }\n      })\n\n      rollupBuild = sortObjectByPathnames(rollupBuild)\n      buildManifest = sortObjectByPathnames(buildManifest)\n      buildMappings = sortObjectByPathnames(buildMappings)\n\n      if (manifestFile) {\n        const manifestFileUrl = resolveUrl(\"manifest.json\", buildDirectoryUrl)\n        await writeFile(manifestFileUrl, JSON.stringify(buildManifest, null, \"  \"))\n      }\n\n      logger.info(createDetailedMessage(`build done`, formatBuildDoneDetails(rollupBuild)))\n\n      if (writeOnFileSystem) {\n        await Promise.all(\n          Object.keys(rollupBuild).map(async (buildRelativeUrl) => {\n            const file = rollupBuild[buildRelativeUrl]\n            const fileBuildUrl = resolveUrl(buildRelativeUrl, buildDirectoryUrl)\n\n            if (file.type === \"chunk\") {\n              let fileCode = file.code\n              if (file.map) {\n                const sourcemapBuildRelativeUrl = `${buildRelativeUrl}.map`\n                if (sourcemapBuildRelativeUrl in rollupBuild === false) {\n                  const sourcemapBuildUrl = resolveUrl(sourcemapBuildRelativeUrl, buildDirectoryUrl)\n                  const fileSourcemapString = JSON.stringify(file.map, null, \"  \")\n                  await writeFile(sourcemapBuildUrl, fileSourcemapString)\n\n                  const sourcemapBuildUrlRelativeToFileBuildUrl = urlToRelativeUrl(\n                    sourcemapBuildUrl,\n                    fileBuildUrl,\n                  )\n                  fileCode = setJavaScriptSourceMappingUrl(\n                    fileCode,\n                    sourcemapBuildUrlRelativeToFileBuildUrl,\n                  )\n                }\n              }\n              await writeFile(fileBuildUrl, fileCode)\n            } else {\n              await writeFile(fileBuildUrl, file.source)\n            }\n          }),\n        )\n      }\n    },\n  }\n\n  const saveUrlResponseBody = (url, responseBody) => {\n    urlResponseBodyMap[url] = responseBody\n    const projectUrl = urlToProjectUrl(url)\n    if (projectUrl && projectUrl !== url) {\n      urlResponseBodyMap[projectUrl] = responseBody\n    }\n  }\n\n  // take any url string and try to return a file url (an url inside projectDirectoryUrl)\n  const urlToProjectUrl = (url) => {\n    if (url.startsWith(projectDirectoryUrl)) {\n      return url\n    }\n\n    const serverUrl = urlToServerUrl(url)\n    if (serverUrl) {\n      return `${projectDirectoryUrl}${serverUrl.slice(`${compileServerOrigin}/`.length)}`\n    }\n\n    return null\n  }\n\n  const urlToUrlForRollup = (url) => {\n    if (url.startsWith(`${compileServerOrigin}/`)) {\n      return `${compileServerOriginForRollup}/${url.slice(`${compileServerOrigin}/`.length)}`\n    }\n    return url\n  }\n\n  const urlToProjectRelativeUrl = (url) => {\n    const projectUrl = urlToProjectUrl(url)\n    if (!projectUrl) {\n      return null\n    }\n    return urlToRelativeUrl(projectUrl, projectDirectoryUrl)\n  }\n\n  // take any url string and try to return the corresponding remote url (an url inside compileServerOrigin)\n  const urlToServerUrl = (url) => {\n    if (url.startsWith(`${compileServerOrigin}/`)) {\n      return url\n    }\n\n    if (url.startsWith(`${compileServerOriginForRollup}/`)) {\n      return `${compileServerOrigin}/${url.slice(`${compileServerOriginForRollup}/`.length)}`\n    }\n\n    if (url.startsWith(projectDirectoryUrl)) {\n      return `${compileServerOrigin}/${url.slice(projectDirectoryUrl.length)}`\n    }\n\n    return null\n  }\n\n  // const urlToOriginalServerUrl = (url) => {\n  //   const serverUrl = urlToServerUrl(url)\n  //   if (!serverUrl) {\n  //     return null\n  //   }\n\n  //   if (!urlIsInsideOf(serverUrl, compileDirectoryRemoteUrl)) {\n  //     return serverUrl\n  //   }\n\n  //   const relativeUrl = urlToRelativeUrl(serverUrl, compileDirectoryRemoteUrl)\n  //   return resolveUrl(relativeUrl, compileServerOrigin)\n  // }\n\n  // take any url string and try to return a file url inside project directory url\n  // prefer the source url if the url is inside compile directory\n  const urlToOriginalProjectUrl = (url) => {\n    const projectUrl = urlToProjectUrl(url)\n    if (!projectUrl) {\n      return null\n    }\n\n    if (!urlIsInsideOf(projectUrl, compileDirectoryUrl)) {\n      return projectUrl\n    }\n\n    const relativeUrl = urlToRelativeUrl(projectUrl, compileDirectoryUrl)\n    return resolveUrl(relativeUrl, projectDirectoryUrl)\n  }\n\n  const urlToCompiledUrl = (url) => {\n    const projectUrl = urlToProjectUrl(url)\n    if (!projectUrl) {\n      return null\n    }\n\n    if (urlIsInsideOf(projectUrl, compileDirectoryUrl)) {\n      return projectUrl\n    }\n\n    const projectRelativeUrl = urlToProjectRelativeUrl(projectUrl)\n    if (projectRelativeUrl) {\n      return resolveUrl(projectRelativeUrl, compileDirectoryRemoteUrl)\n    }\n\n    return null\n  }\n\n  const loadModule = async (\n    moduleUrl,\n    // {\n    //   moduleInfo\n    // },\n  ) => {\n    if (moduleUrl in virtualModules) {\n      const codeInput = virtualModules[moduleUrl]\n\n      const { code, map } = await transformJs({\n        projectDirectoryUrl,\n        importMetaEnvFileRelativeUrl,\n        code: codeInput,\n        url: urlToProjectUrl(moduleUrl), // transformJs expect a file:// url\n        babelPluginMap,\n      })\n\n      return {\n        responseUrl: moduleUrl,\n        contentRaw: code,\n        content: code,\n        map,\n      }\n    }\n\n    const importerUrl = urlImporterMap[moduleUrl]\n    const moduleResponse = await fetchModule(\n      moduleUrl,\n      urlToFileSystemPath(urlToProjectUrl(importerUrl) || importerUrl),\n    )\n    const contentType = moduleResponse.headers[\"content-type\"] || \"\"\n    const commonData = {\n      responseUrl: moduleResponse.url,\n    }\n\n    // keep this in sync with module-registration.js\n    if (contentType === \"application/javascript\" || contentType === \"text/javascript\") {\n      const jsModuleString = await moduleResponse.text()\n      const map = await fetchSourcemap(moduleUrl, jsModuleString, {\n        cancellationToken,\n        logger,\n      })\n\n      return {\n        ...commonData,\n        contentRaw: jsModuleString,\n        content: jsModuleString,\n        map,\n      }\n    }\n\n    if (contentType === \"application/json\" || contentType.endsWith(\"+json\")) {\n      const responseBodyAsString = await moduleResponse.text()\n      // there is no need to minify the json string\n      // because it becomes valid javascript\n      // that will be minified by minifyJs inside renderChunk\n      const json = responseBodyAsString\n      return {\n        ...commonData,\n        contentRaw: json,\n        content: `export default ${json}`,\n      }\n    }\n\n    const moduleResponseBodyAsBuffer = Buffer.from(await moduleResponse.arrayBuffer())\n    const targetContentType = moduleResponse.headers[\"content-type\"]\n    const assetReferenceForImport = await assetBuilder.createReferenceForJs({\n      // Reference to this target is corresponds to a static or dynamic import.\n      // found in a given file (importerUrl).\n      // But we don't know the line and colum because rollup\n      // does not tell us that information\n      jsUrl: importerUrl,\n      jsLine: undefined,\n      jsColumn: undefined,\n\n      targetSpecifier: moduleResponse.url,\n      targetContentType,\n      targetBuffer: moduleResponseBodyAsBuffer,\n    })\n    if (assetReferenceForImport) {\n      markBuildRelativeUrlAsUsedByJs(assetReferenceForImport.target.targetBuildRelativeUrl)\n      const content = `export default ${referenceToCodeForRollup(assetReferenceForImport)}`\n\n      return {\n        ...commonData,\n        contentRaw: String(moduleResponseBodyAsBuffer),\n        content,\n      }\n    }\n\n    return {\n      ...commonData,\n      contentRaw: String(moduleResponseBodyAsBuffer),\n      content: String(moduleResponseBodyAsBuffer),\n    }\n  }\n\n  const fetchModule = async (moduleUrl, importer) => {\n    const response = await fetchUrl(moduleUrl, {\n      cancellationToken,\n      ignoreHttpsError: true,\n    })\n    if (response.status === 404) {\n      throw new Error(formatFileNotFound(urlToProjectUrl(response.url), importer))\n    }\n\n    const okValidation = validateResponseStatusIsOk(response, importer)\n\n    if (!okValidation.valid) {\n      throw new Error(okValidation.message)\n    }\n\n    return response\n  }\n\n  const shortenUrl = (url) => {\n    return urlIsInsideOf(url, projectDirectoryUrl)\n      ? urlToRelativeUrl(url, projectDirectoryUrl)\n      : url\n  }\n\n  return {\n    jsenvRollupPlugin,\n    getResult: () => {\n      return {\n        rollupBuild,\n        urlResponseBodyMap,\n        buildMappings,\n        buildManifest,\n        buildImportMap: createImportMapForFilesUsedInJs(),\n      }\n    },\n  }\n}\n\nconst fixRollupUrl = (rollupUrl) => {\n  // fix rollup not supporting source being http\n  const httpIndex = rollupUrl.indexOf(`http:/`, 1)\n  if (httpIndex > -1) {\n    return `http://${rollupUrl.slice(httpIndex + `http:/`.length)}`\n  }\n\n  const httpsIndex = rollupUrl.indexOf(\"https:/\", 1)\n  if (httpsIndex > -1) {\n    return `https://${rollupUrl.slice(httpsIndex + `https:/`.length)}`\n  }\n\n  const fileIndex = rollupUrl.indexOf(\"file:\", 1)\n  if (fileIndex > -1) {\n    return `file://${rollupUrl.slice(fileIndex + `file:`.length)}`\n  }\n\n  return rollupUrl\n}\n\nconst formatFileNotFound = (url, importer) => {\n  return `A file cannot be found.\n--- file ---\n${urlToFileSystemPath(url)}\n--- imported by ---\n${importer}`\n}\n\nconst showImportmapSourceLocation = (importmapHtmlNode, htmlUrl, htmlSource) => {\n  const { line, column } = getHtmlNodeLocation(importmapHtmlNode)\n\n  return `${htmlUrl}:${line}:${column}\n\n${showSourceLocation(htmlSource, {\n  line,\n  column,\n})}\n`\n}\n\nconst formatIgnoreImportMap = (importmapHtmlNode, htmlUrl, htmlSource) => {\n  return `ignore importmap found in html file.\n${showImportmapSourceLocation(importmapHtmlNode, htmlUrl, htmlSource)}`\n}\n\nconst formatUseImportMap = (importmapHtmlNode, htmlUrl, htmlSource) => {\n  return `use importmap found in html file.\n${showImportmapSourceLocation(importmapHtmlNode, htmlUrl, htmlSource)}`\n}\n\nconst formatImportmapOutsideCompileDirectory = (\n  importmapHtmlNode,\n  htmlUrl,\n  htmlSource,\n  compileDirectoryUrl,\n) => {\n  return `WARNING: found importmap outside compile directory.\nRemapped import will not be compiled.\nYou should make importmap source relative.\n${showImportmapSourceLocation(importmapHtmlNode, htmlUrl, htmlSource)}\n--- compile directory url ---\n${compileDirectoryUrl}`\n}\n\nconst fetchAndNormalizeImportmap = async (importmapUrl, { allow404 = false } = {}) => {\n  const importmapResponse = await fetchUrl(importmapUrl)\n  if (allow404 && importmapResponse.status === 404) {\n    return null\n  }\n  const importmap = await importmapResponse.json()\n  const importmapNormalized = normalizeImportMap(importmap, importmapUrl)\n  return importmapNormalized\n}\n\nconst formatBuildDoneDetails = (build) => {\n  const assetFilenames = Object.keys(build)\n    .filter((key) => build[key].type === \"asset\")\n    .map((key) => build[key].fileName)\n  const assetCount = assetFilenames.length\n\n  const chunkFilenames = Object.keys(build)\n    .filter((key) => build[key].type === \"chunk\")\n    .map((key) => build[key].fileName)\n  const chunkCount = chunkFilenames.length\n\n  const assetDescription =\n    // eslint-disable-next-line no-nested-ternary\n    assetCount === 0 ? \"\" : assetCount === 1 ? \"1 asset\" : `${assetCount} assets`\n  const chunkDescription =\n    // eslint-disable-next-line no-nested-ternary\n    chunkCount === 0 ? \"\" : chunkCount === 1 ? \"1 chunk\" : `${chunkCount} chunks`\n\n  return {\n    ...(assetDescription ? { [assetDescription]: assetFilenames } : {}),\n    ...(chunkDescription ? { [chunkDescription]: chunkFilenames } : {}),\n  }\n}\n\nconst rollupFileNameWithoutHash = (fileName) => {\n  return fileName.replace(/-[a-z0-9]{8,}(\\..*?)?$/, (_, afterHash = \"\") => {\n    return afterHash\n  })\n}\n\nconst createDetailedMessage = (message, details = {}) => {\n  let string = `${message}`\n\n  Object.keys(details).forEach((key) => {\n    const value = details[key]\n    string += `\n--- ${key} ---\n${\n  Array.isArray(value)\n    ? value.join(`\n`)\n    : value\n}`\n  })\n\n  return string\n}\n\n// otherwise importmap handle it as a bare import\nconst ensureRelativeUrlNotation = (relativeUrl) => {\n  if (relativeUrl.startsWith(\"../\")) {\n    return relativeUrl\n  }\n  return `./${relativeUrl}`\n}\n\nconst externalImportUrlPatternsToExternalUrlPredicate = (\n  externalImportUrlPatterns,\n  projectDirectoryUrl,\n) => {\n  const externalImportUrlStructuredMetaMap = normalizeStructuredMetaMap(\n    {\n      external: {\n        ...externalImportUrlPatterns,\n        \"node_modules/@jsenv/core/src/internal/import-meta/\": false,\n        \"node_modules/@jsenv/core/helpers/\": false,\n      },\n    },\n    projectDirectoryUrl,\n  )\n  return (url) => {\n    const meta = urlToMeta({\n      url,\n      structuredMetaMap: externalImportUrlStructuredMetaMap,\n    })\n    return Boolean(meta.external)\n  }\n}\n",
    "import { createOperation } from \"@jsenv/cancellation\"\nimport { urlToFileSystemPath, ensureEmptyDirectory } from \"@jsenv/util\"\nimport { buildServiceWorker } from \"@jsenv/core/src/internal/building/buildServiceWorker.js\"\nimport { require } from \"../require.js\"\nimport { createJsenvRollupPlugin } from \"./createJsenvRollupPlugin.js\"\n\nexport const buildUsingRollup = async ({\n  cancellationToken,\n  logger,\n\n  entryPointMap,\n  projectDirectoryUrl,\n  importMapFileRelativeUrl,\n  compileDirectoryRelativeUrl,\n  compileServerOrigin,\n  importDefaultExtension,\n  externalImportSpecifiers,\n  externalImportUrlPatterns,\n  babelPluginMap,\n  node,\n  browser,\n\n  format,\n  systemJsUrl,\n  globals,\n  globalName,\n  sourcemapExcludeSources,\n\n  buildDirectoryUrl,\n  buildDirectoryClean,\n\n  urlVersioning,\n  useImportMapToImproveLongTermCaching,\n  preserveEntrySignatures,\n  jsConcatenation,\n  minify,\n  minifyJsOptions,\n  minifyCssOptions,\n  minifyHtmlOptions,\n  manifestFile = false,\n\n  serviceWorkers,\n  serviceWorkerFinalizer,\n\n  writeOnFileSystem,\n}) => {\n  const { jsenvRollupPlugin, getResult } = await createJsenvRollupPlugin({\n    cancellationToken,\n    logger,\n\n    entryPointMap,\n    projectDirectoryUrl,\n    importMapFileRelativeUrl,\n    compileDirectoryRelativeUrl,\n    compileServerOrigin,\n    importDefaultExtension,\n    externalImportSpecifiers,\n    externalImportUrlPatterns,\n    babelPluginMap,\n    node,\n    browser,\n\n    format,\n    systemJsUrl,\n    buildDirectoryUrl,\n\n    urlVersioning,\n    useImportMapToImproveLongTermCaching,\n    minify,\n    minifyJsOptions,\n    minifyCssOptions,\n    minifyHtmlOptions,\n\n    manifestFile,\n    writeOnFileSystem,\n  })\n\n  await useRollup({\n    cancellationToken,\n    jsenvRollupPlugin,\n\n    format,\n    globals,\n    globalName,\n    sourcemapExcludeSources,\n    preserveEntrySignatures,\n    jsConcatenation,\n    buildDirectoryUrl,\n    buildDirectoryClean,\n  })\n\n  const jsenvBuild = getResult()\n\n  if (writeOnFileSystem) {\n    await Promise.all(\n      Object.keys(serviceWorkers).map(async (serviceWorkerProjectRelativeUrl) => {\n        const serviceWorkerBuildRelativeUrl = serviceWorkers[serviceWorkerProjectRelativeUrl]\n        await buildServiceWorker({\n          projectDirectoryUrl,\n          buildDirectoryUrl,\n          serviceWorkerProjectRelativeUrl,\n          serviceWorkerBuildRelativeUrl,\n          serviceWorkerTransformer: (code) => serviceWorkerFinalizer(code, jsenvBuild),\n\n          minify,\n        })\n      }),\n    )\n  }\n\n  return jsenvBuild\n}\n\nconst useRollup = async ({\n  cancellationToken,\n  jsenvRollupPlugin,\n  format,\n  globals,\n  globalName,\n  sourcemapExcludeSources,\n  preserveEntrySignatures,\n  // jsConcatenation,\n  buildDirectoryUrl,\n  buildDirectoryClean,\n}) => {\n  const { rollup } = require(\"rollup\")\n\n  const rollupInputOptions = {\n    // about cache here, we should/could reuse previous rollup call\n    // to get the cache from the entryPointMap\n    // as shown here: https://rollupjs.org/guide/en#cache\n    // it could be passed in arguments to this function\n    // however parallelism and having different rollup options per\n    // call make it a bit complex\n    // cache: null\n    // https://rollupjs.org/guide/en#experimentaltoplevelawait\n    //  experimentalTopLevelAwait: true,\n    // if we want to ignore some warning\n    // please use https://rollupjs.org/guide/en#onwarn\n    // to be very clear about what we want to ignore\n    onwarn: (warning, warn) => {\n      if (warning.code === \"THIS_IS_UNDEFINED\") return\n      if (warning.code === \"EMPTY_BUNDLE\" && warning.chunkName === \"__empty__\") return\n      // ignore file name conflict when sourcemap or importmap are re-emitted\n      if (\n        warning.code === \"FILE_NAME_CONFLICT\" &&\n        (warning.message.includes(\".map\") || warning.message.includes(\".importmap\"))\n      ) {\n        return\n      }\n      warn(warning)\n    },\n    // on passe input: [] car c'est le plusign jsenv qui se chargera d'emit des chunks\n    // en fonction de entryPointMap\n    // on fait cela car sinon rollup est pénible si on passe un entry point map de type html\n    input: [],\n    preserveEntrySignatures,\n    plugins: [jsenvRollupPlugin],\n  }\n  const rollupOutputOptions = {\n    // https://rollupjs.org/guide/en#experimentaltoplevelawait\n    // experimentalTopLevelAwait: true,\n    // we could put prefConst to true by checking 'transform-block-scoping'\n    // presence in babelPluginMap\n    preferConst: false,\n    // https://rollupjs.org/guide/en#output-dir\n    dir: urlToFileSystemPath(buildDirectoryUrl),\n    // https://rollupjs.org/guide/en#output-format\n    format: formatToRollupFormat(format),\n    // https://rollupjs.org/guide/en#output-sourcemap\n    sourcemap: true,\n    sourcemapExcludeSources,\n    // preserveModules: !jsConcatenation,\n    ...(format === \"global\"\n      ? {\n          globals,\n          name: globalName,\n        }\n      : {}),\n  }\n\n  const rollupReturnValue = await createOperation({\n    cancellationToken,\n    start: () => rollup(rollupInputOptions),\n  })\n\n  if (buildDirectoryClean) {\n    await ensureEmptyDirectory(buildDirectoryUrl)\n  }\n\n  const rollupOutputArray = await createOperation({\n    cancellationToken,\n    start: () => rollupReturnValue.generate(rollupOutputOptions),\n  })\n\n  return rollupOutputArray\n}\n\nconst formatToRollupFormat = (format) => {\n  if (format === \"global\") return \"iife\"\n  if (format === \"commonjs\") return \"cjs\"\n  if (format === \"systemjs\") return \"system\"\n  if (format === \"esmodule\") return \"esm\"\n  throw new Error(`unexpected format, got ${format}`)\n}\n",
    "/*\n\nOne thing to keep in mind:\nthe sourcemap.sourcesContent will contains a json file transformed to js\nwhile urlResponseBodyMap will contain the json file raw source because the corresponding\njson file etag is used to invalidate the cache\n\n*/\n\nimport { readFileSync } from \"fs\"\nimport { urlToRelativeUrl, urlToFileSystemPath, resolveUrl } from \"@jsenv/util\"\nimport { setJavaScriptSourceMappingUrl } from \"../sourceMappingURLUtils.js\"\n\nexport const buildToCompilationResult = (\n  { rollupBuild, urlResponseBodyMap },\n  { mainFileName, projectDirectoryUrl, compiledFileUrl, sourcemapFileUrl },\n) => {\n  if (typeof projectDirectoryUrl !== \"string\") {\n    throw new TypeError(`projectDirectoryUrl must be a string, got ${projectDirectoryUrl}`)\n  }\n  if (typeof compiledFileUrl !== \"string\") {\n    throw new TypeError(`compiledFileUrl must be a string, got ${compiledFileUrl}`)\n  }\n  if (typeof sourcemapFileUrl !== \"string\") {\n    throw new TypeError(`sourcemapFileUrl must be a string, got ${sourcemapFileUrl}`)\n  }\n\n  const sources = []\n  const sourcesContent = []\n\n  if (mainFileName === undefined) {\n    mainFileName = Object.keys(rollupBuild).find((key) => rollupBuild[key].isEntry)\n  }\n\n  const trackDependencies = (dependencyMap) => {\n    Object.keys(dependencyMap).forEach((moduleUrl) => {\n      // do not track dependency outside project\n      if (!moduleUrl.startsWith(projectDirectoryUrl)) {\n        return\n      }\n\n      if (!sources.includes(moduleUrl)) {\n        sources.push(moduleUrl)\n        sourcesContent.push(dependencyMap[moduleUrl])\n      }\n    })\n  }\n\n  const assets = []\n  const assetsContent = []\n\n  const mainRollupFile = rollupBuild[mainFileName]\n  const mainFile = parseRollupFile(mainRollupFile, {\n    urlResponseBodyMap,\n    sourcemapFileUrl,\n    sourcemapFileRelativeUrlForModule: urlToRelativeUrl(sourcemapFileUrl, compiledFileUrl),\n  })\n  // mainFile.sourcemap.file = fileUrlToRelativePath(originalFileUrl, sourcemapFileUrl)\n  trackDependencies(mainFile.dependencyMap)\n  assets.push(sourcemapFileUrl)\n  assetsContent.push(JSON.stringify(mainFile.sourcemap, null, \"  \"))\n\n  Object.keys(rollupBuild).forEach((fileName) => {\n    if (fileName === mainFileName) return\n\n    const rollupFile = rollupBuild[fileName]\n    const file = parseRollupFile(rollupFile, {\n      urlResponseBodyMap,\n      compiledFileUrl,\n      sourcemapFileUrl: resolveUrl(file.map.file, compiledFileUrl),\n    })\n    trackDependencies(file.dependencyMap)\n    assets.push(resolveUrl(fileName), compiledFileUrl)\n    assetsContent.push(file.content)\n    assets.push(resolveUrl(`${fileName}.map`, compiledFileUrl))\n    assetsContent.push(JSON.stringify(rollupFile.sourcemap, null, \"  \"))\n  })\n\n  return {\n    contentType: \"application/javascript\",\n    compiledSource: mainFile.content,\n    sources,\n    sourcesContent,\n    assets,\n    assetsContent,\n  }\n}\n\nconst parseRollupFile = (\n  rollupFile,\n  {\n    urlResponseBodyMap,\n    sourcemapFileUrl,\n    sourcemapFileRelativeUrlForModule = `./${rollupFile.fileName}.map`,\n  },\n) => {\n  const dependencyMap = {}\n  const mainModuleSourcemap = rollupFile.map\n\n  mainModuleSourcemap.sources.forEach((source, index) => {\n    const moduleUrl = resolveUrl(source, sourcemapFileUrl)\n    dependencyMap[moduleUrl] = getModuleContent({\n      urlResponseBodyMap,\n      mainModuleSourcemap,\n      moduleUrl,\n      moduleIndex: index,\n    })\n  })\n\n  const sourcemap = rollupFile.map\n\n  const content = setJavaScriptSourceMappingUrl(rollupFile.code, sourcemapFileRelativeUrlForModule)\n\n  return {\n    dependencyMap,\n    content,\n    sourcemap,\n  }\n}\n\nconst getModuleContent = ({ urlResponseBodyMap, mainModuleSourcemap, moduleUrl, moduleIndex }) => {\n  if (moduleUrl in urlResponseBodyMap) {\n    return urlResponseBodyMap[moduleUrl]\n  }\n\n  // try to read it from mainModuleSourcemap\n  const sourcesContent = mainModuleSourcemap.sourcesContent || []\n  if (moduleIndex in sourcesContent) {\n    const contentFromRollupSourcemap = sourcesContent[moduleIndex]\n    if (contentFromRollupSourcemap !== null && contentFromRollupSourcemap !== undefined) {\n      return contentFromRollupSourcemap\n    }\n  }\n\n  // try to get it from filesystem\n  if (moduleUrl.startsWith(\"file:///\")) {\n    const moduleFilePath = urlToFileSystemPath(moduleUrl)\n    // this could be async but it's ok for now\n    // making it async could be harder than it seems\n    // because sourcesContent must be in sync with sources\n    try {\n      const moduleFileBuffer = readFileSync(moduleFilePath)\n      const moduleFileString = String(moduleFileBuffer)\n      return moduleFileString\n    } catch (e) {\n      if (e && e.code === \"ENOENT\") {\n        throw new Error(`module file not found at ${moduleUrl}`)\n      }\n      throw e\n    }\n  }\n\n  // it's an external ressource like http, throw\n  throw new Error(`cannot fetch module content from ${moduleUrl}`)\n}\n",
    "import {\n  resolveDirectoryUrl,\n  resolveUrl,\n  urlIsInsideOf,\n  urlToRelativeUrl,\n  urlToBasename,\n  urlToFilename,\n} from \"@jsenv/util\"\nimport { jsenvCoreDirectoryUrl } from \"../jsenvCoreDirectoryUrl.js\"\nimport { COMPILE_ID_BUILD_GLOBAL_FILES, COMPILE_ID_BUILD_COMMONJS_FILES } from \"../CONSTANTS.js\"\nimport { buildUsingRollup } from \"../building/buildUsingRollup.js\"\nimport { buildToCompilationResult } from \"../building/buildToCompilationResult.js\"\nimport { compileFile } from \"./compileFile.js\"\n\nexport const serveBuild = async ({\n  cancellationToken,\n  logger,\n\n  projectDirectoryUrl,\n  importMapFileRelativeUrl,\n  originalFileUrl,\n  compiledFileUrl,\n  outDirectoryRelativeUrl,\n  compileServerOrigin,\n  importDefaultExtension,\n  externalImportSpecifiers = [],\n  compileCacheStrategy,\n\n  format,\n  projectFileRequestedCallback,\n  request,\n  babelPluginMap,\n}) => {\n  const compile = async () => {\n    const compileId =\n      format === \"global\" ? COMPILE_ID_BUILD_GLOBAL_FILES : COMPILE_ID_BUILD_COMMONJS_FILES\n\n    const originalFileRelativeUrl = urlToRelativeUrl(originalFileUrl, projectDirectoryUrl)\n    const buildRelativeUrl =\n      format === \"commonjs\"\n        ? `${urlToBasename(originalFileUrl)}.cjs`\n        : urlToFilename(originalFileUrl)\n\n    const entryPointMap = {\n      [`./${originalFileRelativeUrl}`]: `./${buildRelativeUrl}`,\n    }\n\n    const build = await buildUsingRollup({\n      cancellationToken,\n      logger,\n\n      entryPointMap,\n      projectDirectoryUrl,\n      importMapFileRelativeUrl,\n      compileDirectoryRelativeUrl: `${outDirectoryRelativeUrl}${compileId}/`,\n      compileServerOrigin,\n      importDefaultExtension,\n      externalImportSpecifiers,\n      babelPluginMap,\n\n      format,\n      node: format === \"commonjs\",\n      browser: format !== \"commonjs\",\n      // buildDirectoryUrl is just theorical because of writeOnFileSystem: false\n      // but still important to know where the files will be written\n      buildDirectoryUrl: resolveDirectoryUrl(\"./\", compiledFileUrl),\n      writeOnFileSystem: false,\n      sourcemapExcludeSources: true,\n      manifestFile: false,\n    })\n\n    const sourcemapFileUrl = `${compiledFileUrl}.map`\n\n    return buildToCompilationResult(build, {\n      mainFileName: buildRelativeUrl,\n      projectDirectoryUrl,\n      originalFileUrl,\n      compiledFileUrl,\n      sourcemapFileUrl,\n    })\n  }\n\n  // might want to put this to false while working on jsenv\n  // to that cache gets verified\n  const isJenvInternalFile =\n    false && urlIsInsideOf(originalFileUrl, resolveUrl(\"./src/internal/\", jsenvCoreDirectoryUrl))\n\n  return compileFile({\n    logger,\n    projectDirectoryUrl,\n    originalFileUrl,\n    compiledFileUrl,\n    writeOnFilesystem: true,\n    useFilesystemAsCache: true,\n    compileCacheStrategy,\n    projectFileRequestedCallback,\n    compile,\n    request,\n    compileCacheSourcesValidation: !isJenvInternalFile,\n    compileCacheAssetsValidation: !isJenvInternalFile,\n  })\n}\n",
    "/* eslint-disable import/max-dependencies */\nimport { urlToContentType, serveFile } from \"@jsenv/server\"\nimport { resolveUrl, resolveDirectoryUrl, urlToRelativeUrl } from \"@jsenv/util\"\nimport {\n  COMPILE_ID_OTHERWISE,\n  COMPILE_ID_BUILD_GLOBAL,\n  COMPILE_ID_BUILD_GLOBAL_FILES,\n  COMPILE_ID_BUILD_COMMONJS,\n  COMPILE_ID_BUILD_COMMONJS_FILES,\n} from \"../CONSTANTS.js\"\nimport { jsenvToolbarHtmlUrl, jsenvBrowserSystemBuildUrl } from \"../jsenvInternalFiles.js\"\nimport { transformImportmap } from \"./transformImportmap.js\"\nimport { transformJs } from \"./js-compilation-service/transformJs.js\"\nimport { transformResultToCompilationResult } from \"./js-compilation-service/transformResultToCompilationResult.js\"\nimport { compileFile } from \"./compileFile.js\"\nimport { serveBuild } from \"./serveBuild.js\"\nimport {\n  parseHtmlString,\n  parseHtmlAstRessources,\n  manipulateHtmlAst,\n  stringifyHtmlAst,\n  getHtmlNodeAttributeByName,\n  getHtmlNodeTextNode,\n  getUniqueNameForInlineHtmlNode,\n  removeHtmlNodeAttribute,\n  setHtmlNodeText,\n} from \"./compileHtml.js\"\nimport { setJavaScriptSourceMappingUrl } from \"../sourceMappingURLUtils.js\"\nimport { generateCompiledFileAssetUrl } from \"./compile-directory/compile-asset.js\"\n\nexport const createCompiledFileService = ({\n  cancellationToken,\n  logger,\n\n  projectDirectoryUrl,\n  outDirectoryRelativeUrl,\n  importMapFileRelativeUrl,\n  importMetaEnvFileRelativeUrl,\n  importMeta,\n  importDefaultExtension,\n\n  transformTopLevelAwait,\n  moduleOutFormat,\n  importMetaFormat,\n  babelPluginMap,\n  groupMap,\n  convertMap,\n  scriptInjections,\n\n  projectFileRequestedCallback,\n  useFilesystemAsCache,\n  writeOnFilesystem,\n  compileCacheStrategy,\n  sourcemapExcludeSources,\n}) => {\n  const jsenvBrowserBuildUrlRelativeToProject = urlToRelativeUrl(\n    jsenvBrowserSystemBuildUrl,\n    projectDirectoryUrl,\n  )\n\n  return (request) => {\n    const { origin, ressource } = request\n    const requestUrl = `${origin}${ressource}`\n    const outDirectoryRemoteUrl = resolveDirectoryUrl(outDirectoryRelativeUrl, origin)\n    // not inside compile directory -> nothing to compile\n    if (!requestUrl.startsWith(outDirectoryRemoteUrl)) {\n      return null\n    }\n\n    const afterOutDirectory = requestUrl.slice(outDirectoryRemoteUrl.length)\n\n    // serve files inside /.jsenv/out/* directly without compilation\n    // this is just to allow some files to be written inside outDirectory and read directly\n    // if asked by the client (such as env.json, groupMap.json, meta.json)\n    if (!afterOutDirectory.includes(\"/\") || afterOutDirectory[0] === \"/\") {\n      return serveFile(request, {\n        rootDirectoryUrl: projectDirectoryUrl,\n        etagEnabled: true,\n      })\n    }\n\n    const parts = afterOutDirectory.split(\"/\")\n    const compileId = parts[0]\n    const remaining = parts.slice(1).join(\"/\")\n    const contentType = urlToContentType(requestUrl)\n    // no compileId, we don't know what to compile (not supposed so happen)\n    if (compileId === \"\") {\n      return null\n    }\n\n    const allowedCompileIds = [\n      ...Object.keys(groupMap),\n      COMPILE_ID_BUILD_GLOBAL,\n      COMPILE_ID_BUILD_GLOBAL_FILES,\n      COMPILE_ID_BUILD_COMMONJS,\n      COMPILE_ID_BUILD_COMMONJS_FILES,\n    ]\n\n    if (!allowedCompileIds.includes(compileId)) {\n      return {\n        status: 400,\n        statusText: `compileId must be one of ${allowedCompileIds}, received ${compileId}`,\n      }\n    }\n\n    // nothing after compileId, we don't know what to compile (not supposed to happen)\n    if (remaining === \"\") {\n      return null\n    }\n\n    const originalFileRelativeUrl = remaining\n    const originalFileUrl = `${projectDirectoryUrl}${originalFileRelativeUrl}`\n    const compileDirectoryRelativeUrl = `${outDirectoryRelativeUrl}${compileId}/`\n    const compileDirectoryUrl = resolveDirectoryUrl(\n      compileDirectoryRelativeUrl,\n      projectDirectoryUrl,\n    )\n    const compiledFileUrl = resolveUrl(originalFileRelativeUrl, compileDirectoryUrl)\n\n    if (contentType === \"application/importmap+json\") {\n      return compileFile({\n        cancellationToken,\n        logger,\n\n        projectDirectoryUrl,\n        originalFileUrl,\n        compiledFileUrl,\n\n        writeOnFilesystem: true, // we always need them\n        useFilesystemAsCache,\n        compileCacheStrategy,\n        projectFileRequestedCallback,\n        request,\n\n        compile: (importmapBeforeTransformation) =>\n          transformImportmap(importmapBeforeTransformation, {\n            logger,\n            projectDirectoryUrl,\n            outDirectoryRelativeUrl,\n            originalFileUrl,\n            compiledFileUrl,\n            projectFileRequestedCallback,\n            request,\n          }),\n      })\n    }\n\n    if (contentType === \"application/javascript\") {\n      if (compileId === COMPILE_ID_BUILD_GLOBAL || compileId === COMPILE_ID_BUILD_COMMONJS) {\n        return serveBuild({\n          cancellationToken,\n          logger,\n\n          projectDirectoryUrl,\n          importMapFileRelativeUrl,\n          originalFileUrl,\n          compiledFileUrl,\n          outDirectoryRelativeUrl,\n          compileServerOrigin: request.origin,\n          importDefaultExtension,\n\n          babelPluginMap,\n          projectFileRequestedCallback,\n          request,\n          format: compileId === COMPILE_ID_BUILD_GLOBAL ? \"global\" : \"commonjs\",\n        })\n      }\n\n      return compileFile({\n        cancellationToken,\n        logger,\n\n        projectDirectoryUrl,\n        originalFileUrl,\n        compiledFileUrl,\n\n        writeOnFilesystem,\n        useFilesystemAsCache,\n        compileCacheStrategy,\n        projectFileRequestedCallback,\n        request,\n        compile: async (originalFileContent) => {\n          const transformResult = await transformJs({\n            projectDirectoryUrl,\n            importMetaEnvFileRelativeUrl,\n            importMeta,\n            code: originalFileContent,\n            url: originalFileUrl,\n            urlAfterTransform: compiledFileUrl,\n            babelPluginMap: compileIdToBabelPluginMap(compileId, { groupMap, babelPluginMap }),\n            convertMap,\n            transformTopLevelAwait,\n            moduleOutFormat: compileIdIsForBuildFiles(compileId)\n              ? // we are compiling for rollup, do not transform into systemjs format\n                \"esmodule\"\n              : moduleOutFormat,\n            importMetaFormat:\n              // eslint-disable-next-line no-nested-ternary\n              compileId === COMPILE_ID_BUILD_GLOBAL_FILES\n                ? \"global\"\n                : compileId === COMPILE_ID_BUILD_COMMONJS_FILES\n                ? \"commonjs\"\n                : importMetaFormat,\n          })\n          const sourcemapFileUrl = `${compiledFileUrl}.map`\n\n          return transformResultToCompilationResult(transformResult, {\n            projectDirectoryUrl,\n            originalFileContent,\n            originalFileUrl,\n            compiledFileUrl,\n            sourcemapFileUrl,\n            sourcemapMethod: writeOnFilesystem ? \"comment\" : \"inline\",\n            sourcemapExcludeSources,\n          })\n        },\n      })\n    }\n\n    if (contentType === \"text/html\") {\n      return compileFile({\n        cancellationToken,\n        logger,\n\n        projectDirectoryUrl,\n        originalFileUrl,\n        compiledFileUrl,\n\n        writeOnFilesystem,\n        useFilesystemAsCache,\n        compileCacheStrategy,\n        projectFileRequestedCallback,\n        request,\n\n        compile: async (htmlBeforeCompilation) => {\n          // parsing html should not throw any syntax error\n          // invalid html markup is converted into some valid html\n          // in the worst cases the faulty html string special characters\n          // will be html encoded.\n          // All this comment to say we don't have to try/catch html parsing\n          const htmlAst = parseHtmlString(htmlBeforeCompilation)\n          manipulateHtmlAst(htmlAst, {\n            scriptInjections: [\n              {\n                src: `/${jsenvBrowserBuildUrlRelativeToProject}`,\n              },\n              // todo: this is dirty because it means\n              // compile server is aware of exploring and jsenv toolbar\n              // instead this should be moved to startExploring\n              ...(originalFileUrl === jsenvToolbarHtmlUrl ? [] : scriptInjections),\n            ],\n          })\n          const { scripts } = parseHtmlAstRessources(htmlAst)\n\n          let hasImportmap = false\n          const inlineScriptsContentMap = {}\n          scripts.forEach((script) => {\n            const typeAttribute = getHtmlNodeAttributeByName(script, \"type\")\n            const srcAttribute = getHtmlNodeAttributeByName(script, \"src\")\n\n            if (typeAttribute && typeAttribute.value === \"importmap\" && srcAttribute) {\n              hasImportmap = true\n              typeAttribute.value = \"jsenv-importmap\"\n              return\n            }\n            if (typeAttribute && typeAttribute.value === \"module\" && srcAttribute) {\n              removeHtmlNodeAttribute(script, typeAttribute)\n              removeHtmlNodeAttribute(script, srcAttribute)\n              setHtmlNodeText(\n                script,\n                `window.__jsenv__.importFile(${JSON.stringify(srcAttribute.value)})`,\n              )\n              return\n            }\n            const textNode = getHtmlNodeTextNode(script)\n            if (typeAttribute && typeAttribute.value === \"module\" && textNode) {\n              const scriptAssetUrl = generateCompiledFileAssetUrl(\n                compiledFileUrl,\n                getUniqueNameForInlineHtmlNode(script, scripts, `[id].js`),\n              )\n              const specifier = `./${urlToRelativeUrl(scriptAssetUrl, compiledFileUrl)}`\n              inlineScriptsContentMap[specifier] = textNode.value\n\n              removeHtmlNodeAttribute(script, typeAttribute)\n              removeHtmlNodeAttribute(script, srcAttribute)\n              setHtmlNodeText(script, `window.__jsenv__.importFile(${JSON.stringify(specifier)})`)\n              return\n            }\n          })\n          // ensure there is at least the importmap needed for jsenv\n          if (hasImportmap === false) {\n            manipulateHtmlAst(htmlAst, {\n              scriptInjections: [\n                {\n                  type: \"jsenv-importmap\",\n                  // in case there is no importmap, use a top level one\n                  src: `/${outDirectoryRelativeUrl}${compileId}/${importMapFileRelativeUrl}`,\n                },\n              ],\n            })\n          }\n\n          const htmlAfterTransformation = stringifyHtmlAst(htmlAst)\n\n          let assets = []\n          let assetsContent = []\n          await Promise.all(\n            Object.keys(inlineScriptsContentMap).map(async (scriptSrc) => {\n              const scriptAssetUrl = resolveUrl(scriptSrc, compiledFileUrl)\n              const scriptBasename = urlToRelativeUrl(scriptAssetUrl, compiledFileUrl)\n              const scriptOriginalFileUrl = resolveUrl(scriptBasename, originalFileUrl)\n              const scriptAfterTransformFileUrl = resolveUrl(scriptBasename, compiledFileUrl)\n\n              const scriptBeforeCompilation = inlineScriptsContentMap[scriptSrc]\n              let scriptTransformResult\n              try {\n                scriptTransformResult = await transformJs({\n                  projectDirectoryUrl,\n                  importMetaEnvFileRelativeUrl,\n                  importMeta,\n                  code: scriptBeforeCompilation,\n                  url: scriptOriginalFileUrl,\n                  urlAfterTransform: scriptAfterTransformFileUrl,\n                  babelPluginMap: compileIdToBabelPluginMap(compileId, {\n                    groupMap,\n                    babelPluginMap,\n                  }),\n                  convertMap,\n                  transformTopLevelAwait,\n                  moduleOutFormat,\n                  importMetaFormat,\n                })\n              } catch (e) {\n                // If there is a syntax error in inline script\n                // we put the raw script without transformation.\n                // when systemjs will try to instantiate to script it\n                // will re-throw this syntax error.\n                // Thanks to this we see the syntax error in the\n                // document and livereloading still works\n                // because we gracefully handle this error\n                if (e.code === \"PARSE_ERROR\") {\n                  const code = scriptBeforeCompilation\n                  assets = [...assets, scriptAssetUrl]\n                  assetsContent = [...assetsContent, code]\n                  return\n                }\n                throw e\n              }\n              const sourcemapFileUrl = resolveUrl(\n                `${scriptBasename}.map`,\n                scriptAfterTransformFileUrl,\n              )\n\n              let { code, map } = scriptTransformResult\n              const sourcemapFileRelativePathForModule = urlToRelativeUrl(\n                sourcemapFileUrl,\n                compiledFileUrl,\n              )\n              code = setJavaScriptSourceMappingUrl(code, sourcemapFileRelativePathForModule)\n              assets = [...assets, scriptAssetUrl, sourcemapFileUrl]\n              assetsContent = [...assetsContent, code, JSON.stringify(map, null, \"  \")]\n            }),\n          )\n\n          return {\n            compiledSource: htmlAfterTransformation,\n            contentType: \"text/html\",\n            sources: [originalFileUrl],\n            sourcesContent: [htmlBeforeCompilation],\n            assets,\n            assetsContent,\n          }\n        },\n      })\n    }\n\n    // json, css etc does not need to be compiled, they are redirected to their source version that will be served as file\n    return {\n      status: 307,\n      headers: {\n        location: resolveUrl(originalFileRelativeUrl, origin),\n      },\n    }\n  }\n}\n\nconst compileIdIsForBuildFiles = (compileId) => {\n  return (\n    compileId === COMPILE_ID_BUILD_GLOBAL_FILES || compileId === COMPILE_ID_BUILD_COMMONJS_FILES\n  )\n}\n\nconst getWorstCompileId = (groupMap) => {\n  if (COMPILE_ID_OTHERWISE in groupMap) {\n    return COMPILE_ID_OTHERWISE\n  }\n  return Object.keys(groupMap)[Object.keys(groupMap).length - 1]\n}\n\nconst compileIdToBabelPluginMap = (compileId, { babelPluginMap, groupMap }) => {\n  let compiledIdForGroupMap\n  let babelPluginMapForGroupMap\n  if (compileIdIsForBuildFiles(compileId)) {\n    compiledIdForGroupMap = getWorstCompileId(groupMap)\n    babelPluginMapForGroupMap = {}\n  } else {\n    compiledIdForGroupMap = compileId\n    babelPluginMapForGroupMap = {}\n  }\n\n  const groupBabelPluginMap = {}\n  groupMap[compiledIdForGroupMap].babelPluginRequiredNameArray.forEach(\n    (babelPluginRequiredName) => {\n      if (babelPluginRequiredName in babelPluginMap) {\n        groupBabelPluginMap[babelPluginRequiredName] = babelPluginMap[babelPluginRequiredName]\n      }\n    },\n  )\n\n  return {\n    ...groupBabelPluginMap,\n    ...babelPluginMapForGroupMap,\n  }\n}\n",
    "/* eslint-disable import/max-dependencies */\nimport { readFileSync } from \"fs\"\nimport {\n  createCancellationToken,\n  createCancellationSource,\n  composeCancellationToken,\n} from \"@jsenv/cancellation\"\nimport {\n  jsenvAccessControlAllowedHeaders,\n  startServer,\n  serveFile,\n  createSSERoom,\n  firstServiceWithTiming,\n} from \"@jsenv/server\"\nimport { createLogger } from \"@jsenv/logger\"\nimport {\n  resolveUrl,\n  urlToFileSystemPath,\n  urlToRelativeUrl,\n  resolveDirectoryUrl,\n  readFile,\n  writeFile,\n  removeFileSystemNode,\n  ensureEmptyDirectory,\n  registerFileLifecycle,\n  registerDirectoryLifecycle,\n  urlIsInsideOf,\n} from \"@jsenv/util\"\nimport { jsenvCoreDirectoryUrl } from \"../jsenvCoreDirectoryUrl.js\"\nimport { assertImportMapFileRelativeUrl, assertImportMapFileInsideProject } from \"../argUtils.js\"\nimport { babelPluginReplaceExpressions } from \"../babel-plugin-replace-expressions.js\"\nimport { generateGroupMap } from \"../generateGroupMap/generateGroupMap.js\"\nimport { jsenvBabelPluginCompatMap } from \"../../jsenvBabelPluginCompatMap.js\"\nimport { jsenvBrowserScoreMap } from \"../../jsenvBrowserScoreMap.js\"\nimport { jsenvNodeVersionScoreMap } from \"../../jsenvNodeVersionScoreMap.js\"\nimport { jsenvBabelPluginMap } from \"../../jsenvBabelPluginMap.js\"\nimport { createCallbackList } from \"../createCallbackList.js\"\nimport { createCompiledFileService } from \"./createCompiledFileService.js\"\nimport { urlIsAsset } from \"./compile-directory/compile-asset.js\"\nimport { sourcemapMainFileUrl, sourcemapMappingFileUrl } from \"../jsenvInternalFiles.js\"\n\nexport const startCompileServer = async ({\n  cancellationToken = createCancellationToken(),\n  compileServerLogLevel,\n\n  projectDirectoryUrl,\n  importMapFileRelativeUrl = \"import-map.importmap\",\n  importDefaultExtension,\n  importMetaEnvFileRelativeUrl = \"env.js\",\n  importMeta = {\n    dev: process.env.NODE_ENV !== \"production\",\n  },\n  jsenvDirectoryRelativeUrl = \".jsenv\",\n  jsenvDirectoryClean = false,\n  outDirectoryName = \"out\",\n\n  writeOnFilesystem = true,\n  sourcemapExcludeSources = false, // this should increase perf (no need to download source for browser)\n  useFilesystemAsCache = true,\n  compileCacheStrategy = \"etag\",\n  projectFileEtagEnabled = true,\n\n  // js compile options\n  transformTopLevelAwait = true,\n  moduleOutFormat = \"systemjs\",\n  importMetaFormat = moduleOutFormat,\n  env = {},\n  processEnvNodeEnv = process.env.NODE_ENV,\n  replaceProcessEnvNodeEnv = true,\n  replaceGlobalObject = false,\n  replaceGlobalFilename = false,\n  replaceGlobalDirname = false,\n  replaceMap = {},\n  babelPluginMap = jsenvBabelPluginMap,\n  convertMap = {},\n\n  // options related to the server itself\n  compileServerProtocol = \"https\",\n  compileServerPrivateKey,\n  compileServerCertificate,\n  compileServerIp = \"0.0.0.0\",\n  compileServerPort = 0,\n  keepProcessAlive = false,\n  stopOnPackageVersionChange = false,\n\n  // remaining options are complex or private\n  compileGroupCount = 1,\n  babelCompatMap = jsenvBabelPluginCompatMap,\n  browserScoreMap = jsenvBrowserScoreMap,\n  nodeVersionScoreMap = jsenvNodeVersionScoreMap,\n  runtimeAlwaysInsideRuntimeScoreMap = false,\n\n  livereloadWatchConfig = {\n    \"./**\": true,\n    \"./**/.*/\": false, // any folder starting with a dot is ignored (includes .git for instance)\n    \"./**/node_modules/\": false,\n  },\n  livereloadLogLevel = \"info\",\n  customServices = {},\n  livereloadSSE = false,\n  scriptInjections = [],\n}) => {\n  assertArguments({\n    projectDirectoryUrl,\n    importMapFileRelativeUrl,\n    jsenvDirectoryRelativeUrl,\n    outDirectoryName,\n  })\n\n  const importMapFileUrl = resolveUrl(importMapFileRelativeUrl, projectDirectoryUrl)\n  const jsenvDirectoryUrl = resolveDirectoryUrl(jsenvDirectoryRelativeUrl, projectDirectoryUrl)\n  const outDirectoryUrl = resolveDirectoryUrl(outDirectoryName, jsenvDirectoryUrl)\n  const outDirectoryRelativeUrl = urlToRelativeUrl(outDirectoryUrl, projectDirectoryUrl)\n  // normalization\n  importMapFileRelativeUrl = urlToRelativeUrl(importMapFileUrl, projectDirectoryUrl)\n  jsenvDirectoryRelativeUrl = urlToRelativeUrl(jsenvDirectoryUrl, projectDirectoryUrl)\n\n  const logger = createLogger({ logLevel: compileServerLogLevel })\n  babelPluginMap = {\n    \"transform-replace-expressions\": [\n      babelPluginReplaceExpressions,\n      {\n        replaceMap: {\n          ...(replaceProcessEnvNodeEnv\n            ? { \"process.env.NODE_ENV\": `(\"${processEnvNodeEnv}\")` }\n            : {}),\n          ...(replaceGlobalObject ? { global: \"globalThis\" } : {}),\n          ...(replaceGlobalFilename ? { __filename: __filenameReplacement } : {}),\n          ...(replaceGlobalDirname ? { __dirname: __dirnameReplacement } : {}),\n          ...replaceMap,\n        },\n        allowConflictingReplacements: true,\n      },\n    ],\n    ...babelPluginMap,\n  }\n  const compileServerGroupMap = generateGroupMap({\n    babelPluginMap,\n    babelCompatMap,\n    runtimeScoreMap: { ...browserScoreMap, node: nodeVersionScoreMap },\n    groupCount: compileGroupCount,\n    runtimeAlwaysInsideRuntimeScoreMap,\n  })\n\n  await setupOutDirectory(outDirectoryUrl, {\n    logger,\n    jsenvDirectoryUrl,\n    jsenvDirectoryClean,\n    useFilesystemAsCache,\n    babelPluginMap,\n    convertMap,\n    importMeta,\n    importMetaEnvFileRelativeUrl,\n    compileServerGroupMap,\n  })\n\n  const serverStopCancellationSource = createCancellationSource()\n\n  let projectFileRequestedCallback = () => {}\n  if (livereloadSSE) {\n    const sseSetup = setupServerSentEventsForLivereload({\n      cancellationToken: composeCancellationToken(\n        cancellationToken,\n        serverStopCancellationSource.token,\n      ),\n      projectDirectoryUrl,\n      jsenvDirectoryRelativeUrl,\n      outDirectoryRelativeUrl,\n      livereloadLogLevel,\n      livereloadWatchConfig,\n    })\n\n    projectFileRequestedCallback = sseSetup.projectFileRequestedCallback\n    const serveSSEForLivereload = createSSEForLivereloadService({\n      cancellationToken,\n      outDirectoryRelativeUrl,\n      trackMainAndDependencies: sseSetup.trackMainAndDependencies,\n    })\n    customServices = {\n      \"service:livereload sse\": serveSSEForLivereload,\n      ...customServices,\n    }\n  }\n\n  const serveAssetFile = createAssetFileService({ projectDirectoryUrl })\n  const serveBrowserScript = createBrowserScriptService({\n    projectDirectoryUrl,\n    outDirectoryRelativeUrl,\n  })\n  const serveCompiledFile = createCompiledFileService({\n    cancellationToken,\n    logger,\n\n    projectDirectoryUrl,\n    outDirectoryRelativeUrl,\n    importMapFileRelativeUrl,\n    importDefaultExtension,\n    importMetaEnvFileRelativeUrl,\n    importMeta,\n\n    transformTopLevelAwait,\n    groupMap: compileServerGroupMap,\n    babelPluginMap,\n    convertMap,\n    moduleOutFormat,\n    importMetaFormat,\n    scriptInjections,\n\n    projectFileRequestedCallback,\n    useFilesystemAsCache,\n    writeOnFilesystem,\n    sourcemapExcludeSources,\n    compileCacheStrategy,\n  })\n  const serveProjectFile = createProjectFileService({\n    projectDirectoryUrl,\n    projectFileRequestedCallback,\n    projectFileEtagEnabled,\n  })\n\n  const compileServer = await startServer({\n    cancellationToken,\n    logLevel: compileServerLogLevel,\n\n    protocol: compileServerProtocol,\n    http2: compileServerProtocol === \"https\",\n    privateKey: compileServerPrivateKey,\n    certificate: compileServerCertificate,\n    ip: compileServerIp,\n    port: compileServerPort,\n    sendServerTiming: true,\n    nagle: false,\n    sendServerInternalErrorDetails: true,\n    requestToResponse: firstServiceWithTiming({\n      ...customServices,\n      \"service:asset files\": serveAssetFile,\n      \"service:browser script\": serveBrowserScript,\n      \"service:compiled files\": serveCompiledFile,\n      \"service:project files\": serveProjectFile,\n    }),\n    accessControlAllowRequestOrigin: true,\n    accessControlAllowRequestMethod: true,\n    accessControlAllowRequestHeaders: true,\n    accessControlAllowedRequestHeaders: [\n      ...jsenvAccessControlAllowedHeaders,\n      \"x-jsenv-execution-id\",\n    ],\n    accessControlAllowCredentials: true,\n    keepProcessAlive,\n  })\n\n  compileServer.stoppedPromise.then(serverStopCancellationSource.cancel)\n\n  const uninstallOutFiles = await installOutFiles({\n    logger,\n    projectDirectoryUrl,\n    jsenvDirectoryRelativeUrl,\n    outDirectoryRelativeUrl,\n    importDefaultExtension,\n    importMapFileRelativeUrl,\n    compileServerGroupMap,\n    env,\n    writeOnFilesystem,\n    onOutFileWritten: (outFileUrl) => {\n      logger.debug(`-> ${outFileUrl}`)\n    },\n  })\n  if (!writeOnFilesystem) {\n    compileServer.stoppedPromise.then(() => {\n      uninstallOutFiles()\n    })\n  }\n\n  if (stopOnPackageVersionChange) {\n    const stopListeningJsenvPackageVersionChange = listenJsenvPackageVersionChange({\n      projectDirectoryUrl,\n      jsenvDirectoryRelativeUrl,\n      onJsenvPackageVersionChange: () => {\n        compileServer.stop(STOP_REASON_PACKAGE_VERSION_CHANGED)\n      },\n    })\n    compileServer.stoppedPromise.then(\n      () => {\n        stopListeningJsenvPackageVersionChange()\n      },\n      () => {},\n    )\n  }\n\n  return {\n    jsenvDirectoryRelativeUrl,\n    outDirectoryRelativeUrl,\n    importMapFileRelativeUrl,\n    ...compileServer,\n    compileServerGroupMap,\n  }\n}\n\nexport const computeOutDirectoryRelativeUrl = ({\n  projectDirectoryUrl,\n  jsenvDirectoryRelativeUrl = \".jsenv\",\n  outDirectoryName = \"out\",\n}) => {\n  const jsenvDirectoryUrl = resolveDirectoryUrl(jsenvDirectoryRelativeUrl, projectDirectoryUrl)\n  const outDirectoryUrl = resolveDirectoryUrl(outDirectoryName, jsenvDirectoryUrl)\n  const outDirectoryRelativeUrl = urlToRelativeUrl(outDirectoryUrl, projectDirectoryUrl)\n\n  return outDirectoryRelativeUrl\n}\n\nconst assertArguments = ({\n  projectDirectoryUrl,\n  importMapFileRelativeUrl,\n  jsenvDirectoryRelativeUrl,\n  outDirectoryName,\n}) => {\n  if (typeof projectDirectoryUrl !== \"string\") {\n    throw new TypeError(`projectDirectoryUrl must be a string. got ${projectDirectoryUrl}`)\n  }\n\n  assertImportMapFileRelativeUrl({ importMapFileRelativeUrl })\n  const importMapFileUrl = resolveUrl(importMapFileRelativeUrl, projectDirectoryUrl)\n  assertImportMapFileInsideProject({ importMapFileUrl, projectDirectoryUrl })\n\n  if (typeof jsenvDirectoryRelativeUrl !== \"string\") {\n    throw new TypeError(\n      `jsenvDirectoryRelativeUrl must be a string. got ${jsenvDirectoryRelativeUrl}`,\n    )\n  }\n  const jsenvDirectoryUrl = resolveDirectoryUrl(jsenvDirectoryRelativeUrl, projectDirectoryUrl)\n\n  if (!jsenvDirectoryUrl.startsWith(projectDirectoryUrl)) {\n    throw new TypeError(`jsenv directory must be inside project directory\n--- jsenv directory url ---\n${jsenvDirectoryUrl}\n--- project directory url ---\n${projectDirectoryUrl}`)\n  }\n\n  if (typeof outDirectoryName !== \"string\") {\n    throw new TypeError(`outDirectoryName must be a string. got ${outDirectoryName}`)\n  }\n}\n\nconst setupOutDirectory = async (\n  outDirectoryUrl,\n  {\n    logger,\n    jsenvDirectoryClean,\n    jsenvDirectoryUrl,\n    useFilesystemAsCache,\n    babelPluginMap,\n    convertMap,\n    importMeta,\n    importMetaEnvFileRelativeUrl,\n    compileServerGroupMap,\n    replaceProcessEnvNodeEnv,\n    processEnvNodeEnv,\n  },\n) => {\n  if (jsenvDirectoryClean) {\n    logger.info(`clean jsenv directory at ${jsenvDirectoryUrl}`)\n    await ensureEmptyDirectory(jsenvDirectoryUrl)\n  }\n  if (useFilesystemAsCache) {\n    const jsenvCorePackageFileUrl = resolveUrl(\"./package.json\", jsenvCoreDirectoryUrl)\n    const jsenvCorePackageFilePath = urlToFileSystemPath(jsenvCorePackageFileUrl)\n    const jsenvCorePackageVersion = readPackage(jsenvCorePackageFilePath).version\n    const outDirectoryMeta = {\n      jsenvCorePackageVersion,\n      babelPluginMap,\n      convertMap,\n      importMeta,\n      importMetaEnvFileRelativeUrl,\n      compileServerGroupMap,\n      replaceProcessEnvNodeEnv,\n      processEnvNodeEnv,\n    }\n    const metaFileUrl = resolveUrl(\"./meta.json\", outDirectoryUrl)\n\n    let previousOutDirectoryMeta\n    try {\n      const source = await readFile(metaFileUrl)\n      previousOutDirectoryMeta = JSON.parse(source)\n    } catch (e) {\n      if (e && e.code === \"ENOENT\") {\n        previousOutDirectoryMeta = null\n      } else {\n        throw e\n      }\n    }\n\n    if (previousOutDirectoryMeta !== null) {\n      const previousMetaString = JSON.stringify(previousOutDirectoryMeta, null, \"  \")\n      const metaString = JSON.stringify(outDirectoryMeta, null, \"  \")\n      if (previousMetaString !== metaString) {\n        if (!jsenvDirectoryClean) {\n          logger.warn(`clean out directory at ${urlToFileSystemPath(outDirectoryUrl)}`)\n        }\n        await ensureEmptyDirectory(outDirectoryUrl)\n      }\n    }\n\n    await writeFile(metaFileUrl, JSON.stringify(outDirectoryMeta, null, \"  \"))\n  }\n}\n\n// eslint-disable-next-line valid-jsdoc\n/**\n * We need to get two things:\n * { projectFileRequestedCallback, trackMainAndDependencies }\n *\n * projectFileRequestedCallback\n * This function will be called by the compile server every time a file inside projectDirectory\n * is requested so that we can build up the dependency tree of any file\n *\n * trackMainAndDependencies\n * This function is meant to be used to implement server sent events in order for a client to know\n * when a given file or any of its dependencies changes in order to implement livereloading.\n * At any time this function can be called with (mainRelativeUrl, { modified, removed, lastEventId })\n * modified is called\n *  - immediatly if lastEventId is passed and mainRelativeUrl or any of its dependencies have\n *  changed since that event (last change is passed to modified if their is more than one change)\n *  - when mainRelativeUrl or any of its dependencies is modified\n * removed is called\n *  - with same spec as modified but when a file is deleted from the filesystem instead of modified\n *\n */\nconst setupServerSentEventsForLivereload = ({\n  cancellationToken,\n  projectDirectoryUrl,\n  jsenvDirectoryRelativeUrl,\n  outDirectoryRelativeUrl,\n  livereloadLogLevel,\n  livereloadWatchConfig,\n}) => {\n  const livereloadLogger = createLogger({ logLevel: livereloadLogLevel })\n  const trackerMap = new Map()\n  const projectFileRequested = createCallbackList()\n  const projectFileModified = createCallbackList()\n  const projectFileRemoved = createCallbackList()\n  const projectFileAdded = createCallbackList()\n\n  const projectFileRequestedCallback = (relativeUrl, request) => {\n    // I doubt an asset like .js.map will change\n    // in theory a compilation asset should not change\n    // if the source file did not change\n    // so we can avoid watching compilation asset\n    if (urlIsAsset(`${projectDirectoryUrl}${relativeUrl}`)) {\n      return\n    }\n\n    projectFileRequested.notify(relativeUrl, request)\n  }\n  const watchDescription = {\n    ...livereloadWatchConfig,\n    [jsenvDirectoryRelativeUrl]: false,\n  }\n  const unregisterDirectoryLifecyle = registerDirectoryLifecycle(projectDirectoryUrl, {\n    watchDescription,\n    updated: ({ relativeUrl }) => {\n      projectFileModified.notify(relativeUrl)\n    },\n    removed: ({ relativeUrl }) => {\n      projectFileRemoved.notify(relativeUrl)\n    },\n    added: ({ relativeUrl }) => {\n      projectFileAdded.notify(relativeUrl)\n    },\n    keepProcessAlive: false,\n    recursive: true,\n  })\n  cancellationToken.register(unregisterDirectoryLifecyle)\n\n  const getDependencySet = (mainRelativeUrl) => {\n    if (trackerMap.has(mainRelativeUrl)) {\n      return trackerMap.get(mainRelativeUrl)\n    }\n    const dependencySet = new Set()\n    dependencySet.add(mainRelativeUrl)\n    trackerMap.set(mainRelativeUrl, dependencySet)\n    return dependencySet\n  }\n\n  // each time a file is requested for the first time its dependencySet is computed\n  projectFileRequested.register((mainRelativeUrl) => {\n    // for now node use case of livereloading + node.js\n    // and for browsers only html file can be main files\n    // this avoid collecting dependencies of non html files that will never be used\n    if (!mainRelativeUrl.endsWith(\".html\")) {\n      return\n    }\n\n    // when a file is requested, always rebuild its dependency in case it has changed\n    // since the last time it was requested\n    const dependencySet = new Set()\n    dependencySet.add(mainRelativeUrl)\n    trackerMap.set(mainRelativeUrl, dependencySet)\n\n    const unregisterDependencyRequested = projectFileRequested.register((relativeUrl, request) => {\n      if (dependencySet.has(relativeUrl)) {\n        return\n      }\n\n      const dependencyReport = reportDependency(relativeUrl, mainRelativeUrl, request)\n      if (dependencyReport.dependency === false) {\n        livereloadLogger.debug(\n          `${relativeUrl} not a dependency of ${mainRelativeUrl} because ${dependencyReport.reason}`,\n        )\n        return\n      }\n\n      livereloadLogger.debug(\n        `${relativeUrl} is a dependency of ${mainRelativeUrl} because ${dependencyReport.reason}`,\n      )\n      dependencySet.add(relativeUrl)\n    })\n    const unregisterMainRemoved = projectFileRemoved.register((relativeUrl) => {\n      if (relativeUrl === mainRelativeUrl) {\n        unregisterDependencyRequested()\n        unregisterMainRemoved()\n        trackerMap.delete(mainRelativeUrl)\n      }\n    })\n  })\n\n  const trackMainAndDependencies = (mainRelativeUrl, { modified, removed, added }) => {\n    livereloadLogger.debug(`track ${mainRelativeUrl} and its dependencies`)\n\n    const unregisterModified = projectFileModified.register((relativeUrl) => {\n      const dependencySet = getDependencySet(mainRelativeUrl)\n      if (dependencySet.has(relativeUrl)) {\n        modified(relativeUrl)\n      }\n    })\n    const unregisterRemoved = projectFileRemoved.register((relativeUrl) => {\n      const dependencySet = getDependencySet(mainRelativeUrl)\n      if (dependencySet.has(relativeUrl)) {\n        removed(relativeUrl)\n      }\n    })\n    const unregisterAdded = projectFileAdded.register((relativeUrl) => {\n      const dependencySet = getDependencySet(mainRelativeUrl)\n      if (dependencySet.has(relativeUrl)) {\n        added(relativeUrl)\n      }\n    })\n\n    return () => {\n      livereloadLogger.debug(`stop tracking ${mainRelativeUrl} and its dependencies.`)\n      unregisterModified()\n      unregisterRemoved()\n      unregisterAdded()\n    }\n  }\n\n  const reportDependency = (relativeUrl, mainRelativeUrl, request) => {\n    if (relativeUrl === mainRelativeUrl) {\n      return {\n        dependency: true,\n        reason: \"it's main\",\n      }\n    }\n\n    if (\"x-jsenv-execution-id\" in request.headers) {\n      const executionId = request.headers[\"x-jsenv-execution-id\"]\n      if (executionId === mainRelativeUrl) {\n        return {\n          dependency: true,\n          reason: \"x-jsenv-execution-id request header\",\n        }\n      }\n      return {\n        dependency: false,\n        reason: \"x-jsenv-execution-id request header\",\n      }\n    }\n\n    if (\"referer\" in request.headers) {\n      const { origin } = request\n      const { referer } = request.headers\n      // referer is likely the exploringServer\n      if (referer !== origin && !urlIsInsideOf(referer, origin)) {\n        return {\n          dependency: false,\n          reason: \"referer is an other origin\",\n        }\n      }\n      // here we know the referer is inside compileServer\n      const refererRelativeUrl = urlToOriginalRelativeUrl(\n        referer,\n        resolveUrl(outDirectoryRelativeUrl, request.origin),\n      )\n      if (refererRelativeUrl) {\n        // search if referer (file requesting this one) is tracked as being a dependency of main file\n        // in that case because the importer is a dependency the importee is also a dependency\n        // eslint-disable-next-line no-unused-vars\n        for (const tracker of trackerMap) {\n          if (tracker[0] === mainRelativeUrl && tracker[1].has(refererRelativeUrl)) {\n            return {\n              dependency: true,\n              reason: \"referer is a dependency\",\n            }\n          }\n        }\n      }\n    }\n\n    return {\n      dependency: true,\n      reason: \"it was requested\",\n    }\n  }\n\n  return { projectFileRequestedCallback, trackMainAndDependencies }\n}\n\nconst createSSEForLivereloadService = ({\n  cancellationToken,\n  outDirectoryRelativeUrl,\n  trackMainAndDependencies,\n}) => {\n  const cache = []\n  const sseRoomLimit = 100\n  const getOrCreateSSERoom = (mainFileRelativeUrl) => {\n    const cacheEntry = cache.find(\n      (cacheEntryCandidate) => cacheEntryCandidate.mainFileRelativeUrl === mainFileRelativeUrl,\n    )\n    if (cacheEntry) {\n      return cacheEntry.sseRoom\n    }\n\n    const sseRoom = createSSERoom({\n      retryDuration: 2000,\n      historyLength: 100,\n      welcomeEvent: true,\n    })\n\n    // each time something is modified or removed we send event to the room\n    const stopTracking = trackMainAndDependencies(mainFileRelativeUrl, {\n      modified: (relativeUrl) => {\n        sseRoom.sendEvent({ type: \"file-modified\", data: relativeUrl })\n      },\n      removed: (relativeUrl) => {\n        sseRoom.sendEvent({ type: \"file-removed\", data: relativeUrl })\n      },\n      added: (relativeUrl) => {\n        sseRoom.sendEvent({ type: \"file-added\", data: relativeUrl })\n      },\n    })\n\n    sseRoom.start()\n    cancellationToken.register(() => {\n      sseRoom.stop()\n      stopTracking()\n    })\n    cache.push({ mainFileRelativeUrl, sseRoom })\n    if (cache.length >= sseRoomLimit) {\n      cache.shift()\n    }\n    return sseRoom\n  }\n\n  return (request) => {\n    const { accept } = request.headers\n    if (!accept || !accept.includes(\"text/event-stream\")) {\n      return null\n    }\n\n    const fileRelativeUrl = urlToOriginalRelativeUrl(\n      resolveUrl(request.ressource, request.origin),\n      resolveUrl(outDirectoryRelativeUrl, request.origin),\n    )\n\n    const room = getOrCreateSSERoom(fileRelativeUrl)\n    return room.connect(\n      request.headers[\"last-event-id\"] ||\n        new URL(request.ressource, request.origin).searchParams.get(\"last-event-id\"),\n    )\n  }\n}\n\nconst urlToOriginalRelativeUrl = (url, outDirectoryRemoteUrl) => {\n  if (urlIsInsideOf(url, outDirectoryRemoteUrl)) {\n    const afterCompileDirectory = urlToRelativeUrl(url, outDirectoryRemoteUrl)\n    const fileRelativeUrl = afterCompileDirectory.slice(afterCompileDirectory.indexOf(\"/\") + 1)\n    return fileRelativeUrl\n  }\n  return new URL(url).pathname.slice(1)\n}\n\nconst createAssetFileService = ({ projectDirectoryUrl }) => {\n  return (request) => {\n    const { origin, ressource } = request\n    const requestUrl = `${origin}${ressource}`\n    if (urlIsAsset(requestUrl)) {\n      return serveFile(request, {\n        rootDirectoryUrl: projectDirectoryUrl,\n        etagEnabled: true,\n      })\n    }\n    return null\n  }\n}\n\nconst createBrowserScriptService = ({ projectDirectoryUrl, outDirectoryRelativeUrl }) => {\n  const sourcemapMainFileRelativeUrl = urlToRelativeUrl(sourcemapMainFileUrl, projectDirectoryUrl)\n  const sourcemapMappingFileRelativeUrl = urlToRelativeUrl(\n    sourcemapMappingFileUrl,\n    projectDirectoryUrl,\n  )\n\n  return (request) => {\n    if (\n      request.method === \"GET\" &&\n      request.ressource === \"/.jsenv/compile-meta.json\" &&\n      \"x-jsenv\" in request.headers\n    ) {\n      const body = JSON.stringify({\n        outDirectoryRelativeUrl,\n        errorStackRemapping: true,\n        sourcemapMainFileRelativeUrl,\n        sourcemapMappingFileRelativeUrl,\n      })\n\n      return {\n        status: 200,\n        headers: {\n          \"cache-control\": \"no-store\",\n          \"content-type\": \"application/json\",\n          \"content-length\": Buffer.byteLength(body),\n        },\n        body,\n      }\n    }\n\n    return null\n  }\n}\n\nconst createProjectFileService = ({\n  projectDirectoryUrl,\n  projectFileRequestedCallback,\n  projectFileEtagEnabled,\n}) => {\n  return (request) => {\n    const { ressource } = request\n    const relativeUrl = ressource.slice(1)\n    projectFileRequestedCallback(relativeUrl, request)\n\n    const responsePromise = serveFile(request, {\n      rootDirectoryUrl: projectDirectoryUrl,\n      etagEnabled: projectFileEtagEnabled,\n    })\n\n    return responsePromise\n  }\n}\n\nconst installOutFiles = async ({\n  projectDirectoryUrl,\n  jsenvDirectoryRelativeUrl,\n  outDirectoryRelativeUrl,\n  importDefaultExtension,\n  importMapFileRelativeUrl,\n  compileServerGroupMap,\n  env,\n  onOutFileWritten = () => {},\n}) => {\n  const outDirectoryUrl = resolveUrl(outDirectoryRelativeUrl, projectDirectoryUrl)\n\n  env = {\n    ...env,\n    jsenvDirectoryRelativeUrl,\n    outDirectoryRelativeUrl,\n    importDefaultExtension,\n    importMapFileRelativeUrl,\n  }\n\n  const groupMapToString = () => JSON.stringify(compileServerGroupMap, null, \"  \")\n  const envToString = () => JSON.stringify(env, null, \"  \")\n  const groupMapOutFileUrl = resolveUrl(\"./groupMap.json\", outDirectoryUrl)\n  const envOutFileUrl = resolveUrl(\"./env.json\", outDirectoryUrl)\n\n  await Promise.all([\n    writeFile(groupMapOutFileUrl, groupMapToString()),\n    writeFile(envOutFileUrl, envToString()),\n  ])\n\n  onOutFileWritten(groupMapOutFileUrl)\n  onOutFileWritten(envOutFileUrl)\n\n  return async () => {\n    removeFileSystemNode(groupMapOutFileUrl, { allowUseless: true })\n    removeFileSystemNode(envOutFileUrl)\n  }\n}\n\nconst listenJsenvPackageVersionChange = ({\n  projectDirectoryUrl,\n  jsenvDirectoryRelativeUrl,\n  onJsenvPackageVersionChange = () => {},\n}) => {\n  const jsenvCoreDirectoryUrl = resolveUrl(jsenvDirectoryRelativeUrl, projectDirectoryUrl)\n  const packageFileUrl = resolveUrl(\"./package.json\", jsenvCoreDirectoryUrl)\n  const packageFilePath = urlToFileSystemPath(packageFileUrl)\n  let packageVersion\n\n  try {\n    packageVersion = readPackage(packageFilePath).version\n  } catch (e) {\n    if (e.code === \"ENOENT\") return () => {}\n  }\n\n  const checkPackageVersion = () => {\n    let packageObject\n    try {\n      packageObject = readPackage(packageFilePath)\n    } catch (e) {\n      // package json deleted ? not a problem\n      // let's wait for it to show back\n      if (e.code === \"ENOENT\") return\n      // package.json malformed ? not a problem\n      // let's wait for use to fix it or filesystem to finish writing the file\n      if (e.name === \"SyntaxError\") return\n      throw e\n    }\n\n    if (packageVersion !== packageObject.version) {\n      onJsenvPackageVersionChange()\n    }\n  }\n\n  return registerFileLifecycle(packageFilePath, {\n    added: checkPackageVersion,\n    updated: checkPackageVersion,\n    keepProcessAlive: false,\n  })\n}\n\nconst readPackage = (packagePath) => {\n  const buffer = readFileSync(packagePath)\n  const string = String(buffer)\n  const packageObject = JSON.parse(string)\n  return packageObject\n}\n\nexport const STOP_REASON_PACKAGE_VERSION_CHANGED = {\n  toString: () => `package version changed`,\n}\n\nconst __filenameReplacement = `import.meta.url.slice('file:///'.length)`\n\nconst __dirnameReplacement = `import.meta.url.slice('file:///'.length).replace(/[\\\\\\/\\\\\\\\][^\\\\\\/\\\\\\\\]*$/, '')`\n",
    "import { createLogger } from \"@jsenv/logger\"\nimport { createCancellationTokenForProcess } from \"@jsenv/cancellation\"\nimport { resolveDirectoryUrl } from \"@jsenv/util\"\nimport { executeJsenvAsyncFunction } from \"./internal/executeJsenvAsyncFunction.js\"\nimport { COMPILE_ID_OTHERWISE } from \"./internal/CONSTANTS.js\"\nimport { assertProjectDirectoryUrl, assertProjectDirectoryExists } from \"./internal/argUtils.js\"\nimport { startCompileServer } from \"./internal/compiling/startCompileServer.js\"\nimport { buildUsingRollup } from \"./internal/building/buildUsingRollup.js\"\nimport { jsenvBabelPluginMap } from \"./jsenvBabelPluginMap.js\"\n\nconst FORMAT_ENTRY_POINTS = {\n  commonjs: { \"./main.js\": \"./main.cjs\" },\n  esmodule: { \"./main.html\": \"./main.html\" },\n  global: { \"./main.js\": \"./main.js\" },\n  systemjs: { \"./main.html\": \"./main.html\" },\n}\n\nexport const buildProject = async ({\n  cancellationToken = createCancellationTokenForProcess(),\n  logLevel = \"info\",\n  compileServerLogLevel = \"warn\",\n  logger,\n\n  projectDirectoryUrl,\n  jsenvDirectoryRelativeUrl,\n  jsenvDirectoryClean,\n  importMapFileRelativeUrl,\n  importMetaEnvFileRelativeUrl,\n  importMeta = {\n    dev: false,\n  },\n  importDefaultExtension,\n  externalImportSpecifiers = [],\n  env = {},\n\n  compileServerProtocol,\n  compileServerPrivateKey,\n  compileServerCertificate,\n  compileServerIp,\n  compileServerPort,\n  babelPluginMap = jsenvBabelPluginMap,\n\n  format = \"esmodule\",\n  externalImportUrlPatterns = format === \"commonjs\"\n    ? {\n        \"node_modules/\": true,\n      }\n    : {},\n  browser = format === \"global\" || format === \"systemjs\" || format === \"esmodule\",\n  node = format === \"commonjs\",\n  entryPointMap = FORMAT_ENTRY_POINTS[format],\n  systemJsUrl = \"/node_modules/systemjs/dist/s.min.js\",\n  globalName,\n  globals = {},\n  sourcemapExcludeSources = false,\n\n  buildDirectoryRelativeUrl,\n  buildDirectoryClean = false,\n  writeOnFileSystem = true,\n  manifestFile = false,\n\n  urlVersioning = true,\n  useImportMapToImproveLongTermCaching = format === \"systemjs\",\n  preserveEntrySignatures,\n  jsConcatenation = true,\n  minify = process.env.NODE_ENV === \"production\",\n  // https://github.com/kangax/html-minifier#options-quick-reference\n  minifyHtmlOptions = { collapseWhitespace: true },\n  // https://github.com/terser/terser#minify-options\n  minifyJsOptions,\n  // https://github.com/cssnano/cssnano/tree/master/packages/cssnano-preset-default\n  minifyCssOptions,\n\n  // when true .jsenv/out-build directory is generated\n  // with all intermediated files used to produce the final build files.\n  // it might improve buildProject speed for subsequent build generation\n  // but this is to be proven and not absolutely required\n  // When false intermediates files are transformed and served in memory\n  // by the compile server\n  // must be true by default otherwise rollup cannot find sourcemap files\n  // when asking them to the compile server\n  // (to fix that sourcemap could be inlined)\n  filesystemCache = true,\n\n  serviceWorkers = {},\n  serviceWorkerFinalizer,\n\n  ...rest\n}) => {\n  return executeJsenvAsyncFunction(async () => {\n    logger = logger || createLogger({ logLevel })\n\n    if (format === \"esmodule\") {\n      if (buildDirectoryRelativeUrl === undefined) {\n        buildDirectoryRelativeUrl = \"./dist/esmodule\"\n      }\n    } else if (format === \"systemjs\") {\n      if (buildDirectoryRelativeUrl === undefined) {\n        buildDirectoryRelativeUrl = \"./dist/systemjs\"\n      }\n    } else if (format === \"commonjs\") {\n      if (buildDirectoryRelativeUrl === undefined) {\n        buildDirectoryRelativeUrl = \"./dist/commonjs\"\n      }\n      if (node === undefined) {\n        node = true\n      }\n    } else if (format === \"global\") {\n      if (buildDirectoryRelativeUrl === undefined) {\n        buildDirectoryRelativeUrl = \"./dist/global\"\n      }\n      if (browser === undefined) {\n        browser = true\n      }\n    } else {\n      throw new TypeError(\n        `unexpected format: ${format}. Must be esmodule, systemjs, commonjs or global.`,\n      )\n    }\n\n    if (!jsConcatenation) {\n      throw new Error(\n        `jsConcatenation cannot be disabled for now. See https://github.com/rollup/rollup/issues/3882`,\n      )\n    }\n\n    projectDirectoryUrl = assertProjectDirectoryUrl({ projectDirectoryUrl })\n    await assertProjectDirectoryExists({ projectDirectoryUrl })\n\n    assertEntryPointMap({ entryPointMap })\n\n    if (Object.keys(entryPointMap).length === 0) {\n      logger.error(`entryPointMap is an empty object`)\n      return {\n        rollupBuilds: {},\n      }\n    }\n\n    assertBuildDirectoryRelativeUrl({ buildDirectoryRelativeUrl })\n    const buildDirectoryUrl = resolveDirectoryUrl(buildDirectoryRelativeUrl, projectDirectoryUrl)\n    assertBuildDirectoryInsideProject({ buildDirectoryUrl, projectDirectoryUrl })\n\n    const compileServer = await startCompileServer({\n      cancellationToken,\n      compileServerLogLevel,\n\n      projectDirectoryUrl,\n      jsenvDirectoryRelativeUrl,\n      jsenvDirectoryClean,\n      // build compiled files are written into a different directory\n      // than exploring-server. This is because here we compile for rollup\n      // that is expecting esmodule format, not systemjs\n      // + some more differences like import.meta.dev\n      outDirectoryName: \"out-build\",\n      importMapFileRelativeUrl,\n      importDefaultExtension,\n      importMetaEnvFileRelativeUrl,\n      importMeta,\n      moduleOutFormat: \"esmodule\", // rollup will transform into systemjs\n      importMetaFormat: format, // but ensure import.meta are correctly transformed into the right format\n\n      compileServerProtocol,\n      compileServerPrivateKey,\n      compileServerCertificate,\n      compileServerIp,\n      compileServerPort,\n      env,\n      babelPluginMap,\n\n      writeOnFilesystem: filesystemCache,\n      useFilesystemAsCache: filesystemCache,\n\n      // override with potential custom options\n      ...rest,\n    })\n\n    const { outDirectoryRelativeUrl, origin: compileServerOrigin } = compileServer\n\n    try {\n      const result = await buildUsingRollup({\n        cancellationToken,\n        logger,\n\n        entryPointMap,\n        projectDirectoryUrl,\n        importMapFileRelativeUrl: compileServer.importMapFileRelativeUrl,\n        compileDirectoryRelativeUrl: `${outDirectoryRelativeUrl}${COMPILE_ID_OTHERWISE}/`,\n        compileServerOrigin,\n        importDefaultExtension,\n        externalImportSpecifiers,\n        externalImportUrlPatterns,\n        babelPluginMap,\n        node,\n        browser,\n        writeOnFileSystem,\n\n        format,\n        systemJsUrl,\n        globalName,\n        globals,\n        sourcemapExcludeSources,\n\n        buildDirectoryUrl,\n        buildDirectoryClean,\n        manifestFile,\n\n        urlVersioning,\n        useImportMapToImproveLongTermCaching,\n        preserveEntrySignatures,\n        jsConcatenation,\n        minify,\n        minifyHtmlOptions,\n        minifyJsOptions,\n        minifyCssOptions,\n\n        serviceWorkers,\n        serviceWorkerFinalizer,\n      })\n\n      return result\n    } finally {\n      compileServer.stop(\"build generated\")\n    }\n  })\n}\n\nconst assertEntryPointMap = ({ entryPointMap }) => {\n  if (typeof entryPointMap !== \"object\") {\n    throw new TypeError(`entryPointMap must be an object, got ${entryPointMap}`)\n  }\n  const keys = Object.keys(entryPointMap)\n  keys.forEach((key) => {\n    if (!key.startsWith(\"./\")) {\n      throw new TypeError(\n        `unexpected key in entryPointMap, all keys must start with ./ but found ${key}`,\n      )\n    }\n\n    const value = entryPointMap[key]\n    if (typeof value !== \"string\") {\n      throw new TypeError(\n        `unexpected value in entryPointMap, all values must be strings found ${value} for key ${key}`,\n      )\n    }\n    if (!value.startsWith(\"./\")) {\n      throw new TypeError(\n        `unexpected value in entryPointMap, all values must starts with ./ but found ${value} for key ${key}`,\n      )\n    }\n  })\n}\n\nconst assertBuildDirectoryRelativeUrl = ({ buildDirectoryRelativeUrl }) => {\n  if (typeof buildDirectoryRelativeUrl !== \"string\") {\n    throw new TypeError(\n      `buildDirectoryRelativeUrl must be a string, received ${buildDirectoryRelativeUrl}`,\n    )\n  }\n}\n\nconst assertBuildDirectoryInsideProject = ({ buildDirectoryUrl, projectDirectoryUrl }) => {\n  if (!buildDirectoryUrl.startsWith(projectDirectoryUrl)) {\n    throw new Error(`build directory must be inside project directory\n--- build directory url ---\n${buildDirectoryUrl}\n--- project directory url ---\n${projectDirectoryUrl}`)\n  }\n}\n",
    "import { require } from \"./internal/require.js\"\nimport { transformJs } from \"./internal/compiling/js-compilation-service/transformJs.js\"\nimport { babelPluginReplaceExpressions } from \"./internal/babel-plugin-replace-expressions.js\"\n\nexport const convertCommonJsWithBabel = async ({\n  projectDirectoryUrl,\n  importMetaEnvFileRelativeUrl,\n  code,\n  url,\n  replaceGlobalObject = true,\n  replaceGlobalFilename = true,\n  replaceGlobalDirname = true,\n  replaceProcessEnvNodeEnv = true,\n  processEnvNodeEnv = process.env.NODE_ENV,\n  replaceMap = {},\n}) => {\n  const transformCommonJs = require(\"babel-plugin-transform-commonjs\")\n\n  // maybe we should use babel core here instead of transformJs\n  const result = await transformJs({\n    projectDirectoryUrl,\n    importMetaEnvFileRelativeUrl,\n    code,\n    url,\n    babelPluginMap: {\n      \"transform-commonjs\": [transformCommonJs],\n      \"transform-replace-expressions\": [\n        babelPluginReplaceExpressions,\n        {\n          replaceMap: {\n            ...(replaceProcessEnvNodeEnv\n              ? { \"process.env.NODE_ENV\": `(\"${processEnvNodeEnv}\")` }\n              : {}),\n            ...(replaceGlobalObject ? { global: \"globalThis\" } : {}),\n            ...(replaceGlobalFilename ? { __filename: __filenameReplacement } : {}),\n            ...(replaceGlobalDirname ? { __dirname: __dirnameReplacement } : {}),\n            ...replaceMap,\n          },\n        },\n      ],\n    },\n  })\n  return result\n}\n\nconst __filenameReplacement = `import.meta.url.slice('file:///'.length)`\n\nconst __dirnameReplacement = `import.meta.url.slice('file:///'.length).replace(/[\\\\\\/\\\\\\\\][^\\\\\\/\\\\\\\\]*$/, '')`\n\n// const createInlineProcessNodeEnvBabelPlugin = ({ value = process.env.NODE_ENV }) => {\n//   return ({ types: t }) => {\n//     return {\n//       name: \"inline-process-node-env\",\n//       visitor: {\n//         MemberExpression(path) {\n//           if (path.matchesPattern(\"process.env.NODE_ENV\")) {\n//             path.replaceWith(t.valueToNode(value))\n\n//             if (path.parentPath.isBinaryExpression()) {\n//               const evaluated = path.parentPath.evaluate()\n//               if (evaluated.confident) {\n//                 path.parentPath.replaceWith(t.valueToNode(evaluated.value))\n//               }\n//             }\n//           }\n//         },\n//       },\n//     }\n//   }\n// }\n",
    "import { urlToFileSystemPath, resolveUrl } from \"@jsenv/util\"\nimport { require } from \"./internal/require.js\"\n\nexport const convertCommonJsWithRollup = async ({\n  url,\n  urlAfterTransform,\n  replaceGlobalObject = true,\n  replaceGlobalFilename = true,\n  replaceGlobalDirname = true,\n  replaceProcessEnvNodeEnv = true,\n  replaceProcess = true,\n  replaceBuffer = true,\n  processEnvNodeEnv = process.env.NODE_ENV,\n  replaceMap = {},\n  convertBuiltinsToBrowser = true,\n  external = [],\n} = {}) => {\n  if (!url.startsWith(\"file:///\")) {\n    // it's possible to make rollup compatible with http:// for instance\n    // however it's an exotic use case for now\n    throw new Error(`compatible only with file:// protocol, got ${url}`)\n  }\n\n  const { rollup } = require(\"rollup\")\n  const commonjs = require(\"@rollup/plugin-commonjs\")\n  const { nodeResolve } = require(\"@rollup/plugin-node-resolve\")\n  const createJSONRollupPlugin = require(\"@rollup/plugin-json\")\n  const createReplaceRollupPlugin = require(\"@rollup/plugin-replace\")\n  const builtins = require(\"rollup-plugin-node-builtins-brofs\")\n  const createNodeGlobalRollupPlugin = require(\"rollup-plugin-node-globals\")\n\n  const filePath = urlToFileSystemPath(url)\n\n  const nodeBuiltinsRollupPlugin = builtins()\n\n  const nodeResolveRollupPlugin = nodeResolve({\n    mainFields: [\"main\"],\n  })\n\n  const jsonRollupPlugin = createJSONRollupPlugin()\n\n  const nodeGlobalRollupPlugin = createNodeGlobalRollupPlugin({\n    global: false, // handled by replaceMap\n    dirname: false, // handled by replaceMap\n    filename: false, //  handled by replaceMap\n    process: replaceProcess,\n    buffer: replaceBuffer,\n  })\n\n  const commonJsRollupPlugin = commonjs()\n\n  const rollupBuild = await rollup({\n    input: filePath,\n    inlineDynamicImports: true,\n    external,\n    plugins: [\n      commonJsRollupPlugin,\n      createReplaceRollupPlugin({\n        ...(replaceProcessEnvNodeEnv\n          ? { \"process.env.NODE_ENV\": JSON.stringify(processEnvNodeEnv) }\n          : {}),\n        ...(replaceGlobalObject ? { global: \"globalThis\" } : {}),\n        ...(replaceGlobalFilename ? { __filename: __filenameReplacement } : {}),\n        ...(replaceGlobalDirname ? { __dirname: __dirnameReplacement } : {}),\n        ...replaceMap,\n      }),\n      nodeGlobalRollupPlugin,\n      ...(convertBuiltinsToBrowser ? [nodeBuiltinsRollupPlugin] : []),\n      nodeResolveRollupPlugin,\n      jsonRollupPlugin,\n    ],\n  })\n\n  const generateOptions = {\n    // https://rollupjs.org/guide/en#output-format\n    format: \"esm\",\n    // entryFileNames: `./[name].js`,\n    // https://rollupjs.org/guide/en#output-sourcemap\n    sourcemap: true,\n    sourcemapExcludeSources: true,\n    ...(urlAfterTransform ? { dir: urlToFileSystemPath(resolveUrl(\"./\", urlAfterTransform)) } : {}),\n  }\n\n  const result = await rollupBuild.generate(generateOptions)\n\n  return result.output[0]\n}\n\nconst __filenameReplacement = `import.meta.url.slice('file:///'.length)`\n\nconst __dirnameReplacement = `import.meta.url.slice('file:///'.length).replace(/[\\\\\\/\\\\\\\\][^\\\\\\/\\\\\\\\]*$/, '')`\n",
    "import { require } from \"../../require.js\"\n\nconst { createFileCoverage } = require(\"istanbul-lib-coverage\")\n\n// https://github.com/istanbuljs/istanbuljs/blob/5405550c3868712b14fd8bfe0cbd6f2e7ac42279/packages/istanbul-lib-coverage/lib/coverage-map.js#L43\nexport const composeCoverageMap = (...coverageMaps) => {\n  const finalCoverageMap = {}\n  coverageMaps.forEach((coverageMap) => {\n    Object.keys(coverageMap).forEach((filename) => {\n      const coverage = coverageMap[filename]\n      finalCoverageMap[filename] =\n        filename in finalCoverageMap ? merge(finalCoverageMap[filename], coverage) : coverage\n    })\n  })\n  return finalCoverageMap\n}\n\nconst merge = (coverageA, coverageB) => {\n  const fileCoverage = createFileCoverage(coverageA)\n  fileCoverage.merge(coverageB)\n  return fileCoverage.toJSON()\n}\n",
    "import {\n  createCancellationToken,\n  createOperation,\n  createStoppableOperation,\n  createCancellationSource,\n  composeCancellationToken,\n  errorToCancelReason,\n} from \"@jsenv/cancellation\"\nimport { createLogger } from \"@jsenv/logger\"\nimport { composeCoverageMap } from \"./coverage/composeCoverageMap.js\"\n\nconst TIMING_BEFORE_EXECUTION = \"before-execution\"\nconst TIMING_DURING_EXECUTION = \"during-execution\"\nconst TIMING_AFTER_EXECUTION = \"after-execution\"\n\nexport const launchAndExecute = async ({\n  cancellationToken = createCancellationToken(),\n  executionLogLevel,\n\n  fileRelativeUrl,\n  launch,\n\n  // stopAfterExecute false by default because you want to keep browser alive\n  // or nodejs process\n  // however unit test will pass true because they want to move on\n  stopAfterExecute = false,\n  stopAfterExecuteReason = \"stop after execute\",\n  // when launch returns { disconnected, gracefulStop, stop }\n  // the launched runtime have that amount of ms for disconnected to resolve\n  // before we call stop\n  gracefulStopAllocatedMs = 4000,\n  runtimeConsoleCallback = () => {},\n  runtimeStartedCallback = () => {},\n  runtimeStoppedCallback = () => {},\n  runtimeErrorCallback = () => {},\n  runtimeDisconnectCallback = () => {},\n\n  measureDuration = false,\n  mirrorConsole = false,\n  captureConsole = false, // rename collectConsole ?\n  collectRuntimeName = false,\n  collectRuntimeVersion = false,\n  inheritCoverage = false,\n  collectCoverage = false,\n  ...rest\n} = {}) => {\n  const logger = createLogger({ logLevel: executionLogLevel })\n\n  if (typeof fileRelativeUrl !== \"string\") {\n    throw new TypeError(`fileRelativeUrl must be a string, got ${fileRelativeUrl}`)\n  }\n  if (typeof launch !== \"function\") {\n    throw new TypeError(`launch launch must be a function, got ${launch}`)\n  }\n\n  let executionResultTransformer = (executionResult) => executionResult\n\n  if (measureDuration) {\n    const startMs = Date.now()\n    executionResultTransformer = composeTransformer(\n      executionResultTransformer,\n      (executionResult) => {\n        const endMs = Date.now()\n        executionResult.startMs = startMs\n        executionResult.endMs = endMs\n        return executionResult\n      },\n    )\n  }\n\n  if (mirrorConsole) {\n    runtimeConsoleCallback = composeCallback(runtimeConsoleCallback, ({ type, text }) => {\n      if (type === \"error\") {\n        process.stderr.write(text)\n      } else {\n        process.stdout.write(text)\n      }\n    })\n  }\n\n  if (captureConsole) {\n    const consoleCalls = []\n    runtimeConsoleCallback = composeCallback(runtimeConsoleCallback, ({ type, text }) => {\n      consoleCalls.push({ type, text })\n    })\n    executionResultTransformer = composeTransformer(\n      executionResultTransformer,\n      (executionResult) => {\n        executionResult.consoleCalls = consoleCalls\n        return executionResult\n      },\n    )\n  }\n\n  if (collectRuntimeName) {\n    runtimeStartedCallback = composeCallback(runtimeStartedCallback, ({ name }) => {\n      executionResultTransformer = composeTransformer(\n        executionResultTransformer,\n        (executionResult) => {\n          executionResult.runtimeName = name\n          return executionResult\n        },\n      )\n    })\n  }\n\n  if (collectRuntimeVersion) {\n    runtimeStartedCallback = composeCallback(runtimeStartedCallback, ({ version }) => {\n      executionResultTransformer = composeTransformer(\n        executionResultTransformer,\n        (executionResult) => {\n          executionResult.runtimeVersion = version\n          return executionResult\n        },\n      )\n    })\n  }\n\n  if (inheritCoverage) {\n    const collectCoverageSaved = collectCoverage\n    collectCoverage = true\n    executionResultTransformer = composeTransformer(\n      executionResultTransformer,\n      (executionResult) => {\n        const { coverageMap, ...rest } = executionResult\n        // ensure the coverage of the executed file is taken into account\n        global.__coverage__ = composeCoverageMap(global.__coverage__ || {}, coverageMap || {})\n        if (collectCoverageSaved) {\n          return executionResult\n        }\n        if (fileRelativeUrl.endsWith(\".html\") && rest.namespace) {\n          Object.keys(rest.namespace).forEach((file) => {\n            delete rest.namespace[file].coverageMap\n          })\n        }\n        return rest\n      },\n    )\n  }\n\n  const executionResult = await computeRawExecutionResult({\n    cancellationToken,\n    logger,\n\n    fileRelativeUrl,\n    launch,\n\n    stopAfterExecute,\n    stopAfterExecuteReason,\n    gracefulStopAllocatedMs,\n    runtimeConsoleCallback,\n    runtimeErrorCallback,\n    runtimeDisconnectCallback,\n    runtimeStartedCallback,\n    runtimeStoppedCallback,\n    collectCoverage,\n\n    ...rest,\n  })\n\n  return executionResultTransformer(executionResult)\n}\n\nconst composeCallback = (previousCallback, callback) => {\n  return (...args) => {\n    previousCallback(...args)\n    return callback(...args)\n  }\n}\n\nconst composeTransformer = (previousTransformer, transformer) => {\n  return (value) => {\n    const transformedValue = previousTransformer(value)\n    return transformer(transformedValue)\n  }\n}\n\nconst computeRawExecutionResult = async ({ cancellationToken, allocatedMs, ...rest }) => {\n  const hasAllocatedMs = typeof allocatedMs === \"number\" && allocatedMs !== Infinity\n\n  if (!hasAllocatedMs) {\n    return computeExecutionResult({\n      cancellationToken,\n      ...rest,\n    })\n  }\n\n  // here if allocatedMs is very big\n  // setTimeout may be called immediatly\n  // in that case we should just throw that hte number is too big\n\n  const TIMEOUT_CANCEL_REASON = \"timeout\"\n  const id = setTimeout(() => {\n    timeoutCancellationSource.cancel(TIMEOUT_CANCEL_REASON)\n  }, allocatedMs)\n  const timeoutCancel = () => clearTimeout(id)\n  cancellationToken.register(timeoutCancel)\n\n  const timeoutCancellationSource = createCancellationSource()\n  const externalOrTimeoutCancellationToken = composeCancellationToken(\n    cancellationToken,\n    timeoutCancellationSource.token,\n  )\n\n  try {\n    const executionResult = await computeExecutionResult({\n      cancellationToken: externalOrTimeoutCancellationToken,\n      ...rest,\n    })\n    timeoutCancel()\n    return executionResult\n  } catch (e) {\n    if (errorToCancelReason(e) === TIMEOUT_CANCEL_REASON) {\n      return createTimedoutExecutionResult()\n    }\n    throw e\n  }\n}\n\nconst computeExecutionResult = async ({\n  cancellationToken,\n  logger,\n\n  fileRelativeUrl,\n  launch,\n\n  stopAfterExecute,\n  stopAfterExecuteReason,\n  gracefulStopAllocatedMs,\n  runtimeStartedCallback,\n  runtimeStoppedCallback,\n  runtimeConsoleCallback,\n  runtimeErrorCallback,\n  runtimeDisconnectCallback,\n\n  ...rest\n}) => {\n  logger.debug(`launch runtime environment for ${fileRelativeUrl}`)\n\n  const launchOperation = createStoppableOperation({\n    cancellationToken,\n    start: async () => {\n      const value = await launch({\n        cancellationToken,\n        logger,\n        ...rest,\n      })\n      runtimeStartedCallback({ name: value.name, version: value.version })\n      return value\n    },\n    stop: async ({ name: runtimeName, version: runtimeVersion, gracefulStop, stop }, reason) => {\n      const runtime = `${runtimeName}/${runtimeVersion}`\n\n      // external code can cancel using cancellationToken at any time.\n      // it is important to keep the code inside this stop function because once cancelled\n      // all code after the operation won't execute because it will be rejected with\n      // the cancellation error\n\n      let stoppedGracefully\n\n      if (gracefulStop && gracefulStopAllocatedMs) {\n        logger.debug(`${fileRelativeUrl} ${runtime}: runtime.gracefulStop() because ${reason}`)\n\n        const gracefulStopPromise = (async () => {\n          await gracefulStop({ reason })\n          return true\n        })()\n\n        const stopPromise = (async () => {\n          stoppedGracefully = await new Promise(async (resolve) => {\n            const timeoutId = setTimeout(() => {\n              resolve(false)\n            }, gracefulStopAllocatedMs)\n            try {\n              await gracefulStopPromise\n              resolve(true)\n            } finally {\n              clearTimeout(timeoutId)\n            }\n          })\n          if (stoppedGracefully) {\n            return stoppedGracefully\n          }\n\n          logger.debug(\n            `${fileRelativeUrl} ${runtime}: runtime.stop() because gracefulStop still pending after ${gracefulStopAllocatedMs}ms`,\n          )\n          await stop({ reason, gracefulFailed: true })\n          return false\n        })()\n\n        stoppedGracefully = await Promise.race([gracefulStopPromise, stopPromise])\n      } else {\n        await stop({ reason, gracefulFailed: false })\n        stoppedGracefully = false\n      }\n\n      logger.debug(\n        `${fileRelativeUrl} ${runtime}: runtime stopped${stoppedGracefully ? \" gracefully\" : \"\"}`,\n      )\n      runtimeStoppedCallback({ stoppedGracefully })\n    },\n  })\n\n  const {\n    name: runtimeName,\n    version: runtimeVersion,\n    options,\n    executeFile,\n    registerErrorCallback,\n    registerConsoleCallback,\n    disconnected,\n  } = await launchOperation\n\n  const runtime = `${runtimeName}/${runtimeVersion}`\n\n  logger.debug(`${fileRelativeUrl} ${runtime}: runtime launched.\n--- options ---\noptions: ${JSON.stringify(options, null, \"  \")}`)\n\n  logger.debug(`${fileRelativeUrl} ${runtime}: start file execution.`)\n  registerConsoleCallback(runtimeConsoleCallback)\n\n  const executeOperation = createOperation({\n    cancellationToken,\n    start: async () => {\n      let timing = TIMING_BEFORE_EXECUTION\n\n      disconnected.then(() => {\n        logger.debug(`${fileRelativeUrl} ${runtime}: runtime disconnected ${timing}.`)\n        runtimeDisconnectCallback({ timing })\n      })\n\n      const executed = executeFile(fileRelativeUrl, rest)\n      timing = TIMING_DURING_EXECUTION\n\n      registerErrorCallback((error) => {\n        logger.error(`error ${timing}.\n--- error stack ---\n${error.stack}\n--- file executed ---\n${fileRelativeUrl}\n--- runtime ---\n${runtime}`)\n        runtimeErrorCallback({ error, timing })\n      })\n\n      const raceResult = await promiseTrackRace([disconnected, executed])\n      timing = TIMING_AFTER_EXECUTION\n\n      if (raceResult.winner === disconnected) {\n        return createDisconnectedExecutionResult({})\n      }\n\n      if (stopAfterExecute) {\n        launchOperation.stop(stopAfterExecuteReason)\n      }\n\n      const executionResult = raceResult.value\n      const { status } = executionResult\n      if (status === \"errored\") {\n        // debug log level because this error happens during execution\n        // there is no need to log it.\n        // the code will know the execution errored because it receives\n        // an errored execution result\n        logger.debug(`error ${TIMING_DURING_EXECUTION}.\n--- error stack ---\n${executionResult.error.stack}\n--- file executed ---\n${fileRelativeUrl}\n--- runtime ---\n${runtime}`)\n        return createErroredExecutionResult(executionResult, rest)\n      }\n\n      logger.debug(`${fileRelativeUrl} ${runtime}: execution completed.`)\n      return createCompletedExecutionResult(executionResult, rest)\n    },\n  })\n\n  const executionResult = await executeOperation\n\n  return executionResult\n}\n\nconst createTimedoutExecutionResult = () => {\n  return {\n    status: \"timedout\",\n  }\n}\n\nconst createDisconnectedExecutionResult = () => {\n  return {\n    status: \"disconnected\",\n  }\n}\n\nconst createErroredExecutionResult = ({ error, coverageMap }, { collectCoverage }) => {\n  return {\n    status: \"errored\",\n    error,\n    ...(collectCoverage ? { coverageMap } : {}),\n  }\n}\n\nconst createCompletedExecutionResult = ({ namespace, coverageMap }, { collectCoverage }) => {\n  return {\n    status: \"completed\",\n    namespace: normalizeNamespace(namespace),\n    ...(collectCoverage ? { coverageMap } : {}),\n  }\n}\n\nconst normalizeNamespace = (namespace) => {\n  if (typeof namespace !== \"object\") return namespace\n  if (namespace instanceof Promise) return namespace\n  const normalized = {}\n  // remove \"__esModule\" or Symbol.toStringTag from namespace object\n  Object.keys(namespace).forEach((key) => {\n    normalized[key] = namespace[key]\n  })\n  return normalized\n}\n\nconst promiseTrackRace = (promiseArray) => {\n  return new Promise((resolve, reject) => {\n    let resolved = false\n\n    const visit = (index) => {\n      const promise = promiseArray[index]\n      promise.then((value) => {\n        if (resolved) return\n        resolved = true\n        resolve({ winner: promise, value, index })\n      }, reject)\n    }\n\n    let i = 0\n    while (i < promiseArray.length) {\n      visit(i++)\n    }\n  })\n}\n",
    "import { createCancellationTokenForProcess } from \"@jsenv/cancellation\"\nimport { executeJsenvAsyncFunction } from \"./internal/executeJsenvAsyncFunction.js\"\nimport { assertProjectDirectoryUrl, assertProjectDirectoryExists } from \"./internal/argUtils.js\"\nimport { startCompileServer } from \"./internal/compiling/startCompileServer.js\"\nimport { launchAndExecute } from \"./internal/executing/launchAndExecute.js\"\n\nexport const execute = async ({\n  cancellationToken = createCancellationTokenForProcess(),\n  logLevel = \"warn\",\n  compileServerLogLevel = logLevel,\n  executionLogLevel = logLevel,\n\n  projectDirectoryUrl,\n  jsenvDirectoryRelativeUrl,\n  jsenvDirectoryClean,\n  importMapFileRelativeUrl,\n  importDefaultExtension,\n  fileRelativeUrl,\n\n  compileServerProtocol,\n  compileServerPrivateKey,\n  compileServerCertificate,\n  compileServerIp,\n  compileServerPort,\n  babelPluginMap,\n  convertMap,\n  compileGroupCount = 2,\n\n  launch,\n  mirrorConsole = true,\n  stopAfterExecute = false,\n  gracefulStopAllocatedMs,\n  ignoreError = false,\n  ...rest\n}) => {\n  const executionPromise = executeJsenvAsyncFunction(async () => {\n    projectDirectoryUrl = assertProjectDirectoryUrl({ projectDirectoryUrl })\n    await assertProjectDirectoryExists({ projectDirectoryUrl })\n\n    if (typeof fileRelativeUrl !== \"string\") {\n      throw new TypeError(`fileRelativeUrl must be a string, got ${fileRelativeUrl}`)\n    }\n    fileRelativeUrl = fileRelativeUrl.replace(/\\\\/g, \"/\")\n    if (typeof launch !== \"function\") {\n      throw new TypeError(`launch must be a function, got ${launch}`)\n    }\n\n    const { outDirectoryRelativeUrl, origin: compileServerOrigin, stop } = await startCompileServer(\n      {\n        cancellationToken,\n        compileServerLogLevel,\n\n        projectDirectoryUrl,\n        jsenvDirectoryRelativeUrl,\n        jsenvDirectoryClean,\n        importMapFileRelativeUrl,\n        importDefaultExtension,\n\n        compileServerProtocol,\n        compileServerPrivateKey,\n        compileServerCertificate,\n        compileServerIp,\n        compileServerPort,\n        babelPluginMap,\n        convertMap,\n        compileGroupCount,\n      },\n    )\n\n    const result = await launchAndExecute({\n      cancellationToken,\n      executionLogLevel,\n\n      fileRelativeUrl,\n      launch: (params) =>\n        launch({\n          projectDirectoryUrl,\n          outDirectoryRelativeUrl,\n          compileServerOrigin,\n          ...params,\n        }),\n      mirrorConsole,\n      stopAfterExecute,\n      gracefulStopAllocatedMs,\n      ...rest,\n    })\n\n    stop(\"single-execution-done\")\n\n    return result\n  })\n\n  if (ignoreError) {\n    return executionPromise\n  }\n\n  const result = await executionPromise\n  if (result.status === \"errored\") {\n    /*\n    Warning: when node launched with --unhandled-rejections=strict, despites\n    this promise being rejected by throw result.error node will compltely ignore it.\n\n    The error can be logged by doing\n    ```js\n    process.setUncaughtExceptionCaptureCallback((error) => {\n      console.error(error.stack)\n    })\n    ```\n    But it feels like a hack.\n    */\n    throw result.error\n  }\n  return result\n}\n",
    "import { resolveUrl, normalizeStructuredMetaMap, urlToMeta } from \"@jsenv/util\"\nimport { require } from \"../../require.js\"\n\n// https://github.com/istanbuljs/babel-plugin-istanbul/blob/321740f7b25d803f881466ea819d870f7ed6a254/src/index.js\n\nexport const babelPluginInstrument = (api, options) => {\n  const { programVisitor } = require(\"istanbul-lib-instrument\")\n\n  const { types } = api\n  const {\n    useInlineSourceMaps = false,\n    projectDirectoryUrl,\n    coverageConfig = { \"./**/*\": true },\n  } = options\n\n  const structuredMetaMapForCover = normalizeStructuredMetaMap(\n    {\n      cover: coverageConfig,\n    },\n    projectDirectoryUrl,\n  )\n  const shouldInstrument = (relativeUrl) => {\n    return urlToMeta({\n      url: resolveUrl(relativeUrl, projectDirectoryUrl),\n      structuredMetaMap: structuredMetaMapForCover,\n    }).cover\n  }\n\n  return {\n    name: \"transform-instrument\",\n    visitor: {\n      Program: {\n        enter(path) {\n          const { file } = this\n          const { opts } = file\n\n          const relativeUrl = optionsToRelativeUrl(opts)\n          if (!relativeUrl) {\n            console.warn(\"file without relativeUrl\", relativeUrl)\n            return\n          }\n          if (!shouldInstrument(relativeUrl)) return\n\n          this.__dv__ = null\n\n          let inputSourceMap\n\n          if (useInlineSourceMaps) {\n            // https://github.com/istanbuljs/babel-plugin-istanbul/commit/a9e15643d249a2985e4387e4308022053b2cd0ad#diff-1fdf421c05c1140f6d71444ea2b27638R65\n            inputSourceMap = opts.inputSourceMap || file.inputMap ? file.inputMap.sourcemap : null\n          } else {\n            inputSourceMap = opts.inputSourceMap\n          }\n\n          this.__dv__ = programVisitor(types, opts.filenameRelative || opts.filename, {\n            coverageVariable: \"__coverage__\",\n            inputSourceMap,\n          })\n          this.__dv__.enter(path)\n        },\n\n        exit(path) {\n          if (!this.__dv__) {\n            return\n          }\n          const object = this.__dv__.exit(path)\n          // object got two properties: fileCoverage and sourceMappingURL\n          this.file.metadata.coverage = object.fileCoverage\n        },\n      },\n    },\n  }\n}\n\nconst optionsToRelativeUrl = ({ filenameRelative }) => {\n  if (filenameRelative) return filenameRelative\n  return \"\"\n}\n",
    "export const generateFileExecutionSteps = ({ fileRelativeUrl, filePlan }) => {\n  const fileExecutionSteps = []\n  Object.keys(filePlan).forEach((name) => {\n    const stepConfig = filePlan[name]\n    if (stepConfig === null || stepConfig === undefined) {\n      return\n    }\n\n    if (typeof stepConfig !== \"object\") {\n      throw new TypeError(`found unexpected value in plan, they must be object.\n--- file relative path ---\n${fileRelativeUrl}\n--- name ---\n${name}\n--- value ---\n${stepConfig}`)\n    }\n\n    fileExecutionSteps.push({\n      name,\n      fileRelativeUrl,\n      ...stepConfig,\n    })\n  })\n\n  return fileExecutionSteps\n}\n",
    "import { collectFiles } from \"@jsenv/util\"\nimport { generateFileExecutionSteps } from \"./generateFileExecutionSteps.js\"\n\nexport const generateExecutionSteps = async (plan, { cancellationToken, projectDirectoryUrl }) => {\n  const structuredMetaMap = {\n    filePlan: plan,\n  }\n\n  const fileResultArray = await collectFiles({\n    cancellationToken,\n    directoryUrl: projectDirectoryUrl,\n    structuredMetaMap,\n    predicate: ({ filePlan }) => filePlan,\n  })\n\n  const executionSteps = []\n  fileResultArray.forEach(({ relativeUrl, meta }) => {\n    const fileExecutionSteps = generateFileExecutionSteps({\n      fileRelativeUrl: relativeUrl,\n      filePlan: meta.filePlan,\n    })\n    executionSteps.push(...fileExecutionSteps)\n  })\n  return executionSteps\n}\n",
    "import { require } from \"../../require.js\"\n\nconst { createFileCoverage } = require(\"istanbul-lib-coverage\")\n\nexport const createEmptyCoverage = (relativeUrl) => createFileCoverage(relativeUrl).toJSON()\n",
    "import { createOperation } from \"@jsenv/cancellation\"\nimport { resolveUrl, urlToFileSystemPath, readFile } from \"@jsenv/util\"\nimport { require } from \"../../require.js\"\nimport { minimalBabelPluginArray } from \"../../minimalBabelPluginArray.js\"\nimport { babelPluginInstrument } from \"./babel-plugin-instrument.js\"\nimport { createEmptyCoverage } from \"./createEmptyCoverage.js\"\n\nexport const relativeUrlToEmptyCoverage = async (\n  relativeUrl,\n  { cancellationToken, projectDirectoryUrl, babelPluginMap },\n) => {\n  const { transformAsync } = require(\"@babel/core\")\n\n  const fileUrl = resolveUrl(relativeUrl, projectDirectoryUrl)\n  const source = await createOperation({\n    cancellationToken,\n    start: () => readFile(fileUrl),\n  })\n\n  const plugins = [...minimalBabelPluginArray]\n  Object.keys(babelPluginMap).forEach((babelPluginName) => {\n    if (babelPluginName !== \"transform-instrument\") {\n      plugins.push(babelPluginMap[babelPluginName])\n    }\n  })\n  plugins.push([babelPluginInstrument, { projectDirectoryUrl }])\n\n  try {\n    const { metadata } = await createOperation({\n      cancellationToken,\n      start: () =>\n        transformAsync(source, {\n          filename: urlToFileSystemPath(fileUrl),\n          filenameRelative: relativeUrl,\n          configFile: false,\n          babelrc: false,\n          parserOpts: {\n            allowAwaitOutsideFunction: true,\n          },\n          plugins,\n        }),\n    })\n\n    const { coverage } = metadata\n    if (!coverage) {\n      throw new Error(`missing coverage for file`)\n    }\n\n    // https://github.com/gotwarlost/istanbul/blob/bc84c315271a5dd4d39bcefc5925cfb61a3d174a/lib/command/common/run-with-cover.js#L229\n    Object.keys(coverage.s).forEach(function (key) {\n      coverage.s[key] = 0\n    })\n\n    return coverage\n  } catch (e) {\n    if (e && e.code === \"BABEL_PARSE_ERROR\") {\n      // return an empty coverage for that file when\n      // it contains a syntax error\n      return createEmptyCoverage(relativeUrl)\n    }\n    throw e\n  }\n}\n",
    "export const ensureRelativePathsInCoverage = (coverageMap) => {\n  const coverageMapRelative = {}\n  Object.keys(coverageMap).forEach((key) => {\n    const coverageForFile = coverageMap[key]\n    coverageMapRelative[key] = coverageForFile.path.startsWith(\"./\")\n      ? coverageForFile\n      : {\n          ...coverageForFile,\n          path: `./${coverageForFile.path}`,\n        }\n  })\n  return coverageMapRelative\n}\n",
    "import { collectFiles } from \"@jsenv/util\"\nimport { relativeUrlToEmptyCoverage } from \"./relativeUrlToEmptyCoverage.js\"\nimport { composeCoverageMap } from \"./composeCoverageMap.js\"\nimport { ensureRelativePathsInCoverage } from \"./ensureRelativePathsInCoverage.js\"\n\nexport const reportToCoverageMap = async (\n  report,\n  {\n    cancellationToken,\n    projectDirectoryUrl,\n    babelPluginMap,\n    coverageConfig,\n    coverageIncludeMissing,\n  },\n) => {\n  const coverageMapForReport = executionReportToCoverageMap(report)\n\n  if (!coverageIncludeMissing) {\n    return ensureRelativePathsInCoverage(coverageMapForReport)\n  }\n\n  const relativeFileUrlToCoverArray = await listRelativeFileUrlToCover({\n    cancellationToken,\n    projectDirectoryUrl,\n    coverageConfig,\n  })\n\n  const relativeFileUrlMissingCoverageArray = relativeFileUrlToCoverArray.filter(\n    (relativeFileUrlToCover) => relativeFileUrlToCover in coverageMapForReport === false,\n  )\n\n  const coverageMapForMissedFiles = {}\n  await Promise.all(\n    relativeFileUrlMissingCoverageArray.map(async (relativeFileUrlMissingCoverage) => {\n      const emptyCoverage = await relativeUrlToEmptyCoverage(relativeFileUrlMissingCoverage, {\n        cancellationToken,\n        projectDirectoryUrl,\n        babelPluginMap,\n      })\n      coverageMapForMissedFiles[relativeFileUrlMissingCoverage] = emptyCoverage\n      return emptyCoverage\n    }),\n  )\n\n  return ensureRelativePathsInCoverage({\n    ...coverageMapForReport,\n    ...coverageMapForMissedFiles,\n  })\n}\n\nconst listRelativeFileUrlToCover = async ({\n  cancellationToken,\n  projectDirectoryUrl,\n  coverageConfig,\n}) => {\n  const structuredMetaMapForCoverage = {\n    cover: coverageConfig,\n  }\n\n  const matchingFileResultArray = await collectFiles({\n    cancellationToken,\n    directoryUrl: projectDirectoryUrl,\n    structuredMetaMap: structuredMetaMapForCoverage,\n    predicate: ({ cover }) => cover,\n  })\n\n  return matchingFileResultArray.map(({ relativeUrl }) => relativeUrl)\n}\n\nconst executionReportToCoverageMap = (report) => {\n  const coverageMapArray = []\n\n  Object.keys(report).forEach((file) => {\n    const executionResultForFile = report[file]\n    Object.keys(executionResultForFile).forEach((executionName) => {\n      const executionResultForFileOnRuntime = executionResultForFile[executionName]\n\n      const { coverageMap } = executionResultForFileOnRuntime\n      if (!coverageMap) {\n        // several reasons not to have coverageMap here:\n        // 1. the file we executed did not import an instrumented file.\n        // - a test file without import\n        // - a test file importing only file excluded from coverage\n        // - a coverDescription badly configured so that we don't realize\n        // a file should be covered\n\n        // 2. the file we wanted to executed timedout\n        // - infinite loop\n        // - too extensive operation\n        // - a badly configured or too low allocatedMs for that execution.\n\n        // 3. the file we wanted to execute contains syntax-error\n\n        // in any scenario we are fine because\n        // coverDescription will generate empty coverage for files\n        // that were suppose to be coverage but were not.\n        return\n      }\n\n      coverageMapArray.push(coverageMap)\n    })\n  })\n\n  const executionCoverageMap = composeCoverageMap(...coverageMapArray)\n\n  return executionCoverageMap\n}\n",
    "import readline from \"readline\"\nimport { memoize } from \"@jsenv/util\"\nimport { require } from \"../require.js\"\n\nconst stringWidth = require(\"string-width\")\n\nexport const writeLog = (string, { stream = process.stdout } = {}) => {\n  string = `${string}\n`\n  stream.write(string)\n\n  const consoleModified = spyConsoleModification()\n\n  const moveCursorToLineAbove = () => {\n    readline.moveCursor(stream, 0, -1)\n  }\n\n  const clearCursorLine = () => {\n    readline.clearLine(stream, 0)\n  }\n\n  const remove = memoize(() => {\n    const { columns = 80, rows = 24 } = stream\n    const logLines = string.split(/\\r\\n|\\r|\\n/)\n    let visualLineCount = 0\n    logLines.forEach((logLine) => {\n      const width = stringWidth(logLine)\n      visualLineCount += width === 0 ? 1 : Math.ceil(width / columns)\n    })\n\n    if (visualLineCount > rows) {\n      // the whole log cannot be cleared because it's vertically to long\n      // (longer than terminal height)\n      // readline.moveCursor cannot move cursor higher than screen height\n      // it means we would only clear the visible part of the log\n      // better keep the log untouched\n      return\n    }\n\n    while (visualLineCount--) {\n      clearCursorLine()\n      if (visualLineCount > 0) {\n        moveCursorToLineAbove()\n      }\n    }\n    // an other version of the while above could the code below\n    // readline.moveCursor(stream, 0, -visualLineCount)\n    // readline.clearScreenDown(stream)\n  })\n\n  let updated = false\n  const update = (newString) => {\n    if (updated) {\n      throw new Error(`cannot update twice`)\n    }\n    updated = true\n\n    if (!consoleModified()) {\n      remove()\n    }\n    return writeLog(newString, { stream })\n  }\n\n  return {\n    remove,\n    update,\n  }\n}\n\n// maybe https://github.com/gajus/output-interceptor/tree/v3.0.0 ?\n// the problem with listening data on stdout\n// is that node.js will later throw error if stream gets closed\n// while something listening data on it\nconst spyConsoleModification = () => {\n  const { stdout, stderr } = process\n  const originalStdoutWrite = stdout.write\n  const originalStdErrWrite = stderr.write\n\n  let modified = false\n\n  stdout.write = (chunk, encoding, callback) => {\n    modified = true\n    return originalStdoutWrite.call(stdout, chunk, encoding, callback)\n  }\n  stderr.write = (chunk, encoding, callback) => {\n    modified = true\n    return originalStdErrWrite.call(stderr, chunk, encoding, callback)\n  }\n\n  const uninstall = () => {\n    stdout.write = originalStdoutWrite\n    stderr.write = originalStdErrWrite\n  }\n\n  return () => {\n    uninstall()\n    return modified\n  }\n}\n",
    "import { require } from \"../require.js\"\n\nconst humanizeDuration = require(\"humanize-duration\")\n\nexport const formatDuration = (duration) => {\n  return humanizeDuration(duration, { largest: 2, maxDecimalPoints: 2 })\n}\n",
    "import { magenta, yellow, red, green, ansiResetSequence } from \"./ansi.js\"\nimport { formatDuration } from \"./formatDuration.js\"\n\nexport const createSummaryLog = (summary) => `\n-------------- summary -----------------\n${createSummaryMessage(summary)}${createTotalDurationMessage(summary)}\n----------------------------------------\n`\n\nconst createSummaryMessage = ({\n  executionCount,\n  disconnectedCount,\n  timedoutCount,\n  erroredCount,\n  completedCount,\n}) => {\n  if (executionCount === 0) return `0 execution.`\n\n  return `${executionCount} execution: ${createSummaryDetails({\n    executionCount,\n    disconnectedCount,\n    timedoutCount,\n    erroredCount,\n    completedCount,\n  })}.`\n}\n\nexport const createSummaryDetails = ({\n  executionCount,\n  disconnectedCount,\n  timedoutCount,\n  erroredCount,\n  completedCount,\n}) => {\n  if (disconnectedCount === executionCount) {\n    return createAllDisconnectedDetails()\n  }\n  if (timedoutCount === executionCount) {\n    return createAllTimedoutDetails()\n  }\n  if (erroredCount === executionCount) {\n    return createAllErroredDetails()\n  }\n  if (completedCount === executionCount) {\n    return createAllCompletedDetails()\n  }\n\n  return createMixedDetails({\n    executionCount,\n    disconnectedCount,\n    timedoutCount,\n    erroredCount,\n    completedCount,\n  })\n}\n\nconst createAllDisconnectedDetails = () => `all ${magenta}disconnected${ansiResetSequence}`\n\nconst createAllTimedoutDetails = () => `all ${yellow}timedout${ansiResetSequence}`\n\nconst createAllErroredDetails = () => `all ${red}errored${ansiResetSequence}`\n\nconst createAllCompletedDetails = () => `all ${green}completed${ansiResetSequence}`\n\nconst createMixedDetails = ({ disconnectedCount, timedoutCount, erroredCount, completedCount }) => {\n  const parts = []\n\n  if (disconnectedCount) {\n    parts.push(`${disconnectedCount} ${magenta}disconnected${ansiResetSequence}`)\n  }\n\n  if (timedoutCount) {\n    parts.push(`${timedoutCount} ${yellow}timed out${ansiResetSequence}`)\n  }\n\n  if (erroredCount) {\n    parts.push(`${erroredCount} ${red}errored${ansiResetSequence}`)\n  }\n\n  if (completedCount) {\n    parts.push(`${completedCount} ${green}completed${ansiResetSequence}`)\n  }\n\n  return `${parts.join(\", \")}`\n}\n\nconst createTotalDurationMessage = ({ startMs, endMs }) => {\n  if (!endMs) return \"\"\n\n  return `\ntotal duration: ${formatDuration(endMs - startMs)}`\n}\n",
    "import { magenta, cross, yellow, green, checkmark, grey, red, ansiResetSequence } from \"./ansi.js\"\nimport { formatDuration } from \"./formatDuration.js\"\nimport { createSummaryDetails } from \"./createSummaryLog.js\"\n\nexport const createExecutionResultLog = (\n  {\n    status,\n    fileRelativeUrl,\n    allocatedMs,\n    runtimeName,\n    runtimeVersion,\n    consoleCalls,\n    startMs,\n    endMs,\n    error,\n    executionIndex,\n  },\n  {\n    completedExecutionLogAbbreviation,\n    executionCount,\n    disconnectedCount,\n    timedoutCount,\n    erroredCount,\n    completedCount,\n  },\n) => {\n  const executionNumber = executionIndex + 1\n  const summary = `(${createSummaryDetails({\n    executionCount: executionNumber,\n    disconnectedCount,\n    timedoutCount,\n    erroredCount,\n    completedCount,\n  })})`\n\n  const runtime = `${runtimeName}/${runtimeVersion}`\n\n  if (status === \"completed\") {\n    if (completedExecutionLogAbbreviation) {\n      return `\n${green}${checkmark} execution ${executionNumber} of ${executionCount} completed${ansiResetSequence} ${summary}.`\n    }\n\n    return `\n${green}${checkmark} execution ${executionNumber} of ${executionCount} completed${ansiResetSequence} ${summary}.\nfile: ${fileRelativeUrl}\nruntime: ${runtime}${appendDuration({\n      startMs,\n      endMs,\n    })}${appendConsole(consoleCalls)}${appendError(error)}`\n  }\n\n  if (status === \"disconnected\") {\n    return `\n${magenta}${cross} execution ${executionNumber} of ${executionCount} disconnected${ansiResetSequence} ${summary}.\nfile: ${fileRelativeUrl}\nruntime: ${runtime}${appendDuration({\n      startMs,\n      endMs,\n    })}${appendConsole(consoleCalls)}${appendError(error)}`\n  }\n\n  if (status === \"timedout\") {\n    return `\n${yellow}${cross} execution ${executionNumber} of ${executionCount} timeout after ${allocatedMs}ms${ansiResetSequence} ${summary}.\nfile: ${fileRelativeUrl}\nruntime: ${runtime}${appendDuration({\n      startMs,\n      endMs,\n    })}${appendConsole(consoleCalls)}${appendError(error)}`\n  }\n\n  return `\n${red}${cross} execution ${executionNumber} of ${executionCount} error${ansiResetSequence} ${summary}.\nfile: ${fileRelativeUrl}\nruntime: ${runtime}${appendDuration({\n    startMs,\n    endMs,\n  })}${appendConsole(consoleCalls)}${appendError(error)}`\n}\n\nconst appendDuration = ({ endMs, startMs }) => {\n  if (!endMs) return \"\"\n\n  return `\nduration: ${formatDuration(endMs - startMs)}`\n}\n\nconst appendConsole = (consoleCalls) => {\n  if (!consoleCalls || consoleCalls.length === 0) return \"\"\n\n  const consoleOutput = consoleCalls.reduce((previous, { text }) => {\n    return `${previous}${text}`\n  }, \"\")\n\n  const consoleOutputTrimmed = consoleOutput.trim()\n  if (consoleOutputTrimmed === \"\") return \"\"\n\n  return `\n${grey}-------- console --------${ansiResetSequence}\n${consoleOutputTrimmed}\n${grey}-------------------------${ansiResetSequence}`\n}\n\nconst appendError = (error) => {\n  if (!error) return ``\n  return `\nerror: ${error.stack}`\n}\n\nexport const createShortExecutionResultLog = () => {\n  return `Execution completed (2/9) - (all completed)`\n}\n",
    "/* eslint-disable import/max-dependencies */\nimport { cpus } from \"os\"\nimport { stat } from \"fs\"\nimport {\n  createConcurrentOperations,\n  createCancellationSource,\n  composeCancellationToken,\n} from \"@jsenv/cancellation\"\nimport { loggerToLevels } from \"@jsenv/logger\"\nimport { urlToFileSystemPath } from \"@jsenv/util\"\nimport { require } from \"../require.js\"\nimport { launchAndExecute } from \"../executing/launchAndExecute.js\"\nimport { reportToCoverageMap } from \"./coverage/reportToCoverageMap.js\"\nimport { writeLog } from \"./writeLog.js\"\nimport { createExecutionResultLog } from \"./executionLogs.js\"\nimport { createSummaryLog } from \"./createSummaryLog.js\"\n\nconst wrapAnsi = require(\"wrap-ansi\")\n\nexport const executeConcurrently = async (\n  executionSteps,\n  {\n    cancellationToken,\n    logger,\n    executionLogLevel,\n\n    projectDirectoryUrl,\n    outDirectoryRelativeUrl,\n    compileServerOrigin,\n\n    babelPluginMap,\n\n    concurrencyLimit = Math.max(cpus.length - 1, 1),\n    executionDefaultOptions = {},\n    stopAfterExecute,\n    logSummary,\n    completedExecutionLogMerging,\n    completedExecutionLogAbbreviation,\n\n    coverage,\n    coverageConfig,\n    coverageIncludeMissing,\n\n    ...rest\n  },\n) => {\n  if (typeof compileServerOrigin !== \"string\") {\n    throw new TypeError(`compileServerOrigin must be a string, got ${compileServerOrigin}`)\n  }\n\n  const executionOptionsFromDefault = {\n    allocatedMs: 30000,\n    measureDuration: true,\n    // mirrorConsole: false because file will be executed in parallel\n    // so log would be a mess to read\n    mirrorConsole: false,\n    captureConsole: true,\n    collectRuntimeName: true,\n    collectRuntimeVersion: true,\n    collectCoverage: coverage,\n\n    mainFileNotFoundCallback: ({ fileRelativeUrl }) => {\n      logger.error(\n        new Error(`an execution main file does not exists.\n--- file relative path ---\n${fileRelativeUrl}`),\n      )\n    },\n    beforeExecutionCallback: () => {},\n    afterExecutionCallback: () => {},\n    ...executionDefaultOptions,\n  }\n\n  const startMs = Date.now()\n\n  const allExecutionDoneCancellationSource = createCancellationSource()\n  const executionCancellationToken = composeCancellationToken(\n    cancellationToken,\n    allExecutionDoneCancellationSource.token,\n  )\n\n  const report = {}\n  const executionCount = executionSteps.length\n\n  let previousExecutionResult\n  let previousExecutionLog\n  let disconnectedCount = 0\n  let timedoutCount = 0\n  let erroredCount = 0\n  let completedCount = 0\n  await createConcurrentOperations({\n    cancellationToken,\n    concurrencyLimit,\n    array: executionSteps,\n    start: async (executionOptionsFromStep) => {\n      const executionIndex = executionSteps.indexOf(executionOptionsFromStep)\n      const executionOptions = {\n        ...executionOptionsFromDefault,\n        ...executionOptionsFromStep,\n      }\n\n      const {\n        name,\n        executionId,\n        fileRelativeUrl,\n        launch,\n        allocatedMs,\n        measureDuration,\n        mirrorConsole,\n        captureConsole,\n        collectRuntimeName,\n        collectRuntimeVersion,\n        collectCoverage,\n\n        mainFileNotFoundCallback,\n        beforeExecutionCallback,\n        afterExecutionCallback,\n        gracefulStopAllocatedMs,\n      } = executionOptions\n\n      const beforeExecutionInfo = {\n        allocatedMs,\n        name,\n        executionId,\n        fileRelativeUrl,\n        executionIndex,\n      }\n\n      const filePath = urlToFileSystemPath(`${projectDirectoryUrl}${fileRelativeUrl}`)\n      const fileExists = await pathLeadsToFile(filePath)\n      if (!fileExists) {\n        mainFileNotFoundCallback(beforeExecutionInfo)\n        return\n      }\n\n      beforeExecutionCallback(beforeExecutionInfo)\n      const executionResult = await launchAndExecute({\n        cancellationToken: executionCancellationToken,\n        executionLogLevel,\n        launch: (params) =>\n          launch({\n            projectDirectoryUrl,\n            outDirectoryRelativeUrl,\n            compileServerOrigin,\n            ...params,\n          }),\n        allocatedMs,\n        measureDuration,\n        collectRuntimeName,\n        collectRuntimeVersion,\n        mirrorConsole,\n        captureConsole,\n        gracefulStopAllocatedMs,\n        stopAfterExecute,\n        stopAfterExecuteReason: \"execution-done\",\n        executionId,\n        fileRelativeUrl,\n        collectCoverage,\n\n        ...rest,\n      })\n      const afterExecutionInfo = {\n        ...beforeExecutionInfo,\n        ...executionResult,\n      }\n      afterExecutionCallback(afterExecutionInfo)\n\n      if (executionResult.status === \"timedout\") {\n        timedoutCount++\n      } else if (executionResult.status === \"disconnected\") {\n        disconnectedCount++\n      } else if (executionResult.status === \"errored\") {\n        erroredCount++\n      } else if (executionResult.status === \"completed\") {\n        completedCount++\n      }\n\n      if (loggerToLevels(logger).info) {\n        let log = createExecutionResultLog(afterExecutionInfo, {\n          completedExecutionLogAbbreviation,\n          executionCount,\n          disconnectedCount,\n          timedoutCount,\n          erroredCount,\n          completedCount,\n        })\n        const { columns = 80 } = process.stdout\n        log = wrapAnsi(log, columns, {\n          trim: false,\n          hard: true,\n          wordWrap: false,\n        })\n\n        if (\n          previousExecutionLog &&\n          completedExecutionLogMerging &&\n          previousExecutionResult &&\n          previousExecutionResult.status === \"completed\" &&\n          (previousExecutionResult.consoleCalls\n            ? previousExecutionResult.consoleCalls.length === 0\n            : true) &&\n          executionResult.status === \"completed\"\n        ) {\n          previousExecutionLog = previousExecutionLog.update(log)\n        } else {\n          previousExecutionLog = writeLog(log)\n        }\n      }\n\n      if (fileRelativeUrl in report === false) {\n        report[fileRelativeUrl] = {}\n      }\n      report[fileRelativeUrl][name] = executionResult\n      previousExecutionResult = executionResult\n    },\n  })\n\n  // tell everyone we are done\n  // (used to stop potential chrome browser still opened to be reused)\n  allExecutionDoneCancellationSource.cancel(\"all execution done\")\n\n  const summary = reportToSummary(report)\n  summary.startMs = startMs\n  summary.endMs = Date.now()\n\n  if (logSummary) {\n    logger.info(createSummaryLog(summary))\n  }\n\n  return {\n    summary,\n    report,\n    ...(coverage\n      ? {\n          coverageMap: await reportToCoverageMap(report, {\n            cancellationToken,\n            projectDirectoryUrl,\n            babelPluginMap,\n            coverageConfig,\n            coverageIncludeMissing,\n          }),\n        }\n      : {}),\n  }\n}\n\nconst pathLeadsToFile = (path) =>\n  new Promise((resolve, reject) => {\n    stat(path, (error, stats) => {\n      if (error) {\n        if (error.code === \"ENOENT\") {\n          resolve(false)\n        } else {\n          reject(error)\n        }\n      } else {\n        resolve(stats.isFile())\n      }\n    })\n  })\n\nconst reportToSummary = (report) => {\n  const fileNames = Object.keys(report)\n  const executionCount = fileNames.reduce((previous, fileName) => {\n    return previous + Object.keys(report[fileName]).length\n  }, 0)\n\n  const countResultMatching = (predicate) => {\n    return fileNames.reduce((previous, fileName) => {\n      const fileExecutionResult = report[fileName]\n\n      return (\n        previous +\n        Object.keys(fileExecutionResult).filter((executionName) => {\n          const fileExecutionResultForRuntime = fileExecutionResult[executionName]\n          return predicate(fileExecutionResultForRuntime)\n        }).length\n      )\n    }, 0)\n  }\n\n  const disconnectedCount = countResultMatching(({ status }) => status === \"disconnected\")\n  const timedoutCount = countResultMatching(({ status }) => status === \"timedout\")\n  const erroredCount = countResultMatching(({ status }) => status === \"errored\")\n  const completedCount = countResultMatching(({ status }) => status === \"completed\")\n\n  return {\n    executionCount,\n    disconnectedCount,\n    timedoutCount,\n    erroredCount,\n    completedCount,\n  }\n}\n",
    "import { startCompileServer } from \"../compiling/startCompileServer.js\"\nimport { babelPluginInstrument } from \"./coverage/babel-plugin-instrument.js\"\nimport { generateExecutionSteps } from \"./generateExecutionSteps.js\"\nimport { executeConcurrently } from \"./executeConcurrently.js\"\n\nexport const executePlan = async (\n  plan,\n  {\n    cancellationToken,\n    compileServerLogLevel,\n    logger,\n    executionLogLevel,\n\n    projectDirectoryUrl,\n    jsenvDirectoryRelativeUrl,\n    jsenvDirectoryClean,\n    importMapFileRelativeUrl,\n    importDefaultExtension,\n\n    compileServerProtocol,\n    compileServerPrivateKey,\n    compileServerCertificate,\n    compileServerIp,\n    compileServerPort,\n    babelPluginMap,\n    convertMap,\n    compileGroupCount,\n\n    concurrencyLimit,\n    executionDefaultOptions,\n    stopAfterExecute,\n    completedExecutionLogMerging,\n    completedExecutionLogAbbreviation,\n    logSummary,\n\n    // coverage parameters\n    coverage,\n    coverageConfig,\n    coverageIncludeMissing,\n\n    ...rest\n  } = {},\n) => {\n  if (coverage) {\n    babelPluginMap = {\n      ...babelPluginMap,\n      \"transform-instrument\": [babelPluginInstrument, { projectDirectoryUrl, coverageConfig }],\n    }\n  }\n\n  const { origin: compileServerOrigin, outDirectoryRelativeUrl, stop } = await startCompileServer({\n    cancellationToken,\n    compileServerLogLevel,\n\n    projectDirectoryUrl,\n    jsenvDirectoryRelativeUrl,\n    jsenvDirectoryClean,\n    importMapFileRelativeUrl,\n    importDefaultExtension,\n\n    compileServerProtocol,\n    compileServerPrivateKey,\n    compileServerCertificate,\n    compileServerIp,\n    compileServerPort,\n    keepProcessAlive: true, // to be sure it stays alive\n    babelPluginMap,\n    convertMap,\n    compileGroupCount,\n  })\n\n  const executionSteps = await generateExecutionSteps(\n    {\n      ...plan,\n      [outDirectoryRelativeUrl]: null,\n    },\n    {\n      cancellationToken,\n      projectDirectoryUrl,\n    },\n  )\n\n  const executionResult = await executeConcurrently(executionSteps, {\n    cancellationToken,\n    logger,\n    executionLogLevel,\n\n    projectDirectoryUrl,\n    outDirectoryRelativeUrl,\n    compileServerOrigin,\n    importMapFileRelativeUrl,\n    importDefaultExtension,\n\n    babelPluginMap,\n\n    stopAfterExecute,\n    concurrencyLimit,\n    executionDefaultOptions,\n    completedExecutionLogMerging,\n    completedExecutionLogAbbreviation,\n    logSummary,\n\n    coverage,\n    coverageConfig,\n    coverageIncludeMissing,\n\n    ...rest,\n  })\n\n  stop(\"all execution done\")\n\n  return executionResult\n}\n",
    "export const executionIsPassed = ({ summary }) => summary.executionCount === summary.completedCount\n",
    "import { writeFile } from \"@jsenv/util\"\n\nexport const generateCoverageJsonFile = async (coverageMap, coverageJsonFileUrl) => {\n  await writeFile(coverageJsonFileUrl, JSON.stringify(coverageMap, null, \"  \"))\n}\n",
    "import { resolveUrl, urlToFileSystemPath } from \"@jsenv/util\"\nimport { require } from \"../../require.js\"\n\nconst { readFileSync } = require(\"fs\")\n\nexport const generateCoverageHtmlDirectory = async (\n  coverageMap,\n  htmlDirectoryRelativeUrl,\n  projectDirectoryUrl,\n) => {\n  const libReport = require(\"istanbul-lib-report\")\n  const reports = require(\"istanbul-reports\")\n  const { createCoverageMap } = require(\"istanbul-lib-coverage\")\n\n  const context = libReport.createContext({\n    dir: urlToFileSystemPath(projectDirectoryUrl),\n    coverageMap: createCoverageMap(coverageMap),\n    sourceFinder: (path) => {\n      return readFileSync(urlToFileSystemPath(resolveUrl(path, projectDirectoryUrl)), \"utf8\")\n    },\n  })\n\n  const report = reports.create(\"html\", {\n    skipEmpty: true,\n    skipFull: true,\n    subdir: htmlDirectoryRelativeUrl,\n  })\n  report.execute(context)\n}\n",
    "import { require } from \"../../require.js\"\n\nexport const generateCoverageTextLog = (coverageMap) => {\n  const libReport = require(\"istanbul-lib-report\")\n  const reports = require(\"istanbul-reports\")\n  const { createCoverageMap } = require(\"istanbul-lib-coverage\")\n\n  const context = libReport.createContext({\n    coverageMap: createCoverageMap(coverageMap),\n  })\n  const report = reports.create(\"text\", {\n    skipEmpty: true,\n    skipFull: true,\n  })\n  report.execute(context)\n}\n",
    "export const jsenvCoverageConfig = {\n  \"./index.js\": true,\n  \"./main.js\": true,\n  \"./src/**/*.js\": true,\n  \"./**/*.test.*\": false, // contains .test. -> nope\n  \"./**/test/\": false, // inside a test folder -> nope,\n}\n",
    "/* eslint-disable import/max-dependencies */\nimport { createCancellationTokenForProcess } from \"@jsenv/cancellation\"\nimport {\n  normalizeStructuredMetaMap,\n  urlToFileSystemPath,\n  ensureEmptyDirectory,\n  resolveDirectoryUrl,\n  urlToMeta,\n  resolveUrl,\n} from \"@jsenv/util\"\nimport { createLogger } from \"@jsenv/logger\"\nimport { executeJsenvAsyncFunction } from \"./internal/executeJsenvAsyncFunction.js\"\nimport { assertProjectDirectoryUrl, assertProjectDirectoryExists } from \"./internal/argUtils.js\"\nimport { executePlan } from \"./internal/executing/executePlan.js\"\nimport { executionIsPassed } from \"./internal/executing/executionIsPassed.js\"\nimport { generateCoverageJsonFile } from \"./internal/executing/coverage/generateCoverageJsonFile.js\"\nimport { generateCoverageHtmlDirectory } from \"./internal/executing/coverage/generateCoverageHtmlDirectory.js\"\nimport { generateCoverageTextLog } from \"./internal/executing/coverage/generateCoverageTextLog.js\"\nimport { jsenvCoverageConfig } from \"./jsenvCoverageConfig.js\"\n\nexport const executeTestPlan = async ({\n  cancellationToken = createCancellationTokenForProcess(),\n  logLevel = \"info\",\n  compileServerLogLevel = \"warn\",\n  executionLogLevel = \"warn\",\n\n  projectDirectoryUrl,\n  jsenvDirectoryRelativeUrl,\n  jsenvDirectoryClean,\n  importMapFileRelativeUrl,\n  importDefaultExtension,\n\n  compileServerProtocol,\n  compileServerPrivateKey,\n  compileServerCertificate,\n  compileServerIp,\n  compileServerPort,\n  babelPluginMap,\n  convertMap,\n  compileGroupCount = 2,\n\n  testPlan,\n  concurrencyLimit,\n  executionDefaultOptions = {},\n  // stopAfterExecute: true to ensure runtime is stopped once executed\n  // because we have what we wants: execution is completed and\n  // we have associated coverageMap and capturedConsole\n  // you can still pass false to debug what happens\n  // meaning all node process and browsers launched stays opened\n  stopAfterExecute = true,\n  completedExecutionLogAbbreviation = false,\n  completedExecutionLogMerging = false,\n  logSummary = true,\n  updateProcessExitCode = true,\n\n  coverage = process.argv.includes(\"--cover\") || process.argv.includes(\"--coverage\"),\n  coverageConfig = jsenvCoverageConfig,\n  coverageIncludeMissing = true,\n  coverageAndExecutionAllowed = false,\n  coverageTextLog = true,\n  coverageJsonFile = Boolean(process.env.CI),\n  coverageJsonFileLog = true,\n  coverageJsonFileRelativeUrl = \"./coverage/coverage.json\",\n  coverageHtmlDirectory = !process.env.CI,\n  coverageHtmlDirectoryRelativeUrl = \"./coverage\",\n  coverageHtmlDirectoryIndexLog = true,\n\n  // for chromiumExecutablePath, firefoxExecutablePath and webkitExecutablePath\n  // but we need something angostic that just forward the params hence using ...rest\n  ...rest\n}) => {\n  return executeJsenvAsyncFunction(async () => {\n    const logger = createLogger({ logLevel })\n\n    cancellationToken.register((cancelError) => {\n      if (cancelError.reason === \"process SIGINT\") {\n        logger.info(`process SIGINT -> cancelling test execution`)\n      }\n    })\n\n    projectDirectoryUrl = assertProjectDirectoryUrl({ projectDirectoryUrl })\n    await assertProjectDirectoryExists({ projectDirectoryUrl })\n\n    if (typeof testPlan !== \"object\") {\n      throw new Error(`testPlan must be an object, got ${testPlan}`)\n    }\n\n    if (coverage) {\n      if (typeof coverageConfig !== \"object\") {\n        throw new TypeError(`coverageConfig must be an object, got ${coverageConfig}`)\n      }\n      if (Object.keys(coverageConfig).length === 0) {\n        logger.warn(\n          `coverageConfig is an empty object. Nothing will be instrumented for coverage so your coverage will be empty`,\n        )\n      }\n      if (!coverageAndExecutionAllowed) {\n        const structuredMetaMapForExecute = normalizeStructuredMetaMap(\n          {\n            execute: testPlan,\n          },\n          \"file:///\",\n        )\n        const structuredMetaMapForCover = normalizeStructuredMetaMap(\n          {\n            cover: coverageConfig,\n          },\n          \"file:///\",\n        )\n        const patternsMatchingCoverAndExecute = Object.keys(\n          structuredMetaMapForExecute.execute,\n        ).filter((testPlanPattern) => {\n          return urlToMeta({\n            url: testPlanPattern,\n            structuredMetaMap: structuredMetaMapForCover,\n          }).cover\n        })\n\n        if (patternsMatchingCoverAndExecute.length) {\n          // I think it is an error, it would be strange, for a given file\n          // to be both covered and executed\n          throw new Error(`some file will be both covered and executed\n--- patterns ---\n${patternsMatchingCoverAndExecute.join(\"\\n\")}`)\n        }\n      }\n    }\n\n    const result = await executePlan(testPlan, {\n      cancellationToken,\n      compileServerLogLevel,\n      logger,\n      executionLogLevel,\n\n      projectDirectoryUrl,\n      jsenvDirectoryRelativeUrl,\n      jsenvDirectoryClean,\n      importMapFileRelativeUrl,\n      importDefaultExtension,\n\n      compileServerProtocol,\n      compileServerPrivateKey,\n      compileServerCertificate,\n      compileServerIp,\n      compileServerPort,\n      babelPluginMap,\n      convertMap,\n      compileGroupCount,\n\n      concurrencyLimit,\n      executionDefaultOptions,\n      stopAfterExecute,\n      completedExecutionLogMerging,\n      completedExecutionLogAbbreviation,\n      logSummary,\n\n      coverage,\n      coverageConfig,\n      coverageIncludeMissing,\n\n      ...rest,\n    })\n\n    if (updateProcessExitCode && !executionIsPassed(result)) {\n      process.exitCode = 1\n    }\n\n    const promises = []\n    // keep this one first because it does ensureEmptyDirectory\n    // and in case coverage json file gets written in the same directory\n    // it must be done before\n    if (coverage && coverageHtmlDirectory) {\n      const coverageHtmlDirectoryUrl = resolveDirectoryUrl(\n        coverageHtmlDirectoryRelativeUrl,\n        projectDirectoryUrl,\n      )\n      await ensureEmptyDirectory(coverageHtmlDirectoryUrl)\n      if (coverageHtmlDirectoryIndexLog) {\n        const htmlCoverageDirectoryIndexFileUrl = `${coverageHtmlDirectoryUrl}index.html`\n        logger.info(`-> ${urlToFileSystemPath(htmlCoverageDirectoryIndexFileUrl)}`)\n      }\n      promises.push(\n        generateCoverageHtmlDirectory(\n          result.coverageMap,\n          coverageHtmlDirectoryRelativeUrl,\n          projectDirectoryUrl,\n        ),\n      )\n    }\n    if (coverage && coverageJsonFile) {\n      const coverageJsonFileUrl = resolveUrl(coverageJsonFileRelativeUrl, projectDirectoryUrl)\n      if (coverageJsonFileLog) {\n        logger.info(`-> ${urlToFileSystemPath(coverageJsonFileUrl)}`)\n      }\n      promises.push(generateCoverageJsonFile(result.coverageMap, coverageJsonFileUrl))\n    }\n    if (coverage && coverageTextLog) {\n      promises.push(generateCoverageTextLog(result.coverageMap))\n    }\n    await Promise.all(promises)\n\n    return result\n  })\n}\n",
    "import { computeBabelPluginMapForRuntime } from \"./internal/generateGroupMap/computeBabelPluginMapForRuntime.js\"\nimport { jsenvBabelPluginMap } from \"./jsenvBabelPluginMap.js\"\n\nexport const getBabelPluginMapForNode = ({\n  babelPluginMap = jsenvBabelPluginMap,\n  nodeMinimumVersion = decideNodeMinimumVersion(),\n} = {}) => {\n  const babelPluginMapForNode = computeBabelPluginMapForRuntime({\n    babelPluginMap,\n    runtimeName: \"node\",\n    runtimeVersion: nodeMinimumVersion,\n  })\n  return babelPluginMapForNode\n}\n\nconst decideNodeMinimumVersion = () => {\n  return process.version.slice(1)\n}\n",
    "export const jsenvExplorableConfig = {\n  source: {\n    \"./*.html\": true,\n    \"./src/**/*.html\": true,\n  },\n  test: {\n    \"./test/**/*.html\": true,\n  },\n}\n",
    "import { generateContentHash } from \"./internal/building/url-versioning.js\"\n\nexport const jsenvServiceWorkerFinalizer = (code, { buildManifest, rollupBuild }) => {\n  const generatedUrlsConfig = {}\n  Object.keys(buildManifest).forEach((projectRelativeUrl) => {\n    if (projectRelativeUrl.endsWith(\".map\")) {\n      return\n    }\n    const buildRelativeUrl = buildManifest[projectRelativeUrl]\n    const versioned = fileNameContainsHash(buildRelativeUrl)\n    const rollupFile = rollupBuild[buildRelativeUrl]\n\n    generatedUrlsConfig[buildRelativeUrl] = {\n      versioned,\n      ...(versioned\n        ? {}\n        : {\n            // when url is not versioned we compute a \"version\" for that url anyway\n            // so that service worker source still changes and navigator\n            // detect there is a change\n            version: generateContentHash(\n              rollupFile.type === \"chunk\" ? rollupFile.code : rollupFile.source,\n            ),\n          }),\n    }\n  })\n\n  return `\nself.generatedUrlsConfig = ${JSON.stringify(generatedUrlsConfig, null, \"  \")}\n${code}\n`\n}\n\nconst fileNameContainsHash = (fileName) => /-[a-z0-9]{8,}(\\..*?)?$/.test(fileName)\n",
    "import { memoize } from \"@jsenv/util\"\n\nexport const trackRessources = () => {\n  const callbackArray = []\n\n  const registerCleanupCallback = (callback) => {\n    if (typeof callback !== \"function\")\n      throw new TypeError(`callback must be a function\ncallback: ${callback}`)\n    callbackArray.push(callback)\n    return () => {\n      const index = callbackArray.indexOf(callback)\n      if (index > -1) callbackArray.splice(index, 1)\n    }\n  }\n\n  const cleanup = memoize(async (reason) => {\n    const localCallbackArray = callbackArray.slice()\n    await Promise.all(localCallbackArray.map((callback) => callback(reason)))\n  })\n\n  return { registerCleanupCallback, cleanup }\n}\n",
    "export const trackPageToNotify = (page, { onError, onConsole }) => {\n  // https://github.com/GoogleChrome/puppeteer/blob/v1.4.0/docs/api.md#event-error\n  const removeErrorListener = registerEvent({\n    object: page,\n    eventType: \"error\",\n    callback: onError,\n  })\n\n  // https://github.com/GoogleChrome/puppeteer/blob/v1.4.0/docs/api.md#event-pageerror\n  const removePageErrorListener = registerEvent({\n    object: page,\n    eventType: \"pageerror\",\n    callback: onError,\n  })\n\n  // https://github.com/GoogleChrome/puppeteer/blob/v1.4.0/docs/api.md#event-console\n  const removeConsoleListener = registerEvent({\n    object: page,\n    eventType: \"console\",\n    // https://github.com/microsoft/playwright/blob/master/docs/api.md#event-console\n    callback: async (consoleMessage) => {\n      onConsole({\n        type: consoleMessage.type(),\n        text: appendNewLine(extractTextFromConsoleMessage(consoleMessage)),\n      })\n    },\n  })\n\n  return () => {\n    removeErrorListener()\n    removePageErrorListener()\n    removeConsoleListener()\n  }\n}\n\nconst appendNewLine = (string) => `${string}\n`\n\nconst extractTextFromConsoleMessage = (consoleMessage) => {\n  return consoleMessage.text()\n  // ensure we use a string so that istanbul won't try\n  // to put any coverage statement inside it\n  // ideally we should use uneval no ?\n  // eslint-disable-next-line no-new-func\n  //   const functionEvaluatedBrowserSide = new Function(\n  //     \"value\",\n  //     `if (value instanceof Error) {\n  //   return value.stack\n  // }\n  // return value`,\n  //   )\n  //   const argValues = await Promise.all(\n  //     message.args().map(async (arg) => {\n  //       const jsHandle = arg\n  //       try {\n  //         return await jsHandle.executionContext().evaluate(functionEvaluatedBrowserSide, jsHandle)\n  //       } catch (e) {\n  //         return String(jsHandle)\n  //       }\n  //     }),\n  //   )\n  //   const text = argValues.reduce((previous, value, index) => {\n  //     let string\n  //     if (typeof value === \"object\") string = JSON.stringify(value, null, \"  \")\n  //     else string = String(value)\n  //     if (index === 0) return `${previous}${string}`\n  //     return `${previous} ${string}`\n  //   }, \"\")\n  //   return text\n}\n\nconst registerEvent = ({ object, eventType, callback }) => {\n  object.on(eventType, callback)\n  return () => {\n    object.removeListener(eventType, callback)\n  }\n}\n",
    "export const createSharing = ({ argsToId = argsToIdFallback } = {}) => {\n  const tokenMap = {}\n\n  const getSharingToken = (...args) => {\n    const id = argsToId(args)\n\n    if (id in tokenMap) {\n      return tokenMap[id]\n    }\n\n    const sharingToken = createSharingToken({\n      unusedCallback: () => {\n        delete tokenMap[id]\n      },\n    })\n    tokenMap[id] = sharingToken\n    return sharingToken\n  }\n\n  const getUniqueSharingToken = () => {\n    return createSharingToken()\n  }\n\n  return { getSharingToken, getUniqueSharingToken }\n}\n\nconst createSharingToken = ({ unusedCallback = () => {} } = {}) => {\n  let useCount = 0\n  let sharedValue\n  let cleanup\n  const sharingToken = {\n    isUsed: () => useCount > 0,\n\n    setSharedValue: (value, cleanupFunction = () => {}) => {\n      sharedValue = value\n      cleanup = cleanupFunction\n    },\n\n    useSharedValue: () => {\n      useCount++\n\n      let stopped = false\n      let stopUsingReturnValue\n      const stopUsing = () => {\n        // ensure if stopUsing is called many times\n        // it returns the same value and does not decrement useCount more than once\n        if (stopped) {\n          return stopUsingReturnValue\n        }\n\n        stopped = true\n        useCount--\n        if (useCount === 0) {\n          unusedCallback()\n          sharedValue = undefined\n          stopUsingReturnValue = cleanup()\n        } else {\n          stopUsingReturnValue = undefined\n        }\n\n        return stopUsingReturnValue\n      }\n\n      return [sharedValue, stopUsing]\n    },\n  }\n  return sharingToken\n}\n\nconst argsToIdFallback = (args) => JSON.stringify(args)\n",
    "import { Script } from \"vm\"\n\nexport const evalSource = (code, filePath) => {\n  const script = new Script(code, { filename: filePath })\n  return script.runInThisContext()\n}\n",
    "// https://github.com/benjamingr/RegExp.escape/blob/master/polyfill.js\n\nexport const escapeRegexpSpecialCharacters = (string) => {\n  string = String(string)\n  let i = 0\n  let escapedString = \"\"\n\n  while (i < string.length) {\n    const char = string[i]\n    i++\n    escapedString += isRegExpSpecialChar(char) ? `\\\\${char}` : char\n  }\n  return escapedString\n}\n\nconst isRegExpSpecialChar = (char) => regexpSpecialChars.indexOf(char) > -1\n\nconst regexpSpecialChars = [\n  \"/\",\n  \"^\",\n  \"\\\\\",\n  \"[\",\n  \"]\",\n  \"(\",\n  \")\",\n  \"{\",\n  \"}\",\n  \"?\",\n  \"+\",\n  \"*\",\n  \".\",\n  \"|\",\n  \"$\",\n]\n",
    "import { extname } from \"path\"\nimport { resolveUrl, assertFilePresence } from \"@jsenv/util\"\nimport { evalSource } from \"../runtime/createNodeRuntime/evalSource.js\"\nimport { escapeRegexpSpecialCharacters } from \"../escapeRegexpSpecialCharacters.js\"\nimport { composeCoverageMap } from \"../executing/coverage/composeCoverageMap.js\"\n\nexport const executeHtmlFile = async (\n  fileRelativeUrl,\n  {\n    cancellationToken,\n    projectDirectoryUrl,\n    outDirectoryRelativeUrl,\n    compileServerOrigin,\n    page,\n    collectCoverage,\n  },\n) => {\n  const fileUrl = resolveUrl(fileRelativeUrl, projectDirectoryUrl)\n  if (extname(fileUrl) !== \".html\") {\n    throw new Error(`the file to execute must use .html extension, received ${fileRelativeUrl}.`)\n  }\n\n  await assertFilePresence(fileUrl)\n\n  const compileDirectoryRelativeUrl = `${outDirectoryRelativeUrl}otherwise/`\n  const compileDirectoryRemoteUrl = resolveUrl(compileDirectoryRelativeUrl, compileServerOrigin)\n  const fileClientUrl = resolveUrl(fileRelativeUrl, compileDirectoryRemoteUrl)\n  await page.goto(fileClientUrl, { timeout: 0 })\n\n  await page.waitForFunction(\n    /* istanbul ignore next */\n    () => {\n      return Boolean(window.__jsenv__)\n    },\n    [],\n    { timeout: 0 },\n  )\n\n  let executionResult\n  try {\n    executionResult = await page.evaluate(\n      /* istanbul ignore next */\n      () => {\n        return window.__jsenv__.executionResultPromise\n      },\n    )\n  } catch (e) {\n    // if browser is closed due to cancellation\n    // before it is able to finish evaluate we can safely ignore\n    // and rethrow with current cancelError\n    if (\n      e.message.match(/^Protocol error \\(.*?\\): Target closed/) &&\n      cancellationToken.cancellationRequested\n    ) {\n      cancellationToken.throwIfRequested()\n    }\n\n    throw e\n  }\n\n  const { fileExecutionResultMap } = executionResult\n\n  const fileErrored = Object.keys(fileExecutionResultMap).find((fileRelativeUrl) => {\n    const fileExecutionResult = fileExecutionResultMap[fileRelativeUrl]\n    return fileExecutionResult.status === \"errored\"\n  })\n\n  if (!collectCoverage) {\n    Object.keys(fileExecutionResultMap).forEach((fileRelativeUrl) => {\n      delete fileExecutionResultMap[fileRelativeUrl].coverageMap\n    })\n  }\n\n  if (fileErrored) {\n    const { exceptionSource } = fileExecutionResultMap[fileErrored]\n    return {\n      status: \"errored\",\n      error: evalException(exceptionSource, { projectDirectoryUrl, compileServerOrigin }),\n      namespace: fileExecutionResultMap,\n      ...(collectCoverage ? { coverageMap: generateCoverageForPage(fileExecutionResultMap) } : {}),\n    }\n  }\n\n  return {\n    status: \"completed\",\n    namespace: fileExecutionResultMap,\n    ...(collectCoverage ? { coverageMap: generateCoverageForPage(fileExecutionResultMap) } : {}),\n  }\n}\n\nconst generateCoverageForPage = (fileExecutionResultMap) => {\n  const coverageMap = composeCoverageMap(\n    ...Object.keys(fileExecutionResultMap).map((fileRelativeUrl) => {\n      return fileExecutionResultMap[fileRelativeUrl].coverageMap || {}\n    }),\n  )\n  return coverageMap\n}\n\nconst evalException = (exceptionSource, { projectDirectoryUrl, compileServerOrigin }) => {\n  const error = evalSource(exceptionSource)\n\n  if (error && error instanceof Error) {\n    const remoteRootRegexp = new RegExp(\n      escapeRegexpSpecialCharacters(`${compileServerOrigin}/`),\n      \"g\",\n    )\n    error.stack = error.stack.replace(remoteRootRegexp, projectDirectoryUrl)\n    error.message = error.message.replace(remoteRootRegexp, projectDirectoryUrl)\n  }\n\n  return error\n}\n",
    "/* eslint-disable import/max-dependencies */\n// https://github.com/microsoft/playwright/blob/master/docs/api.md\n\nimport { createCancellationToken, createStoppableOperation } from \"@jsenv/cancellation\"\nimport { teardownSignal } from \"@jsenv/node-signals\"\nimport { trackRessources } from \"./internal/trackRessources.js\"\nimport { require } from \"./internal/require.js\"\nimport { fetchUrl } from \"./internal/fetchUrl.js\"\nimport { validateResponseStatusIsOk } from \"./internal/validateResponseStatusIsOk.js\"\nimport { trackPageToNotify } from \"./internal/browser-launcher/trackPageToNotify.js\"\nimport { createSharing } from \"./internal/browser-launcher/createSharing.js\"\nimport { executeHtmlFile } from \"./internal/browser-launcher/executeHtmlFile.js\"\n\nconst chromiumSharing = createSharing()\n\nexport const launchChromium = async ({\n  cancellationToken = createCancellationToken(),\n  chromiumExecutablePath,\n  browserServerLogLevel,\n\n  projectDirectoryUrl,\n  outDirectoryRelativeUrl,\n  compileServerOrigin,\n\n  headless = true,\n  // about debug check https://github.com/microsoft/playwright/blob/master/docs/api.md#browsertypelaunchserveroptions\n  debug = false,\n  debugPort = 0,\n  stopOnExit = true,\n  share = false,\n}) => {\n  const ressourceTracker = trackRessources()\n  const sharingToken = share\n    ? chromiumSharing.getSharingToken({ chromiumExecutablePath, headless, debug, debugPort })\n    : chromiumSharing.getUniqueSharingToken()\n\n  if (!sharingToken.isUsed()) {\n    const launchOperation = launchBrowser(\"chromium\", {\n      cancellationToken,\n      ressourceTracker,\n      options: {\n        headless,\n        executablePath: chromiumExecutablePath,\n        ...(debug ? { devtools: true } : {}),\n        args: [\n          // https://github.com/GoogleChrome/puppeteer/issues/1834\n          // https://github.com/GoogleChrome/puppeteer/blob/master/docs/troubleshooting.md#tips\n          // \"--disable-dev-shm-usage\",\n          ...(debug ? [`--remote-debugging-port=${debugPort}`] : []),\n        ],\n      },\n      stopOnExit,\n    })\n    sharingToken.setSharedValue(launchOperation)\n  }\n\n  const [launchOperation, stopUsingBrowser] = sharingToken.useSharedValue()\n  ressourceTracker.registerCleanupCallback(stopUsingBrowser)\n\n  const browser = await launchOperation\n\n  if (debug) {\n    // https://github.com/puppeteer/puppeteer/blob/v2.0.0/docs/api.md#browserwsendpoint\n    // https://chromedevtools.github.io/devtools-protocol/#how-do-i-access-the-browser-target\n    const webSocketEndpoint = browser.wsEndpoint()\n    const webSocketUrl = new URL(webSocketEndpoint)\n    const browserEndpoint = `http://${webSocketUrl.host}/json/version`\n    const browserResponse = await fetchUrl(browserEndpoint, {\n      cancellationToken,\n      ignoreHttpsError: true,\n    })\n    const { valid, message } = validateResponseStatusIsOk(browserResponse)\n    if (!valid) {\n      throw new Error(message)\n    }\n\n    const browserResponseObject = JSON.parse(browserResponse.body)\n    const { webSocketDebuggerUrl } = browserResponseObject\n    console.log(`Debugger listening on ${webSocketDebuggerUrl}`)\n  }\n\n  return {\n    browser,\n    name: \"chromium\",\n    version: \"82.0.4057.0\",\n    stop: ressourceTracker.cleanup,\n    ...browserToRuntimeHooks(browser, {\n      cancellationToken,\n      ressourceTracker,\n      browserServerLogLevel,\n\n      projectDirectoryUrl,\n      outDirectoryRelativeUrl,\n      compileServerOrigin,\n    }),\n  }\n}\n\nexport const launchChromiumTab = (namedArgs) =>\n  launchChromium({\n    share: true,\n    ...namedArgs,\n  })\n\nconst firefoxSharing = createSharing()\n\nexport const launchFirefox = async ({\n  cancellationToken = createCancellationToken(),\n  firefoxExecutablePath,\n  browserServerLogLevel,\n\n  projectDirectoryUrl,\n  outDirectoryRelativeUrl,\n  compileServerOrigin,\n\n  headless = true,\n  stopOnExit = true,\n  share = false,\n}) => {\n  const ressourceTracker = trackRessources()\n  const sharingToken = share\n    ? firefoxSharing.getSharingToken({ firefoxExecutablePath, headless })\n    : firefoxSharing.getUniqueSharingToken()\n\n  if (!sharingToken.isUsed()) {\n    const launchOperation = launchBrowser(\"firefox\", {\n      cancellationToken,\n      ressourceTracker,\n      options: {\n        headless,\n        executablePath: firefoxExecutablePath,\n      },\n      stopOnExit,\n    })\n    sharingToken.setSharedValue(launchOperation)\n  }\n\n  const [launchOperation, stopUsingBrowser] = sharingToken.useSharedValue()\n  ressourceTracker.registerCleanupCallback(stopUsingBrowser)\n\n  const browser = await launchOperation\n\n  return {\n    browser,\n    name: \"firefox\",\n    version: \"73.0b13\",\n    stop: ressourceTracker.cleanup,\n    ...browserToRuntimeHooks(browser, {\n      cancellationToken,\n      ressourceTracker,\n      browserServerLogLevel,\n\n      projectDirectoryUrl,\n      outDirectoryRelativeUrl,\n      compileServerOrigin,\n    }),\n  }\n}\n\nexport const launchFirefoxTab = (namedArgs) =>\n  launchFirefox({\n    share: true,\n    ...namedArgs,\n  })\n\nconst webkitSharing = createSharing()\n\nexport const launchWebkit = async ({\n  cancellationToken = createCancellationToken(),\n  webkitExecutablePath,\n  browserServerLogLevel,\n\n  projectDirectoryUrl,\n  outDirectoryRelativeUrl,\n  compileServerOrigin,\n\n  headless = true,\n  stopOnExit = true,\n  share = false,\n}) => {\n  const ressourceTracker = trackRessources()\n  const sharingToken = share\n    ? webkitSharing.getSharingToken({ webkitExecutablePath, headless })\n    : webkitSharing.getUniqueSharingToken()\n\n  if (!sharingToken.isUsed()) {\n    const launchOperation = launchBrowser(\"webkit\", {\n      cancellationToken,\n      ressourceTracker,\n      options: {\n        headless,\n        executablePath: webkitExecutablePath,\n      },\n      stopOnExit,\n    })\n    sharingToken.setSharedValue(launchOperation)\n  }\n\n  const [launchOperation, stopUsingBrowser] = sharingToken.useSharedValue()\n  ressourceTracker.registerCleanupCallback(stopUsingBrowser)\n\n  const browser = await launchOperation\n\n  return {\n    browser,\n    name: \"webkit\",\n    version: \"13.0.4\",\n    stop: ressourceTracker.cleanup,\n    ...browserToRuntimeHooks(browser, {\n      cancellationToken,\n      ressourceTracker,\n      browserServerLogLevel,\n\n      projectDirectoryUrl,\n      outDirectoryRelativeUrl,\n      compileServerOrigin,\n    }),\n  }\n}\n\nexport const launchWebkitTab = (namedArgs) =>\n  launchWebkit({\n    share: true,\n    ...namedArgs,\n  })\n\nconst launchBrowser = async (\n  browserName,\n  { cancellationToken, ressourceTracker, options, stopOnExit },\n) => {\n  // eslint-disable-next-line import/no-dynamic-require\n  const browserClass = require(`playwright-${browserName}`)[browserName]\n  const launchOperation = createStoppableOperation({\n    cancellationToken,\n    start: async () => {\n      if (stopOnExit) {\n        const unregisterProcessTeardown = teardownSignal.addCallback((reason) => {\n          unregisterProcessTeardown()\n          launchOperation.stop(`process ${reason}`)\n        })\n        ressourceTracker.registerCleanupCallback(unregisterProcessTeardown)\n        cancellationToken.register(unregisterProcessTeardown)\n      }\n\n      try {\n        const browser = await browserClass.launch({\n          ...options,\n          // let's handle them to close properly browser + remove listener\n          // instead of relying on playwright to do so\n          handleSIGINT: false,\n          handleSIGTERM: false,\n          handleSIGHUP: false,\n        })\n        return browser\n      } catch (e) {\n        if (cancellationToken.cancellationRequested && isTargetClosedError(e)) {\n          return e\n        }\n        throw e\n      }\n    },\n    stop: async (browser) => {\n      const disconnected = browser.isConnected()\n        ? new Promise((resolve) => {\n            const disconnectedCallback = () => {\n              browser.removeListener(\"disconnected\", disconnectedCallback)\n              resolve()\n            }\n            browser.on(\"disconnected\", disconnectedCallback)\n          })\n        : Promise.resolve()\n\n      // for some reason without this 100ms timeout\n      // browser.close() never resolves (playwright does not like something)\n      await new Promise((resolve) => setTimeout(resolve, 100))\n\n      await browser.close()\n      await disconnected\n    },\n  })\n  ressourceTracker.registerCleanupCallback(launchOperation.stop)\n\n  return launchOperation\n}\n\nconst browserToRuntimeHooks = (\n  browser,\n  {\n    cancellationToken,\n    ressourceTracker,\n\n    projectDirectoryUrl,\n    outDirectoryRelativeUrl,\n    compileServerOrigin,\n  },\n) => {\n  const disconnected = new Promise((resolve) => {\n    // https://github.com/GoogleChrome/puppeteer/blob/v1.4.0/docs/api.md#event-disconnected\n    browser.on(\"disconnected\", resolve)\n  })\n\n  const errorCallbackArray = []\n  const registerErrorCallback = (callback) => {\n    errorCallbackArray.push(callback)\n  }\n\n  const consoleCallbackArray = []\n  const registerConsoleCallback = (callback) => {\n    consoleCallbackArray.push(callback)\n  }\n\n  const executeFile = async (\n    fileRelativeUrl,\n    {\n      // because we use a self signed certificate\n      collectCoverage,\n      ignoreHTTPSErrors = true,\n    },\n  ) => {\n    // open a tab to execute to the file\n    const browserContext = await browser.newContext({ ignoreHTTPSErrors })\n    const page = await browserContext.newPage()\n    ressourceTracker.registerCleanupCallback(async () => {\n      try {\n        await browserContext.close()\n      } catch (e) {\n        if (isTargetClosedError(e)) {\n          return\n        }\n        throw e\n      }\n    })\n    // track tab error and console\n    const stopTrackingToNotify = trackPageToNotify(page, {\n      onError: (error) => {\n        errorCallbackArray.forEach((callback) => {\n          callback(error)\n        })\n      },\n      onConsole: ({ type, text }) => {\n        consoleCallbackArray.forEach((callback) => {\n          callback({ type, text })\n        })\n      },\n    })\n    ressourceTracker.registerCleanupCallback(stopTrackingToNotify)\n    return executeHtmlFile(fileRelativeUrl, {\n      cancellationToken,\n\n      projectDirectoryUrl,\n      outDirectoryRelativeUrl,\n      compileServerOrigin,\n\n      page,\n      collectCoverage,\n    })\n  }\n\n  return {\n    disconnected,\n    registerErrorCallback,\n    registerConsoleCallback,\n    executeFile,\n  }\n}\n\nconst isTargetClosedError = (error) => {\n  if (error.message.match(/Protocol error \\(.*?\\): Target closed/)) {\n    return true\n  }\n  if (error.message.match(/Protocol error \\(.*?\\): Browser has been closed/)) {\n    return true\n  }\n  return false\n}\n",
    "import { Script } from \"vm\"\nimport { readFileSync } from \"fs\"\nimport { resolveUrl, urlToFileSystemPath, memoize } from \"@jsenv/util\"\nimport { jsenvCoreDirectoryUrl } from \"./jsenvCoreDirectoryUrl.js\"\n\nexport const supportsDynamicImport = memoize(async () => {\n  const fileUrl = resolveUrl(\"./src/internal/dynamicImportSource.js\", jsenvCoreDirectoryUrl)\n  const filePath = urlToFileSystemPath(fileUrl)\n  const fileAsString = String(readFileSync(filePath))\n\n  try {\n    return await evalSource(fileAsString, filePath)\n  } catch (e) {\n    return false\n  }\n})\n\nconst evalSource = (code, filePath) => {\n  const script = new Script(code, {\n    filename: filePath,\n  })\n  return script.runInThisContext()\n}\n",
    "export const getCommandArgument = (argv, name) => {\n  let i = 0\n\n  while (i < argv.length) {\n    const arg = argv[i]\n\n    if (arg === name) {\n      return {\n        name,\n        index: i,\n        value: \"\",\n      }\n    }\n\n    if (arg.startsWith(`${name}=`)) {\n      return {\n        name,\n        index: i,\n        value: arg.slice(`${name}=`.length),\n      }\n    }\n\n    i++\n  }\n\n  return null\n}\n\nexport const addOrReplaceCommandArgument = (argv, name, value) => {\n  const argSource = value ? `${name}=${value}` : name\n  const argvCopy = argv.slice()\n  const arg = getCommandArgument(argvCopy, name)\n  if (arg) {\n    argvCopy[arg.index] = argSource\n  } else {\n    argvCopy.push(argSource)\n  }\n  return argvCopy\n}\n\nexport const removeCommandArgument = (argv, name) => {\n  const argvCopy = argv.slice()\n  const arg = getCommandArgument(argv, name)\n  if (arg) {\n    argvCopy.splice(arg.index, 1)\n  }\n\n  return argvCopy\n}\n",
    "import { createCancellationToken } from \"@jsenv/cancellation\"\nimport { findFreePort } from \"@jsenv/server\"\nimport { getCommandArgument, removeCommandArgument } from \"./commandArguments.js\"\n\nconst AVAILABLE_DEBUG_MODE = [\"none\", \"inherit\", \"inspect\", \"inspect-brk\", \"debug\", \"debug-brk\"]\n\nexport const createChildExecArgv = async ({\n  cancellationToken = createCancellationToken(),\n  // https://code.visualstudio.com/docs/nodejs/nodejs-debugging#_automatically-attach-debugger-to-nodejs-subprocesses\n  processExecArgv = process.execArgv,\n  processDebugPort = process.debugPort,\n\n  debugPort = 0,\n  debugMode = \"inherit\",\n  debugModeInheritBreak = true,\n  traceWarnings = \"inherit\",\n  unhandledRejection = \"inherit\",\n  jsonModules = \"inherit\",\n} = {}) => {\n  if (typeof debugMode === \"string\" && AVAILABLE_DEBUG_MODE.indexOf(debugMode) === -1) {\n    throw new TypeError(`unexpected debug mode.\n--- debug mode ---\n${debugMode}\n--- allowed debug mode ---\n${AVAILABLE_DEBUG_MODE}`)\n  }\n\n  let childExecArgv = processExecArgv.slice()\n  const { debugModeArg, debugPortArg } = getCommandDebugArgs(processExecArgv)\n  let childDebugMode\n  if (debugMode === \"inherit\") {\n    if (debugModeArg) {\n      childDebugMode = debugModeArg.name.slice(2)\n      if (debugModeInheritBreak === false) {\n        if (childDebugMode === \"--debug-brk\") childDebugMode = \"--debug\"\n        if (childDebugMode === \"--inspect-brk\") childDebugMode = \"--inspect\"\n      }\n    } else {\n      childDebugMode = \"none\"\n    }\n  } else {\n    childDebugMode = debugMode\n  }\n  if (childDebugMode === \"none\") {\n    // remove debug mode or debug port arg\n    if (debugModeArg) {\n      childExecArgv = removeCommandArgument(childExecArgv, debugModeArg.name)\n    }\n    if (debugPortArg) {\n      childExecArgv = removeCommandArgument(childExecArgv, debugPortArg.name)\n    }\n  } else {\n    // this is required because vscode does not\n    // support assigning a child spwaned without a specific port\n    const childDebugPort =\n      debugPort === 0 ? await findFreePort(processDebugPort + 1, { cancellationToken }) : debugPort\n\n    // remove process debugMode, it will be replaced with the child debugMode\n    const childDebugModeArgName = `--${childDebugMode}`\n    if (debugPortArg) {\n      // replace the debug port arg\n      const childDebugPortArgFull = `--${childDebugMode}-port${portToArgValue(childDebugPort)}`\n      childExecArgv[debugPortArg.index] = childDebugPortArgFull\n\n      // replace debug mode or create it (would be strange to have to create it)\n      if (debugModeArg) {\n        childExecArgv[debugModeArg.index] = childDebugModeArgName\n      } else {\n        childExecArgv.push(childDebugModeArgName)\n      }\n    } else {\n      const childDebugArgFull = `${childDebugModeArgName}${portToArgValue(childDebugPort)}`\n      // replace debug mode for child\n      if (debugModeArg) {\n        childExecArgv[debugModeArg.index] = childDebugArgFull\n      }\n      // add debug mode to child\n      else {\n        childExecArgv.push(childDebugArgFull)\n      }\n    }\n  }\n\n  if (traceWarnings !== \"inherit\") {\n    const traceWarningsArg = getCommandArgument(childExecArgv, \"--trace-warnings\")\n    if (traceWarnings && !traceWarningsArg) {\n      childExecArgv.push(\"--trace-warnings\")\n    } else if (!traceWarnings && traceWarningsArg) {\n      childExecArgv.splice(traceWarningsArg.index, 1)\n    }\n  }\n\n  // https://nodejs.org/api/cli.html#cli_unhandled_rejections_mode\n  if (unhandledRejection !== \"inherit\") {\n    const unhandledRejectionArg = getCommandArgument(childExecArgv, \"--unhandled-rejections\")\n    if (unhandledRejection && !unhandledRejectionArg) {\n      childExecArgv.push(`--unhandled-rejections=${unhandledRejection}`)\n    } else if (unhandledRejection && unhandledRejectionArg) {\n      childExecArgv[unhandledRejectionArg.index] = `--unhandled-rejections=${unhandledRejection}`\n    } else if (!unhandledRejection && unhandledRejectionArg) {\n      childExecArgv.splice(unhandledRejectionArg.index, 1)\n    }\n  }\n\n  // https://nodejs.org/api/cli.html#cli_experimental_json_modules\n  if (jsonModules !== \"inherit\") {\n    const jsonModulesArg = getCommandArgument(childExecArgv, \"--experimental-json-modules\")\n    if (jsonModules && !jsonModulesArg) {\n      childExecArgv.push(`--experimental-json-modules`)\n    } else if (!jsonModules && jsonModulesArg) {\n      childExecArgv.splice(jsonModulesArg.index, 1)\n    }\n  }\n\n  return childExecArgv\n}\n\nconst portToArgValue = (port) => {\n  if (typeof port !== \"number\") return \"\"\n  if (port === 0) return \"\"\n  return `=${port}`\n}\n\n// https://nodejs.org/en/docs/guides/debugging-getting-started/\nconst getCommandDebugArgs = (argv) => {\n  const inspectArg = getCommandArgument(argv, \"--inspect\")\n  if (inspectArg) {\n    return {\n      debugModeArg: inspectArg,\n      debugPortArg: getCommandArgument(argv, \"--inspect-port\"),\n    }\n  }\n  const inspectBreakArg = getCommandArgument(argv, \"--inspect-brk\")\n  if (inspectBreakArg) {\n    return {\n      debugModeArg: inspectBreakArg,\n      debugPortArg: getCommandArgument(argv, \"--inspect-port\"),\n    }\n  }\n\n  const debugArg = getCommandArgument(argv, \"--debug\")\n  if (debugArg) {\n    return {\n      debugModeArg: debugArg,\n      debugPortArg: getCommandArgument(argv, \"--debug-port\"),\n    }\n  }\n  const debugBreakArg = getCommandArgument(argv, \"--debug-brk\")\n  if (debugBreakArg) {\n    return {\n      debugModeArg: debugBreakArg,\n      debugPortArg: getCommandArgument(argv, \"--debug-port\"),\n    }\n  }\n\n  return {}\n}\n\nexport const processIsExecutedByVSCode = () => {\n  return typeof process.env.VSCODE_PID === \"string\"\n}\n",
    "/* eslint-disable import/max-dependencies */\nimport { Script } from \"vm\"\nimport { fork as forkChildProcess } from \"child_process\"\nimport { uneval } from \"@jsenv/uneval\"\nimport { createCancellationToken } from \"@jsenv/cancellation\"\nimport { urlToFileSystemPath, resolveUrl, assertFilePresence } from \"@jsenv/util\"\nimport {\n  jsenvNodeSystemUrl,\n  jsenvNodeSystemBuildUrl,\n} from \"@jsenv/core/src/internal/jsenvInternalFiles.js\"\nimport { require } from \"./internal/require.js\"\nimport { supportsDynamicImport } from \"./internal/supportsDynamicImport.js\"\nimport { jsenvCoreDirectoryUrl } from \"./internal/jsenvCoreDirectoryUrl.js\"\nimport { escapeRegexpSpecialCharacters } from \"./internal/escapeRegexpSpecialCharacters.js\"\nimport { createChildExecArgv } from \"./internal/node-launcher/createChildExecArgv.js\"\n\nconst killProcessTree = require(\"tree-kill\")\n\nconst EVALUATION_STATUS_OK = \"evaluation-ok\"\n\n// https://nodejs.org/api/process.html#process_signal_events\nconst SIGINT_SIGNAL_NUMBER = 2\nconst SIGABORT_SIGNAL_NUMBER = 6\nconst SIGTERM_SIGNAL_NUMBER = 15\nconst SIGINT_EXIT_CODE = 128 + SIGINT_SIGNAL_NUMBER\nconst SIGABORT_EXIT_CODE = 128 + SIGABORT_SIGNAL_NUMBER\nconst SIGTERM_EXIT_CODE = 128 + SIGTERM_SIGNAL_NUMBER\n// http://man7.org/linux/man-pages/man7/signal.7.html\n// https:// github.com/nodejs/node/blob/1d9511127c419ec116b3ddf5fc7a59e8f0f1c1e4/lib/internal/child_process.js#L472\nconst GRACEFUL_STOP_SIGNAL = \"SIGTERM\"\nconst STOP_SIGNAL = \"SIGKILL\"\n// it would be more correct if GRACEFUL_STOP_FAILED_SIGNAL was SIGHUP instead of SIGKILL.\n// but I'm not sure and it changes nothing so just use SIGKILL\nconst GRACEFUL_STOP_FAILED_SIGNAL = \"SIGKILL\"\n\nexport const launchNode = async ({\n  cancellationToken = createCancellationToken(),\n  logger,\n\n  projectDirectoryUrl,\n  outDirectoryRelativeUrl,\n  compileServerOrigin,\n\n  debugPort,\n  debugMode,\n  debugModeInheritBreak,\n  traceWarnings,\n  unhandledRejection,\n  jsonModules,\n  env,\n\n  remap = true,\n  collectCoverage = false,\n}) => {\n  if (typeof projectDirectoryUrl !== \"string\") {\n    throw new TypeError(`projectDirectoryUrl must be a string, got ${projectDirectoryUrl}`)\n  }\n  if (typeof compileServerOrigin !== \"string\") {\n    throw new TypeError(`compileServerOrigin must be a string, got ${compileServerOrigin}`)\n  }\n  if (typeof outDirectoryRelativeUrl !== \"string\") {\n    throw new TypeError(`outDirectoryRelativeUrl must be a string, got ${outDirectoryRelativeUrl}`)\n  }\n  if (env === undefined) {\n    env = { ...process.env }\n  } else if (typeof env !== \"object\") {\n    throw new TypeError(`env must be an object, got ${env}`)\n  }\n\n  const dynamicImportSupported = await supportsDynamicImport()\n  const nodeControllableFileUrl = resolveUrl(\n    dynamicImportSupported\n      ? \"./src/internal/node-launcher/nodeControllableFile.js\"\n      : \"./src/internal/node-launcher/nodeControllableFile.cjs\",\n    jsenvCoreDirectoryUrl,\n  )\n  await assertFilePresence(nodeControllableFileUrl)\n\n  const execArgv = await createChildExecArgv({\n    cancellationToken,\n    debugPort,\n    debugMode,\n    debugModeInheritBreak,\n    traceWarnings,\n    unhandledRejection,\n    jsonModules,\n  })\n\n  env.COVERAGE_ENABLED = collectCoverage\n\n  const childProcess = forkChildProcess(urlToFileSystemPath(nodeControllableFileUrl), {\n    execArgv,\n    // silent: true\n    stdio: \"pipe\",\n    env,\n  })\n  logger.debug(\n    `${process.argv[0]} ${execArgv.join(\" \")} ${urlToFileSystemPath(nodeControllableFileUrl)}`,\n  )\n\n  const childProcessReadyPromise = new Promise((resolve) => {\n    onceProcessMessage(childProcess, \"ready\", resolve)\n  })\n\n  const consoleCallbackArray = []\n  const registerConsoleCallback = (callback) => {\n    consoleCallbackArray.push(callback)\n  }\n  installProcessOutputListener(childProcess, ({ type, text }) => {\n    consoleCallbackArray.forEach((callback) => {\n      callback({\n        type,\n        text,\n      })\n    })\n  })\n  // keep listening process outputs while child process is killed to catch\n  // outputs until it's actually disconnected\n  // registerCleanupCallback(removeProcessOutputListener)\n\n  const errorCallbackArray = []\n  const registerErrorCallback = (callback) => {\n    errorCallbackArray.push(callback)\n  }\n  let killing = false\n  installProcessErrorListener(childProcess, (error) => {\n    if (!childProcess.connected && error.code === \"ERR_IPC_DISCONNECTED\") {\n      return\n    }\n    // on windows killProcessTree uses taskkill which seems to kill the process\n    // with an exitCode of 1\n    if (process.platform === \"win32\" && killing && error.exitCode === 1) {\n      return\n    }\n    errorCallbackArray.forEach((callback) => {\n      callback(error)\n    })\n  })\n  // keep listening process errors while child process is killed to catch\n  // errors until it's actually disconnected\n  // registerCleanupCallback(removeProcessErrorListener)\n\n  // https://nodejs.org/api/child_process.html#child_process_event_disconnect\n  let resolveDisconnect\n  const disconnected = new Promise((resolve) => {\n    resolveDisconnect = resolve\n    onceProcessMessage(childProcess, \"disconnect\", () => {\n      resolve()\n    })\n  })\n  // child might exit without disconnect apparently, exit is disconnect for us\n  childProcess.once(\"exit\", () => {\n    disconnectChildProcess()\n  })\n\n  const disconnectChildProcess = () => {\n    try {\n      childProcess.disconnect()\n    } catch (e) {\n      if (e.code === \"ERR_IPC_DISCONNECTED\") {\n        resolveDisconnect()\n      } else {\n        throw e\n      }\n    }\n    return disconnected\n  }\n\n  const killChildProcess = async ({ signal }) => {\n    killing = true\n    logger.debug(`send ${signal} to child process with pid ${childProcess.pid}`)\n\n    await new Promise((resolve) => {\n      killProcessTree(childProcess.pid, signal, (error) => {\n        if (error) {\n          // on windows: process with pid cannot be found\n          if (error.stack.includes(`The process \"${childProcess.pid}\" not found`)) {\n            resolve()\n            return\n          }\n          // on windows: child process with a pid cannot be found\n          if (error.stack.includes(\"Reason: There is no running instance of the task\")) {\n            resolve()\n            return\n          }\n          // windows too\n          if (error.stack.includes(\"The operation attempted is not supported\")) {\n            resolve()\n            return\n          }\n\n          logger.error(`error while killing process tree with ${signal}\n    --- error stack ---\n    ${error.stack}\n    --- process.pid ---\n    ${childProcess.pid}`)\n\n          // even if we could not kill the child\n          // we will ask it to disconnect\n          resolve()\n          return\n        }\n\n        resolve()\n      })\n    })\n\n    // in case the child process did not disconnect by itself at this point\n    // something is keeping it alive and it cannot be propely killed\n    // disconnect it manually.\n    // something inside makeProcessControllable.cjs ensure process.exit()\n    // when the child process is disconnected.\n    return disconnectChildProcess()\n  }\n\n  const stop = ({ gracefulFailed } = {}) => {\n    return killChildProcess({\n      signal: gracefulFailed ? GRACEFUL_STOP_FAILED_SIGNAL : STOP_SIGNAL,\n    })\n  }\n\n  const gracefulStop = () => {\n    return killChildProcess({ signal: GRACEFUL_STOP_SIGNAL })\n  }\n\n  const executeFile = async (fileRelativeUrl, { collectCoverage, executionId }) => {\n    const execute = async () => {\n      return new Promise(async (resolve, reject) => {\n        onceProcessMessage(childProcess, \"evaluate-result\", ({ status, value }) => {\n          logger.debug(`child process sent the following evaluation result.\n--- status ---\n${status}\n--- value ---\n${value}`)\n          if (status === EVALUATION_STATUS_OK) resolve(value)\n          else reject(value)\n        })\n\n        const executeParams = {\n          jsenvCoreDirectoryUrl,\n          projectDirectoryUrl,\n          outDirectoryRelativeUrl,\n          fileRelativeUrl,\n          compileServerOrigin,\n\n          collectCoverage,\n          executionId,\n          remap,\n        }\n\n        const source = await generateSourceToEvaluate({\n          dynamicImportSupported,\n          cancellationToken,\n          projectDirectoryUrl,\n          outDirectoryRelativeUrl,\n          compileServerOrigin,\n          executeParams,\n        })\n\n        logger.debug(`ask child process to evaluate\n--- source ---\n${source}`)\n\n        await childProcessReadyPromise\n        try {\n          await sendToProcess(childProcess, \"evaluate\", source)\n        } catch (e) {\n          logger.error(`error while sending message to child\n--- error stack ---\n${e.stack}`)\n          throw e\n        }\n      })\n    }\n\n    const executionResult = await execute()\n\n    const { status } = executionResult\n    if (status === \"errored\") {\n      const { exceptionSource, coverageMap } = executionResult\n      return {\n        status,\n        error: evalException(exceptionSource, { compileServerOrigin, projectDirectoryUrl }),\n        coverageMap,\n      }\n    }\n\n    const { namespace, coverageMap } = executionResult\n    return {\n      status,\n      namespace,\n      coverageMap,\n    }\n  }\n\n  return {\n    name: \"node\",\n    version: process.version.slice(1),\n    options: {\n      execArgv,\n      // for now do not pass env, it make debug logs to verbose\n      // because process.env is very big\n      // env,\n    },\n    gracefulStop,\n    stop,\n    disconnected,\n    registerErrorCallback,\n    registerConsoleCallback,\n    executeFile,\n  }\n}\n\nconst evalException = (exceptionSource, { compileServerOrigin, projectDirectoryUrl }) => {\n  const error = evalSource(exceptionSource)\n  if (error && error instanceof Error) {\n    const compileServerOriginRegexp = new RegExp(\n      escapeRegexpSpecialCharacters(`${compileServerOrigin}/`),\n      \"g\",\n    )\n\n    error.stack = error.stack.replace(compileServerOriginRegexp, projectDirectoryUrl)\n    error.message = error.message.replace(compileServerOriginRegexp, projectDirectoryUrl)\n\n    // const projectDirectoryPath = urlToFileSystemPath(projectDirectoryUrl)\n    // const projectDirectoryPathRegexp = new RegExp(\n    //   `(?<!file:\\/\\/)${escapeRegexpSpecialCharacters(projectDirectoryPath)}`,\n    //   \"g\",\n    // )\n    // error.stack = error.stack.replace(projectDirectoryPathRegexp, projectDirectoryUrl)\n    // error.message = error.message.replace(projectDirectoryPathRegexp, projectDirectoryUrl)\n  }\n\n  return error\n}\n\nconst sendToProcess = async (childProcess, type, data) => {\n  const source = uneval(data, { functionAllowed: true })\n\n  return new Promise((resolve, reject) => {\n    childProcess.send({ type, data: source }, (error) => {\n      if (error) {\n        reject(error)\n      } else {\n        resolve()\n      }\n    })\n  })\n}\n\nconst installProcessOutputListener = (childProcess, callback) => {\n  // beware that we may receive ansi output here, should not be a problem but keep that in mind\n  const stdoutDataCallback = (chunk) => {\n    callback({ type: \"log\", text: String(chunk) })\n  }\n  childProcess.stdout.on(\"data\", stdoutDataCallback)\n\n  const stdErrorDataCallback = (chunk) => {\n    callback({ type: \"error\", text: String(chunk) })\n  }\n  childProcess.stderr.on(\"data\", stdErrorDataCallback)\n\n  return () => {\n    childProcess.stdout.removeListener(\"data\", stdoutDataCallback)\n    childProcess.stderr.removeListener(\"data\", stdoutDataCallback)\n  }\n}\n\nconst installProcessErrorListener = (childProcess, callback) => {\n  // https://nodejs.org/api/child_process.html#child_process_event_error\n  const errorListener = (error) => {\n    removeExitListener() // if an error occured we ignore the child process exitCode\n    callback(error)\n    onceProcessMessage(childProcess, \"error\", errorListener)\n  }\n  const removeErrorListener = onceProcessMessage(childProcess, \"error\", errorListener)\n  // process.exit(1) in child process or process.exitCode = 1 + process.exit()\n  // means there was an error even if we don't know exactly what.\n  const removeExitListener = onceProcessEvent(childProcess, \"exit\", (code) => {\n    if (\n      code !== null &&\n      code !== 0 &&\n      code !== SIGINT_EXIT_CODE &&\n      code !== SIGTERM_EXIT_CODE &&\n      code !== SIGABORT_EXIT_CODE\n    ) {\n      removeErrorListener()\n      callback(createExitWithFailureCodeError(code))\n    }\n  })\n  return () => {\n    removeErrorListener()\n    removeExitListener()\n  }\n}\n\nconst createExitWithFailureCodeError = (code) => {\n  if (code === 12) {\n    return new Error(\n      `child exited with 12: forked child wanted to use a non available port for debug`,\n    )\n  }\n  const error = new Error(`child exited with ${code}`)\n  error.exitCode = code\n  return error\n}\n\nconst onceProcessMessage = (childProcess, type, callback) => {\n  return onceProcessEvent(childProcess, \"message\", (message) => {\n    if (message.type === type) {\n      // eslint-disable-next-line no-eval\n      callback(message.data ? eval(`(${message.data})`) : \"\")\n    }\n  })\n}\n\nconst onceProcessEvent = (childProcess, type, callback) => {\n  childProcess.on(type, callback)\n\n  return () => {\n    childProcess.removeListener(type, callback)\n  }\n}\n\nconst generateSourceToEvaluate = async ({ dynamicImportSupported, executeParams }) => {\n  if (dynamicImportSupported) {\n    return `import { execute } from ${JSON.stringify(jsenvNodeSystemUrl)}\n\nexport default execute(${JSON.stringify(executeParams, null, \"    \")})`\n  }\n\n  // The compiled nodeRuntime file will be somewhere else in the filesystem\n  // than the original nodeRuntime file.\n  // It is important for the compiled file to be able to require\n  // node modules that original file could access\n  // hence the requireCompiledFileAsOriginalFile\n  return `(() => {\n  const { readFileSync } = require(\"fs\")\n  const Module = require('module')\n  const { dirname } = require(\"path\")\n\n  const run = async () => {\n    const nodeFilePath = ${JSON.stringify(urlToFileSystemPath(jsenvNodeSystemBuildUrl))}\n    const { execute } = requireCompiledFileAsOriginalFile(nodeFilePath, nodeFilePath)\n\n    return execute(${JSON.stringify(executeParams, null, \"    \")})\n  }\n\n  const requireCompiledFileAsOriginalFile = (compiledFilePath, originalFilePath) => {\n    const fileContent = String(readFileSync(compiledFilePath))\n    const moduleObject = new Module(compiledFilePath)\n    moduleObject.paths = Module._nodeModulePaths(dirname(originalFilePath))\n    moduleObject._compile(fileContent, compiledFilePath)\n    return moduleObject.exports\n  }\n\n  return {\n    default: run()\n  }\n})()`\n}\n\nconst evalSource = (code, href) => {\n  const script = new Script(code, { filename: href })\n  return script.runInThisContext()\n}\n",
    "import { createCancellationTokenForProcess } from \"@jsenv/cancellation\"\nimport { normalizeStructuredMetaMap, collectFiles, urlToRelativeUrl } from \"@jsenv/util\"\nimport { executeJsenvAsyncFunction } from \"./internal/executeJsenvAsyncFunction.js\"\nimport { jsenvCoreDirectoryUrl } from \"./internal/jsenvCoreDirectoryUrl.js\"\nimport { assertProjectDirectoryUrl, assertProjectDirectoryExists } from \"./internal/argUtils.js\"\nimport {\n  startCompileServer,\n  computeOutDirectoryRelativeUrl,\n} from \"./internal/compiling/startCompileServer.js\"\nimport { jsenvExplorableConfig } from \"./jsenvExplorableConfig.js\"\nimport {\n  sourcemapMainFileUrl,\n  sourcemapMappingFileUrl,\n  jsenvExploringRedirectorHtmlUrl,\n  jsenvExploringRedirectorJsBuildUrl,\n  jsenvExploringHtmlUrl,\n  jsenvToolbarInjectorBuildUrl,\n  jsenvToolbarJsBuildUrl,\n} from \"./internal/jsenvInternalFiles.js\"\n\nexport const startExploring = async ({\n  cancellationToken = createCancellationTokenForProcess(),\n  explorableConfig = jsenvExplorableConfig,\n  projectDirectoryUrl,\n  jsenvDirectoryRelativeUrl,\n  outDirectoryName,\n  toolbar = true,\n  livereloading = true,\n  ...rest\n}) => {\n  return executeJsenvAsyncFunction(async () => {\n    projectDirectoryUrl = assertProjectDirectoryUrl({ projectDirectoryUrl })\n    await assertProjectDirectoryExists({ projectDirectoryUrl })\n\n    const outDirectoryRelativeUrl = computeOutDirectoryRelativeUrl({\n      projectDirectoryUrl,\n      jsenvDirectoryRelativeUrl,\n      outDirectoryName,\n    })\n    const jsenvToolbarInjectorBuildRelativeUrlForProject = urlToRelativeUrl(\n      jsenvToolbarInjectorBuildUrl,\n      projectDirectoryUrl,\n    )\n\n    const redirectFiles = createRedirectFilesService({\n      projectDirectoryUrl,\n      outDirectoryRelativeUrl,\n    })\n    const serveExploringData = createExploringDataService({\n      projectDirectoryUrl,\n      outDirectoryRelativeUrl,\n      explorableConfig,\n    })\n    const serveExplorableListAsJson = createExplorableListAsJsonService({\n      projectDirectoryUrl,\n      outDirectoryRelativeUrl,\n      explorableConfig,\n    })\n\n    const compileServer = await startCompileServer({\n      cancellationToken,\n      projectDirectoryUrl,\n      keepProcessAlive: true,\n      cors: true,\n      livereloadSSE: livereloading,\n      accessControlAllowRequestOrigin: true,\n      accessControlAllowRequestMethod: true,\n      accessControlAllowRequestHeaders: true,\n      accessControlAllowCredentials: true,\n      stopOnPackageVersionChange: true,\n      watchAndSyncImportMap: true,\n      compileGroupCount: 2,\n      scriptInjections: [\n        ...(toolbar\n          ? [\n              {\n                src: `/${jsenvToolbarInjectorBuildRelativeUrlForProject}`,\n              },\n            ]\n          : []),\n      ],\n      customServices: {\n        \"service:exploring-redirect\": (request) => redirectFiles(request),\n        \"service:exploring-data\": (request) => serveExploringData(request),\n        \"service:explorables\": (request) => serveExplorableListAsJson(request),\n      },\n      jsenvDirectoryRelativeUrl,\n      outDirectoryName,\n      ...rest,\n    })\n\n    return compileServer\n  })\n}\n\nconst createRedirectFilesService = ({ projectDirectoryUrl }) => {\n  const jsenvExploringRedirectorHtmlRelativeUrlForProject = urlToRelativeUrl(\n    jsenvExploringRedirectorHtmlUrl,\n    projectDirectoryUrl,\n  )\n  const jsenvExploringRedirectorJsBuildRelativeUrlForProject = urlToRelativeUrl(\n    jsenvExploringRedirectorJsBuildUrl,\n    projectDirectoryUrl,\n  )\n  const jsenvToolbarJsBuildRelativeUrlForProject = urlToRelativeUrl(\n    jsenvToolbarJsBuildUrl,\n    projectDirectoryUrl,\n  )\n\n  return (request) => {\n    if (request.ressource === \"/\") {\n      const jsenvExploringRedirectorHtmlServerUrl = `${request.origin}/${jsenvExploringRedirectorHtmlRelativeUrlForProject}`\n      return {\n        status: 307,\n        headers: {\n          location: jsenvExploringRedirectorHtmlServerUrl,\n        },\n      }\n    }\n    if (request.ressource === \"/.jsenv/toolbar.main.js\") {\n      const jsenvToolbarJsBuildServerUrl = `${request.origin}/${jsenvToolbarJsBuildRelativeUrlForProject}`\n      return {\n        status: 307,\n        headers: {\n          location: jsenvToolbarJsBuildServerUrl,\n        },\n      }\n    }\n    // unfortunately browser don't resolve sourcemap to url after redirection\n    // but to url before. It means browser tries to load source map from\n    // \"/.jsenv/jsenv-toolbar.js.map\"\n    // we could also inline sourcemap but it's not yet possible\n    // inside buildProject\n    if (request.ressource === \"/.jsenv/jsenv-toolbar.js.map\") {\n      const jsenvToolbarJsBuildSourcemapServerUrl = `${request.origin}/${jsenvToolbarJsBuildRelativeUrlForProject}.map`\n      return {\n        status: 307,\n        headers: {\n          location: jsenvToolbarJsBuildSourcemapServerUrl,\n        },\n      }\n    }\n    if (request.ressource === \"/.jsenv/exploring.redirector.js\") {\n      const jsenvExploringRedirectorBuildServerUrl = `${request.origin}/${jsenvExploringRedirectorJsBuildRelativeUrlForProject}`\n      return {\n        status: 307,\n        headers: {\n          location: jsenvExploringRedirectorBuildServerUrl,\n        },\n      }\n    }\n\n    return null\n  }\n}\n\nconst createExploringDataService = ({\n  projectDirectoryUrl,\n  outDirectoryRelativeUrl,\n  explorableConfig,\n}) => {\n  return (request) => {\n    if (\n      request.ressource === \"/.jsenv/exploring.json\" &&\n      request.method === \"GET\" &&\n      \"x-jsenv\" in request.headers\n    ) {\n      const data = {\n        projectDirectoryUrl,\n        outDirectoryRelativeUrl,\n        jsenvDirectoryRelativeUrl: urlToRelativeUrl(jsenvCoreDirectoryUrl, projectDirectoryUrl),\n        exploringHtmlFileRelativeUrl: urlToRelativeUrl(jsenvExploringHtmlUrl, projectDirectoryUrl),\n        sourcemapMainFileRelativeUrl: urlToRelativeUrl(sourcemapMainFileUrl, jsenvCoreDirectoryUrl),\n        sourcemapMappingFileRelativeUrl: urlToRelativeUrl(\n          sourcemapMappingFileUrl,\n          jsenvCoreDirectoryUrl,\n        ),\n        explorableConfig,\n      }\n      const json = JSON.stringify(data)\n      return {\n        status: 200,\n        headers: {\n          \"cache-control\": \"no-store\",\n          \"content-type\": \"application/json\",\n          \"content-length\": Buffer.byteLength(json),\n        },\n        body: json,\n      }\n    }\n    return null\n  }\n}\n\nconst createExplorableListAsJsonService = ({\n  projectDirectoryUrl,\n  outDirectoryRelativeUrl,\n  explorableConfig,\n}) => {\n  return async (request) => {\n    if (\n      request.ressource === \"/.jsenv/explorables.json\" &&\n      request.method === \"GET\" &&\n      \"x-jsenv\" in request.headers\n    ) {\n      const structuredMetaMapRelativeForExplorable = {}\n      Object.keys(explorableConfig).forEach((explorableGroup) => {\n        const explorableGroupConfig = explorableConfig[explorableGroup]\n        structuredMetaMapRelativeForExplorable[explorableGroup] = {\n          \"**/.jsenv/\": false, // temporary (in theory) to avoid visting .jsenv directory in jsenv itself\n          ...explorableGroupConfig,\n          [outDirectoryRelativeUrl]: false,\n        }\n      })\n      const structuredMetaMapForExplorable = normalizeStructuredMetaMap(\n        structuredMetaMapRelativeForExplorable,\n        projectDirectoryUrl,\n      )\n      const matchingFileResultArray = await collectFiles({\n        directoryUrl: projectDirectoryUrl,\n        structuredMetaMap: structuredMetaMapForExplorable,\n        predicate: (meta) =>\n          Object.keys(meta).some((explorableGroup) => Boolean(meta[explorableGroup])),\n      })\n      const explorableFiles = matchingFileResultArray.map(({ relativeUrl, meta }) => ({\n        relativeUrl,\n        meta,\n      }))\n      const json = JSON.stringify(explorableFiles)\n      return {\n        status: 200,\n        headers: {\n          \"cache-control\": \"no-store\",\n          \"content-type\": \"application/json\",\n          \"content-length\": Buffer.byteLength(json),\n        },\n        body: json,\n      }\n    }\n    return null\n  }\n}\n"
  ],
  "names": [
    "executeJsenvAsyncFunction",
    "fn",
    "executeAsyncFunction",
    "catchCancellation",
    "considerUnhandledRejectionsAsExceptions",
    "COMPILE_ID_BEST",
    "COMPILE_ID_OTHERWISE",
    "COMPILE_ID_BUILD_GLOBAL",
    "COMPILE_ID_BUILD_GLOBAL_FILES",
    "COMPILE_ID_BUILD_COMMONJS",
    "COMPILE_ID_BUILD_COMMONJS_FILES",
    "assertProjectDirectoryUrl",
    "projectDirectoryUrl",
    "assertAndNormalizeDirectoryUrl",
    "assertProjectDirectoryExists",
    "assertDirectoryPresence",
    "assertImportMapFileRelativeUrl",
    "importMapFileRelativeUrl",
    "TypeError",
    "assertImportMapFileInsideProject",
    "importMapFileUrl",
    "urlIsInsideOf",
    "Error",
    "filenameContainsBackSlashes",
    "__filename",
    "indexOf",
    "url",
    "replace",
    "jsenvCoreDirectoryUrl",
    "resolveUrl",
    "fileSystemPathToUrl",
    "babelPluginReplaceExpressions",
    "api",
    "options",
    "traverse",
    "parse",
    "types",
    "replaceMap",
    "allowConflictingReplacements",
    "replacementMap",
    "Map",
    "valueExpressionSet",
    "Set",
    "name",
    "pre",
    "state",
    "parseExpression",
    "value",
    "expressionNode",
    "opts",
    "program",
    "body",
    "expression",
    "removeProperties",
    "Object",
    "keys",
    "forEach",
    "key",
    "keyExpressionNode",
    "candidateArray",
    "get",
    "type",
    "valueExpressionNode",
    "equivalentKeyExpressionIndex",
    "findIndex",
    "candidate",
    "isNodesEquivalent",
    "newCandidate",
    "push",
    "set",
    "add",
    "visitor",
    "Expression",
    "path",
    "has",
    "node",
    "skip",
    "candidateFound",
    "find",
    "validate",
    "parent",
    "err",
    "replaceWith",
    "valueToVersion",
    "numberToVersion",
    "stringToVersion",
    "createValueErrorMessage",
    "version",
    "number",
    "major",
    "minor",
    "patch",
    "string",
    "parts",
    "split",
    "Number",
    "isNaN",
    "versionCompare",
    "versionA",
    "versionB",
    "semanticVersionA",
    "semanticVersionB",
    "majorDiff",
    "minorDiff",
    "patchDiff",
    "versionIsBelow",
    "versionSupposedBelow",
    "versionSupposedAbove",
    "findHighestVersion",
    "values",
    "length",
    "reduce",
    "highestVersion",
    "jsenvBabelPluginCompatMap",
    "chrome",
    "edge",
    "firefox",
    "safari",
    "ios",
    "opera",
    "electron",
    "samsung",
    "ie",
    "android",
    "phantom",
    "jsenvPluginCompatMap",
    "computeBabelPluginMapForRuntime",
    "babelPluginMap",
    "babelPluginCompatMap",
    "runtimeName",
    "runtimeVersion",
    "babelPluginMapForRuntime",
    "compatible",
    "runtimeIsCompatibleWithFeature",
    "runtimeCompatMap",
    "runtimeCompatibleVersion",
    "computeRuntimeCompatibleVersion",
    "computeJsenvPluginMapForRuntime",
    "jsenvPluginMap",
    "jsenvPluginCompatMapFallback",
    "jsenvPluginMapForRuntime",
    "featureCompat",
    "groupHaveSameRequirements",
    "leftGroup",
    "rightGroup",
    "babelPluginRequiredNameArray",
    "join",
    "jsenvPluginRequiredNameArray",
    "generateRuntimeGroupArray",
    "versionArray",
    "babelPluginKey",
    "babelPluginCompat",
    "String",
    "includes",
    "jsenvPluginKey",
    "jsenvPluginCompat",
    "sort",
    "runtimeGroupArray",
    "filter",
    "group",
    "groupWithSameRequirements",
    "runtimeGroupCandidate",
    "composeRuntimeCompatMap",
    "secondRuntimeCompatMap",
    "objectComposeValue",
    "normalizeRuntimeCompatMapVersions",
    "secondVersion",
    "runtimeCompatibility",
    "objectMapValue",
    "object",
    "callback",
    "mapped",
    "previous",
    "composed",
    "composeGroupArray",
    "arrayOfGroupArray",
    "groupArrayReducer",
    "previousGroupArray",
    "groupArray",
    "reducedGroupArray",
    "copyGroup",
    "existingGroupCandidate",
    "slice",
    "generateAllRuntimeGroupArray",
    "runtimeNames",
    "map",
    "runtimeCompatMapToScore",
    "runtimeScoreMap",
    "runtimeToScore",
    "other",
    "versionUsageMap",
    "versionArrayAscending",
    "closestVersion",
    "reverse",
    "generateGroupMap",
    "groupCount",
    "runtimeAlwaysInsideRuntimeScoreMap",
    "runtimeWillAlwaysBeKnown",
    "groupWithoutFeature",
    "allRuntimeGroupArray",
    "arrayWithoutValue",
    "groupToScore",
    "allRuntimeGroupArraySortedByScore",
    "a",
    "b",
    "addOtherwiseToBeSafe",
    "lastGroupIndex",
    "groupMap",
    "index",
    "array",
    "valueCandidate",
    "jsenvBrowserScoreMap",
    "jsenvNodeVersionScoreMap",
    "require",
    "createRequire",
    "proposalJSONStrings",
    "proposalNumericSeparator",
    "proposalObjectRestSpread",
    "proposalOptionalCatchBinding",
    "proposalOptionalChaining",
    "proposalUnicodePropertyRegex",
    "syntaxObjectRestSpread",
    "syntaxOptionalCatchBinding",
    "transformArrowFunction",
    "transformAsyncToPromises",
    "transformBlockScopedFunctions",
    "transformBlockScoping",
    "transformClasses",
    "transformComputedProperties",
    "transformDestructuring",
    "transformDotAllRegex",
    "transformDuplicateKeys",
    "transformExponentiationOperator",
    "transformForOf",
    "transformFunctionName",
    "transformLiterals",
    "transformNewTarget",
    "transformObjectSuper",
    "transformParameters",
    "transformRegenerator",
    "transformShorthandProperties",
    "transformSpread",
    "transformStickyRegex",
    "transformTemplateLiterals",
    "transformTypeOfSymbol",
    "transformUnicodeRegex",
    "jsenvBabelPluginMap",
    "asyncGenerators",
    "generators",
    "async",
    "createCallbackList",
    "callbackSet",
    "register",
    "delete",
    "notify",
    "args",
    "jsenvNodeSystemRelativeUrl",
    "jsenvNodeSystemBuildRelativeUrl",
    "jsenvNodeSystemUrl",
    "jsenvNodeSystemBuildUrl",
    "jsenvBrowserSystemRelativeUrl",
    "jsenvBrowserSystemBuildRelativeUrl",
    "jsenvBrowserSystemUrl",
    "jsenvBrowserSystemBuildUrl",
    "sourcemapMainFileUrl",
    "resolve",
    "sourcemapMappingFileUrl",
    "jsenvExploringRedirectorHtmlUrl",
    "jsenvExploringRedirectorJsRelativeUrl",
    "jsenvExploringRedirectorJsBuildRelativeUrl",
    "jsenvExploringRedirectorJsUrl",
    "jsenvExploringRedirectorJsBuildUrl",
    "jsenvExploringHtmlUrl",
    "jsenvToolbarHtmlUrl",
    "jsenvToolbarInjectorBuildRelativeUrl",
    "jsenvToolbarInjectorBuildUrl",
    "jsenvToolbarJsRelativeUrl",
    "jsenvToolbarJsBuildRelativeUrl",
    "jsenvToolbarJsUrl",
    "jsenvToolbarJsBuildUrl",
    "transformImportmap",
    "importmapBeforeTransformation",
    "logger",
    "outDirectoryRelativeUrl",
    "originalFileUrl",
    "compiledFileUrl",
    "projectFileRequestedCallback",
    "request",
    "urlToRelativeUrl",
    "importMapForProject",
    "JSON",
    "originalFileRelativeUrl",
    "importMapForJsenvCore",
    "getImportMapFromNodeModules",
    "logLevel",
    "loggerToLogLevel",
    "rootProjectDirectoryUrl",
    "projectPackageDevDependenciesIncluded",
    "topLevelRemappingForJsenvCore",
    "urlToRelativeUrlRemapping",
    "importmapForSelfImport",
    "imports",
    "scopes",
    "generateJsenvCoreScopes",
    "outDirectoryUrl",
    "importMapInternal",
    "importMap",
    "current",
    "composeTwoImportMaps",
    "projectTopLevelMappings",
    "scope",
    "scopedMappings",
    "compiledSource",
    "stringify",
    "contentType",
    "sources",
    "sourcesContent",
    "assets",
    "assetsContent",
    "baseUrl",
    "relativeUrl",
    "startsWith",
    "undefined",
    "scopesForJsenvCore",
    "scopeKey",
    "syntaxDynamicImport",
    "syntaxImportMeta",
    "syntaxNumericSeparator",
    "minimalBabelPluginArray",
    "addNamespace",
    "addDefault",
    "addNamed",
    "babelPluginTransformImportMeta",
    "pluginOptions",
    "replaceImportMeta",
    "babelState",
    "jsValueToAst",
    "jsValue",
    "valueAst",
    "Program",
    "programPath",
    "metaPropertyPathMap",
    "MemberExpression",
    "property",
    "objectProperty",
    "importMetaPropertyName",
    "replaceWithImport",
    "namespace",
    "from",
    "importAst",
    "replaceWithValue",
    "findAsyncPluginNameInBabelPluginMap",
    "ansiToHTML",
    "ansiString",
    "Convert",
    "toHtml",
    "ensureRegeneratorRuntimeImportBabelPlugin",
    "addSideEffect",
    "assertVersion",
    "regeneratorRuntimeIdentifierName",
    "regeneratorRuntimeImportPath",
    "Identifier",
    "filename",
    "filepathname",
    "endsWith",
    "getProgramParent",
    "ensureGlobalThisImportBabelPlugin",
    "globalThisIdentifierName",
    "globalThisImportPath",
    "list",
    "babelHelperNameInsideJsenvCoreArray",
    "babelHelperScope",
    "babelHelperAbstractScope",
    "babelHelperNameToImportSpecifier",
    "babelHelperName",
    "filePathToBabelHelperName",
    "filePath",
    "fileUrl",
    "babelHelperPrefix",
    "afterBabelHelper",
    "transformBabelHelperToImportBabelPlugin",
    "file",
    "cachedHelpers",
    "availableHelper",
    "babelHelperImportSpecifier",
    "helper",
    "nameHint",
    "transformAsync",
    "transformFromAstAsync",
    "transformModulesSystemJs",
    "proposalDynamicImport",
    "jsenvTransform",
    "inputCode",
    "inputPath",
    "inputRelativePath",
    "inputAst",
    "inputMap",
    "moduleOutFormat",
    "importMetaFormat",
    "importMetaEnvFileSpecifier",
    "importMeta",
    "allowTopLevelAwait",
    "transformTopLevelAwait",
    "transformGenerator",
    "transformGlobalThis",
    "sourcemapEnabled",
    "filenameRelative",
    "inputSourceMap",
    "configFile",
    "babelrc",
    "ast",
    "sourceMaps",
    "sourceFileName",
    "parserOpts",
    "allowAwaitOutsideFunction",
    "babelPluginMapWithoutTransformTypeOf",
    "metaPropertyName",
    "asyncPluginName",
    "babelPluginArrayWithoutAsync",
    "result",
    "babelTransform",
    "code",
    "plugins",
    "finalResult",
    "metadata",
    "babelPluginArray",
    "babelPluginName",
    "error",
    "message",
    "createParseError",
    "ansiRegex",
    "messageHTML",
    "lineNumber",
    "loc",
    "line",
    "columnNumber",
    "column",
    "pattern",
    "RegExp",
    "data",
    "parseError",
    "transformJs",
    "urlAfterTransform",
    "convertMap",
    "importMetaEnvFileRelativeUrl",
    "computeInputCodeAndInputMap",
    "computeInputPath",
    "computeInputRelativePath",
    "importMetaEnvFileUrl",
    "importMetaEnvRelativeUrlForInput",
    "relativeUrlToSpecifier",
    "remap",
    "structuredMetaMap",
    "normalizeStructuredMetaMap",
    "convert",
    "urlToMeta",
    "conversionResult",
    "urlToFileSystemPath",
    "startsWithWindowsDriveLetter",
    "firstChar",
    "test",
    "secondChar",
    "windowsFilePathToUrl",
    "windowsFilePath",
    "replaceBackSlashesWithSlashes",
    "getJavaScriptSourceMappingUrl",
    "javaScriptSource",
    "sourceMappingUrl",
    "replaceSourceMappingUrl",
    "javascriptSourceMappingUrlCommentRegexp",
    "setJavaScriptSourceMappingUrl",
    "sourceMappingFileUrl",
    "replaced",
    "sourceAfterReplace",
    "writeJavaScriptSourceMappingURL",
    "getCssSourceMappingUrl",
    "cssSource",
    "cssSourceMappingUrlCommentRegExp",
    "setCssSourceMappingUrl",
    "writeCssSourceMappingUrl",
    "sourcemapToBase64Url",
    "sourcemap",
    "asBase64",
    "Buffer",
    "toString",
    "source",
    "regexp",
    "lastSourceMappingUrl",
    "matchSourceMappingUrl",
    "exec",
    "before",
    "after",
    "mappedAfter",
    "match",
    "firstGroup",
    "urlIsAsset",
    "urlToFilename",
    "getMetaJsonFileUrl",
    "compileFileUrl",
    "generateCompiledFileAssetUrl",
    "assetName",
    "isWindows",
    "process",
    "platform",
    "transformResultToCompilationResult",
    "originalFileContent",
    "sourcemapFileUrl",
    "sourcemapExcludeSources",
    "sourcemapMethod",
    "output",
    "Promise",
    "all",
    "sourceFileUrl",
    "ensureWindowsDriveLetter",
    "sourceFileContent",
    "readFile",
    "sourceRoot",
    "sourcemapFileRelativePathForModule",
    "stringifyMap",
    "coverage",
    "coverageAssetFileUrl",
    "stringifyCoverage",
    "readFileContent",
    "buffer",
    "readFileSync",
    "writeFileContent",
    "content",
    "fileLikelyNotFound",
    "directoryPath",
    "dirname",
    "ensureParentDirectory",
    "mkdirSync",
    "recursive",
    "writeFileSync",
    "testFilePresence",
    "existsSync",
    "readMeta",
    "metaJsonFileUrl",
    "metaJsonString",
    "metaJsonObject",
    "debug",
    "createCacheSyntaxErrorMessage",
    "syntaxError",
    "stack",
    "validateMeta",
    "meta",
    "ifEtagMatch",
    "ifModifiedSinceDate",
    "compileCacheSourcesValidation",
    "compileCacheAssetsValidation",
    "compiledFileValidationTiming",
    "compiledFileValidation",
    "timeFunction",
    "validateCompiledFile",
    "valid",
    "timing",
    "warn",
    "sourcesValidationTiming",
    "sourcesValidations",
    "assetsValidationTiming",
    "assetValidations",
    "validateSources",
    "validateAssets",
    "invalidSourceValidation",
    "invalidAssetValidation",
    "assetFileUrl",
    "sourceContent",
    "assetContent",
    "compiledEtag",
    "bufferToEtag",
    "compiledMtime",
    "readFileSystemNodeModificationTime",
    "dateToSecondsPrecision",
    "reject",
    "validateSource",
    "eTag",
    "sourcesEtag",
    "sourceETag",
    "e",
    "asset",
    "validateAsset",
    "assetsEtag",
    "assetContentETag",
    "date",
    "dateWithSecondsPrecision",
    "Date",
    "setMilliseconds",
    "updateMeta",
    "cacheHitTracking",
    "compileResult",
    "compileResultStatus",
    "isNew",
    "isUpdated",
    "isCached",
    "promises",
    "sourceExists",
    "sourceFileExists",
    "writeCompiledSourceFile",
    "writeAssetsFile",
    "latestMeta",
    "sourceAndAssetProps",
    "createdMs",
    "now",
    "lastModifiedMs",
    "matchCount",
    "lastMatchMs",
    "createLockRegistry",
    "lockArray",
    "lockForRessource",
    "ressource",
    "currentLock",
    "lock",
    "unlockResolve",
    "unlocked",
    "unlock",
    "lockCandidate",
    "getOrGenerateCompiledFile",
    "writeOnFilesystem",
    "useFilesystemAsCache",
    "cacheInterProcessLocking",
    "compile",
    "lockTimeEnd",
    "timeStart",
    "startAsap",
    "lockTiming",
    "computeCompileReport",
    "cacheWriteTiming",
    "cacheReadTiming",
    "compileTiming",
    "callCompile",
    "metaValidation",
    "rest",
    "metaJsonFilePath",
    "unlockLocal",
    "unlockInterProcessLock",
    "ensureParentDirectories",
    "lockfile",
    "realpath",
    "retries",
    "minTimeout",
    "maxTimeout",
    "compileFile",
    "compileCacheStrategy",
    "serverCompileCacheHitTracking",
    "serverCompileCacheInterProcessLocking",
    "headers",
    "clientCacheDisabled",
    "cacheWithETag",
    "cacheWithMtime",
    "ifModifiedSince",
    "status",
    "statusText",
    "byteLength",
    "toUTCString",
    "json",
    "convertFileSystemErrorToResponseProperties",
    "minifyJs",
    "jsString",
    "jsUrl",
    "minify",
    "transformSync",
    "bundleWorker",
    "workerScriptUrl",
    "workerScriptSourceMap",
    "transformWorkerScript",
    "scriptUrl",
    "importerUrl",
    "scriptPath",
    "scriptContent",
    "babelPluginInlineImportScripts",
    "CallExpression",
    "calleePath",
    "replaceImportScriptsWithFileContents",
    "previousArgType",
    "importedUrls",
    "arg",
    "isStringLiteral",
    "importedUrl",
    "nodes",
    "importedScriptResult",
    "importedSourceAst",
    "parentPath",
    "replaceWithMultiple",
    "isIdentifier",
    "isMemberExpression",
    "calleeObject",
    "isSelf",
    "propertyPath",
    "buildServiceWorker",
    "buildDirectoryUrl",
    "serviceWorkerProjectRelativeUrl",
    "serviceWorkerBuildRelativeUrl",
    "serviceWorkerTransformer",
    "serviceWorkerProjectUrl",
    "serviceWorkerBuildUrl",
    "workerBundle",
    "serviceWorkerCode",
    "minifyResult",
    "sourceMap",
    "asObject",
    "includeSources",
    "writeJsAndSourcemap",
    "serviceWorkerSourceMap",
    "sourcemapFilename",
    "sourcemapBuildUrl",
    "urlToParentUrl",
    "writeFile",
    "globalAgent",
    "rejectUnauthorized",
    "fetchUrl",
    "ignoreHttpsError",
    "response",
    "serverFetchUrl",
    "headersToObject",
    "text",
    "bind",
    "blob",
    "arrayBuffer",
    "validateResponseStatusIsOk",
    "importer",
    "responseStatusIsOk",
    "responseStatus",
    "renderNamePattern",
    "replacements",
    "_match",
    "replacement",
    "parse5",
    "parseHtmlString",
    "htmlString",
    "htmlAst",
    "sourceCodeLocationInfo",
    "parseSvgString",
    "svgString",
    "svgAst",
    "parseFragment",
    "stringifyHtmlAst",
    "serialize",
    "findNode",
    "htmlStringOrAst",
    "predicate",
    "nodeMatching",
    "visitHtmlAst",
    "findFirstImportmapNode",
    "htmlNodeIsScriptImportmap",
    "getHtmlNodeAttributeByName",
    "htmlNode",
    "attributeName",
    "attrs",
    "attr",
    "removeHtmlNodeAttribute",
    "attributeToRemove",
    "attrIndex",
    "splice",
    "addHtmlNodeAttribute",
    "attributeToSet",
    "existingAttributeIndex",
    "getHtmlNodeTextNode",
    "firstChild",
    "childNodes",
    "nodeName",
    "setHtmlNodeText",
    "textContent",
    "textNode",
    "newTextNode",
    "parentNode",
    "removeHtmlNodeText",
    "getHtmlNodeLocation",
    "sourceCodeLocation",
    "startLine",
    "startCol",
    "htmlAstContains",
    "contains",
    "htmlNodeIsScriptModule",
    "typeAttribute",
    "parseSrcset",
    "srcsetString",
    "srcsetParts",
    "specifier",
    "descriptor",
    "trim",
    "stringifySrcset",
    "parseHtmlAstRessources",
    "links",
    "styles",
    "scripts",
    "imgs",
    "images",
    "uses",
    "replaceHtmlNode",
    "inheritAttributes",
    "newNode",
    "parseHtmlAsSingleElement",
    "replaceNode",
    "manipulateHtmlAst",
    "scriptInjections",
    "headNode",
    "bodyNode",
    "scriptsToPreprendInHead",
    "script",
    "scriptExistingInHead",
    "findExistingScript",
    "scriptToNode",
    "scriptExistingInBody",
    "headScriptsFragment",
    "scriptsToFragment",
    "insertFragmentBefore",
    "findChild",
    "fragment",
    "childNode",
    "childNodeIndex",
    "child",
    "html",
    "attributes",
    "scriptAttributes",
    "objectToHtmlAttributes",
    "sameScript",
    "src",
    "srcAttribute",
    "valueToHtmlAttributeValue",
    "getUniqueNameForInlineHtmlNode",
    "id",
    "idAttribute",
    "lineTaken",
    "some",
    "nodeCandidate",
    "parentNodeChildNodes",
    "nodeIndex",
    "visitNode",
    "callbackReturnValue",
    "i",
    "sortObjectByPathnames",
    "objectSorted",
    "keysSorted",
    "comparePathnames",
    "parseDataUrl",
    "dataUrl",
    "afterDataProtocol",
    "commaIndex",
    "beforeComma",
    "mediaType",
    "base64Flag",
    "afterComma",
    "stringifyDataUrl",
    "dataToBase64",
    "dataUrlToRawData",
    "base64ToString",
    "window",
    "atob",
    "btoa",
    "base64String",
    "getTargetAsBase64Url",
    "targetBufferAfterTransformation",
    "targetContentType",
    "memoize",
    "called",
    "previousCallReturnValue",
    "memoized",
    "forceMemoization",
    "getCallerLocation",
    "prepareStackTrace",
    "callerCallsite",
    "fileName",
    "getFileName",
    "isFileSystemPath",
    "getLineNumber",
    "getColumnNumber",
    "compareContentType",
    "leftContentType",
    "rightContentType",
    "checkContentType",
    "reference",
    "showReferenceSourceLocation",
    "referenceExpectedContentType",
    "target",
    "targetUrl",
    "formatContentTypeMismatchLog",
    "formatExternalReferenceLog",
    "formatReferenceFound",
    "referenceSourceLocation",
    "targetIsInline",
    "targetIsJsModule",
    "targetRelativeUrl",
    "collectNodesMutations",
    "notifiers",
    "candidates",
    "mutations",
    "collectNodeMutations",
    "htmlNodeToReferenceLocation",
    "referenceLine",
    "referenceColumn",
    "firstValueReturned",
    "returnValue",
    "Array",
    "isArray",
    "minifyHtml",
    "parseSvgAsset",
    "svgTarget",
    "minifyHtmlOptions",
    "targetBuffer",
    "htmlRessources",
    "collectSvgMutations",
    "getReferenceUrlRelativeToImporter",
    "mutationCallback",
    "svgAfterTransformation",
    "imagesMutations",
    "imageHrefVisitor",
    "usesMutations",
    "useHrefVisitor",
    "svgMutations",
    "image",
    "notifyReferenceFound",
    "hrefAttribute",
    "hrefReference",
    "referenceTargetSpecifier",
    "hrefNewValue",
    "referenceToUrl",
    "use",
    "href",
    "hash",
    "URL",
    "parseHtmlAsset",
    "htmlTarget",
    "transformImportmapTarget",
    "htmlStringToHtmlAst",
    "htmlAstToHtmlString",
    "scriptsMutations",
    "regularScriptSrcVisitor",
    "regularScriptTextNodeVisitor",
    "moduleScriptSrcVisitor",
    "moduleScriptTextNodeVisitor",
    "importmapScriptSrcVisitor",
    "importmapScriptTextNodeVisitor",
    "linksMutations",
    "linkStylesheetHrefVisitor",
    "linkHrefVisitor",
    "stylesMutations",
    "styleTextNodeVisitor",
    "imgsSrcMutations",
    "imgSrcVisitor",
    "imgsSrcsetMutations",
    "srcsetVisitor",
    "sourcesSrcMutations",
    "sourceSrcVisitor",
    "sourcesSrcsetMutations",
    "htmlMutations",
    "params",
    "htmlAfterTransformation",
    "remoteScriptReference",
    "urlRelativeToImporter",
    "jsReference",
    "urlToBasename",
    "format",
    "relativeUrlNotation",
    "ensureRelativeUrlNotation",
    "importmapReference",
    "targetFileNamePattern",
    "importmapReferenceUrl",
    "referenceUrl",
    "importmapTargetUrl",
    "importmapUrlRelativeToImporter",
    "importmapParentRelativeUrl",
    "link",
    "relAttribute",
    "cssReference",
    "linkToContentType",
    "targetUrlVersioningDisabled",
    "style",
    "inlineStyleReference",
    "img",
    "srcReference",
    "srcNewValue",
    "srcsetAttribute",
    "srcsetPartsReferences",
    "srcsetPart",
    "srcsetNewValue",
    "parseImportmapAsset",
    "importmapTarget",
    "importmapString",
    "applyPostCss",
    "cssString",
    "cssUrl",
    "postcss",
    "cssFileUrl",
    "urlToFileUrl",
    "collectUrls",
    "to",
    "console",
    "filesystemRootUrl",
    "origin",
    "afterOrigin",
    "valueParser",
    "postCssUrlHashPlugin",
    "postcssPlugin",
    "prepare",
    "getUrlReplacementValue",
    "fromUrl",
    "AtRule",
    "import",
    "atImportNode",
    "parsed",
    "urlNode",
    "firstNode",
    "urlReference",
    "urlNewValue",
    "newParams",
    "newAtImportRule",
    "messages",
    "Declaration",
    "declarationNode",
    "declarationNodeContainsUrl",
    "walkUrls",
    "isDataUrl",
    "walk",
    "isUrlFunctionNode",
    "isImageSetFunctionNode",
    "parseCssUrls",
    "css",
    "atImports",
    "urlDeclarations",
    "postCssPlugins",
    "postCssOptions",
    "urlDeclarationNode",
    "replaceCssUrls",
    "cssMinification",
    "cssMinificationOptions",
    "sourcemapOptions",
    "postcssPlugins",
    "getCssMinificationPlugin",
    "postcssOptions",
    "inline",
    "cssnano",
    "cssnanoDefaultPreset",
    "preset",
    "parseCssAsset",
    "cssTarget",
    "minifyCssOptions",
    "cssSourcemapUrl",
    "sourcemapReference",
    "urlNodeReferenceMapping",
    "atImport",
    "importReference",
    "cssNodeToReferenceLocation",
    "urlDeclaration",
    "precomputeBuildRelativeUrl",
    "registerAssetEmitter",
    "cssReplaceResult",
    "nodeCandidates",
    "urlNodeFound",
    "urlNodeCandidate",
    "isSameCssDocumentUrlNode",
    "urlNodeReference",
    "prev",
    "toJSON",
    "cssBuildRelativeUrl",
    "cssSourcemapFilename",
    "basename",
    "cssSourceAfterTransformation",
    "emitAsset",
    "cssBuildUrl",
    "targetBuildRelativeUrl",
    "mapBuildUrl",
    "sourceUrl",
    "sourceUrlRelativeToSourceMap",
    "mapSource",
    "buildRelativeUrl",
    "updateOnceReady",
    "start",
    "firstUrlNode",
    "secondUrlNode",
    "compareUrlNodeTypes",
    "compareUrlNodeValue",
    "sourceIndex",
    "firstUrlNodeType",
    "secondUrlNodeType",
    "firstUrlNodeValue",
    "secondUrlNodeValue",
    "firstValueNormalized",
    "secondValueNormalized",
    "parseJsAsset",
    "jsTarget",
    "urlToOriginalProjectUrl",
    "minifyJsOptions",
    "jsSourcemapUrl",
    "mightBeAWorkerScript",
    "jsSourceAfterTransformation",
    "jsUrlRelativeToImporter",
    "targetReferences",
    "toplevel",
    "jsBuildRelativeUrl",
    "jsSourcemapFilename",
    "jsBuildUrl",
    "parseJsonAsset",
    "jsonTarget",
    "jsonString",
    "parseWebmanifest",
    "webmanifestTarget",
    "manifestString",
    "manifest",
    "icons",
    "iconReferences",
    "icon",
    "iconReference",
    "iconsAfterBuild",
    "iconAfterBuild",
    "manifestAfterBuild",
    "parseTarget",
    "systemJsUrl",
    "useImportMapToImproveLongTermCaching",
    "createImportMapForFilesUsedInJs",
    "injectSystemJsScriptIfNeeded",
    "htmlContainsModuleScript",
    "injectImportMapScriptIfNeeded",
    "injectImportedFilesIntoImportMapTarget",
    "importMapToInject",
    "importmapOriginal",
    "importmapFinal",
    "importmapFinalContent",
    "cross",
    "checkmark",
    "yellow",
    "magenta",
    "red",
    "green",
    "grey",
    "ansiResetSequence",
    "showSourceLocation",
    "numberOfSurroundingLinesToShow",
    "lineMaxLength",
    "color",
    "mark",
    "aside",
    "lines",
    "lineRange",
    "end",
    "moveLineRangeUp",
    "moveLineRangeDown",
    "lineRangeWithinLines",
    "linesToShow",
    "endLineNumber",
    "lineNumberMaxWidth",
    "columnRange",
    "Math",
    "floor",
    "ceil",
    "lineSource",
    "isMainLine",
    "lineSourceTruncated",
    "applyColumnRange",
    "lineNumberWidth",
    "lineNumberRightSpacing",
    "repeat",
    "asideSource",
    "lineFormatted",
    "spacing",
    "stringToSpaces",
    "prefix",
    "suffix",
    "lastIndex",
    "startTruncated",
    "endTruncated",
    "NATIVE_NODE_MODULE_SPECIFIER_ARRAY",
    "isBareSpecifierForNativeNodeModule",
    "fetchSourcemap",
    "cancellationToken",
    "createCancellationToken",
    "createLogger",
    "jsSourcemapString",
    "parseSourcemapString",
    "sourcemapUrl",
    "sourcemapResponse",
    "okValidation",
    "sourcemapBodyAsText",
    "sourcemapString",
    "computeBuildRelativeUrl",
    "fileContent",
    "generateContentHash",
    "extname",
    "urlToExtension",
    "stringOrBuffer",
    "createHash",
    "update",
    "digest",
    "computeBuildRelativeUrlForTarget",
    "targetToFileNamePattern",
    "assetFileNamePattern",
    "assetFileNamePatternWithoutHash",
    "targetIsEntry",
    "isTargetIsJsModule",
    "precomputeBuildRelativeUrlForTarget",
    "precomputedBuildRelativeUrl",
    "createAssetBuilder",
    "fetch",
    "buildDirectoryRelativeUrl",
    "loadUrl",
    "connectTarget",
    "resolveTargetUrl",
    "targetSpecifier",
    "createReferenceForHTMLEntry",
    "entryContentType",
    "entryUrl",
    "entryBuffer",
    "entryBuildRelativeUrl",
    "callerLocation",
    "entryReference",
    "createReference",
    "getDependenciesAvailablePromise",
    "getReadyPromise",
    "createReferenceForJs",
    "jsLine",
    "jsColumn",
    "getRollupReferenceIdAvailablePromise",
    "getAllAssetEntryEmittedPromise",
    "urlToWait",
    "targetMap",
    "importerTarget",
    "resolveTargetReturnValue",
    "importerIsEntry",
    "importerIsJsModule",
    "targetIsExternal",
    "external",
    "decodeURI",
    "removePotentialUrlHash",
    "importerBuildRelativeUrl",
    "importerParentRelativeUrl",
    "connectReferenceAndTarget",
    "createTarget",
    "getBufferAvailablePromise",
    "then",
    "assetTransformMap",
    "buildRelativeUrlsToClean",
    "getBuildRelativeUrlsToClean",
    "responseContentTypeHeader",
    "responseBodyAsArrayBuffer",
    "dependencies",
    "previousJsDependency",
    "parsingDone",
    "dependencyReference",
    "parseReturnValue",
    "shortenUrl",
    "rollupChunkReadyPromise",
    "registerCallbackOnceRollupChunkIsReady",
    "targetFileName",
    "transform",
    "assetEmitters",
    "transformReturnValue",
    "referenceTarget",
    "referenceTargetBuildRelativeUrl",
    "referenceTargetBuildUrl",
    "importerBuildUrl",
    "connect",
    "connectFn",
    "rollupReferenceId",
    "assign",
    "rollupChunkReadyCallbackMap",
    "getRollupChunkReadyCallbackMap",
    "findAssetUrlByBuildRelativeUrl",
    "assetUrl",
    "referenceSource",
    "inspect",
    "referenceToCodeForRollup",
    "urlObject",
    "asyncWalk",
    "MagicString",
    "transformImportMetaUrlReferences",
    "assetBuilder",
    "markBuildRelativeUrlAsUsedByJs",
    "magicString",
    "enter",
    "isNewUrlImportMetaUrl",
    "arguments",
    "overwrite",
    "codeOutput",
    "generateMap",
    "hires",
    "callee",
    "STATIC_COMPILE_SERVER_AUTHORITY",
    "createJsenvRollupPlugin",
    "entryPointMap",
    "compileDirectoryRelativeUrl",
    "compileServerOrigin",
    "importDefaultExtension",
    "externalImportSpecifiers",
    "externalImportUrlPatterns",
    "browser",
    "urlVersioning",
    "manifestFile",
    "writeOnFileSystem",
    "urlImporterMap",
    "urlResponseBodyMap",
    "virtualModules",
    "urlRedirectionMap",
    "jsModulesInHtml",
    "externalUrlPredicate",
    "externalImportUrlPatternsToExternalUrlPredicate",
    "buildManifest",
    "fileNameToBuildRelativeUrl",
    "buildRelativeUrlToFileName",
    "addFileNameMapping",
    "buildRelativeUrlsUsedInJs",
    "topLevelMappings",
    "buildMappings",
    "rollupBuild",
    "compileServerOriginForRollup",
    "EMPTY_CHUNK_URL",
    "compileDirectoryUrl",
    "resolveDirectoryUrl",
    "compileDirectoryRemoteUrl",
    "nativeModulePredicate",
    "fetchImportmapFromParameter",
    "importmapProjectUrl",
    "importMapFileCompiledUrl",
    "fetchAndNormalizeImportmap",
    "allow404",
    "emitFile",
    "fetchImportmap",
    "rollupFileNameWithoutHash",
    "emitChunk",
    "chunk",
    "jsenvRollupPlugin",
    "buildStart",
    "info",
    "entryPointsPrepared",
    "entryProjectUrl",
    "entryBuildUrl",
    "entryProjectRelativeUrl",
    "entryServerUrl",
    "entryCompiledUrl",
    "entryResponse",
    "fetchModule",
    "htmlSource",
    "importmapHtmlNode",
    "formatUseImportMap",
    "importmapUrl",
    "formatImportmapOutsideCompileDirectory",
    "importmapRaw",
    "importmap",
    "normalizeImportMap",
    "formatIgnoreImportMap",
    "atleastOneChunkEmitted",
    "moduleResponse",
    "urlToProjectUrl",
    "isHtmlEntryPoint",
    "isHtmlEntryPointReferencingAJsModule",
    "htmlCompiledUrl",
    "urlToCompiledUrl",
    "jsModuleUrl",
    "projectUrl",
    "urlToUrlForRollup",
    "previousJsReference",
    "implicitlyLoadedAfterOneOf",
    "resolveId",
    "urlToServerUrl",
    "hasOwnProperty",
    "importUrl",
    "resolveImport",
    "defaultExtension",
    "importProjectUrl",
    "resolveFileUrl",
    "load",
    "moduleInfo",
    "getModuleInfo",
    "responseUrl",
    "contentRaw",
    "loadModule",
    "saveUrlResponseBody",
    "locations",
    "outputOptions",
    "extension",
    "outputExtension",
    "entryFileNames",
    "chunkFileNames",
    "sourcemapPathTransform",
    "relativePath",
    "sourcemapPath",
    "relativePathToUrl",
    "serverUrl",
    "finalUrl",
    "rollupUrl",
    "fixRollupUrl",
    "renderChunk",
    "generateBundle",
    "rollupResult",
    "jsBuild",
    "facadeModuleId",
    "canBeHashed",
    "isEntry",
    "buildRelativeUrlCandidate",
    "assetBuild",
    "originalProjectUrl",
    "originalProjectRelativeUrl",
    "sourcePath",
    "fileBuildUrl",
    "manifestFileUrl",
    "createDetailedMessage",
    "formatBuildDoneDetails",
    "fileCode",
    "sourcemapBuildRelativeUrl",
    "fileSourcemapString",
    "sourcemapBuildUrlRelativeToFileBuildUrl",
    "responseBody",
    "urlToProjectRelativeUrl",
    "projectRelativeUrl",
    "moduleUrl",
    "codeInput",
    "commonData",
    "jsModuleString",
    "responseBodyAsString",
    "moduleResponseBodyAsBuffer",
    "assetReferenceForImport",
    "formatFileNotFound",
    "getResult",
    "buildImportMap",
    "httpIndex",
    "httpsIndex",
    "fileIndex",
    "showImportmapSourceLocation",
    "htmlUrl",
    "importmapResponse",
    "importmapNormalized",
    "build",
    "assetFilenames",
    "assetCount",
    "chunkFilenames",
    "chunkCount",
    "assetDescription",
    "chunkDescription",
    "_",
    "afterHash",
    "details",
    "externalImportUrlStructuredMetaMap",
    "Boolean",
    "buildUsingRollup",
    "globals",
    "globalName",
    "buildDirectoryClean",
    "preserveEntrySignatures",
    "jsConcatenation",
    "serviceWorkers",
    "serviceWorkerFinalizer",
    "useRollup",
    "jsenvBuild",
    "rollup",
    "rollupInputOptions",
    "onwarn",
    "warning",
    "chunkName",
    "input",
    "rollupOutputOptions",
    "preferConst",
    "dir",
    "formatToRollupFormat",
    "rollupReturnValue",
    "createOperation",
    "ensureEmptyDirectory",
    "rollupOutputArray",
    "generate",
    "buildToCompilationResult",
    "mainFileName",
    "trackDependencies",
    "dependencyMap",
    "mainRollupFile",
    "mainFile",
    "parseRollupFile",
    "sourcemapFileRelativeUrlForModule",
    "rollupFile",
    "mainModuleSourcemap",
    "getModuleContent",
    "moduleIndex",
    "contentFromRollupSourcemap",
    "moduleFilePath",
    "moduleFileBuffer",
    "moduleFileString",
    "serveBuild",
    "compileId",
    "isJenvInternalFile",
    "createCompiledFileService",
    "jsenvBrowserBuildUrlRelativeToProject",
    "requestUrl",
    "outDirectoryRemoteUrl",
    "afterOutDirectory",
    "serveFile",
    "rootDirectoryUrl",
    "etagEnabled",
    "remaining",
    "urlToContentType",
    "allowedCompileIds",
    "transformResult",
    "compileIdToBabelPluginMap",
    "compileIdIsForBuildFiles",
    "htmlBeforeCompilation",
    "hasImportmap",
    "inlineScriptsContentMap",
    "scriptAssetUrl",
    "scriptSrc",
    "scriptBasename",
    "scriptOriginalFileUrl",
    "scriptAfterTransformFileUrl",
    "scriptBeforeCompilation",
    "scriptTransformResult",
    "location",
    "getWorstCompileId",
    "compiledIdForGroupMap",
    "babelPluginMapForGroupMap",
    "groupBabelPluginMap",
    "babelPluginRequiredName",
    "startCompileServer",
    "compileServerLogLevel",
    "dev",
    "jsenvDirectoryRelativeUrl",
    "jsenvDirectoryClean",
    "outDirectoryName",
    "projectFileEtagEnabled",
    "env",
    "processEnvNodeEnv",
    "replaceProcessEnvNodeEnv",
    "replaceGlobalObject",
    "replaceGlobalFilename",
    "replaceGlobalDirname",
    "compileServerProtocol",
    "compileServerPrivateKey",
    "compileServerCertificate",
    "compileServerIp",
    "compileServerPort",
    "keepProcessAlive",
    "stopOnPackageVersionChange",
    "compileGroupCount",
    "babelCompatMap",
    "browserScoreMap",
    "nodeVersionScoreMap",
    "livereloadWatchConfig",
    "livereloadLogLevel",
    "customServices",
    "livereloadSSE",
    "assertArguments",
    "jsenvDirectoryUrl",
    "global",
    "__filenameReplacement",
    "__dirname",
    "__dirnameReplacement",
    "compileServerGroupMap",
    "setupOutDirectory",
    "serverStopCancellationSource",
    "createCancellationSource",
    "sseSetup",
    "setupServerSentEventsForLivereload",
    "composeCancellationToken",
    "token",
    "serveSSEForLivereload",
    "createSSEForLivereloadService",
    "trackMainAndDependencies",
    "serveAssetFile",
    "createAssetFileService",
    "serveBrowserScript",
    "createBrowserScriptService",
    "serveCompiledFile",
    "serveProjectFile",
    "createProjectFileService",
    "compileServer",
    "startServer",
    "protocol",
    "http2",
    "privateKey",
    "certificate",
    "ip",
    "port",
    "sendServerTiming",
    "nagle",
    "sendServerInternalErrorDetails",
    "requestToResponse",
    "firstServiceWithTiming",
    "accessControlAllowRequestOrigin",
    "accessControlAllowRequestMethod",
    "accessControlAllowRequestHeaders",
    "accessControlAllowedRequestHeaders",
    "jsenvAccessControlAllowedHeaders",
    "accessControlAllowCredentials",
    "stoppedPromise",
    "cancel",
    "uninstallOutFiles",
    "installOutFiles",
    "onOutFileWritten",
    "outFileUrl",
    "stopListeningJsenvPackageVersionChange",
    "listenJsenvPackageVersionChange",
    "onJsenvPackageVersionChange",
    "stop",
    "STOP_REASON_PACKAGE_VERSION_CHANGED",
    "computeOutDirectoryRelativeUrl",
    "jsenvCorePackageFileUrl",
    "jsenvCorePackageFilePath",
    "jsenvCorePackageVersion",
    "readPackage",
    "outDirectoryMeta",
    "metaFileUrl",
    "previousOutDirectoryMeta",
    "previousMetaString",
    "metaString",
    "livereloadLogger",
    "trackerMap",
    "projectFileRequested",
    "projectFileModified",
    "projectFileRemoved",
    "projectFileAdded",
    "watchDescription",
    "unregisterDirectoryLifecyle",
    "registerDirectoryLifecycle",
    "updated",
    "removed",
    "added",
    "getDependencySet",
    "mainRelativeUrl",
    "dependencySet",
    "unregisterDependencyRequested",
    "dependencyReport",
    "reportDependency",
    "dependency",
    "reason",
    "unregisterMainRemoved",
    "modified",
    "unregisterModified",
    "unregisterRemoved",
    "unregisterAdded",
    "executionId",
    "referer",
    "refererRelativeUrl",
    "urlToOriginalRelativeUrl",
    "tracker",
    "cache",
    "sseRoomLimit",
    "getOrCreateSSERoom",
    "mainFileRelativeUrl",
    "cacheEntry",
    "cacheEntryCandidate",
    "sseRoom",
    "createSSERoom",
    "retryDuration",
    "historyLength",
    "welcomeEvent",
    "stopTracking",
    "sendEvent",
    "shift",
    "accept",
    "fileRelativeUrl",
    "room",
    "searchParams",
    "afterCompileDirectory",
    "pathname",
    "sourcemapMainFileRelativeUrl",
    "sourcemapMappingFileRelativeUrl",
    "method",
    "errorStackRemapping",
    "responsePromise",
    "groupMapToString",
    "envToString",
    "groupMapOutFileUrl",
    "envOutFileUrl",
    "removeFileSystemNode",
    "allowUseless",
    "packageFileUrl",
    "packageFilePath",
    "packageVersion",
    "checkPackageVersion",
    "packageObject",
    "registerFileLifecycle",
    "packagePath",
    "FORMAT_ENTRY_POINTS",
    "commonjs",
    "esmodule",
    "systemjs",
    "buildProject",
    "createCancellationTokenForProcess",
    "collapseWhitespace",
    "filesystemCache",
    "assertEntryPointMap",
    "rollupBuilds",
    "assertBuildDirectoryRelativeUrl",
    "assertBuildDirectoryInsideProject",
    "convertCommonJsWithBabel",
    "transformCommonJs",
    "convertCommonJsWithRollup",
    "replaceProcess",
    "replaceBuffer",
    "convertBuiltinsToBrowser",
    "nodeResolve",
    "createJSONRollupPlugin",
    "createReplaceRollupPlugin",
    "builtins",
    "createNodeGlobalRollupPlugin",
    "nodeBuiltinsRollupPlugin",
    "nodeResolveRollupPlugin",
    "mainFields",
    "jsonRollupPlugin",
    "nodeGlobalRollupPlugin",
    "commonJsRollupPlugin",
    "inlineDynamicImports",
    "generateOptions",
    "createFileCoverage",
    "composeCoverageMap",
    "coverageMaps",
    "finalCoverageMap",
    "coverageMap",
    "merge",
    "coverageA",
    "coverageB",
    "fileCoverage",
    "TIMING_BEFORE_EXECUTION",
    "TIMING_DURING_EXECUTION",
    "TIMING_AFTER_EXECUTION",
    "launchAndExecute",
    "executionLogLevel",
    "launch",
    "stopAfterExecute",
    "stopAfterExecuteReason",
    "gracefulStopAllocatedMs",
    "runtimeConsoleCallback",
    "runtimeStartedCallback",
    "runtimeStoppedCallback",
    "runtimeErrorCallback",
    "runtimeDisconnectCallback",
    "measureDuration",
    "mirrorConsole",
    "captureConsole",
    "collectRuntimeName",
    "collectRuntimeVersion",
    "inheritCoverage",
    "collectCoverage",
    "executionResultTransformer",
    "executionResult",
    "startMs",
    "composeTransformer",
    "endMs",
    "composeCallback",
    "stderr",
    "write",
    "stdout",
    "consoleCalls",
    "collectCoverageSaved",
    "__coverage__",
    "computeRawExecutionResult",
    "previousCallback",
    "previousTransformer",
    "transformer",
    "transformedValue",
    "allocatedMs",
    "hasAllocatedMs",
    "Infinity",
    "computeExecutionResult",
    "TIMEOUT_CANCEL_REASON",
    "setTimeout",
    "timeoutCancellationSource",
    "timeoutCancel",
    "clearTimeout",
    "externalOrTimeoutCancellationToken",
    "errorToCancelReason",
    "createTimedoutExecutionResult",
    "launchOperation",
    "createStoppableOperation",
    "gracefulStop",
    "runtime",
    "stoppedGracefully",
    "gracefulStopPromise",
    "stopPromise",
    "timeoutId",
    "gracefulFailed",
    "race",
    "executeFile",
    "registerErrorCallback",
    "registerConsoleCallback",
    "disconnected",
    "executeOperation",
    "executed",
    "raceResult",
    "promiseTrackRace",
    "winner",
    "createDisconnectedExecutionResult",
    "createErroredExecutionResult",
    "createCompletedExecutionResult",
    "normalizeNamespace",
    "normalized",
    "promiseArray",
    "resolved",
    "visit",
    "promise",
    "execute",
    "ignoreError",
    "executionPromise",
    "babelPluginInstrument",
    "programVisitor",
    "useInlineSourceMaps",
    "coverageConfig",
    "structuredMetaMapForCover",
    "cover",
    "shouldInstrument",
    "optionsToRelativeUrl",
    "__dv__",
    "coverageVariable",
    "exit",
    "generateFileExecutionSteps",
    "filePlan",
    "fileExecutionSteps",
    "stepConfig",
    "generateExecutionSteps",
    "plan",
    "fileResultArray",
    "collectFiles",
    "directoryUrl",
    "executionSteps",
    "createEmptyCoverage",
    "relativeUrlToEmptyCoverage",
    "s",
    "ensureRelativePathsInCoverage",
    "coverageMapRelative",
    "coverageForFile",
    "reportToCoverageMap",
    "report",
    "coverageIncludeMissing",
    "coverageMapForReport",
    "executionReportToCoverageMap",
    "relativeFileUrlToCoverArray",
    "listRelativeFileUrlToCover",
    "relativeFileUrlMissingCoverageArray",
    "relativeFileUrlToCover",
    "coverageMapForMissedFiles",
    "relativeFileUrlMissingCoverage",
    "emptyCoverage",
    "structuredMetaMapForCoverage",
    "matchingFileResultArray",
    "coverageMapArray",
    "executionResultForFile",
    "executionName",
    "executionResultForFileOnRuntime",
    "executionCoverageMap",
    "stringWidth",
    "writeLog",
    "stream",
    "consoleModified",
    "spyConsoleModification",
    "moveCursorToLineAbove",
    "readline",
    "moveCursor",
    "clearCursorLine",
    "clearLine",
    "remove",
    "columns",
    "rows",
    "logLines",
    "visualLineCount",
    "logLine",
    "width",
    "newString",
    "originalStdoutWrite",
    "originalStdErrWrite",
    "encoding",
    "call",
    "uninstall",
    "humanizeDuration",
    "formatDuration",
    "duration",
    "largest",
    "maxDecimalPoints",
    "createSummaryLog",
    "summary",
    "createSummaryMessage",
    "createTotalDurationMessage",
    "executionCount",
    "disconnectedCount",
    "timedoutCount",
    "erroredCount",
    "completedCount",
    "createSummaryDetails",
    "createAllDisconnectedDetails",
    "createAllTimedoutDetails",
    "createAllErroredDetails",
    "createAllCompletedDetails",
    "createMixedDetails",
    "createExecutionResultLog",
    "executionIndex",
    "completedExecutionLogAbbreviation",
    "executionNumber",
    "appendDuration",
    "appendConsole",
    "appendError",
    "consoleOutput",
    "consoleOutputTrimmed",
    "wrapAnsi",
    "executeConcurrently",
    "concurrencyLimit",
    "max",
    "cpus",
    "executionDefaultOptions",
    "logSummary",
    "completedExecutionLogMerging",
    "executionOptionsFromDefault",
    "mainFileNotFoundCallback",
    "beforeExecutionCallback",
    "afterExecutionCallback",
    "allExecutionDoneCancellationSource",
    "executionCancellationToken",
    "previousExecutionResult",
    "previousExecutionLog",
    "createConcurrentOperations",
    "executionOptionsFromStep",
    "executionOptions",
    "beforeExecutionInfo",
    "fileExists",
    "pathLeadsToFile",
    "afterExecutionInfo",
    "loggerToLevels",
    "log",
    "hard",
    "wordWrap",
    "reportToSummary",
    "stat",
    "stats",
    "isFile",
    "fileNames",
    "countResultMatching",
    "fileExecutionResult",
    "fileExecutionResultForRuntime",
    "executePlan",
    "executionIsPassed",
    "generateCoverageJsonFile",
    "coverageJsonFileUrl",
    "generateCoverageHtmlDirectory",
    "htmlDirectoryRelativeUrl",
    "libReport",
    "reports",
    "createCoverageMap",
    "context",
    "createContext",
    "sourceFinder",
    "create",
    "skipEmpty",
    "skipFull",
    "subdir",
    "generateCoverageTextLog",
    "jsenvCoverageConfig",
    "executeTestPlan",
    "testPlan",
    "updateProcessExitCode",
    "argv",
    "coverageAndExecutionAllowed",
    "coverageTextLog",
    "coverageJsonFile",
    "CI",
    "coverageJsonFileLog",
    "coverageJsonFileRelativeUrl",
    "coverageHtmlDirectory",
    "coverageHtmlDirectoryRelativeUrl",
    "coverageHtmlDirectoryIndexLog",
    "cancelError",
    "structuredMetaMapForExecute",
    "patternsMatchingCoverAndExecute",
    "testPlanPattern",
    "exitCode",
    "coverageHtmlDirectoryUrl",
    "htmlCoverageDirectoryIndexFileUrl",
    "getBabelPluginMapForNode",
    "nodeMinimumVersion",
    "decideNodeMinimumVersion",
    "babelPluginMapForNode",
    "jsenvExplorableConfig",
    "jsenvServiceWorkerFinalizer",
    "generatedUrlsConfig",
    "versioned",
    "fileNameContainsHash",
    "trackRessources",
    "callbackArray",
    "registerCleanupCallback",
    "cleanup",
    "localCallbackArray",
    "trackPageToNotify",
    "page",
    "onError",
    "onConsole",
    "removeErrorListener",
    "registerEvent",
    "eventType",
    "removePageErrorListener",
    "removeConsoleListener",
    "consoleMessage",
    "appendNewLine",
    "extractTextFromConsoleMessage",
    "on",
    "removeListener",
    "createSharing",
    "argsToId",
    "argsToIdFallback",
    "tokenMap",
    "getSharingToken",
    "sharingToken",
    "createSharingToken",
    "unusedCallback",
    "getUniqueSharingToken",
    "useCount",
    "sharedValue",
    "isUsed",
    "setSharedValue",
    "cleanupFunction",
    "useSharedValue",
    "stopped",
    "stopUsingReturnValue",
    "stopUsing",
    "evalSource",
    "Script",
    "runInThisContext",
    "escapeRegexpSpecialCharacters",
    "escapedString",
    "char",
    "isRegExpSpecialChar",
    "regexpSpecialChars",
    "executeHtmlFile",
    "assertFilePresence",
    "fileClientUrl",
    "goto",
    "timeout",
    "waitForFunction",
    "__jsenv__",
    "evaluate",
    "executionResultPromise",
    "cancellationRequested",
    "throwIfRequested",
    "fileExecutionResultMap",
    "fileErrored",
    "exceptionSource",
    "evalException",
    "generateCoverageForPage",
    "remoteRootRegexp",
    "chromiumSharing",
    "launchChromium",
    "chromiumExecutablePath",
    "browserServerLogLevel",
    "headless",
    "debugPort",
    "stopOnExit",
    "share",
    "ressourceTracker",
    "launchBrowser",
    "executablePath",
    "devtools",
    "stopUsingBrowser",
    "webSocketEndpoint",
    "wsEndpoint",
    "webSocketUrl",
    "browserEndpoint",
    "host",
    "browserResponse",
    "browserResponseObject",
    "webSocketDebuggerUrl",
    "browserToRuntimeHooks",
    "launchChromiumTab",
    "namedArgs",
    "firefoxSharing",
    "launchFirefox",
    "firefoxExecutablePath",
    "launchFirefoxTab",
    "webkitSharing",
    "launchWebkit",
    "webkitExecutablePath",
    "launchWebkitTab",
    "browserName",
    "browserClass",
    "unregisterProcessTeardown",
    "teardownSignal",
    "addCallback",
    "handleSIGINT",
    "handleSIGTERM",
    "handleSIGHUP",
    "isTargetClosedError",
    "isConnected",
    "disconnectedCallback",
    "close",
    "errorCallbackArray",
    "consoleCallbackArray",
    "ignoreHTTPSErrors",
    "browserContext",
    "newContext",
    "newPage",
    "stopTrackingToNotify",
    "supportsDynamicImport",
    "fileAsString",
    "getCommandArgument",
    "removeCommandArgument",
    "argvCopy",
    "AVAILABLE_DEBUG_MODE",
    "createChildExecArgv",
    "processExecArgv",
    "execArgv",
    "processDebugPort",
    "debugMode",
    "debugModeInheritBreak",
    "traceWarnings",
    "unhandledRejection",
    "jsonModules",
    "childExecArgv",
    "debugModeArg",
    "debugPortArg",
    "getCommandDebugArgs",
    "childDebugMode",
    "childDebugPort",
    "findFreePort",
    "childDebugModeArgName",
    "childDebugPortArgFull",
    "portToArgValue",
    "childDebugArgFull",
    "traceWarningsArg",
    "unhandledRejectionArg",
    "jsonModulesArg",
    "inspectArg",
    "inspectBreakArg",
    "debugArg",
    "debugBreakArg",
    "killProcessTree",
    "EVALUATION_STATUS_OK",
    "SIGINT_SIGNAL_NUMBER",
    "SIGABORT_SIGNAL_NUMBER",
    "SIGTERM_SIGNAL_NUMBER",
    "SIGINT_EXIT_CODE",
    "SIGABORT_EXIT_CODE",
    "SIGTERM_EXIT_CODE",
    "GRACEFUL_STOP_SIGNAL",
    "STOP_SIGNAL",
    "GRACEFUL_STOP_FAILED_SIGNAL",
    "launchNode",
    "dynamicImportSupported",
    "nodeControllableFileUrl",
    "COVERAGE_ENABLED",
    "childProcess",
    "forkChildProcess",
    "stdio",
    "childProcessReadyPromise",
    "onceProcessMessage",
    "installProcessOutputListener",
    "killing",
    "installProcessErrorListener",
    "connected",
    "resolveDisconnect",
    "once",
    "disconnectChildProcess",
    "disconnect",
    "killChildProcess",
    "signal",
    "pid",
    "executeParams",
    "generateSourceToEvaluate",
    "sendToProcess",
    "compileServerOriginRegexp",
    "uneval",
    "functionAllowed",
    "send",
    "stdoutDataCallback",
    "stdErrorDataCallback",
    "errorListener",
    "removeExitListener",
    "onceProcessEvent",
    "createExitWithFailureCodeError",
    "eval",
    "startExploring",
    "explorableConfig",
    "toolbar",
    "livereloading",
    "jsenvToolbarInjectorBuildRelativeUrlForProject",
    "redirectFiles",
    "createRedirectFilesService",
    "serveExploringData",
    "createExploringDataService",
    "serveExplorableListAsJson",
    "createExplorableListAsJsonService",
    "cors",
    "watchAndSyncImportMap",
    "jsenvExploringRedirectorHtmlRelativeUrlForProject",
    "jsenvExploringRedirectorJsBuildRelativeUrlForProject",
    "jsenvToolbarJsBuildRelativeUrlForProject",
    "jsenvExploringRedirectorHtmlServerUrl",
    "jsenvToolbarJsBuildServerUrl",
    "jsenvToolbarJsBuildSourcemapServerUrl",
    "jsenvExploringRedirectorBuildServerUrl",
    "exploringHtmlFileRelativeUrl",
    "structuredMetaMapRelativeForExplorable",
    "explorableGroup",
    "explorableGroupConfig",
    "structuredMetaMapForExplorable",
    "explorableFiles"
  ],
  "mappings": "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"
}