{
  "version": 3,
  "names": [
    "window",
    "__html_supervisor__",
    "executions",
    "addExecution",
    "execution",
    "push",
    "collectScriptResults",
    "Error",
    "superviseScriptTypeModule",
    "superviseScript",
    "src",
    "crossorigin",
    "integrity",
    "type",
    "improveErrorWithFetch",
    "currentScript",
    "document",
    "promise",
    "Promise",
    "resolve",
    "reject",
    "script",
    "createElement",
    "scriptUrl",
    "URL",
    "location",
    "href",
    "lastWindowErrorUrl",
    "lastWindowError",
    "windowErrorCallback",
    "e",
    "filename",
    "error",
    "cleanup",
    "body",
    "removeChild",
    "removeEventListener",
    "addEventListener",
    "appendChild",
    "getScriptExecutionResults",
    "htmlReadyPromise",
    "readyState",
    "loadCallback",
    "then"
  ],
  "sources": [
    "../src/plugins/html_supervisor/client/html_supervisor_setup.js"
  ],
  "sourcesContent": [
    "window.__html_supervisor__ = {\n  // \"html_supervisor_installer.js\" will implement\n  // - \"addExecution\"\n  // - \"collectScriptResults\"\n  // - \"superviseScriptTypeModule\"\n  // and take all executions in \"executions\" and implement their supervision\n  executions: [],\n  addExecution: (execution) => {\n    window.__html_supervisor__.executions.push(execution)\n  },\n  collectScriptResults: () => {\n    throw new Error(\"htmlSupervisor not installed\")\n  },\n  superviseScriptTypeModule: () => {\n    throw new Error(\"htmlSupervisor not installed\")\n  },\n  superviseScript: ({ src, crossorigin, integrity }) => {\n    window.__html_supervisor__.addExecution({\n      type: \"js_classic\",\n      improveErrorWithFetch: true,\n      currentScript: document.currentScript,\n      src,\n      promise: new Promise((resolve, reject) => {\n        const script = document.createElement(\"script\")\n        if (crossorigin) {\n          script.crossorigin = crossorigin\n        }\n        if (integrity) {\n          script.integrity = integrity\n        }\n        script.src = src\n        const scriptUrl = new URL(src, window.location).href\n        let lastWindowErrorUrl\n        let lastWindowError\n        const windowErrorCallback = (e) => {\n          lastWindowErrorUrl = e.filename\n          lastWindowError = e.error\n        }\n        const cleanup = () => {\n          document.body.removeChild(script)\n          window.removeEventListener(\"error\", windowErrorCallback)\n        }\n        window.addEventListener(\"error\", windowErrorCallback)\n        script.addEventListener(\"error\", () => {\n          cleanup()\n          reject(src)\n        })\n        script.addEventListener(\"load\", () => {\n          cleanup()\n          if (lastWindowErrorUrl === scriptUrl) {\n            reject(lastWindowError)\n          } else {\n            resolve()\n          }\n        })\n        document.body.appendChild(script)\n      }),\n    })\n  },\n  getScriptExecutionResults: () => {\n    // wait for page to load before collecting script execution results\n    const htmlReadyPromise = new Promise((resolve) => {\n      if (document.readyState === \"complete\") {\n        resolve()\n        return\n      }\n      const loadCallback = () => {\n        window.removeEventListener(\"load\", loadCallback)\n        resolve()\n      }\n      window.addEventListener(\"load\", loadCallback)\n    })\n    return htmlReadyPromise.then(() => {\n      return window.__html_supervisor__.collectScriptResults()\n    })\n  },\n}\n"
  ],
  "mappings": "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"
}