{
  "version": 3,
  "sources": [
    "../index.js"
  ],
  "names": [
    "createModuleRunner",
    "params",
    "then",
    "server",
    "runInsideNode",
    "file",
    "rest",
    "nodeClient",
    "execute",
    "runInsideChromium",
    "headless",
    "cover",
    "compileURL",
    "chromiumClient",
    "collectCoverage",
    "promise"
  ],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAOA;;AACA;;AACA;;AACA;;AACA;;AACA;;;;;;;;;;AAQO,IAAMA,kBAAkB,GAAG,SAArBA,kBAAqB,CAACC,MAAD,EAAY;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA,SAAO,0CAAkBA,MAAlB,EAA0BC,IAA1B,CAA+B,UAACC,MAAD,EAAY;AAChD,QAAMC,aAAa,GAAG,SAAhBA,aAAgB,OAAuB;AAAA,UAApBC,IAAoB,QAApBA,IAAoB;AAAA,UAAXC,IAAW;;AAC3C,aAAO,oCAAe;AAAEH,QAAAA,MAAM,EAANA;AAAF,OAAf,EAA2BD,IAA3B,CAAgC,UAACK,UAAD,EAAgB;AACrD;AACA,eAAOA,UAAU,CAACC,OAAX;AACLH,UAAAA,IAAI,EAAJA;AADK,WAEFC,IAFE,EAAP;AAID,OANM,CAAP;AAOD,KARD;;AAUA,QAAMG,iBAAiB,GAAG,SAApBA,iBAAoB,QAA8C;AAAA,UAA3CJ,IAA2C,SAA3CA,IAA2C;AAAA,iCAArCK,QAAqC;AAAA,UAArCA,QAAqC,+BAA1B,IAA0B;AAAA,8BAApBC,KAAoB;AAAA,UAApBA,KAAoB,4BAAZ,KAAY;AACtE,aAAO,4CAAmB;AACxBC,QAAAA,UAAU,EAAET,MAAM,CAACS,UADK;AAExBF,QAAAA,QAAQ,EAARA;AAFwB,OAAnB,EAGJR,IAHI,CAGC,UAACW,cAAD,EAAoB;AAC1B,eAAOA,cAAc,CAClBL,OADI,CACI;AACPH,UAAAA,IAAI,EAAJA,IADO;AAEPS,UAAAA,eAAe,EAAEH;AAFV,SADJ,EAKJT,IALI,CAKC;AAAA,cAAGa,OAAH,SAAGA,OAAH;AAAA,iBAAiBA,OAAjB;AAAA,SALD,CAAP;AAMD,OAVM,CAAP;AAWD,KAZD;;AAcA,WAAO;AAAEX,MAAAA,aAAa,EAAbA,aAAF;AAAiBK,MAAAA,iBAAiB,EAAjBA;AAAjB,KAAP;AACD,GA1BM,CAAP;AA2BD,CAtCM",
  "sourcesContent": [
    "// https://github.com/jsenv/core/blob/master/src/api/api.js\n// https://github.com/ModuleLoader/system-register-loader/blob/master/src/system-register-loader.js\n\n// pour le coverage\n// https://github.com/jsenv/core/blob/master/more/test/playground/coverage/run.js\n// https://github.com/jsenv/core/blob/master/more/to-externalize/module-cover/index.js\n\nimport { openChromiumClient } from \"./src/openChromiumClient/openChromiumClient.js\"\nimport { openCompileServer } from \"./src/openCompileServer/openCompileServer.js\"\nimport { openNodeClient } from \"./src/openNodeClient/openNodeClient.js\"\nimport { openBrowserServer } from \"./src/openBrowserServer/openBrowserServer.js\"\nimport { testProject, createCoverageFromTestReport } from \"./src/coverFolder/coverFolder.js\"\nimport { run } from \"./src/run/run.js\"\n\nexport { testProject, createCoverageFromTestReport }\nexport { openCompileServer }\nexport { openBrowserServer }\nexport { openChromiumClient }\nexport { run }\n\nexport const createModuleRunner = (params) => {\n  // if there is already a compileServer running for that location\n  // they will work as long as the code which created them run in the same terminal\n  // if two terminal spawns a server trying to compile a given project they will concurrently\n  // read/write filesystem.\n  // To fix that we could:\n  // - update createLock.js so that, somehow, it can lock calls from different terminals\n  // - save somewhere the port used for that specific project and reuse when existing\n  // save used port is the easiest solution but we'll ignore this issue for now\n  // and assume noone will try to open two server for the same location\n\n  return openCompileServer(params).then((server) => {\n    const runInsideNode = ({ file, ...rest }) => {\n      return openNodeClient({ server }).then((nodeClient) => {\n        // we should return a way to close?\n        return nodeClient.execute({\n          file,\n          ...rest,\n        })\n      })\n    }\n\n    const runInsideChromium = ({ file, headless = true, cover = false }) => {\n      return openChromiumClient({\n        compileURL: server.compileURL,\n        headless,\n      }).then((chromiumClient) => {\n        return chromiumClient\n          .execute({\n            file,\n            collectCoverage: cover,\n          })\n          .then(({ promise }) => promise)\n      })\n    }\n\n    return { runInsideNode, runInsideChromium }\n  })\n}\n"
  ]
}