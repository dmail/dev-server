{"version":3,"sources":["../../../src/openFirefoxClient/openFirefoxClient.js"],"names":["clientFunction","file","setupSource","teardownSource","done","eval","window","System","then","value","status","openFirefoxClient","compileURL","headless","runFile","driver","setup","teardown","executeScriptAsync","toString","Promise","reject","options","Options","forBrowser","setFirefoxOptions","build","title","indexHTML","indexBody","indexRequestHandler","execute","autoClean","collectCoverage","remoteFile","get","url","stop","close","quit"],"mappings":"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","file":"openFirefoxClient.js","sourcesContent":["// https://www.npmjs.com/package/selenium-webdriver\n\n// http://seleniumhq.github.io/selenium/docs/api/javascript/module/selenium-webdriver/index_exports_WebDriver.html\nimport { Builder } from \"selenium-webdriver\"\n// https://github.com/SeleniumHQ/selenium/blob/master/javascript/node/selenium-webdriver/firefox.js#L34\nimport firefox from \"selenium-webdriver/firefox\"\nimport { createHTMLForBrowser } from \"../createHTMLForBrowser.js\"\nimport { openIndexServer } from \"../openIndexServer/openIndexServer.js\"\nimport { getRemoteLocation } from \"../getRemoteLocation.js\"\nimport { getBrowserSetupAndTeardowm } from \"../getClientSetupAndTeardown.js\"\n\nconst clientFunction = (file, setupSource, teardownSource, done) => {\n  eval(setupSource)(file)\n  window.System.import(file)\n    .then(eval(teardownSource))\n    .then(\n      (value) => done({ status: \"resolved\", value }),\n      (value) => done({ status: \"rejected\", value }),\n    )\n}\n\nexport const openFirefoxClient = ({\n  compileURL,\n  headless = true,\n  runFile = ({ driver, file, setup, teardown }) => {\n    return driver\n      .executeScriptAsync(\n        `(${clientFunction.toString()}.apply(this, arguments)`,\n        file,\n        `(${setup.toString()})`,\n        `(${teardown.toString()})`,\n      )\n      .then(({ status, value }) => {\n        return status === \"resolved\" ? value : Promise.reject(value)\n      })\n  },\n}) => {\n  const options = new firefox.Options()\n  if (headless) {\n    options.headless()\n  }\n\n  return new Builder()\n    .forBrowser(\"firefox\")\n    .setFirefoxOptions(options)\n    .build()\n    .then((driver) => {\n      return createHTMLForBrowser({\n        title: \"Skeleton for Firefox\",\n      }).then((indexHTML) => {\n        return openIndexServer({\n          indexBody: indexHTML,\n        }).then((indexRequestHandler) => {\n          const execute = ({ file, autoClean = false, collectCoverage = false }) => {\n            const remoteFile = getRemoteLocation({\n              compileURL,\n\n              file,\n            })\n\n            return driver\n              .get(indexRequestHandler.url)\n              .then(() =>\n                runFile({\n                  driver,\n                  file: remoteFile,\n                  ...getBrowserSetupAndTeardowm({ collectCoverage }),\n                }),\n              )\n              .then(({ status, value }) => {\n                if (autoClean) {\n                  indexRequestHandler.stop()\n                }\n\n                if (status === \"resolved\") {\n                  return value\n                }\n                return Promise.reject(value)\n              })\n          }\n\n          const close = () => {\n            return driver.quit()\n          }\n\n          return { execute, close }\n        })\n      })\n    })\n}\n"]}