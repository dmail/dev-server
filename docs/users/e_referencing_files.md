# E) Referencing files

This page documents "how to reference files within a file".  
For example, it documents how to reference a css file from a js module.

Jsenv relies on web standards to recognize references, consequently this documentation is just listing standard ways to reference files.

# 1. General notes

## 1.1 Leading slash

It's recommended to prefer leading slash instead of `"../"`:

```diff
-  background-image: url(../../logo.png);
+  background-image: url(/src/logo.png);
```

- :+1: create consistent specifiers
- :+1: escape `"../../"` hell.

## 1.2 External urls

External urls, like `https://fonts.googleapis.com/css2?family=Roboto`, are preserved during dev and in the files generated by a build.

## 1.3 Browser compatibility

This page showcases code using recent features. Keep in mind that when a feature is not supported by a browser during dev or after build, code is transformed by jsenv to become compatible. This includes most remarkably:

- script type module
- worker type module
- import assertions
- document.adoptedStylesheets

# 2. HTML

Inside HTML files the following way to reference files are recognized:

```html
<!doctype html>
<html>
  <head>
    <title>Title</title>
    <meta charset="utf-8" />
    <link rel="preload" href="./image.jpg" />
    <link rel="preload" href="./script.js" as="script" />
    <link rel="modulepreload" href="./module.js" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Roboto"
      crossorigin="anonymous"
    />
  </head>

  <body>
    Hello world
    <iframe href="./iframe.html"></iframe>
    <a href="./page.html">page</a>
    <picture>
      <source srcset="image_320.jpg 320w, image_640.jpg 640w" />
      <img src="image.jpg" alt="logo" />
    </picture>
    <script src="script.js"></script>
    <script type="module" src="module.js"></script>
  </body>
</html>
```

☝️ The HTML above list a subset of references to keep it concise, but everything is recognized including [`<link rel="manifest">`](https://developer.mozilla.org/en-US/docs/Web/Manifest#deploying_a_manifest)<sup>↗</sup> for instance.

## 2.1 Inline `<script>` and `<style>`

Jsenv detects code inside `<script>` and `<style>` tags.

```html
<!doctype html>
<html>
  <head>
    <title>Title</title>
    <meta charset="utf-8" />
    <style>
      body {
        background: green;
      }
    </style>
  </head>

  <body>
    <script>
      console.log("hello world");
    </script>
    <script type="module">
      try {
        await import("./main.js");
      } catch (e) {
        console.error(`error while importing "main.js"`);
      }
    </script>
  </body>
</html>
```

# 3. CSS

Inside CSS files the following ways to reference files are recognized:

```css
@import "./file.css";

body {
  background-image: url(./logo.png);
}
```

> **Note**  
> "@import" cannot be used with [4.1 CSS import assertion](#41-css-import-assertion) as explained in https://web.dev/css-module-scripts/#@import-rules-not-yet-allowed<sup>↗</sup>

# 4. JS module

Js module refers to js executed in a context where is has access to `import` and `import.meta`.  
In these files the following is recognized:

## 4.1 CSS import assertion

```js
import sheet from "./style.css" assert { type: "css" };

document.adoptedStyleSheets = [...document.adoptedStyleSheets, sheet];
```

And the dynamic import counterpart

```js
const sheet = await import("./style.css", {
  assert: { type: "css" },
});

document.adoptedStyleSheets = [...document.adoptedStyleSheets, sheet];
```

## 4.2 CSS urls

```js
const cssUrl = new URL("./style.css", import.meta.url);
const link = document.createElement("link");
link.rel = "stylesheet";
link.href = cssUrl;
document.head.appendChild(link);
```

Or

```diff
- const cssUrl = new URL("./style.css", import.meta.url);
+ const cssUrl = import.meta.resolve("./style.css");
```

## 4.3 Image urls

```js
const imageUrl = new URL("./img.png", import.meta.url);
const img = document.createElement("img");
img.src = imageUrl;
document.body.appendChild(img);
```

Or

```diff
- const imageUrl = new URL("./img.png", import.meta.url);
+ const imageUrl = import.meta.resolve("./img.png");
```

## 4.4 Worker urls

Depending how the worker file is written one of the 2 solutions below must be used

1. Classic worker

```js
const worker = new Worker(new URL("/worker.js", import.meta.url));
```

2. Module worker

```js
const worker = new Worker(new URL("/worker.js", import.meta.url), {
  type: "module",
});
```

Jsenv also recognize [serviceWorker.register()](https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorkerContainer/register)<sup>↗</sup> and [new SharedWorker()](https://developer.mozilla.org/en-US/docs/Web/API/SharedWorker)<sup>↗</sup>.

Here again `import.meta.resolve` can be used

```diff
-   new URL("/worker.js", import.meta.url);
+   import.meta.resolve("/worker.js");
```

## 4.5 JSON import assertion

```js
import data from "./data.json" assert { type: "json" };

console.log(data);
```

And the dynamic import counterpart

```js
const jsonModule = await import("./data.json", {
  assert: { type: "json" },
});

console.log(jsonModule.default);
```

## 4.6 Text import assertion

Gives the textual content of a file within a js module.

**not standard**: Jsenv support this but it's not part of web standards.

```js
import text from "./data.txt" assert { type: "text" };

console.log(text);
```

# 5. JS classic

`document.currentScript.src` can be used as substitute of `import.meta.url` when js is executed by `<script></script>`.

```js
const imageUrl = new URL("./img.png", document.currentScript.src);

const img = document.createElement("img");
img.src = imageUrl;
document.body.appendChild(img);
```

Finally when js is inline into html, use `window.location` instead of `document.currentScript.src`.

```diff
- const jsonUrl = new URL("./data.json", document.currentScript.src);
+ const jsonUrl = new URL('./file.json', window.location);
```

<table>
 <tr>
  <td width="2000px" align="left" nowrap>
   <a href="./d_test.md">< D) Test</a>
  </td>
  <td width="2000px" align="right" nowrap>
   <a href="./f_features.md">> F) Features</a>
  </td>
 </tr>
<table>
