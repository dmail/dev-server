<!-- TITLE: E) Referencing files -->

<!-- PLACEHOLDER_START:NAV_PREV_NEXT -->

<table>
  <tr>
    <td width="2000px" align="left" nowrap>
      <a href="../d_test/d_test.md">&lt; D) Test</a>
    </td>
    <td width="2000px" align="center" nowrap>
      E) Referencing files
    </td>
    <td width="2000px" align="right" nowrap>
      <a href="../f_features/f_features.md">&gt; F) Features</a>
    </td>
  </tr>
<table>

<!-- PLACEHOLDER_END -->

This page documents "how to reference files within a file".  
For example, it documents how to reference a css file from a js module.

Jsenv relies on web standards to recognize references, consequently this documentation is just listing standard ways to reference files.

<!-- PLACEHOLDER_START:TOC -->

<details>
  <summary>Table of contents</summary>
  <ul>
    <li>
      <a href="#1-general-notes">
        1. General notes
      </a>
        <ul>
          <li>
            <a href="#11-leading-slash">
              1.1 Leading slash
            </a>
          </li>
          <li>
            <a href="#12-external-urls">
              1.2 External urls
            </a>
          </li>
          <li>
            <a href="#13-browser-compatibility">
              1.3 Browser compatibility
            </a>
          </li>
        </ul>
    </li>
    <li>
      <a href="#2-html">
        2. HTML
      </a>
        <ul>
          <li>
            <a href="#21-inline">
              2.1 Inline 
            </a>
          </li>
        </ul>
    </li>
    <li>
      <a href="#3-css">
        3. CSS
      </a>
    </li>
    <li>
      <a href="#4-js-module">
        4. JS module
      </a>
        <ul>
          <li>
            <a href="#41-css-import">
              4.1 CSS import
            </a>
          </li>
          <li>
            <a href="#42-urls">
              4.2 Urls
            </a>
          </li>
          <li>
            <a href="#43-worker-urls">
              4.3 Worker urls
            </a>
          </li>
          <li>
            <a href="#45-json-import">
              4.5 JSON import
            </a>
          </li>
          <li>
            <a href="#46-text-import">
              4.6 Text import
            </a>
          </li>
        </ul>
    </li>
    <li>
      <a href="#5-js-classic">
        5. JS classic
      </a>
    </li>
  </ul>
</details>

<!-- PLACEHOLDER_END -->

# 1. General notes

## 1.1 Leading slash

It's recommended to prefer leading slash instead of `"../"`:

```diff
-  background-image: url(../../logo.png);
+  background-image: url(/logo.png);
```

- :+1: create consistent specifiers
- :+1: escape `"../../"` hell.

## 1.2 External urls

External urls, like `https://fonts.googleapis.com/css2?family=Roboto`, are preserved during dev and in the files generated by a build.

## 1.3 Browser compatibility

This page showcases code using recent features. Keep in mind that when a feature is not supported by a browser during dev or after build, code is transformed by jsenv to become compatible. This includes most remarkably:

- script type module
- worker type module
- import attributes
- document.adoptedStylesheets

# 2. HTML

Inside HTML files the following way to reference files are recognized:

```html
<!doctype html>
<html>
  <head>
    <title>Title</title>
    <meta charset="utf-8" />
    <link rel="preload" href="./image.jpg" />
    <link rel="preload" href="./script.js" as="script" />
    <link rel="modulepreload" href="./module.js" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Roboto"
      crossorigin="anonymous"
    />
  </head>

  <body>
    Hello world
    <iframe href="./iframe.html"></iframe>
    <a href="./page.html">page</a>
    <picture>
      <source srcset="image_320.jpg 320w, image_640.jpg 640w" />
      <img src="image.jpg" alt="logo" />
    </picture>
    <script src="script.js"></script>
    <script type="module" src="module.js"></script>
  </body>
</html>
```

☝️ The HTML above list a subset of references to keep it concise, but everything is recognized including [`<link rel="manifest">`](https://developer.mozilla.org/en-US/docs/Web/Manifest#deploying_a_manifest)<sup>↗</sup> for instance.

## 2.1 Inline `<script>` and `<style>`

Jsenv detects code inside `<script>` and `<style>` tags.

```html
<!doctype html>
<html>
  <head>
    <title>Title</title>
    <meta charset="utf-8" />
    <style>
      body {
        background: green;
      }
    </style>
  </head>

  <body>
    <script>
      console.log("hello world");
    </script>
    <script type="module">
      try {
        await import("./main.js");
      } catch (e) {
        console.error(`error while importing "main.js"`);
      }
    </script>
  </body>
</html>
```

# 3. CSS

Inside CSS files the following ways to reference files are recognized:

```css
@import "./file.css";

body {
  background-image: url(./logo.png);
}
```

> **Note**  
> "@import" cannot be used with [4.1 CSS import](#41-css-import) as explained in https://web.dev/css-module-scripts/#@import-rules-not-yet-allowed<sup>↗</sup>

# 4. JS module

Js module refers to js executed in a context where is has access to `import` and `import.meta`.  
In these files the following is recognized:

## 4.1 CSS import

```js
import sheet from "./style.css" with { type: "css" };

document.adoptedStyleSheets = [...document.adoptedStyleSheets, sheet];
```

And the dynamic import equivalent

```js
const sheet = await import("./style.css", {
  with: { type: "css" },
});

document.adoptedStyleSheets = [...document.adoptedStyleSheets, sheet];
```

## 4.2 Urls

You can use [URL](https://developer.mozilla.org/en-US/docs/Web/API/URL/URL)<sup>↗</sup> constructor to reference an other file:

```js
const textUrl = new URL("./file.txt", import.meta.url);
```

You can also use [import.meta.resolve](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/import.meta/resolve)<sup>↗</sup>:

```diff
- const textUrl = new URL("./file.txt", import.meta.url);
+ const textUrl = import.meta.resolve("./file.txt");
```

The way you want to use that url afterwards is up to you; some prevalant uses cases:

```js
// inject css in the document
const cssUrl = new URL("./style.css", import.meta.url);
const link = document.createElement("link");
link.rel = "stylesheet";
link.href = cssUrl;
document.head.appendChild(link);

// inject an image in the document
const imageUrl = new URL("./img.png", import.meta.url);
const img = document.createElement("img");
img.src = imageUrl;
document.body.appendChild(img);
```

## 4.3 Worker urls

Depending how the worker file is written one of the 2 solutions below must be used

1. Classic worker

```js
const worker = new Worker(new URL("/worker.js", import.meta.url));
```

2. Module worker

```js
const worker = new Worker(new URL("/worker.js", import.meta.url), {
  type: "module",
});
```

Jsenv also recognize [serviceWorker.register()](https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorkerContainer/register)<sup>↗</sup> and [new SharedWorker()](https://developer.mozilla.org/en-US/docs/Web/API/SharedWorker)<sup>↗</sup>.

Here again `import.meta.resolve` can be used

```diff
-   new URL("/worker.js", import.meta.url);
+   import.meta.resolve("/worker.js");
```

## 4.5 JSON import

```js
import data from "./data.json" with { type: "json" };

console.log(data);
```

And the dynamic import equivalent

```js
const jsonModule = await import("./data.json", {
  with: { type: "json" },
});

console.log(jsonModule.default);
```

## 4.6 Text import

Gives the textual content of a file within a js module.

**not standard**: Jsenv support this but it's not part of web standards.

```js
import text from "./data.txt" with { type: "text" };

console.log(text);
```

# 5. JS classic

When js is loaded by `<script></script>`, `import.meta.url` is not available. In that case `document.currentScript.src` must be used.

```html
<script src="./file.js"></script>
```

_file.js_:

```js
const imageUrl = new URL("./img.png", document.currentScript.src);

const img = document.createElement("img");
img.src = imageUrl;
document.body.appendChild(img);
```

When js is inlined between `<script>` tags inside html `window.location` must be used.

```diff
<script>
-   const jsonUrl = new URL("./data.json", document.currentScript.src);
+   const jsonUrl = new URL('./file.json', window.location);
</script>
```

It is because in this situation `document.currentScript.src` would be `undefined`.

<!-- PLACEHOLDER_START:NAV_PREV_NEXT -->

<table>
  <tr>
    <td width="2000px" align="left" nowrap>
      <a href="../d_test/d_test.md">&lt; D) Test</a>
    </td>
    <td width="2000px" align="center" nowrap>
      E) Referencing files
    </td>
    <td width="2000px" align="right" nowrap>
      <a href="../f_features/f_features.md">&gt; F) Features</a>
    </td>
  </tr>
<table>

<!-- PLACEHOLDER_END -->
