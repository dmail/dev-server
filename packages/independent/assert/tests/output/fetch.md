# fetch.md

<sub>
  Generated by <a href="https://github.com/jsenv/core/tree/main/packages/independent/snapshot">@jsenv/snapshot</a> executing <a href="../fetch.test.js">../fetch.test.js</a>
</sub>

## abort signal pending vs aborted

```js
const expectAbortController = new AbortController();
expectAbortController.abort("toto");
assert({
  actual: new AbortController().signal,
  expect: expectAbortController.signal,
});
```

```console
AssertionError: actual and expect are different

actual: AbortSignal
expect: AbortSignal {
  aborted: true,
  reason: "toto",
}
```

<details>
  <summary>see colored</summary>

  <img src="fetch/abort_signal_pending_vs_aborted_throw.svg" alt="img" />

</details>


## request url diff

```js
assert({
  actual: new Request("https://foo.com"),
  expect: new Request("https://bar.com"),
});
```

```console
AssertionError: actual and expect are different

actual: Request("https://foo.com/")
expect: Request("https://bar.com/")
```

<details>
  <summary>see colored</summary>

  <img src="fetch/request_url_diff_throw.svg" alt="img" />

</details>


## request with custom options

```js
assert({
  actual: new Request("http://example.com", {
    cache: "default",
    credentials: "same-origin",
    destination: "",
    method: "GET",
    mode: "cors",
    priority: "auto",
    redirect: "follow",
    referrerPolicy: "",
    referrer: "about:client",
  }),
  expect: new Request("http://example.com", {
    body: '{"foo": "bar"}',
    cache: "no-store",
    credentials: "omit",
    destination: "document",
    headers: { from: "developer@example.org" },
    method: "POST",
    mode: "same-origin",
    priority: "high",
    redirect: "manual",
    referrerPolicy: "strict-origin",
    referrer: "http://google.com",
  }),
  MAX_CONTEXT_AFTER_DIFF: 10,
  MAX_CONTEXT_BEFORE_DIFF: 10,
  MAX_DEPTH_INSIDE_DIFF: 5,
});
```

```console
AssertionError: actual and expect are different

actual: Request("http://example.com/")
expect: Request("http://example.com/", {
  body: ReadableStream,
  cache: "no-store",
  credentials: "omit",
  headers: Headers(
    "from" => "developer@example.org",
  ),
  method: "POST",
  mode: "same-origin",
  redirect: "manual",
  referrerPolicy: "strict-origin",
  referrer: "http://google.com/",
})
```

<details>
  <summary>see colored</summary>

  <img src="fetch/request_with_custom_options_throw.svg" alt="img" />

</details>


## request abort signal pending vs aborted

```js
const expectAbortController = new AbortController();
expectAbortController.abort("toto");
assert({
  actual: new Request("http://example.com", {
    signal: new AbortController().signal,
  }),
  expect: new Request("http://example.com", {
    signal: expectAbortController.signal,
  }),
});
```

```console
AssertionError: actual and expect are different

actual: Request("http://example.com/")
expect: Request("http://example.com/", {
  signal: AbortSignal {
    aborted: true,
    reason: "toto",
  },
})
```

<details>
  <summary>see colored</summary>

  <img src="fetch/request_abort_signal_pending_vs_aborted_throw.svg" alt="img" />

</details>


## response body diff

```js
assert({
  actual: {
    a: new Response("foo"),
    b: true,
  },
  expect: {
    a: new Response("bar"),
    b: false,
  },
});
```

```console
AssertionError: actual and expect are different

actual: {
  a: Response(ReadableStream, { status: 200 }),
  b: true,
}
expect: {
  a: Response(ReadableStream, { status: 200 }),
  b: false,
}
```

<details>
  <summary>see colored</summary>

  <img src="fetch/response_body_diff_throw.svg" alt="img" />

</details>


## response status diff

```js
assert({
  actual: new Response("", {
    status: 200,
  }),
  expect: new Response("", {
    status: 400,
  }),
});
```

```console
AssertionError: actual and expect are different

actual: Response(ReadableStream, {
  status: 200,
})
expect: Response(ReadableStream, {
  status: 400,
})
```

<details>
  <summary>see colored</summary>

  <img src="fetch/response_status_diff_throw.svg" alt="img" />

</details>


## response prop diff

```js
assert({
  actual: new Response("", {
    status: 200,
    statusText: "",
    type: "basic",
  }),
  expect: new Response("", {
    status: 400,
    statusText: "Bad request",
    headers: {
      "content-length": "0",
    },
    type: "opaque",
  }),
  MAX_CONTEXT_BEFORE_DIFF: 8,
  MAX_CONTEXT_AFTER_DIFF: 8,
});
```

```console
AssertionError: actual and expect are different

actual: Response(ReadableStream, {
  headers: Headers(
    "content-type" => "text/plain;charset=UTF-8",
  ),
  status: 200,
})
expect: Response(ReadableStream, {
  headers: Headers(
    "content-length" => "0"
  ),
  status: 400,
  statusText: "Bad request",
})
```

<details>
  <summary>see colored</summary>

  <img src="fetch/response_prop_diff_throw.svg" alt="img" />

</details>


## redirected response

```js
assert({
  actual: new Response("", { status: 200 }),
  expect: Response.redirect("http://example.com"),
});
```

```console
AssertionError: actual and expect are different

actual: Response(ReadableStream, {
  headers: Headers(
    "content-type" => "text/plain;charset=UTF-8",
  ),
  status: 200,
})
expect: Response(null, {
  headers: Headers(
    "location" => "http://example.com/",
  ),
  status: 302,
})
```

<details>
  <summary>see colored</summary>

  <img src="fetch/redirected_response_throw.svg" alt="img" />

</details>
