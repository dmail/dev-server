<html>

<head></head>

<body>
	<a href="./build-chrome/file.es5.js/file.es5.js">./build-chrome/file.es5.js/file.es5.js</a>
	<script type="text/javascript">
		function replaceSourceMappingURL(source, how) {
			var sourceMappingUrlRegExp = /\/\/[#@] ?sourceMappingURL=([^\s'"]+)\s*$/mg;
			var lastSourceMappingUrl;
			var matchSourceMappingUrl;
			while (matchSourceMappingUrl = sourceMappingUrlRegExp.exec(source)) {
				debugger
				lastSourceMappingUrl = matchSourceMappingUrl
			}
			if (lastSourceMappingUrl) {
				source.slice(0, lastSourceMappingUrl.index) + source.slice(lastSourceMappingUrl.index).replace(sourceMappingUrlRegExp, how())
			}
			return lastSourceMappingUrl || null
		}

		const fetchUsingXHR = (url) => {
			return new Promise((resolve, reject) => {
				const xhr = new XMLHttpRequest()

				const load = () => {
					resolve(xhr.responseText)
				}

				const error = () => {
					reject(
						new Error(
							`XHR error (status: ${xhr.status}, text: ${xhr.statusText}) loading ${url})`
						)
					)
				}

				xhr.onreadystatechange = () => {
					if (xhr.readyState === 4) {
						// in Chrome on file:/// URLs, status is 0
						if (xhr.status === 0) {
							if (xhr.responseText) {
								load()
							}
							else {
								// when responseText is empty, wait for load or error event
								// to inform if it is a 404 or empty file
								xhr.addEventListener('error', error)
								xhr.addEventListener('load', load)
							}
						}
						else if (xhr.status === 200) {
							load()
						}
						else {
							error()
						}
					}
				}
				xhr.open("GET", url, true)
				xhr.send(null)
			})
		}

		fetchUsingXHR('./compiled/file.es5.js').then((content) => {
			const sourceMapURL = findSourceMappingURL(content)
			debugger


			content = `${content}
			//# sourceURL=compiled/file.es5.js`

			eval(content)
		})
	</script>
</body>

</html>
